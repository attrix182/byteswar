var N9=Object.defineProperty;var X9=(r,e,t)=>e in r?N9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var To=(r,e,t)=>X9(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();var Y9=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function UN(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var aF={exports:{}},zV={},sF={exports:{}},dR={exports:{}};dR.exports;(function(r,e){/**
 * @license React
 * react.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var t="18.3.1",n=Symbol.for("react.element"),a=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),d=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),Z=Symbol.for("react.lazy"),V=Symbol.for("react.offscreen"),R=Symbol.iterator,S="@@iterator";function N(L){if(L===null||typeof L!="object")return null;var le=R&&L[R]||L[S];return typeof le=="function"?le:null}var w={current:null},X={transition:null},H={current:null,isBatchingLegacy:!1,didScheduleLegacyUpdate:!1},F={current:null},_={},P=null;function K(L){P=L}_.setExtraStackFrame=function(L){P=L},_.getCurrentStack=null,_.getStackAddendum=function(){var L="";P&&(L+=P);var le=_.getCurrentStack;return le&&(L+=le()||""),L};var E=!1,ee=!1,Ie=!1,be=!1,se=!1,Ce={ReactCurrentDispatcher:w,ReactCurrentBatchConfig:X,ReactCurrentOwner:F};Ce.ReactDebugCurrentFrame=_,Ce.ReactCurrentActQueue=H;function he(L){{for(var le=arguments.length,Ke=new Array(le>1?le-1:0),Je=1;Je<le;Je++)Ke[Je-1]=arguments[Je];ve("warn",L,Ke)}}function Be(L){{for(var le=arguments.length,Ke=new Array(le>1?le-1:0),Je=1;Je<le;Je++)Ke[Je-1]=arguments[Je];ve("error",L,Ke)}}function ve(L,le,Ke){{var Je=Ce.ReactDebugCurrentFrame,Nt=Je.getStackAddendum();Nt!==""&&(le+="%s",Ke=Ke.concat([Nt]));var yn=Ke.map(function(sn){return String(sn)});yn.unshift("Warning: "+le),Function.prototype.apply.call(console[L],console,yn)}}var we={};function me(L,le){{var Ke=L.constructor,Je=Ke&&(Ke.displayName||Ke.name)||"ReactClass",Nt=Je+"."+le;if(we[Nt])return;Be("Can't call %s on a component that is not yet mounted. This is a no-op, but it might indicate a bug in your application. Instead, assign to `this.state` directly or define a `state = {};` class property with the desired state in the %s component.",le,Je),we[Nt]=!0}}var Xe={isMounted:function(L){return!1},enqueueForceUpdate:function(L,le,Ke){me(L,"forceUpdate")},enqueueReplaceState:function(L,le,Ke,Je){me(L,"replaceState")},enqueueSetState:function(L,le,Ke,Je){me(L,"setState")}},Ue=Object.assign,de={};Object.freeze(de);function Ee(L,le,Ke){this.props=L,this.context=le,this.refs=de,this.updater=Ke||Xe}Ee.prototype.isReactComponent={},Ee.prototype.setState=function(L,le){if(typeof L!="object"&&typeof L!="function"&&L!=null)throw new Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,L,le,"setState")},Ee.prototype.forceUpdate=function(L){this.updater.enqueueForceUpdate(this,L,"forceUpdate")};{var At={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see https://github.com/facebook/react/issues/3236)."]},Zt=function(L,le){Object.defineProperty(Ee.prototype,L,{get:function(){he("%s(...) is deprecated in plain JavaScript React classes. %s",le[0],le[1])}})};for(var Bt in At)At.hasOwnProperty(Bt)&&Zt(Bt,At[Bt])}function kt(){}kt.prototype=Ee.prototype;function $t(L,le,Ke){this.props=L,this.context=le,this.refs=de,this.updater=Ke||Xe}var Xt=$t.prototype=new kt;Xt.constructor=$t,Ue(Xt,Ee.prototype),Xt.isPureReactComponent=!0;function Ot(){var L={current:null};return Object.seal(L),L}var oe=Array.isArray;function ut(L){return oe(L)}function _e(L){{var le=typeof Symbol=="function"&&Symbol.toStringTag,Ke=le&&L[Symbol.toStringTag]||L.constructor.name||"Object";return Ke}}function it(L){try{return Te(L),!1}catch{return!0}}function Te(L){return""+L}function Et(L){if(it(L))return Be("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",_e(L)),Te(L)}function Wt(L,le,Ke){var Je=L.displayName;if(Je)return Je;var Nt=le.displayName||le.name||"";return Nt!==""?Ke+"("+Nt+")":Ke}function O(L){return L.displayName||"Context"}function k(L){if(L==null)return null;if(typeof L.tag=="number"&&Be("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof L=="function")return L.displayName||L.name||null;if(typeof L=="string")return L;switch(L){case o:return"Fragment";case a:return"Portal";case I:return"Profiler";case c:return"StrictMode";case b:return"Suspense";case v:return"SuspenseList"}if(typeof L=="object")switch(L.$$typeof){case d:var le=L;return O(le)+".Consumer";case C:var Ke=L;return O(Ke._context)+".Provider";case f:return Wt(L,L.render,"ForwardRef");case y:var Je=L.displayName||null;return Je!==null?Je:k(L.type)||"Memo";case Z:{var Nt=L,yn=Nt._payload,sn=Nt._init;try{return k(sn(yn))}catch{return null}}}return null}var Ae=Object.prototype.hasOwnProperty,Oe={key:!0,ref:!0,__self:!0,__source:!0},$e,et,Yt;Yt={};function vt(L){if(Ae.call(L,"ref")){var le=Object.getOwnPropertyDescriptor(L,"ref").get;if(le&&le.isReactWarning)return!1}return L.ref!==void 0}function Vt(L){if(Ae.call(L,"key")){var le=Object.getOwnPropertyDescriptor(L,"key").get;if(le&&le.isReactWarning)return!1}return L.key!==void 0}function tn(L,le){var Ke=function(){$e||($e=!0,Be("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",le))};Ke.isReactWarning=!0,Object.defineProperty(L,"key",{get:Ke,configurable:!0})}function un(L,le){var Ke=function(){et||(et=!0,Be("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",le))};Ke.isReactWarning=!0,Object.defineProperty(L,"ref",{get:Ke,configurable:!0})}function ae(L){if(typeof L.ref=="string"&&F.current&&L.__self&&F.current.stateNode!==L.__self){var le=k(F.current.type);Yt[le]||(Be('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',le,L.ref),Yt[le]=!0)}}var Le=function(L,le,Ke,Je,Nt,yn,sn){var xn={$$typeof:n,type:L,key:le,ref:Ke,props:sn,_owner:yn};return xn._store={},Object.defineProperty(xn._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(xn,"_self",{configurable:!1,enumerable:!1,writable:!1,value:Je}),Object.defineProperty(xn,"_source",{configurable:!1,enumerable:!1,writable:!1,value:Nt}),Object.freeze&&(Object.freeze(xn.props),Object.freeze(xn)),xn};function at(L,le,Ke){var Je,Nt={},yn=null,sn=null,xn=null,Jn=null;if(le!=null){vt(le)&&(sn=le.ref,ae(le)),Vt(le)&&(Et(le.key),yn=""+le.key),xn=le.__self===void 0?null:le.__self,Jn=le.__source===void 0?null:le.__source;for(Je in le)Ae.call(le,Je)&&!Oe.hasOwnProperty(Je)&&(Nt[Je]=le[Je])}var ui=arguments.length-2;if(ui===1)Nt.children=Ke;else if(ui>1){for(var Hi=Array(ui),Gi=0;Gi<ui;Gi++)Hi[Gi]=arguments[Gi+2];Object.freeze&&Object.freeze(Hi),Nt.children=Hi}if(L&&L.defaultProps){var Ln=L.defaultProps;for(Je in Ln)Nt[Je]===void 0&&(Nt[Je]=Ln[Je])}if(yn||sn){var Pi=typeof L=="function"?L.displayName||L.name||"Unknown":L;yn&&tn(Nt,Pi),sn&&un(Nt,Pi)}return Le(L,yn,sn,xn,Jn,F.current,Nt)}function Pe(L,le){var Ke=Le(L.type,le,L.ref,L._self,L._source,L._owner,L.props);return Ke}function pt(L,le,Ke){if(L==null)throw new Error("React.cloneElement(...): The argument must be a React element, but you passed "+L+".");var Je,Nt=Ue({},L.props),yn=L.key,sn=L.ref,xn=L._self,Jn=L._source,ui=L._owner;if(le!=null){vt(le)&&(sn=le.ref,ui=F.current),Vt(le)&&(Et(le.key),yn=""+le.key);var Hi;L.type&&L.type.defaultProps&&(Hi=L.type.defaultProps);for(Je in le)Ae.call(le,Je)&&!Oe.hasOwnProperty(Je)&&(le[Je]===void 0&&Hi!==void 0?Nt[Je]=Hi[Je]:Nt[Je]=le[Je])}var Gi=arguments.length-2;if(Gi===1)Nt.children=Ke;else if(Gi>1){for(var Ln=Array(Gi),Pi=0;Pi<Gi;Pi++)Ln[Pi]=arguments[Pi+2];Nt.children=Ln}return Le(L.type,yn,sn,xn,Jn,ui,Nt)}function Ct(L){return typeof L=="object"&&L!==null&&L.$$typeof===n}var q=".",ye=":";function gt(L){var le=/[=:]/g,Ke={"=":"=0",":":"=2"},Je=L.replace(le,function(Nt){return Ke[Nt]});return"$"+Je}var De=!1,Ne=/\/+/g;function ce(L){return L.replace(Ne,"$&/")}function dt(L,le){return typeof L=="object"&&L!==null&&L.key!=null?(Et(L.key),gt(""+L.key)):le.toString(36)}function wt(L,le,Ke,Je,Nt){var yn=typeof L;(yn==="undefined"||yn==="boolean")&&(L=null);var sn=!1;if(L===null)sn=!0;else switch(yn){case"string":case"number":sn=!0;break;case"object":switch(L.$$typeof){case n:case a:sn=!0}}if(sn){var xn=L,Jn=Nt(xn),ui=Je===""?q+dt(xn,0):Je;if(ut(Jn)){var Hi="";ui!=null&&(Hi=ce(ui)+"/"),wt(Jn,le,Hi,"",function(vb){return vb})}else Jn!=null&&(Ct(Jn)&&(Jn.key&&(!xn||xn.key!==Jn.key)&&Et(Jn.key),Jn=Pe(Jn,Ke+(Jn.key&&(!xn||xn.key!==Jn.key)?ce(""+Jn.key)+"/":"")+ui)),le.push(Jn));return 1}var Gi,Ln,Pi=0,ma=Je===""?q:Je+ye;if(ut(L))for(var Pc=0;Pc<L.length;Pc++)Gi=L[Pc],Ln=ma+dt(Gi,Pc),Pi+=wt(Gi,le,Ke,Ln,Nt);else{var CC=N(L);if(typeof CC=="function"){var Dl=L;CC===Dl.entries&&(De||he("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),De=!0);for(var hC=CC.call(Dl),SI,bb=0;!(SI=hC.next()).done;)Gi=SI.value,Ln=ma+dt(Gi,bb++),Pi+=wt(Gi,le,Ke,Ln,Nt)}else if(yn==="object"){var TA=String(L);throw new Error("Objects are not valid as a React child (found: "+(TA==="[object Object]"?"object with keys {"+Object.keys(L).join(", ")+"}":TA)+"). If you meant to render a collection of children, use an array instead.")}}return Pi}function rn(L,le,Ke){if(L==null)return L;var Je=[],Nt=0;return wt(L,Je,"","",function(yn){return le.call(Ke,yn,Nt++)}),Je}function mt(L){var le=0;return rn(L,function(){le++}),le}function mn(L,le,Ke){rn(L,function(){le.apply(this,arguments)},Ke)}function Wn(L){return rn(L,function(le){return le})||[]}function zn(L){if(!Ct(L))throw new Error("React.Children.only expected to receive a single React element child.");return L}function Dn(L){var le={$$typeof:d,_currentValue:L,_currentValue2:L,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null};le.Provider={$$typeof:C,_context:le};var Ke=!1,Je=!1,Nt=!1;{var yn={$$typeof:d,_context:le};Object.defineProperties(yn,{Provider:{get:function(){return Je||(Je=!0,Be("Rendering <Context.Consumer.Provider> is not supported and will be removed in a future major release. Did you mean to render <Context.Provider> instead?")),le.Provider},set:function(sn){le.Provider=sn}},_currentValue:{get:function(){return le._currentValue},set:function(sn){le._currentValue=sn}},_currentValue2:{get:function(){return le._currentValue2},set:function(sn){le._currentValue2=sn}},_threadCount:{get:function(){return le._threadCount},set:function(sn){le._threadCount=sn}},Consumer:{get:function(){return Ke||(Ke=!0,Be("Rendering <Context.Consumer.Consumer> is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?")),le.Consumer}},displayName:{get:function(){return le.displayName},set:function(sn){Nt||(he("Setting `displayName` on Context.Consumer has no effect. You should set it directly on the context with Context.displayName = '%s'.",sn),Nt=!0)}}}),le.Consumer=yn}return le._currentRenderer=null,le._currentRenderer2=null,le}var In=-1,fi=0,ci=1,is=2;function Rr(L){if(L._status===In){var le=L._result,Ke=le();if(Ke.then(function(yn){if(L._status===fi||L._status===In){var sn=L;sn._status=ci,sn._result=yn}},function(yn){if(L._status===fi||L._status===In){var sn=L;sn._status=is,sn._result=yn}}),L._status===In){var Je=L;Je._status=fi,Je._result=Ke}}if(L._status===ci){var Nt=L._result;return Nt===void 0&&Be(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))

Did you accidentally put curly braces around the import?`,Nt),"default"in Nt||Be(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))`,Nt),Nt.default}else throw L._result}function re(L){var le={_status:In,_result:L},Ke={$$typeof:Z,_payload:le,_init:Rr};{var Je,Nt;Object.defineProperties(Ke,{defaultProps:{configurable:!0,get:function(){return Je},set:function(yn){Be("React.lazy(...): It is not supported to assign `defaultProps` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),Je=yn,Object.defineProperty(Ke,"defaultProps",{enumerable:!0})}},propTypes:{configurable:!0,get:function(){return Nt},set:function(yn){Be("React.lazy(...): It is not supported to assign `propTypes` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),Nt=yn,Object.defineProperty(Ke,"propTypes",{enumerable:!0})}}})}return Ke}function ot(L){L!=null&&L.$$typeof===y?Be("forwardRef requires a render function but received a `memo` component. Instead of forwardRef(memo(...)), use memo(forwardRef(...))."):typeof L!="function"?Be("forwardRef requires a render function but was given %s.",L===null?"null":typeof L):L.length!==0&&L.length!==2&&Be("forwardRef render functions accept exactly two parameters: props and ref. %s",L.length===1?"Did you forget to use the ref parameter?":"Any additional parameter will be undefined."),L!=null&&(L.defaultProps!=null||L.propTypes!=null)&&Be("forwardRef render functions do not support propTypes or defaultProps. Did you accidentally pass a React component?");var le={$$typeof:f,render:L};{var Ke;Object.defineProperty(le,"displayName",{enumerable:!1,configurable:!0,get:function(){return Ke},set:function(Je){Ke=Je,!L.name&&!L.displayName&&(L.displayName=Je)}})}return le}var Q;Q=Symbol.for("react.module.reference");function Ye(L){return!!(typeof L=="string"||typeof L=="function"||L===o||L===I||se||L===c||L===b||L===v||be||L===V||E||ee||Ie||typeof L=="object"&&L!==null&&(L.$$typeof===Z||L.$$typeof===y||L.$$typeof===C||L.$$typeof===d||L.$$typeof===f||L.$$typeof===Q||L.getModuleId!==void 0))}function ct(L,le){Ye(L)||Be("memo: The first argument must be a component. Instead received: %s",L===null?"null":typeof L);var Ke={$$typeof:y,type:L,compare:le===void 0?null:le};{var Je;Object.defineProperty(Ke,"displayName",{enumerable:!1,configurable:!0,get:function(){return Je},set:function(Nt){Je=Nt,!L.name&&!L.displayName&&(L.displayName=Nt)}})}return Ke}function ft(){var L=w.current;return L===null&&Be(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.`),L}function _t(L){var le=ft();if(L._context!==void 0){var Ke=L._context;Ke.Consumer===L?Be("Calling useContext(Context.Consumer) is not supported, may cause bugs, and will be removed in a future major release. Did you mean to call useContext(Context) instead?"):Ke.Provider===L&&Be("Calling useContext(Context.Provider) is not supported. Did you mean to call useContext(Context) instead?")}return le.useContext(L)}function xt(L){var le=ft();return le.useState(L)}function D(L,le,Ke){var Je=ft();return Je.useReducer(L,le,Ke)}function ge(L){var le=ft();return le.useRef(L)}function Ge(L,le){var Ke=ft();return Ke.useEffect(L,le)}function Se(L,le){var Ke=ft();return Ke.useInsertionEffect(L,le)}function Ze(L,le){var Ke=ft();return Ke.useLayoutEffect(L,le)}function bt(L,le){var Ke=ft();return Ke.useCallback(L,le)}function Ft(L,le){var Ke=ft();return Ke.useMemo(L,le)}function nn(L,le,Ke){var Je=ft();return Je.useImperativeHandle(L,le,Ke)}function jt(L,le){{var Ke=ft();return Ke.useDebugValue(L,le)}}function Mt(){var L=ft();return L.useTransition()}function vn(L){var le=ft();return le.useDeferredValue(L)}function Zn(){var L=ft();return L.useId()}function Si(L,le,Ke){var Je=ft();return Je.useSyncExternalStore(L,le,Ke)}var na=0,Ji,ms,yi,dn,wr,xi,Po;function kl(){}kl.__reactDisabledLog=!0;function Wr(){{if(na===0){Ji=console.log,ms=console.info,yi=console.warn,dn=console.error,wr=console.group,xi=console.groupCollapsed,Po=console.groupEnd;var L={configurable:!0,enumerable:!0,value:kl,writable:!0};Object.defineProperties(console,{info:L,log:L,warn:L,error:L,group:L,groupCollapsed:L,groupEnd:L})}na++}}function to(){{if(na--,na===0){var L={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Ue({},L,{value:Ji}),info:Ue({},L,{value:ms}),warn:Ue({},L,{value:yi}),error:Ue({},L,{value:dn}),group:Ue({},L,{value:wr}),groupCollapsed:Ue({},L,{value:xi}),groupEnd:Ue({},L,{value:Po})})}na<0&&Be("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Mi=Ce.ReactCurrentDispatcher,as;function xr(L,le,Ke){{if(as===void 0)try{throw Error()}catch(Nt){var Je=Nt.stack.trim().match(/\n( *(at )?)/);as=Je&&Je[1]||""}return`
`+as+L}}var ga=!1,Vr;{var Lg=typeof WeakMap=="function"?WeakMap:Map;Vr=new Lg}function kc(L,le){if(!L||ga)return"";{var Ke=Vr.get(L);if(Ke!==void 0)return Ke}var Je;ga=!0;var Nt=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var yn;yn=Mi.current,Mi.current=null,Wr();try{if(le){var sn=function(){throw Error()};if(Object.defineProperty(sn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(sn,[])}catch(ma){Je=ma}Reflect.construct(L,[],sn)}else{try{sn.call()}catch(ma){Je=ma}L.call(sn.prototype)}}else{try{throw Error()}catch(ma){Je=ma}L()}}catch(ma){if(ma&&Je&&typeof ma.stack=="string"){for(var xn=ma.stack.split(`
`),Jn=Je.stack.split(`
`),ui=xn.length-1,Hi=Jn.length-1;ui>=1&&Hi>=0&&xn[ui]!==Jn[Hi];)Hi--;for(;ui>=1&&Hi>=0;ui--,Hi--)if(xn[ui]!==Jn[Hi]){if(ui!==1||Hi!==1)do if(ui--,Hi--,Hi<0||xn[ui]!==Jn[Hi]){var Gi=`
`+xn[ui].replace(" at new "," at ");return L.displayName&&Gi.includes("<anonymous>")&&(Gi=Gi.replace("<anonymous>",L.displayName)),typeof L=="function"&&Vr.set(L,Gi),Gi}while(ui>=1&&Hi>=0);break}}}finally{ga=!1,Mi.current=yn,to(),Error.prepareStackTrace=Nt}var Ln=L?L.displayName||L.name:"",Pi=Ln?xr(Ln):"";return typeof L=="function"&&Vr.set(L,Pi),Pi}function Uc(L,le,Ke){return kc(L,!1)}function vI(L){var le=L.prototype;return!!(le&&le.isReactComponent)}function Dc(L,le,Ke){if(L==null)return"";if(typeof L=="function")return kc(L,vI(L));if(typeof L=="string")return xr(L);switch(L){case b:return xr("Suspense");case v:return xr("SuspenseList")}if(typeof L=="object")switch(L.$$typeof){case f:return Uc(L.render);case y:return Dc(L.type,le,Ke);case Z:{var Je=L,Nt=Je._payload,yn=Je._init;try{return Dc(yn(Nt),le,Ke)}catch{}}}return""}var no={},_g=Ce.ReactDebugCurrentFrame;function Mn(L){if(L){var le=L._owner,Ke=Dc(L.type,L._source,le?le.type:null);_g.setExtraStackFrame(Ke)}else _g.setExtraStackFrame(null)}function Ab(L,le,Ke,Je,Nt){{var yn=Function.call.bind(Ae);for(var sn in L)if(yn(L,sn)){var xn=void 0;try{if(typeof L[sn]!="function"){var Jn=Error((Je||"React class")+": "+Ke+" type `"+sn+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof L[sn]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Jn.name="Invariant Violation",Jn}xn=L[sn](le,sn,Je,Ke,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(ui){xn=ui}xn&&!(xn instanceof Error)&&(Mn(Nt),Be("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",Je||"React class",Ke,sn,typeof xn),Mn(null)),xn instanceof Error&&!(xn.message in no)&&(no[xn.message]=!0,Mn(Nt),Be("Failed %s type: %s",Ke,xn.message),Mn(null))}}}function Ul(L){if(L){var le=L._owner,Ke=Dc(L.type,L._source,le?le.type:null);K(Ke)}else K(null)}var Xn;Xn=!1;function lC(){if(F.current){var L=k(F.current.type);if(L)return`

Check the render method of \``+L+"`."}return""}function Vs(L){if(L!==void 0){var le=L.fileName.replace(/^.*[\\\/]/,""),Ke=L.lineNumber;return`

Check your code at `+le+":"+Ke+"."}return""}function Jc(L){return L!=null?Vs(L.__source):""}var So={};function fb(L){var le=lC();if(!le){var Ke=typeof L=="string"?L:L.displayName||L.name;Ke&&(le=`

Check the top-level render call using <`+Ke+">.")}return le}function za(L,le){if(!(!L._store||L._store.validated||L.key!=null)){L._store.validated=!0;var Ke=fb(le);if(!So[Ke]){So[Ke]=!0;var Je="";L&&L._owner&&L._owner!==F.current&&(Je=" It was passed a child from "+k(L._owner.type)+"."),Ul(L),Be('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',Ke,Je),Ul(null)}}}function Oi(L,le){if(typeof L=="object"){if(ut(L))for(var Ke=0;Ke<L.length;Ke++){var Je=L[Ke];Ct(Je)&&za(Je,le)}else if(Ct(L))L._store&&(L._store.validated=!0);else if(L){var Nt=N(L);if(typeof Nt=="function"&&Nt!==L.entries)for(var yn=Nt.call(L),sn;!(sn=yn.next()).done;)Ct(sn.value)&&za(sn.value,le)}}}function kg(L){{var le=L.type;if(le==null||typeof le=="string")return;var Ke;if(typeof le=="function")Ke=le.propTypes;else if(typeof le=="object"&&(le.$$typeof===f||le.$$typeof===y))Ke=le.propTypes;else return;if(Ke){var Je=k(le);Ab(Ke,L.props,"prop",Je,L)}else if(le.PropTypes!==void 0&&!Xn){Xn=!0;var Nt=k(le);Be("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",Nt||"Unknown")}typeof le.getDefaultProps=="function"&&!le.getDefaultProps.isReactClassApproved&&Be("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Qo(L){{for(var le=Object.keys(L.props),Ke=0;Ke<le.length;Ke++){var Je=le[Ke];if(Je!=="children"&&Je!=="key"){Ul(L),Be("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",Je),Ul(null);break}}L.ref!==null&&(Ul(L),Be("Invalid attribute `ref` supplied to `React.Fragment`."),Ul(null))}}function Ns(L,le,Ke){var Je=Ye(L);if(!Je){var Nt="";(L===void 0||typeof L=="object"&&L!==null&&Object.keys(L).length===0)&&(Nt+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var yn=Jc(le);yn?Nt+=yn:Nt+=lC();var sn;L===null?sn="null":ut(L)?sn="array":L!==void 0&&L.$$typeof===n?(sn="<"+(k(L.type)||"Unknown")+" />",Nt=" Did you accidentally export a JSX literal instead of a component?"):sn=typeof L,Be("React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",sn,Nt)}var xn=at.apply(this,arguments);if(xn==null)return xn;if(Je)for(var Jn=2;Jn<arguments.length;Jn++)Oi(arguments[Jn],L);return L===o?Qo(xn):kg(xn),xn}var Nr=!1;function pb(L){var le=Ns.bind(null,L);return le.type=L,Nr||(Nr=!0,he("React.createFactory() is deprecated and will be removed in a future major release. Consider using JSX or use React.createElement() directly instead.")),Object.defineProperty(le,"type",{enumerable:!1,get:function(){return he("Factory.type is deprecated. Access the class directly before passing it to createFactory."),Object.defineProperty(this,"type",{value:L}),L}}),le}function gC(L,le,Ke){for(var Je=pt.apply(this,arguments),Nt=2;Nt<arguments.length;Nt++)Oi(arguments[Nt],Je.type);return kg(Je),Je}function FA(L,le){var Ke=X.transition;X.transition={};var Je=X.transition;X.transition._updatedFibers=new Set;try{L()}finally{if(X.transition=Ke,Ke===null&&Je._updatedFibers){var Nt=Je._updatedFibers.size;Nt>10&&he("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),Je._updatedFibers.clear()}}}var cC=!1,yI=null;function mb(L){if(yI===null)try{var le=("require"+Math.random()).slice(0,7),Ke=r&&r[le];yI=Ke.call(r,"timers").setImmediate}catch{yI=function(Nt){cC===!1&&(cC=!0,typeof MessageChannel>"u"&&Be("This browser does not have a MessageChannel implementation, so enqueuing tasks via await act(async () => ...) will fail. Please file an issue at https://github.com/facebook/react/issues if you encounter this warning."));var yn=new MessageChannel;yn.port1.onmessage=Nt,yn.port2.postMessage(void 0)}}return yI(L)}var Ug=0,Oc=!1;function uC(L){{var le=Ug;Ug++,H.current===null&&(H.current=[]);var Ke=H.isBatchingLegacy,Je;try{if(H.isBatchingLegacy=!0,Je=L(),!Ke&&H.didScheduleLegacyUpdate){var Nt=H.current;Nt!==null&&(H.didScheduleLegacyUpdate=!1,ZI(Nt))}}catch(Ln){throw ol(le),Ln}finally{H.isBatchingLegacy=Ke}if(Je!==null&&typeof Je=="object"&&typeof Je.then=="function"){var yn=Je,sn=!1,xn={then:function(Ln,Pi){sn=!0,yn.then(function(ma){ol(le),Ug===0?GI(ma,Ln,Pi):Ln(ma)},function(ma){ol(le),Pi(ma)})}};return!Oc&&typeof Promise<"u"&&Promise.resolve().then(function(){}).then(function(){sn||(Oc=!0,Be("You called act(async () => ...) without await. This could lead to unexpected testing behaviour, interleaving multiple act calls and mixing their scopes. You should - await act(async () => ...);"))}),xn}else{var Jn=Je;if(ol(le),Ug===0){var ui=H.current;ui!==null&&(ZI(ui),H.current=null);var Hi={then:function(Ln,Pi){H.current===null?(H.current=[],GI(Jn,Ln,Pi)):Ln(Jn)}};return Hi}else{var Gi={then:function(Ln,Pi){Ln(Jn)}};return Gi}}}}function ol(L){L!==Ug-1&&Be("You seem to have overlapping act() calls, this is not supported. Be sure to await previous act() calls before making a new one. "),Ug=L}function GI(L,le,Ke){{var Je=H.current;if(Je!==null)try{ZI(Je),mb(function(){Je.length===0?(H.current=null,le(L)):GI(L,le,Ke)})}catch(Nt){Ke(Nt)}else le(L)}}var BI=!1;function ZI(L){if(!BI){BI=!0;var le=0;try{for(;le<L.length;le++){var Ke=L[le];do Ke=Ke(!0);while(Ke!==null)}L.length=0}catch(Je){throw L=L.slice(le+1),Je}finally{BI=!1}}}var KA=Ns,EA=gC,IC=pb,dC={map:rn,forEach:mn,count:mt,toArray:Wn,only:zn};e.Children=dC,e.Component=Ee,e.Fragment=o,e.Profiler=I,e.PureComponent=$t,e.StrictMode=c,e.Suspense=b,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ce,e.act=uC,e.cloneElement=EA,e.createContext=Dn,e.createElement=KA,e.createFactory=IC,e.createRef=Ot,e.forwardRef=ot,e.isValidElement=Ct,e.lazy=re,e.memo=ct,e.startTransition=FA,e.unstable_act=uC,e.useCallback=bt,e.useContext=_t,e.useDebugValue=jt,e.useDeferredValue=vn,e.useEffect=Ge,e.useId=Zn,e.useImperativeHandle=nn,e.useInsertionEffect=Se,e.useLayoutEffect=Ze,e.useMemo=Ft,e.useReducer=D,e.useRef=ge,e.useState=xt,e.useSyncExternalStore=Si,e.useTransition=Mt,e.version=t,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})()})(dR,dR.exports);var M9=dR.exports;sF.exports=M9;var rt=sF.exports;const H9=UN(rt);/**
 * @license React
 * react-jsx-dev-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){var r=rt,e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),I=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),b=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),y=Symbol.for("react.offscreen"),Z=Symbol.iterator,V="@@iterator";function R(re){if(re===null||typeof re!="object")return null;var ot=Z&&re[Z]||re[V];return typeof ot=="function"?ot:null}var S=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function N(re){{for(var ot=arguments.length,Q=new Array(ot>1?ot-1:0),Ye=1;Ye<ot;Ye++)Q[Ye-1]=arguments[Ye];w("error",re,Q)}}function w(re,ot,Q){{var Ye=S.ReactDebugCurrentFrame,ct=Ye.getStackAddendum();ct!==""&&(ot+="%s",Q=Q.concat([ct]));var ft=Q.map(function(_t){return String(_t)});ft.unshift("Warning: "+ot),Function.prototype.apply.call(console[re],console,ft)}}var X=!1,H=!1,F=!1,_=!1,P=!1,K;K=Symbol.for("react.module.reference");function E(re){return!!(typeof re=="string"||typeof re=="function"||re===n||re===o||P||re===a||re===d||re===f||_||re===y||X||H||F||typeof re=="object"&&re!==null&&(re.$$typeof===v||re.$$typeof===b||re.$$typeof===c||re.$$typeof===I||re.$$typeof===C||re.$$typeof===K||re.getModuleId!==void 0))}function ee(re,ot,Q){var Ye=re.displayName;if(Ye)return Ye;var ct=ot.displayName||ot.name||"";return ct!==""?Q+"("+ct+")":Q}function Ie(re){return re.displayName||"Context"}function be(re){if(re==null)return null;if(typeof re.tag=="number"&&N("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof re=="function")return re.displayName||re.name||null;if(typeof re=="string")return re;switch(re){case n:return"Fragment";case t:return"Portal";case o:return"Profiler";case a:return"StrictMode";case d:return"Suspense";case f:return"SuspenseList"}if(typeof re=="object")switch(re.$$typeof){case I:var ot=re;return Ie(ot)+".Consumer";case c:var Q=re;return Ie(Q._context)+".Provider";case C:return ee(re,re.render,"ForwardRef");case b:var Ye=re.displayName||null;return Ye!==null?Ye:be(re.type)||"Memo";case v:{var ct=re,ft=ct._payload,_t=ct._init;try{return be(_t(ft))}catch{return null}}}return null}var se=Object.assign,Ce=0,he,Be,ve,we,me,Xe,Ue;function de(){}de.__reactDisabledLog=!0;function Ee(){{if(Ce===0){he=console.log,Be=console.info,ve=console.warn,we=console.error,me=console.group,Xe=console.groupCollapsed,Ue=console.groupEnd;var re={configurable:!0,enumerable:!0,value:de,writable:!0};Object.defineProperties(console,{info:re,log:re,warn:re,error:re,group:re,groupCollapsed:re,groupEnd:re})}Ce++}}function At(){{if(Ce--,Ce===0){var re={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:se({},re,{value:he}),info:se({},re,{value:Be}),warn:se({},re,{value:ve}),error:se({},re,{value:we}),group:se({},re,{value:me}),groupCollapsed:se({},re,{value:Xe}),groupEnd:se({},re,{value:Ue})})}Ce<0&&N("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Zt=S.ReactCurrentDispatcher,Bt;function kt(re,ot,Q){{if(Bt===void 0)try{throw Error()}catch(ct){var Ye=ct.stack.trim().match(/\n( *(at )?)/);Bt=Ye&&Ye[1]||""}return`
`+Bt+re}}var $t=!1,Xt;{var Ot=typeof WeakMap=="function"?WeakMap:Map;Xt=new Ot}function oe(re,ot){if(!re||$t)return"";{var Q=Xt.get(re);if(Q!==void 0)return Q}var Ye;$t=!0;var ct=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var ft;ft=Zt.current,Zt.current=null,Ee();try{if(ot){var _t=function(){throw Error()};if(Object.defineProperty(_t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_t,[])}catch(Ft){Ye=Ft}Reflect.construct(re,[],_t)}else{try{_t.call()}catch(Ft){Ye=Ft}re.call(_t.prototype)}}else{try{throw Error()}catch(Ft){Ye=Ft}re()}}catch(Ft){if(Ft&&Ye&&typeof Ft.stack=="string"){for(var xt=Ft.stack.split(`
`),D=Ye.stack.split(`
`),ge=xt.length-1,Ge=D.length-1;ge>=1&&Ge>=0&&xt[ge]!==D[Ge];)Ge--;for(;ge>=1&&Ge>=0;ge--,Ge--)if(xt[ge]!==D[Ge]){if(ge!==1||Ge!==1)do if(ge--,Ge--,Ge<0||xt[ge]!==D[Ge]){var Se=`
`+xt[ge].replace(" at new "," at ");return re.displayName&&Se.includes("<anonymous>")&&(Se=Se.replace("<anonymous>",re.displayName)),typeof re=="function"&&Xt.set(re,Se),Se}while(ge>=1&&Ge>=0);break}}}finally{$t=!1,Zt.current=ft,At(),Error.prepareStackTrace=ct}var Ze=re?re.displayName||re.name:"",bt=Ze?kt(Ze):"";return typeof re=="function"&&Xt.set(re,bt),bt}function ut(re,ot,Q){return oe(re,!1)}function _e(re){var ot=re.prototype;return!!(ot&&ot.isReactComponent)}function it(re,ot,Q){if(re==null)return"";if(typeof re=="function")return oe(re,_e(re));if(typeof re=="string")return kt(re);switch(re){case d:return kt("Suspense");case f:return kt("SuspenseList")}if(typeof re=="object")switch(re.$$typeof){case C:return ut(re.render);case b:return it(re.type,ot,Q);case v:{var Ye=re,ct=Ye._payload,ft=Ye._init;try{return it(ft(ct),ot,Q)}catch{}}}return""}var Te=Object.prototype.hasOwnProperty,Et={},Wt=S.ReactDebugCurrentFrame;function O(re){if(re){var ot=re._owner,Q=it(re.type,re._source,ot?ot.type:null);Wt.setExtraStackFrame(Q)}else Wt.setExtraStackFrame(null)}function k(re,ot,Q,Ye,ct){{var ft=Function.call.bind(Te);for(var _t in re)if(ft(re,_t)){var xt=void 0;try{if(typeof re[_t]!="function"){var D=Error((Ye||"React class")+": "+Q+" type `"+_t+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof re[_t]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw D.name="Invariant Violation",D}xt=re[_t](ot,_t,Ye,Q,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(ge){xt=ge}xt&&!(xt instanceof Error)&&(O(ct),N("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",Ye||"React class",Q,_t,typeof xt),O(null)),xt instanceof Error&&!(xt.message in Et)&&(Et[xt.message]=!0,O(ct),N("Failed %s type: %s",Q,xt.message),O(null))}}}var Ae=Array.isArray;function Oe(re){return Ae(re)}function $e(re){{var ot=typeof Symbol=="function"&&Symbol.toStringTag,Q=ot&&re[Symbol.toStringTag]||re.constructor.name||"Object";return Q}}function et(re){try{return Yt(re),!1}catch{return!0}}function Yt(re){return""+re}function vt(re){if(et(re))return N("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",$e(re)),Yt(re)}var Vt=S.ReactCurrentOwner,tn={key:!0,ref:!0,__self:!0,__source:!0},un,ae,Le;Le={};function at(re){if(Te.call(re,"ref")){var ot=Object.getOwnPropertyDescriptor(re,"ref").get;if(ot&&ot.isReactWarning)return!1}return re.ref!==void 0}function Pe(re){if(Te.call(re,"key")){var ot=Object.getOwnPropertyDescriptor(re,"key").get;if(ot&&ot.isReactWarning)return!1}return re.key!==void 0}function pt(re,ot){if(typeof re.ref=="string"&&Vt.current&&ot&&Vt.current.stateNode!==ot){var Q=be(Vt.current.type);Le[Q]||(N('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',be(Vt.current.type),re.ref),Le[Q]=!0)}}function Ct(re,ot){{var Q=function(){un||(un=!0,N("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ot))};Q.isReactWarning=!0,Object.defineProperty(re,"key",{get:Q,configurable:!0})}}function q(re,ot){{var Q=function(){ae||(ae=!0,N("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",ot))};Q.isReactWarning=!0,Object.defineProperty(re,"ref",{get:Q,configurable:!0})}}var ye=function(re,ot,Q,Ye,ct,ft,_t){var xt={$$typeof:e,type:re,key:ot,ref:Q,props:_t,_owner:ft};return xt._store={},Object.defineProperty(xt._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(xt,"_self",{configurable:!1,enumerable:!1,writable:!1,value:Ye}),Object.defineProperty(xt,"_source",{configurable:!1,enumerable:!1,writable:!1,value:ct}),Object.freeze&&(Object.freeze(xt.props),Object.freeze(xt)),xt};function gt(re,ot,Q,Ye,ct){{var ft,_t={},xt=null,D=null;Q!==void 0&&(vt(Q),xt=""+Q),Pe(ot)&&(vt(ot.key),xt=""+ot.key),at(ot)&&(D=ot.ref,pt(ot,ct));for(ft in ot)Te.call(ot,ft)&&!tn.hasOwnProperty(ft)&&(_t[ft]=ot[ft]);if(re&&re.defaultProps){var ge=re.defaultProps;for(ft in ge)_t[ft]===void 0&&(_t[ft]=ge[ft])}if(xt||D){var Ge=typeof re=="function"?re.displayName||re.name||"Unknown":re;xt&&Ct(_t,Ge),D&&q(_t,Ge)}return ye(re,xt,D,ct,Ye,Vt.current,_t)}}var De=S.ReactCurrentOwner,Ne=S.ReactDebugCurrentFrame;function ce(re){if(re){var ot=re._owner,Q=it(re.type,re._source,ot?ot.type:null);Ne.setExtraStackFrame(Q)}else Ne.setExtraStackFrame(null)}var dt;dt=!1;function wt(re){return typeof re=="object"&&re!==null&&re.$$typeof===e}function rn(){{if(De.current){var re=be(De.current.type);if(re)return`

Check the render method of \``+re+"`."}return""}}function mt(re){{if(re!==void 0){var ot=re.fileName.replace(/^.*[\\\/]/,""),Q=re.lineNumber;return`

Check your code at `+ot+":"+Q+"."}return""}}var mn={};function Wn(re){{var ot=rn();if(!ot){var Q=typeof re=="string"?re:re.displayName||re.name;Q&&(ot=`

Check the top-level render call using <`+Q+">.")}return ot}}function zn(re,ot){{if(!re._store||re._store.validated||re.key!=null)return;re._store.validated=!0;var Q=Wn(ot);if(mn[Q])return;mn[Q]=!0;var Ye="";re&&re._owner&&re._owner!==De.current&&(Ye=" It was passed a child from "+be(re._owner.type)+"."),ce(re),N('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',Q,Ye),ce(null)}}function Dn(re,ot){{if(typeof re!="object")return;if(Oe(re))for(var Q=0;Q<re.length;Q++){var Ye=re[Q];wt(Ye)&&zn(Ye,ot)}else if(wt(re))re._store&&(re._store.validated=!0);else if(re){var ct=R(re);if(typeof ct=="function"&&ct!==re.entries)for(var ft=ct.call(re),_t;!(_t=ft.next()).done;)wt(_t.value)&&zn(_t.value,ot)}}}function In(re){{var ot=re.type;if(ot==null||typeof ot=="string")return;var Q;if(typeof ot=="function")Q=ot.propTypes;else if(typeof ot=="object"&&(ot.$$typeof===C||ot.$$typeof===b))Q=ot.propTypes;else return;if(Q){var Ye=be(ot);k(Q,re.props,"prop",Ye,re)}else if(ot.PropTypes!==void 0&&!dt){dt=!0;var ct=be(ot);N("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",ct||"Unknown")}typeof ot.getDefaultProps=="function"&&!ot.getDefaultProps.isReactClassApproved&&N("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function fi(re){{for(var ot=Object.keys(re.props),Q=0;Q<ot.length;Q++){var Ye=ot[Q];if(Ye!=="children"&&Ye!=="key"){ce(re),N("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",Ye),ce(null);break}}re.ref!==null&&(ce(re),N("Invalid attribute `ref` supplied to `React.Fragment`."),ce(null))}}var ci={};function is(re,ot,Q,Ye,ct,ft){{var _t=E(re);if(!_t){var xt="";(re===void 0||typeof re=="object"&&re!==null&&Object.keys(re).length===0)&&(xt+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var D=mt(ct);D?xt+=D:xt+=rn();var ge;re===null?ge="null":Oe(re)?ge="array":re!==void 0&&re.$$typeof===e?(ge="<"+(be(re.type)||"Unknown")+" />",xt=" Did you accidentally export a JSX literal instead of a component?"):ge=typeof re,N("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",ge,xt)}var Ge=gt(re,ot,Q,ct,ft);if(Ge==null)return Ge;if(_t){var Se=ot.children;if(Se!==void 0)if(Ye)if(Oe(Se)){for(var Ze=0;Ze<Se.length;Ze++)Dn(Se[Ze],re);Object.freeze&&Object.freeze(Se)}else N("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else Dn(Se,re)}if(Te.call(ot,"key")){var bt=be(re),Ft=Object.keys(ot).filter(function(Mt){return Mt!=="key"}),nn=Ft.length>0?"{key: someKey, "+Ft.join(": ..., ")+": ...}":"{key: someKey}";if(!ci[bt+nn]){var jt=Ft.length>0?"{"+Ft.join(": ..., ")+": ...}":"{}";N(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,nn,bt,jt,bt),ci[bt+nn]=!0}}return re===n?fi(Ge):In(Ge),Ge}}var Rr=is;zV.Fragment=n,zV.jsxDEV=Rr})();aF.exports=zV;var Fe=aF.exports,LV={},oF={exports:{}},nl={},rF={exports:{}},lF={};(function(r){/**
 * @license React
 * scheduler.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var e=!1,t=5;function n(ae,Le){var at=ae.length;ae.push(Le),c(ae,Le,at)}function a(ae){return ae.length===0?null:ae[0]}function o(ae){if(ae.length===0)return null;var Le=ae[0],at=ae.pop();return at!==Le&&(ae[0]=at,I(ae,at,0)),Le}function c(ae,Le,at){for(var Pe=at;Pe>0;){var pt=Pe-1>>>1,Ct=ae[pt];if(C(Ct,Le)>0)ae[pt]=Le,ae[Pe]=Ct,Pe=pt;else return}}function I(ae,Le,at){for(var Pe=at,pt=ae.length,Ct=pt>>>1;Pe<Ct;){var q=(Pe+1)*2-1,ye=ae[q],gt=q+1,De=ae[gt];if(C(ye,Le)<0)gt<pt&&C(De,ye)<0?(ae[Pe]=De,ae[gt]=Le,Pe=gt):(ae[Pe]=ye,ae[q]=Le,Pe=q);else if(gt<pt&&C(De,Le)<0)ae[Pe]=De,ae[gt]=Le,Pe=gt;else return}}function C(ae,Le){var at=ae.sortIndex-Le.sortIndex;return at!==0?at:ae.id-Le.id}var d=1,f=2,b=3,v=4,y=5;function Z(ae,Le){}var V=typeof performance=="object"&&typeof performance.now=="function";if(V){var R=performance;r.unstable_now=function(){return R.now()}}else{var S=Date,N=S.now();r.unstable_now=function(){return S.now()-N}}var w=1073741823,X=-1,H=250,F=5e3,_=1e4,P=w,K=[],E=[],ee=1,Ie=null,be=b,se=!1,Ce=!1,he=!1,Be=typeof setTimeout=="function"?setTimeout:null,ve=typeof clearTimeout=="function"?clearTimeout:null,we=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function me(ae){for(var Le=a(E);Le!==null;){if(Le.callback===null)o(E);else if(Le.startTime<=ae)o(E),Le.sortIndex=Le.expirationTime,n(K,Le);else return;Le=a(E)}}function Xe(ae){if(he=!1,me(ae),!Ce)if(a(K)!==null)Ce=!0,Yt(Ue);else{var Le=a(E);Le!==null&&vt(Xe,Le.startTime-ae)}}function Ue(ae,Le){Ce=!1,he&&(he=!1,Vt()),se=!0;var at=be;try{var Pe;if(!e)return de(ae,Le)}finally{Ie=null,be=at,se=!1}}function de(ae,Le){var at=Le;for(me(at),Ie=a(K);Ie!==null&&!(Ie.expirationTime>at&&(!ae||Wt()));){var Pe=Ie.callback;if(typeof Pe=="function"){Ie.callback=null,be=Ie.priorityLevel;var pt=Ie.expirationTime<=at,Ct=Pe(pt);at=r.unstable_now(),typeof Ct=="function"?Ie.callback=Ct:Ie===a(K)&&o(K),me(at)}else o(K);Ie=a(K)}if(Ie!==null)return!0;var q=a(E);return q!==null&&vt(Xe,q.startTime-at),!1}function Ee(ae,Le){switch(ae){case d:case f:case b:case v:case y:break;default:ae=b}var at=be;be=ae;try{return Le()}finally{be=at}}function At(ae){var Le;switch(be){case d:case f:case b:Le=b;break;default:Le=be;break}var at=be;be=Le;try{return ae()}finally{be=at}}function Zt(ae){var Le=be;return function(){var at=be;be=Le;try{return ae.apply(this,arguments)}finally{be=at}}}function Bt(ae,Le,at){var Pe=r.unstable_now(),pt;if(typeof at=="object"&&at!==null){var Ct=at.delay;typeof Ct=="number"&&Ct>0?pt=Pe+Ct:pt=Pe}else pt=Pe;var q;switch(ae){case d:q=X;break;case f:q=H;break;case y:q=P;break;case v:q=_;break;case b:default:q=F;break}var ye=pt+q,gt={id:ee++,callback:Le,priorityLevel:ae,startTime:pt,expirationTime:ye,sortIndex:-1};return pt>Pe?(gt.sortIndex=pt,n(E,gt),a(K)===null&&gt===a(E)&&(he?Vt():he=!0,vt(Xe,pt-Pe))):(gt.sortIndex=ye,n(K,gt),!Ce&&!se&&(Ce=!0,Yt(Ue))),gt}function kt(){}function $t(){!Ce&&!se&&(Ce=!0,Yt(Ue))}function Xt(){return a(K)}function Ot(ae){ae.callback=null}function oe(){return be}var ut=!1,_e=null,it=-1,Te=t,Et=-1;function Wt(){var ae=r.unstable_now()-Et;return!(ae<Te)}function O(){}function k(ae){if(ae<0||ae>125){console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported");return}ae>0?Te=Math.floor(1e3/ae):Te=t}var Ae=function(){if(_e!==null){var ae=r.unstable_now();Et=ae;var Le=!0,at=!0;try{at=_e(Le,ae)}finally{at?Oe():(ut=!1,_e=null)}}else ut=!1},Oe;if(typeof we=="function")Oe=function(){we(Ae)};else if(typeof MessageChannel<"u"){var $e=new MessageChannel,et=$e.port2;$e.port1.onmessage=Ae,Oe=function(){et.postMessage(null)}}else Oe=function(){Be(Ae,0)};function Yt(ae){_e=ae,ut||(ut=!0,Oe())}function vt(ae,Le){it=Be(function(){ae(r.unstable_now())},Le)}function Vt(){ve(it),it=-1}var tn=O,un=null;r.unstable_IdlePriority=y,r.unstable_ImmediatePriority=d,r.unstable_LowPriority=v,r.unstable_NormalPriority=b,r.unstable_Profiling=un,r.unstable_UserBlockingPriority=f,r.unstable_cancelCallback=Ot,r.unstable_continueExecution=$t,r.unstable_forceFrameRate=k,r.unstable_getCurrentPriorityLevel=oe,r.unstable_getFirstCallbackNode=Xt,r.unstable_next=At,r.unstable_pauseExecution=kt,r.unstable_requestPaint=tn,r.unstable_runWithPriority=Ee,r.unstable_scheduleCallback=Bt,r.unstable_shouldYield=Wt,r.unstable_wrapCallback=Zt,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})()})(lF);rF.exports=lF;var F9=rF.exports;/**
 * @license React
 * react-dom.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var r=rt,e=F9,t=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,n=!1;function a(i){n=i}function o(i){if(!n){for(var s=arguments.length,u=new Array(s>1?s-1:0),h=1;h<s;h++)u[h-1]=arguments[h];I("warn",i,u)}}function c(i){if(!n){for(var s=arguments.length,u=new Array(s>1?s-1:0),h=1;h<s;h++)u[h-1]=arguments[h];I("error",i,u)}}function I(i,s,u){{var h=t.ReactDebugCurrentFrame,p=h.getStackAddendum();p!==""&&(s+="%s",u=u.concat([p]));var B=u.map(function(x){return String(x)});B.unshift("Warning: "+s),Function.prototype.apply.call(console[i],console,B)}}var C=0,d=1,f=2,b=3,v=4,y=5,Z=6,V=7,R=8,S=9,N=10,w=11,X=12,H=13,F=14,_=15,P=16,K=17,E=18,ee=19,Ie=21,be=22,se=23,Ce=24,he=25,Be=!0,ve=!1,we=!1,me=!1,Xe=!1,Ue=!0,de=!0,Ee=!0,At=!0,Zt=new Set,Bt={},kt={};function $t(i,s){Xt(i,s),Xt(i+"Capture",s)}function Xt(i,s){Bt[i]&&c("EventRegistry: More than one plugin attempted to publish the same registration name, `%s`.",i),Bt[i]=s;{var u=i.toLowerCase();kt[u]=i,i==="onDoubleClick"&&(kt.ondblclick=i)}for(var h=0;h<s.length;h++)Zt.add(s[h])}var Ot=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",oe=Object.prototype.hasOwnProperty;function ut(i){{var s=typeof Symbol=="function"&&Symbol.toStringTag,u=s&&i[Symbol.toStringTag]||i.constructor.name||"Object";return u}}function _e(i){try{return it(i),!1}catch{return!0}}function it(i){return""+i}function Te(i,s){if(_e(i))return c("The provided `%s` attribute is an unsupported type %s. This value must be coerced to a string before before using it here.",s,ut(i)),it(i)}function Et(i){if(_e(i))return c("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",ut(i)),it(i)}function Wt(i,s){if(_e(i))return c("The provided `%s` prop is an unsupported type %s. This value must be coerced to a string before before using it here.",s,ut(i)),it(i)}function O(i,s){if(_e(i))return c("The provided `%s` CSS property is an unsupported type %s. This value must be coerced to a string before before using it here.",s,ut(i)),it(i)}function k(i){if(_e(i))return c("The provided HTML markup uses a value of unsupported type %s. This value must be coerced to a string before before using it here.",ut(i)),it(i)}function Ae(i){if(_e(i))return c("Form field values (value, checked, defaultValue, or defaultChecked props) must be strings, not %s. This value must be coerced to a string before before using it here.",ut(i)),it(i)}var Oe=0,$e=1,et=2,Yt=3,vt=4,Vt=5,tn=6,un=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",ae=un+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",Le=new RegExp("^["+un+"]["+ae+"]*$"),at={},Pe={};function pt(i){return oe.call(Pe,i)?!0:oe.call(at,i)?!1:Le.test(i)?(Pe[i]=!0,!0):(at[i]=!0,c("Invalid attribute name: `%s`",i),!1)}function Ct(i,s,u){return s!==null?s.type===Oe:u?!1:i.length>2&&(i[0]==="o"||i[0]==="O")&&(i[1]==="n"||i[1]==="N")}function q(i,s,u,h){if(u!==null&&u.type===Oe)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":{if(h)return!1;if(u!==null)return!u.acceptsBooleans;var p=i.toLowerCase().slice(0,5);return p!=="data-"&&p!=="aria-"}default:return!1}}function ye(i,s,u,h){if(s===null||typeof s>"u"||q(i,s,u,h))return!0;if(h)return!1;if(u!==null)switch(u.type){case Yt:return!s;case vt:return s===!1;case Vt:return isNaN(s);case tn:return isNaN(s)||s<1}return!1}function gt(i){return Ne.hasOwnProperty(i)?Ne[i]:null}function De(i,s,u,h,p,B,x){this.acceptsBooleans=s===et||s===Yt||s===vt,this.attributeName=h,this.attributeNamespace=p,this.mustUseProperty=u,this.propertyName=i,this.type=s,this.sanitizeURL=B,this.removeEmptyString=x}var Ne={},ce=["children","dangerouslySetInnerHTML","defaultValue","defaultChecked","innerHTML","suppressContentEditableWarning","suppressHydrationWarning","style"];ce.forEach(function(i){Ne[i]=new De(i,Oe,!1,i,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var s=i[0],u=i[1];Ne[s]=new De(s,$e,!1,u,null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(i){Ne[i]=new De(i,et,!1,i.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Ne[i]=new De(i,et,!1,i,null,!1,!1)}),["allowFullScreen","async","autoFocus","autoPlay","controls","default","defer","disabled","disablePictureInPicture","disableRemotePlayback","formNoValidate","hidden","loop","noModule","noValidate","open","playsInline","readOnly","required","reversed","scoped","seamless","itemScope"].forEach(function(i){Ne[i]=new De(i,Yt,!1,i.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(i){Ne[i]=new De(i,Yt,!0,i,null,!1,!1)}),["capture","download"].forEach(function(i){Ne[i]=new De(i,vt,!1,i,null,!1,!1)}),["cols","rows","size","span"].forEach(function(i){Ne[i]=new De(i,tn,!1,i,null,!1,!1)}),["rowSpan","start"].forEach(function(i){Ne[i]=new De(i,Vt,!1,i.toLowerCase(),null,!1,!1)});var dt=/[\-\:]([a-z])/g,wt=function(i){return i[1].toUpperCase()};["accent-height","alignment-baseline","arabic-form","baseline-shift","cap-height","clip-path","clip-rule","color-interpolation","color-interpolation-filters","color-profile","color-rendering","dominant-baseline","enable-background","fill-opacity","fill-rule","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","glyph-name","glyph-orientation-horizontal","glyph-orientation-vertical","horiz-adv-x","horiz-origin-x","image-rendering","letter-spacing","lighting-color","marker-end","marker-mid","marker-start","overline-position","overline-thickness","paint-order","panose-1","pointer-events","rendering-intent","shape-rendering","stop-color","stop-opacity","strikethrough-position","strikethrough-thickness","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-anchor","text-decoration","text-rendering","underline-position","underline-thickness","unicode-bidi","unicode-range","units-per-em","v-alphabetic","v-hanging","v-ideographic","v-mathematical","vector-effect","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","writing-mode","xmlns:xlink","x-height"].forEach(function(i){var s=i.replace(dt,wt);Ne[s]=new De(s,$e,!1,i,null,!1,!1)}),["xlink:actuate","xlink:arcrole","xlink:role","xlink:show","xlink:title","xlink:type"].forEach(function(i){var s=i.replace(dt,wt);Ne[s]=new De(s,$e,!1,i,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(i){var s=i.replace(dt,wt);Ne[s]=new De(s,$e,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(i){Ne[i]=new De(i,$e,!1,i.toLowerCase(),null,!1,!1)});var rn="xlinkHref";Ne[rn]=new De("xlinkHref",$e,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(i){Ne[i]=new De(i,$e,!1,i.toLowerCase(),null,!0,!0)});var mt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*\:/i,mn=!1;function Wn(i){!mn&&mt.test(i)&&(mn=!0,c("A future version of React will block javascript: URLs as a security precaution. Use event handlers instead if you can. If you need to generate unsafe HTML try using dangerouslySetInnerHTML instead. React was passed %s.",JSON.stringify(i)))}function zn(i,s,u,h){if(h.mustUseProperty){var p=h.propertyName;return i[p]}else{Te(u,s),h.sanitizeURL&&Wn(""+u);var B=h.attributeName,x=null;if(h.type===vt){if(i.hasAttribute(B)){var Y=i.getAttribute(B);return Y===""?!0:ye(s,u,h,!1)?Y:Y===""+u?u:Y}}else if(i.hasAttribute(B)){if(ye(s,u,h,!1))return i.getAttribute(B);if(h.type===Yt)return u;x=i.getAttribute(B)}return ye(s,u,h,!1)?x===null?u:x:x===""+u?u:x}}function Dn(i,s,u,h){{if(!pt(s))return;if(!i.hasAttribute(s))return u===void 0?void 0:null;var p=i.getAttribute(s);return Te(u,s),p===""+u?u:p}}function In(i,s,u,h){var p=gt(s);if(!Ct(s,p,h)){if(ye(s,u,p,h)&&(u=null),h||p===null){if(pt(s)){var B=s;u===null?i.removeAttribute(B):(Te(u,s),i.setAttribute(B,""+u))}return}var x=p.mustUseProperty;if(x){var Y=p.propertyName;if(u===null){var z=p.type;i[Y]=z===Yt?!1:""}else i[Y]=u;return}var J=p.attributeName,j=p.attributeNamespace;if(u===null)i.removeAttribute(J);else{var pe=p.type,fe;pe===Yt||pe===vt&&u===!0?fe="":(Te(u,J),fe=""+u,p.sanitizeURL&&Wn(fe.toString())),j?i.setAttributeNS(j,J,fe):i.setAttribute(J,fe)}}}var fi=Symbol.for("react.element"),ci=Symbol.for("react.portal"),is=Symbol.for("react.fragment"),Rr=Symbol.for("react.strict_mode"),re=Symbol.for("react.profiler"),ot=Symbol.for("react.provider"),Q=Symbol.for("react.context"),Ye=Symbol.for("react.forward_ref"),ct=Symbol.for("react.suspense"),ft=Symbol.for("react.suspense_list"),_t=Symbol.for("react.memo"),xt=Symbol.for("react.lazy"),D=Symbol.for("react.scope"),ge=Symbol.for("react.debug_trace_mode"),Ge=Symbol.for("react.offscreen"),Se=Symbol.for("react.legacy_hidden"),Ze=Symbol.for("react.cache"),bt=Symbol.for("react.tracing_marker"),Ft=Symbol.iterator,nn="@@iterator";function jt(i){if(i===null||typeof i!="object")return null;var s=Ft&&i[Ft]||i[nn];return typeof s=="function"?s:null}var Mt=Object.assign,vn=0,Zn,Si,na,Ji,ms,yi,dn;function wr(){}wr.__reactDisabledLog=!0;function xi(){{if(vn===0){Zn=console.log,Si=console.info,na=console.warn,Ji=console.error,ms=console.group,yi=console.groupCollapsed,dn=console.groupEnd;var i={configurable:!0,enumerable:!0,value:wr,writable:!0};Object.defineProperties(console,{info:i,log:i,warn:i,error:i,group:i,groupCollapsed:i,groupEnd:i})}vn++}}function Po(){{if(vn--,vn===0){var i={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Mt({},i,{value:Zn}),info:Mt({},i,{value:Si}),warn:Mt({},i,{value:na}),error:Mt({},i,{value:Ji}),group:Mt({},i,{value:ms}),groupCollapsed:Mt({},i,{value:yi}),groupEnd:Mt({},i,{value:dn})})}vn<0&&c("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var kl=t.ReactCurrentDispatcher,Wr;function to(i,s,u){{if(Wr===void 0)try{throw Error()}catch(p){var h=p.stack.trim().match(/\n( *(at )?)/);Wr=h&&h[1]||""}return`
`+Wr+i}}var Mi=!1,as;{var xr=typeof WeakMap=="function"?WeakMap:Map;as=new xr}function ga(i,s){if(!i||Mi)return"";{var u=as.get(i);if(u!==void 0)return u}var h;Mi=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var B;B=kl.current,kl.current=null,xi();try{if(s){var x=function(){throw Error()};if(Object.defineProperty(x.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(x,[])}catch(ze){h=ze}Reflect.construct(i,[],x)}else{try{x.call()}catch(ze){h=ze}i.call(x.prototype)}}else{try{throw Error()}catch(ze){h=ze}i()}}catch(ze){if(ze&&h&&typeof ze.stack=="string"){for(var Y=ze.stack.split(`
`),z=h.stack.split(`
`),J=Y.length-1,j=z.length-1;J>=1&&j>=0&&Y[J]!==z[j];)j--;for(;J>=1&&j>=0;J--,j--)if(Y[J]!==z[j]){if(J!==1||j!==1)do if(J--,j--,j<0||Y[J]!==z[j]){var pe=`
`+Y[J].replace(" at new "," at ");return i.displayName&&pe.includes("<anonymous>")&&(pe=pe.replace("<anonymous>",i.displayName)),typeof i=="function"&&as.set(i,pe),pe}while(J>=1&&j>=0);break}}}finally{Mi=!1,kl.current=B,Po(),Error.prepareStackTrace=p}var fe=i?i.displayName||i.name:"",He=fe?to(fe):"";return typeof i=="function"&&as.set(i,He),He}function Vr(i,s,u){return ga(i,!0)}function Lg(i,s,u){return ga(i,!1)}function kc(i){var s=i.prototype;return!!(s&&s.isReactComponent)}function Uc(i,s,u){if(i==null)return"";if(typeof i=="function")return ga(i,kc(i));if(typeof i=="string")return to(i);switch(i){case ct:return to("Suspense");case ft:return to("SuspenseList")}if(typeof i=="object")switch(i.$$typeof){case Ye:return Lg(i.render);case _t:return Uc(i.type,s,u);case xt:{var h=i,p=h._payload,B=h._init;try{return Uc(B(p),s,u)}catch{}}}return""}function vI(i){switch(i._debugOwner&&i._debugOwner.type,i._debugSource,i.tag){case y:return to(i.type);case P:return to("Lazy");case H:return to("Suspense");case ee:return to("SuspenseList");case C:case f:case _:return Lg(i.type);case w:return Lg(i.type.render);case d:return Vr(i.type);default:return""}}function Dc(i){try{var s="",u=i;do s+=vI(u),u=u.return;while(u);return s}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}function no(i,s,u){var h=i.displayName;if(h)return h;var p=s.displayName||s.name||"";return p!==""?u+"("+p+")":u}function _g(i){return i.displayName||"Context"}function Mn(i){if(i==null)return null;if(typeof i.tag=="number"&&c("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case is:return"Fragment";case ci:return"Portal";case re:return"Profiler";case Rr:return"StrictMode";case ct:return"Suspense";case ft:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Q:var s=i;return _g(s)+".Consumer";case ot:var u=i;return _g(u._context)+".Provider";case Ye:return no(i,i.render,"ForwardRef");case _t:var h=i.displayName||null;return h!==null?h:Mn(i.type)||"Memo";case xt:{var p=i,B=p._payload,x=p._init;try{return Mn(x(B))}catch{return null}}}return null}function Ab(i,s,u){var h=s.displayName||s.name||"";return i.displayName||(h!==""?u+"("+h+")":u)}function Ul(i){return i.displayName||"Context"}function Xn(i){var s=i.tag,u=i.type;switch(s){case Ce:return"Cache";case S:var h=u;return Ul(h)+".Consumer";case N:var p=u;return Ul(p._context)+".Provider";case E:return"DehydratedFragment";case w:return Ab(u,u.render,"ForwardRef");case V:return"Fragment";case y:return u;case v:return"Portal";case b:return"Root";case Z:return"Text";case P:return Mn(u);case R:return u===Rr?"StrictMode":"Mode";case be:return"Offscreen";case X:return"Profiler";case Ie:return"Scope";case H:return"Suspense";case ee:return"SuspenseList";case he:return"TracingMarker";case d:case C:case K:case f:case F:case _:if(typeof u=="function")return u.displayName||u.name||null;if(typeof u=="string")return u;break}return null}var lC=t.ReactDebugCurrentFrame,Vs=null,Jc=!1;function So(){{if(Vs===null)return null;var i=Vs._debugOwner;if(i!==null&&typeof i<"u")return Xn(i)}return null}function fb(){return Vs===null?"":Dc(Vs)}function za(){lC.getCurrentStack=null,Vs=null,Jc=!1}function Oi(i){lC.getCurrentStack=i===null?null:fb,Vs=i,Jc=!1}function kg(){return Vs}function Qo(i){Jc=i}function Ns(i){return""+i}function Nr(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return Ae(i),i;default:return""}}var pb={button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0};function gC(i,s){pb[s.type]||s.onChange||s.onInput||s.readOnly||s.disabled||s.value==null||c("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`."),s.onChange||s.readOnly||s.disabled||s.checked==null||c("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")}function FA(i){var s=i.type,u=i.nodeName;return u&&u.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function cC(i){return i._valueTracker}function yI(i){i._valueTracker=null}function mb(i){var s="";return i&&(FA(i)?s=i.checked?"true":"false":s=i.value),s}function Ug(i){var s=FA(i)?"checked":"value",u=Object.getOwnPropertyDescriptor(i.constructor.prototype,s);Ae(i[s]);var h=""+i[s];if(!(i.hasOwnProperty(s)||typeof u>"u"||typeof u.get!="function"||typeof u.set!="function")){var p=u.get,B=u.set;Object.defineProperty(i,s,{configurable:!0,get:function(){return p.call(this)},set:function(Y){Ae(Y),h=""+Y,B.call(this,Y)}}),Object.defineProperty(i,s,{enumerable:u.enumerable});var x={getValue:function(){return h},setValue:function(Y){Ae(Y),h=""+Y},stopTracking:function(){yI(i),delete i[s]}};return x}}function Oc(i){cC(i)||(i._valueTracker=Ug(i))}function uC(i){if(!i)return!1;var s=cC(i);if(!s)return!0;var u=s.getValue(),h=mb(i);return h!==u?(s.setValue(h),!0):!1}function ol(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var GI=!1,BI=!1,ZI=!1,KA=!1;function EA(i){var s=i.type==="checkbox"||i.type==="radio";return s?i.checked!=null:i.value!=null}function IC(i,s){var u=i,h=s.checked,p=Mt({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??u._wrapperState.initialChecked});return p}function dC(i,s){gC("input",s),s.checked!==void 0&&s.defaultChecked!==void 0&&!BI&&(c("%s contains an input of type %s with both checked and defaultChecked props. Input elements must be either controlled or uncontrolled (specify either the checked prop, or the defaultChecked prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://reactjs.org/link/controlled-components",So()||"A component",s.type),BI=!0),s.value!==void 0&&s.defaultValue!==void 0&&!GI&&(c("%s contains an input of type %s with both value and defaultValue props. Input elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://reactjs.org/link/controlled-components",So()||"A component",s.type),GI=!0);var u=i,h=s.defaultValue==null?"":s.defaultValue;u._wrapperState={initialChecked:s.checked!=null?s.checked:s.defaultChecked,initialValue:Nr(s.value!=null?s.value:h),controlled:EA(s)}}function L(i,s){var u=i,h=s.checked;h!=null&&In(u,"checked",h,!1)}function le(i,s){var u=i;{var h=EA(s);!u._wrapperState.controlled&&h&&!KA&&(c("A component is changing an uncontrolled input to be controlled. This is likely caused by the value changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://reactjs.org/link/controlled-components"),KA=!0),u._wrapperState.controlled&&!h&&!ZI&&(c("A component is changing a controlled input to be uncontrolled. This is likely caused by the value changing from a defined to undefined, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://reactjs.org/link/controlled-components"),ZI=!0)}L(i,s);var p=Nr(s.value),B=s.type;if(p!=null)B==="number"?(p===0&&u.value===""||u.value!=p)&&(u.value=Ns(p)):u.value!==Ns(p)&&(u.value=Ns(p));else if(B==="submit"||B==="reset"){u.removeAttribute("value");return}s.hasOwnProperty("value")?yn(u,s.type,p):s.hasOwnProperty("defaultValue")&&yn(u,s.type,Nr(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(u.defaultChecked=!!s.defaultChecked)}function Ke(i,s,u){var h=i;if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var p=s.type,B=p==="submit"||p==="reset";if(B&&(s.value===void 0||s.value===null))return;var x=Ns(h._wrapperState.initialValue);u||x!==h.value&&(h.value=x),h.defaultValue=x}var Y=h.name;Y!==""&&(h.name=""),h.defaultChecked=!h.defaultChecked,h.defaultChecked=!!h._wrapperState.initialChecked,Y!==""&&(h.name=Y)}function Je(i,s){var u=i;le(u,s),Nt(u,s)}function Nt(i,s){var u=s.name;if(s.type==="radio"&&u!=null){for(var h=i;h.parentNode;)h=h.parentNode;Te(u,"name");for(var p=h.querySelectorAll("input[name="+JSON.stringify(""+u)+'][type="radio"]'),B=0;B<p.length;B++){var x=p[B];if(!(x===i||x.form!==i.form)){var Y=Gp(x);if(!Y)throw new Error("ReactDOMInput: Mixing React and non-React radio inputs with the same `name` is not supported.");uC(x),le(x,Y)}}}}function yn(i,s,u){(s!=="number"||ol(i.ownerDocument)!==i)&&(u==null?i.defaultValue=Ns(i._wrapperState.initialValue):i.defaultValue!==Ns(u)&&(i.defaultValue=Ns(u)))}var sn=!1,xn=!1,Jn=!1;function ui(i,s){s.value==null&&(typeof s.children=="object"&&s.children!==null?r.Children.forEach(s.children,function(u){u!=null&&(typeof u=="string"||typeof u=="number"||xn||(xn=!0,c("Cannot infer the option value of complex children. Pass a `value` prop or use a plain string as children to <option>.")))}):s.dangerouslySetInnerHTML!=null&&(Jn||(Jn=!0,c("Pass a `value` prop if you set dangerouslyInnerHTML so React knows which value should be selected.")))),s.selected!=null&&!sn&&(c("Use the `defaultValue` or `value` props on <select> instead of setting `selected` on <option>."),sn=!0)}function Hi(i,s){s.value!=null&&i.setAttribute("value",Ns(Nr(s.value)))}var Gi=Array.isArray;function Ln(i){return Gi(i)}var Pi;Pi=!1;function ma(){var i=So();return i?`

Check the render method of \``+i+"`.":""}var Pc=["value","defaultValue"];function CC(i){{gC("select",i);for(var s=0;s<Pc.length;s++){var u=Pc[s];if(i[u]!=null){var h=Ln(i[u]);i.multiple&&!h?c("The `%s` prop supplied to <select> must be an array if `multiple` is true.%s",u,ma()):!i.multiple&&h&&c("The `%s` prop supplied to <select> must be a scalar value if `multiple` is false.%s",u,ma())}}}}function Dl(i,s,u,h){var p=i.options;if(s){for(var B=u,x={},Y=0;Y<B.length;Y++)x["$"+B[Y]]=!0;for(var z=0;z<p.length;z++){var J=x.hasOwnProperty("$"+p[z].value);p[z].selected!==J&&(p[z].selected=J),J&&h&&(p[z].defaultSelected=!0)}}else{for(var j=Ns(Nr(u)),pe=null,fe=0;fe<p.length;fe++){if(p[fe].value===j){p[fe].selected=!0,h&&(p[fe].defaultSelected=!0);return}pe===null&&!p[fe].disabled&&(pe=p[fe])}pe!==null&&(pe.selected=!0)}}function hC(i,s){return Mt({},s,{value:void 0})}function SI(i,s){var u=i;CC(s),u._wrapperState={wasMultiple:!!s.multiple},s.value!==void 0&&s.defaultValue!==void 0&&!Pi&&(c("Select elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled select element and remove one of these props. More info: https://reactjs.org/link/controlled-components"),Pi=!0)}function bb(i,s){var u=i;u.multiple=!!s.multiple;var h=s.value;h!=null?Dl(u,!!s.multiple,h,!1):s.defaultValue!=null&&Dl(u,!!s.multiple,s.defaultValue,!0)}function TA(i,s){var u=i,h=u._wrapperState.wasMultiple;u._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?Dl(u,!!s.multiple,p,!1):h!==!!s.multiple&&(s.defaultValue!=null?Dl(u,!!s.multiple,s.defaultValue,!0):Dl(u,!!s.multiple,s.multiple?[]:"",!1))}function vb(i,s){var u=i,h=s.value;h!=null&&Dl(u,!!s.multiple,h,!1)}var IG=!1;function yb(i,s){var u=i;if(s.dangerouslySetInnerHTML!=null)throw new Error("`dangerouslySetInnerHTML` does not make sense on <textarea>.");var h=Mt({},s,{value:void 0,defaultValue:void 0,children:Ns(u._wrapperState.initialValue)});return h}function dG(i,s){var u=i;gC("textarea",s),s.value!==void 0&&s.defaultValue!==void 0&&!IG&&(c("%s contains a textarea with both value and defaultValue props. Textarea elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled textarea and remove one of these props. More info: https://reactjs.org/link/controlled-components",So()||"A component"),IG=!0);var h=s.value;if(h==null){var p=s.children,B=s.defaultValue;if(p!=null){c("Use the `defaultValue` or `value` props instead of setting children on <textarea>.");{if(B!=null)throw new Error("If you supply `defaultValue` on a <textarea>, do not pass children.");if(Ln(p)){if(p.length>1)throw new Error("<textarea> can only have at most one child.");p=p[0]}B=p}}B==null&&(B=""),h=B}u._wrapperState={initialValue:Nr(h)}}function CG(i,s){var u=i,h=Nr(s.value),p=Nr(s.defaultValue);if(h!=null){var B=Ns(h);B!==u.value&&(u.value=B),s.defaultValue==null&&u.defaultValue!==B&&(u.defaultValue=B)}p!=null&&(u.defaultValue=Ns(p))}function hG(i,s){var u=i,h=u.textContent;h===u._wrapperState.initialValue&&h!==""&&h!==null&&(u.value=h)}function $R(i,s){CG(i,s)}var Jl="http://www.w3.org/1999/xhtml",ew="http://www.w3.org/1998/Math/MathML",Gb="http://www.w3.org/2000/svg";function Bb(i){switch(i){case"svg":return Gb;case"math":return ew;default:return Jl}}function Zb(i,s){return i==null||i===Jl?Bb(s):i===Gb&&s==="foreignObject"?Jl:i}var tw=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,u,h,p){MSApp.execUnsafeLocalFunction(function(){return i(s,u,h,p)})}:i},zA,AG=tw(function(i,s){if(i.namespaceURI===Gb&&!("innerHTML"in i)){zA=zA||document.createElement("div"),zA.innerHTML="<svg>"+s.valueOf().toString()+"</svg>";for(var u=zA.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;u.firstChild;)i.appendChild(u.firstChild);return}i.innerHTML=s}),io=1,Ol=3,Qi=8,rl=9,LA=11,AC=function(i,s){if(s){var u=i.firstChild;if(u&&u===i.lastChild&&u.nodeType===Ol){u.nodeValue=s;return}}i.textContent=s},fG={animation:["animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimingFunction"],background:["backgroundAttachment","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPositionX","backgroundPositionY","backgroundRepeat","backgroundSize"],backgroundPosition:["backgroundPositionX","backgroundPositionY"],border:["borderBottomColor","borderBottomStyle","borderBottomWidth","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRightColor","borderRightStyle","borderRightWidth","borderTopColor","borderTopStyle","borderTopWidth"],borderBlockEnd:["borderBlockEndColor","borderBlockEndStyle","borderBlockEndWidth"],borderBlockStart:["borderBlockStartColor","borderBlockStartStyle","borderBlockStartWidth"],borderBottom:["borderBottomColor","borderBottomStyle","borderBottomWidth"],borderColor:["borderBottomColor","borderLeftColor","borderRightColor","borderTopColor"],borderImage:["borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth"],borderInlineEnd:["borderInlineEndColor","borderInlineEndStyle","borderInlineEndWidth"],borderInlineStart:["borderInlineStartColor","borderInlineStartStyle","borderInlineStartWidth"],borderLeft:["borderLeftColor","borderLeftStyle","borderLeftWidth"],borderRadius:["borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"],borderRight:["borderRightColor","borderRightStyle","borderRightWidth"],borderStyle:["borderBottomStyle","borderLeftStyle","borderRightStyle","borderTopStyle"],borderTop:["borderTopColor","borderTopStyle","borderTopWidth"],borderWidth:["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth"],columnRule:["columnRuleColor","columnRuleStyle","columnRuleWidth"],columns:["columnCount","columnWidth"],flex:["flexBasis","flexGrow","flexShrink"],flexFlow:["flexDirection","flexWrap"],font:["fontFamily","fontFeatureSettings","fontKerning","fontLanguageOverride","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition","fontWeight","lineHeight"],fontVariant:["fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition"],gap:["columnGap","rowGap"],grid:["gridAutoColumns","gridAutoFlow","gridAutoRows","gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],gridArea:["gridColumnEnd","gridColumnStart","gridRowEnd","gridRowStart"],gridColumn:["gridColumnEnd","gridColumnStart"],gridColumnGap:["columnGap"],gridGap:["columnGap","rowGap"],gridRow:["gridRowEnd","gridRowStart"],gridRowGap:["rowGap"],gridTemplate:["gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],listStyle:["listStyleImage","listStylePosition","listStyleType"],margin:["marginBottom","marginLeft","marginRight","marginTop"],marker:["markerEnd","markerMid","markerStart"],mask:["maskClip","maskComposite","maskImage","maskMode","maskOrigin","maskPositionX","maskPositionY","maskRepeat","maskSize"],maskPosition:["maskPositionX","maskPositionY"],outline:["outlineColor","outlineStyle","outlineWidth"],overflow:["overflowX","overflowY"],padding:["paddingBottom","paddingLeft","paddingRight","paddingTop"],placeContent:["alignContent","justifyContent"],placeItems:["alignItems","justifyItems"],placeSelf:["alignSelf","justifySelf"],textDecoration:["textDecorationColor","textDecorationLine","textDecorationStyle"],textEmphasis:["textEmphasisColor","textEmphasisStyle"],transition:["transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction"],wordWrap:["overflowWrap"]},RI={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};function pG(i,s){return i+s.charAt(0).toUpperCase()+s.substring(1)}var mG=["Webkit","ms","Moz","O"];Object.keys(RI).forEach(function(i){mG.forEach(function(s){RI[pG(s,i)]=RI[i]})});function _A(i,s,u){var h=s==null||typeof s=="boolean"||s==="";return h?"":!u&&typeof s=="number"&&s!==0&&!(RI.hasOwnProperty(i)&&RI[i])?s+"px":(O(s,i),(""+s).trim())}var nw=/([A-Z])/g,iw=/^ms-/;function Sb(i){return i.replace(nw,"-$1").toLowerCase().replace(iw,"-ms-")}var kA=function(){};{var Dg=/^(?:webkit|moz|o)[A-Z]/,Rb=/^-ms-/,UA=/-(.)/g,bG=/;\s*$/,Jg={},wb={},DA=!1,vG=!1,Wb=function(i){return i.replace(UA,function(s,u){return u.toUpperCase()})},yG=function(i){Jg.hasOwnProperty(i)&&Jg[i]||(Jg[i]=!0,c("Unsupported style property %s. Did you mean %s?",i,Wb(i.replace(Rb,"ms-"))))},GG=function(i){Jg.hasOwnProperty(i)&&Jg[i]||(Jg[i]=!0,c("Unsupported vendor-prefixed style property %s. Did you mean %s?",i,i.charAt(0).toUpperCase()+i.slice(1)))},BG=function(i,s){wb.hasOwnProperty(s)&&wb[s]||(wb[s]=!0,c(`Style property values shouldn't contain a semicolon. Try "%s: %s" instead.`,i,s.replace(bG,"")))},JA=function(i,s){DA||(DA=!0,c("`NaN` is an invalid value for the `%s` css style property.",i))},Xr=function(i,s){vG||(vG=!0,c("`Infinity` is an invalid value for the `%s` css style property.",i))};kA=function(i,s){i.indexOf("-")>-1?yG(i):Dg.test(i)?GG(i):bG.test(s)&&BG(i,s),typeof s=="number"&&(isNaN(s)?JA(i,s):isFinite(s)||Xr(i,s))}}var xb=kA;function OA(i){{var s="",u="";for(var h in i)if(i.hasOwnProperty(h)){var p=i[h];if(p!=null){var B=h.indexOf("--")===0;s+=u+(B?h:Sb(h))+":",s+=_A(h,p,B),u=";"}}return s||null}}function ll(i,s){var u=i.style;for(var h in s)if(s.hasOwnProperty(h)){var p=h.indexOf("--")===0;p||xb(h,s[h]);var B=_A(h,s[h],p);h==="float"&&(h="cssFloat"),p?u.setProperty(h,B):u[h]=B}}function Og(i){return i==null||typeof i=="boolean"||i===""}function ss(i){var s={};for(var u in i)for(var h=fG[u]||[u],p=0;p<h.length;p++)s[h[p]]=u;return s}function os(i,s){{if(!s)return;var u=ss(i),h=ss(s),p={};for(var B in u){var x=u[B],Y=h[B];if(Y&&x!==Y){var z=x+","+Y;if(p[z])continue;p[z]=!0,c("%s a style property during rerender (%s) when a conflicting property is set (%s) can lead to styling bugs. To avoid this, don't mix shorthand and non-shorthand properties for the same value; instead, replace the shorthand with separate values.",Og(i[x])?"Removing":"Updating",x,Y)}}}}var Vb={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},Ro=Mt({menuitem:!0},Vb),Pl="__html";function jo(i,s){if(s){if(Ro[i]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw new Error(i+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");if(typeof s.dangerouslySetInnerHTML!="object"||!(Pl in s.dangerouslySetInnerHTML))throw new Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://reactjs.org/link/dangerously-set-inner-html for more information.")}if(!s.suppressContentEditableWarning&&s.contentEditable&&s.children!=null&&c("A component is `contentEditable` and contains `children` managed by React. It is now your responsibility to guarantee that none of those nodes are unexpectedly modified or duplicated. This is probably not intentional."),s.style!=null&&typeof s.style!="object")throw new Error("The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.")}}function Ql(i,s){if(i.indexOf("-")===-1)return typeof s.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jl={accept:"accept",acceptcharset:"acceptCharset","accept-charset":"acceptCharset",accesskey:"accessKey",action:"action",allowfullscreen:"allowFullScreen",alt:"alt",as:"as",async:"async",autocapitalize:"autoCapitalize",autocomplete:"autoComplete",autocorrect:"autoCorrect",autofocus:"autoFocus",autoplay:"autoPlay",autosave:"autoSave",capture:"capture",cellpadding:"cellPadding",cellspacing:"cellSpacing",challenge:"challenge",charset:"charSet",checked:"checked",children:"children",cite:"cite",class:"className",classid:"classID",classname:"className",cols:"cols",colspan:"colSpan",content:"content",contenteditable:"contentEditable",contextmenu:"contextMenu",controls:"controls",controlslist:"controlsList",coords:"coords",crossorigin:"crossOrigin",dangerouslysetinnerhtml:"dangerouslySetInnerHTML",data:"data",datetime:"dateTime",default:"default",defaultchecked:"defaultChecked",defaultvalue:"defaultValue",defer:"defer",dir:"dir",disabled:"disabled",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback",download:"download",draggable:"draggable",enctype:"encType",enterkeyhint:"enterKeyHint",for:"htmlFor",form:"form",formmethod:"formMethod",formaction:"formAction",formenctype:"formEncType",formnovalidate:"formNoValidate",formtarget:"formTarget",frameborder:"frameBorder",headers:"headers",height:"height",hidden:"hidden",high:"high",href:"href",hreflang:"hrefLang",htmlfor:"htmlFor",httpequiv:"httpEquiv","http-equiv":"httpEquiv",icon:"icon",id:"id",imagesizes:"imageSizes",imagesrcset:"imageSrcSet",innerhtml:"innerHTML",inputmode:"inputMode",integrity:"integrity",is:"is",itemid:"itemID",itemprop:"itemProp",itemref:"itemRef",itemscope:"itemScope",itemtype:"itemType",keyparams:"keyParams",keytype:"keyType",kind:"kind",label:"label",lang:"lang",list:"list",loop:"loop",low:"low",manifest:"manifest",marginwidth:"marginWidth",marginheight:"marginHeight",max:"max",maxlength:"maxLength",media:"media",mediagroup:"mediaGroup",method:"method",min:"min",minlength:"minLength",multiple:"multiple",muted:"muted",name:"name",nomodule:"noModule",nonce:"nonce",novalidate:"noValidate",open:"open",optimum:"optimum",pattern:"pattern",placeholder:"placeholder",playsinline:"playsInline",poster:"poster",preload:"preload",profile:"profile",radiogroup:"radioGroup",readonly:"readOnly",referrerpolicy:"referrerPolicy",rel:"rel",required:"required",reversed:"reversed",role:"role",rows:"rows",rowspan:"rowSpan",sandbox:"sandbox",scope:"scope",scoped:"scoped",scrolling:"scrolling",seamless:"seamless",selected:"selected",shape:"shape",size:"size",sizes:"sizes",span:"span",spellcheck:"spellCheck",src:"src",srcdoc:"srcDoc",srclang:"srcLang",srcset:"srcSet",start:"start",step:"step",style:"style",summary:"summary",tabindex:"tabIndex",target:"target",title:"title",type:"type",usemap:"useMap",value:"value",width:"width",wmode:"wmode",wrap:"wrap",about:"about",accentheight:"accentHeight","accent-height":"accentHeight",accumulate:"accumulate",additive:"additive",alignmentbaseline:"alignmentBaseline","alignment-baseline":"alignmentBaseline",allowreorder:"allowReorder",alphabetic:"alphabetic",amplitude:"amplitude",arabicform:"arabicForm","arabic-form":"arabicForm",ascent:"ascent",attributename:"attributeName",attributetype:"attributeType",autoreverse:"autoReverse",azimuth:"azimuth",basefrequency:"baseFrequency",baselineshift:"baselineShift","baseline-shift":"baselineShift",baseprofile:"baseProfile",bbox:"bbox",begin:"begin",bias:"bias",by:"by",calcmode:"calcMode",capheight:"capHeight","cap-height":"capHeight",clip:"clip",clippath:"clipPath","clip-path":"clipPath",clippathunits:"clipPathUnits",cliprule:"clipRule","clip-rule":"clipRule",color:"color",colorinterpolation:"colorInterpolation","color-interpolation":"colorInterpolation",colorinterpolationfilters:"colorInterpolationFilters","color-interpolation-filters":"colorInterpolationFilters",colorprofile:"colorProfile","color-profile":"colorProfile",colorrendering:"colorRendering","color-rendering":"colorRendering",contentscripttype:"contentScriptType",contentstyletype:"contentStyleType",cursor:"cursor",cx:"cx",cy:"cy",d:"d",datatype:"datatype",decelerate:"decelerate",descent:"descent",diffuseconstant:"diffuseConstant",direction:"direction",display:"display",divisor:"divisor",dominantbaseline:"dominantBaseline","dominant-baseline":"dominantBaseline",dur:"dur",dx:"dx",dy:"dy",edgemode:"edgeMode",elevation:"elevation",enablebackground:"enableBackground","enable-background":"enableBackground",end:"end",exponent:"exponent",externalresourcesrequired:"externalResourcesRequired",fill:"fill",fillopacity:"fillOpacity","fill-opacity":"fillOpacity",fillrule:"fillRule","fill-rule":"fillRule",filter:"filter",filterres:"filterRes",filterunits:"filterUnits",floodopacity:"floodOpacity","flood-opacity":"floodOpacity",floodcolor:"floodColor","flood-color":"floodColor",focusable:"focusable",fontfamily:"fontFamily","font-family":"fontFamily",fontsize:"fontSize","font-size":"fontSize",fontsizeadjust:"fontSizeAdjust","font-size-adjust":"fontSizeAdjust",fontstretch:"fontStretch","font-stretch":"fontStretch",fontstyle:"fontStyle","font-style":"fontStyle",fontvariant:"fontVariant","font-variant":"fontVariant",fontweight:"fontWeight","font-weight":"fontWeight",format:"format",from:"from",fx:"fx",fy:"fy",g1:"g1",g2:"g2",glyphname:"glyphName","glyph-name":"glyphName",glyphorientationhorizontal:"glyphOrientationHorizontal","glyph-orientation-horizontal":"glyphOrientationHorizontal",glyphorientationvertical:"glyphOrientationVertical","glyph-orientation-vertical":"glyphOrientationVertical",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",hanging:"hanging",horizadvx:"horizAdvX","horiz-adv-x":"horizAdvX",horizoriginx:"horizOriginX","horiz-origin-x":"horizOriginX",ideographic:"ideographic",imagerendering:"imageRendering","image-rendering":"imageRendering",in2:"in2",in:"in",inlist:"inlist",intercept:"intercept",k1:"k1",k2:"k2",k3:"k3",k4:"k4",k:"k",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",kerning:"kerning",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",letterspacing:"letterSpacing","letter-spacing":"letterSpacing",lightingcolor:"lightingColor","lighting-color":"lightingColor",limitingconeangle:"limitingConeAngle",local:"local",markerend:"markerEnd","marker-end":"markerEnd",markerheight:"markerHeight",markermid:"markerMid","marker-mid":"markerMid",markerstart:"markerStart","marker-start":"markerStart",markerunits:"markerUnits",markerwidth:"markerWidth",mask:"mask",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",mathematical:"mathematical",mode:"mode",numoctaves:"numOctaves",offset:"offset",opacity:"opacity",operator:"operator",order:"order",orient:"orient",orientation:"orientation",origin:"origin",overflow:"overflow",overlineposition:"overlinePosition","overline-position":"overlinePosition",overlinethickness:"overlineThickness","overline-thickness":"overlineThickness",paintorder:"paintOrder","paint-order":"paintOrder",panose1:"panose1","panose-1":"panose1",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointerevents:"pointerEvents","pointer-events":"pointerEvents",points:"points",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",prefix:"prefix",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",property:"property",r:"r",radius:"radius",refx:"refX",refy:"refY",renderingintent:"renderingIntent","rendering-intent":"renderingIntent",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",resource:"resource",restart:"restart",result:"result",results:"results",rotate:"rotate",rx:"rx",ry:"ry",scale:"scale",security:"security",seed:"seed",shaperendering:"shapeRendering","shape-rendering":"shapeRendering",slope:"slope",spacing:"spacing",specularconstant:"specularConstant",specularexponent:"specularExponent",speed:"speed",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stemh:"stemh",stemv:"stemv",stitchtiles:"stitchTiles",stopcolor:"stopColor","stop-color":"stopColor",stopopacity:"stopOpacity","stop-opacity":"stopOpacity",strikethroughposition:"strikethroughPosition","strikethrough-position":"strikethroughPosition",strikethroughthickness:"strikethroughThickness","strikethrough-thickness":"strikethroughThickness",string:"string",stroke:"stroke",strokedasharray:"strokeDasharray","stroke-dasharray":"strokeDasharray",strokedashoffset:"strokeDashoffset","stroke-dashoffset":"strokeDashoffset",strokelinecap:"strokeLinecap","stroke-linecap":"strokeLinecap",strokelinejoin:"strokeLinejoin","stroke-linejoin":"strokeLinejoin",strokemiterlimit:"strokeMiterlimit","stroke-miterlimit":"strokeMiterlimit",strokewidth:"strokeWidth","stroke-width":"strokeWidth",strokeopacity:"strokeOpacity","stroke-opacity":"strokeOpacity",suppresscontenteditablewarning:"suppressContentEditableWarning",suppresshydrationwarning:"suppressHydrationWarning",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textanchor:"textAnchor","text-anchor":"textAnchor",textdecoration:"textDecoration","text-decoration":"textDecoration",textlength:"textLength",textrendering:"textRendering","text-rendering":"textRendering",to:"to",transform:"transform",typeof:"typeof",u1:"u1",u2:"u2",underlineposition:"underlinePosition","underline-position":"underlinePosition",underlinethickness:"underlineThickness","underline-thickness":"underlineThickness",unicode:"unicode",unicodebidi:"unicodeBidi","unicode-bidi":"unicodeBidi",unicoderange:"unicodeRange","unicode-range":"unicodeRange",unitsperem:"unitsPerEm","units-per-em":"unitsPerEm",unselectable:"unselectable",valphabetic:"vAlphabetic","v-alphabetic":"vAlphabetic",values:"values",vectoreffect:"vectorEffect","vector-effect":"vectorEffect",version:"version",vertadvy:"vertAdvY","vert-adv-y":"vertAdvY",vertoriginx:"vertOriginX","vert-origin-x":"vertOriginX",vertoriginy:"vertOriginY","vert-origin-y":"vertOriginY",vhanging:"vHanging","v-hanging":"vHanging",videographic:"vIdeographic","v-ideographic":"vIdeographic",viewbox:"viewBox",viewtarget:"viewTarget",visibility:"visibility",vmathematical:"vMathematical","v-mathematical":"vMathematical",vocab:"vocab",widths:"widths",wordspacing:"wordSpacing","word-spacing":"wordSpacing",writingmode:"writingMode","writing-mode":"writingMode",x1:"x1",x2:"x2",x:"x",xchannelselector:"xChannelSelector",xheight:"xHeight","x-height":"xHeight",xlinkactuate:"xlinkActuate","xlink:actuate":"xlinkActuate",xlinkarcrole:"xlinkArcrole","xlink:arcrole":"xlinkArcrole",xlinkhref:"xlinkHref","xlink:href":"xlinkHref",xlinkrole:"xlinkRole","xlink:role":"xlinkRole",xlinkshow:"xlinkShow","xlink:show":"xlinkShow",xlinktitle:"xlinkTitle","xlink:title":"xlinkTitle",xlinktype:"xlinkType","xlink:type":"xlinkType",xmlbase:"xmlBase","xml:base":"xmlBase",xmllang:"xmlLang","xml:lang":"xmlLang",xmlns:"xmlns","xml:space":"xmlSpace",xmlnsxlink:"xmlnsXlink","xmlns:xlink":"xmlnsXlink",xmlspace:"xmlSpace",y1:"y1",y2:"y2",y:"y",ychannelselector:"yChannelSelector",z:"z",zoomandpan:"zoomAndPan"},Nb={"aria-current":0,"aria-description":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0},Yr={},PA=new RegExp("^(aria)-["+ae+"]*$"),gl=new RegExp("^(aria)[A-Z]["+ae+"]*$");function QA(i,s){{if(oe.call(Yr,s)&&Yr[s])return!0;if(gl.test(s)){var u="aria-"+s.slice(4).toLowerCase(),h=Nb.hasOwnProperty(u)?u:null;if(h==null)return c("Invalid ARIA attribute `%s`. ARIA attributes follow the pattern aria-* and must be lowercase.",s),Yr[s]=!0,!0;if(s!==h)return c("Invalid ARIA attribute `%s`. Did you mean `%s`?",s,h),Yr[s]=!0,!0}if(PA.test(s)){var p=s.toLowerCase(),B=Nb.hasOwnProperty(p)?p:null;if(B==null)return Yr[s]=!0,!1;if(s!==B)return c("Unknown ARIA attribute `%s`. Did you mean `%s`?",s,B),Yr[s]=!0,!0}}return!0}function Xb(i,s){{var u=[];for(var h in s){var p=QA(i,h);p||u.push(h)}var B=u.map(function(x){return"`"+x+"`"}).join(", ");u.length===1?c("Invalid aria prop %s on <%s> tag. For details, see https://reactjs.org/link/invalid-aria-props",B,i):u.length>1&&c("Invalid aria props %s on <%s> tag. For details, see https://reactjs.org/link/invalid-aria-props",B,i)}}function ZG(i,s){Ql(i,s)||Xb(i,s)}var Yb=!1;function jA(i,s){{if(i!=="input"&&i!=="textarea"&&i!=="select")return;s!=null&&s.value===null&&!Yb&&(Yb=!0,i==="select"&&s.multiple?c("`value` prop on `%s` should not be null. Consider using an empty array when `multiple` is set to `true` to clear the component or `undefined` for uncontrolled components.",i):c("`value` prop on `%s` should not be null. Consider using an empty string to clear the component or `undefined` for uncontrolled components.",i))}}var Mb=function(){};{var Xs={},Qc=/^on./,SG=/^on[^A-Z]/,Yn=new RegExp("^(aria)-["+ae+"]*$"),Ri=new RegExp("^(aria)[A-Z]["+ae+"]*$");Mb=function(i,s,u,h){if(oe.call(Xs,s)&&Xs[s])return!0;var p=s.toLowerCase();if(p==="onfocusin"||p==="onfocusout")return c("React uses onFocus and onBlur instead of onFocusIn and onFocusOut. All React events are normalized to bubble, so onFocusIn and onFocusOut are not needed/supported by React."),Xs[s]=!0,!0;if(h!=null){var B=h.registrationNameDependencies,x=h.possibleRegistrationNames;if(B.hasOwnProperty(s))return!0;var Y=x.hasOwnProperty(p)?x[p]:null;if(Y!=null)return c("Invalid event handler property `%s`. Did you mean `%s`?",s,Y),Xs[s]=!0,!0;if(Qc.test(s))return c("Unknown event handler property `%s`. It will be ignored.",s),Xs[s]=!0,!0}else if(Qc.test(s))return SG.test(s)&&c("Invalid event handler property `%s`. React events use the camelCase naming convention, for example `onClick`.",s),Xs[s]=!0,!0;if(Yn.test(s)||Ri.test(s))return!0;if(p==="innerhtml")return c("Directly setting property `innerHTML` is not permitted. For more information, lookup documentation on `dangerouslySetInnerHTML`."),Xs[s]=!0,!0;if(p==="aria")return c("The `aria` attribute is reserved for future use in React. Pass individual `aria-` attributes instead."),Xs[s]=!0,!0;if(p==="is"&&u!==null&&u!==void 0&&typeof u!="string")return c("Received a `%s` for a string attribute `is`. If this is expected, cast the value to a string.",typeof u),Xs[s]=!0,!0;if(typeof u=="number"&&isNaN(u))return c("Received NaN for the `%s` attribute. If this is expected, cast the value to a string.",s),Xs[s]=!0,!0;var z=gt(s),J=z!==null&&z.type===Oe;if(jl.hasOwnProperty(p)){var j=jl[p];if(j!==s)return c("Invalid DOM property `%s`. Did you mean `%s`?",s,j),Xs[s]=!0,!0}else if(!J&&s!==p)return c("React does not recognize the `%s` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `%s` instead. If you accidentally passed it from a parent component, remove it from the DOM element.",s,p),Xs[s]=!0,!0;return typeof u=="boolean"&&q(s,u,z,!1)?(u?c('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.',u,s,s,u,s):c('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.',u,s,s,u,s,s,s),Xs[s]=!0,!0):J?!0:q(s,u,z,!1)?(Xs[s]=!0,!1):((u==="false"||u==="true")&&z!==null&&z.type===Yt&&(c("Received the string `%s` for the boolean attribute `%s`. %s Did you mean %s={%s}?",u,s,u==="false"?"The browser will interpret it as a truthy value.":'Although this works, it will not work as expected if you pass the string "false".',s,u),Xs[s]=!0),!0)}}var Ii=function(i,s,u){{var h=[];for(var p in s){var B=Mb(i,p,s[p],u);B||h.push(p)}var x=h.map(function(Y){return"`"+Y+"`"}).join(", ");h.length===1?c("Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://reactjs.org/link/attribute-behavior ",x,i):h.length>1&&c("Invalid values for props %s on <%s> tag. Either remove them from the element, or pass a string or number value to keep them in the DOM. For details, see https://reactjs.org/link/attribute-behavior ",x,i)}};function ba(i,s,u){Ql(i,s)||Ii(i,s,u)}var Mr=1,qA=2,fC=4,aw=Mr|qA|fC,pC=null;function Hb(i){pC!==null&&c("Expected currently replaying event to be null. This error is likely caused by a bug in React. Please file an issue."),pC=i}function yt(){pC===null&&c("Expected currently replaying event to not be null. This error is likely caused by a bug in React. Please file an issue."),pC=null}function La(i){return i===pC}function On(i){var s=i.target||i.srcElement||window;return s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===Ol?s.parentNode:s}var Pg=null,wo=null,qo=null;function cl(i){var s=da(i);if(s){if(typeof Pg!="function")throw new Error("setRestoreImplementation() needs to be called to handle a target for controlled events. This error is likely caused by a bug in React. Please file an issue.");var u=s.stateNode;if(u){var h=Gp(u);Pg(s.stateNode,s.type,h)}}}function mC(i){Pg=i}function jc(i){wo?qo?qo.push(i):qo=[i]:wo=i}function bC(){return wo!==null||qo!==null}function $A(){if(wo){var i=wo,s=qo;if(wo=null,qo=null,cl(i),s)for(var u=0;u<s.length;u++)cl(s[u])}}var ef=function(i,s){return i(s)},tf=function(){},vC=!1;function Fb(){var i=bC();i&&(tf(),$A())}function nf(i,s,u){if(vC)return i(s,u);vC=!0;try{return ef(i,s,u)}finally{vC=!1,Fb()}}function Kb(i,s,u){ef=i,tf=u}function Eb(i){return i==="button"||i==="input"||i==="select"||i==="textarea"}function Tb(i,s,u){switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":return!!(u.disabled&&Eb(s));default:return!1}}function qc(i,s){var u=i.stateNode;if(u===null)return null;var h=Gp(u);if(h===null)return null;var p=h[s];if(Tb(s,i.type,h))return null;if(p&&typeof p!="function")throw new Error("Expected `"+s+"` listener to be a function, instead got a value of `"+typeof p+"` type.");return p}var yC=!1;if(Ot)try{var $c={};Object.defineProperty($c,"passive",{get:function(){yC=!0}}),window.addEventListener("test",$c,$c),window.removeEventListener("test",$c,$c)}catch{yC=!1}function af(i,s,u,h,p,B,x,Y,z){var J=Array.prototype.slice.call(arguments,3);try{s.apply(u,J)}catch(j){this.onError(j)}}var sf=af;if(typeof window<"u"&&typeof window.dispatchEvent=="function"&&typeof document<"u"&&typeof document.createEvent=="function"){var GC=document.createElement("react");sf=function(s,u,h,p,B,x,Y,z,J){if(typeof document>"u"||document===null)throw new Error("The `document` global was defined when React was initialized, but is not defined anymore. This can happen in a test environment if a component schedules an update from an asynchronous callback, but the test has already finished running. To solve this, you can either unmount the component at the end of your test (and ensure that any asynchronous operations get canceled in `componentWillUnmount`), or you can change the test itself to be asynchronous.");var j=document.createEvent("Event"),pe=!1,fe=!0,He=window.event,ze=Object.getOwnPropertyDescriptor(window,"event");function je(){GC.removeEventListener(qe,bn,!1),typeof window.event<"u"&&window.hasOwnProperty("event")&&(window.event=He)}var Jt=Array.prototype.slice.call(arguments,3);function bn(){pe=!0,je(),u.apply(h,Jt),fe=!1}var gn,ii=!1,$n=!1;function We(xe){if(gn=xe.error,ii=!0,gn===null&&xe.colno===0&&xe.lineno===0&&($n=!0),xe.defaultPrevented&&gn!=null&&typeof gn=="object")try{gn._suppressLogging=!0}catch{}}var qe="react-"+(s||"invokeguardedcallback");if(window.addEventListener("error",We),GC.addEventListener(qe,bn,!1),j.initEvent(qe,!1,!1),GC.dispatchEvent(j),ze&&Object.defineProperty(window,"event",ze),pe&&fe&&(ii?$n&&(gn=new Error("A cross-origin error was thrown. React doesn't have access to the actual error object in development. See https://reactjs.org/link/crossorigin-error for more information.")):gn=new Error(`An error was thrown inside one of your components, but React doesn't know what it was. This is likely due to browser flakiness. React does its best to preserve the "Pause on exceptions" behavior of the DevTools, which requires some DEV-mode only tricks. It's possible that these don't work in your browser. Try triggering the error in production mode, or switching to a modern browser. If you suspect that this is actually an issue with React, please file an issue.`),this.onError(gn)),window.removeEventListener("error",We),!pe)return je(),af.apply(this,arguments)}}var of=sf,Hr=!1,wI=null,WI=!1,BC=null,zb={onError:function(i){Hr=!0,wI=i}};function rf(i,s,u,h,p,B,x,Y,z){Hr=!1,wI=null,of.apply(zb,arguments)}function ZC(i,s,u,h,p,B,x,Y,z){if(rf.apply(this,arguments),Hr){var J=ql();WI||(WI=!0,BC=J)}}function RG(){if(WI){var i=BC;throw WI=!1,BC=null,i}}function SC(){return Hr}function ql(){if(Hr){var i=wI;return Hr=!1,wI=null,i}else throw new Error("clearCaughtError was called but no error was captured. This error is likely caused by a bug in React. Please file an issue.")}function _a(i){return i._reactInternals}function sw(i){return i._reactInternals!==void 0}function Fi(i,s){i._reactInternals=s}var fn=0,$l=1,ji=2,ei=4,eu=16,RC=32,wG=64,ai=128,Fr=256,tu=512,Qg=1024,eg=2048,tg=4096,ul=8192,Lb=16384,WG=32767,lf=32768,Ys=65536,ng=131072,xI=1048576,ig=2097152,ag=4194304,Ms=8388608,Wo=16777216,Kn=33554432,VI=ei|Qg|0,gf=ji|ei|eu|RC|tu|tg|ul,cf=ei|wG|tu|ul,NI=eg|eu,Kr=ag|Ms|ig,wC=t.ReactCurrentOwner;function nu(i){var s=i,u=i;if(i.alternate)for(;s.return;)s=s.return;else{var h=s;do s=h,(s.flags&(ji|tg))!==fn&&(u=s.return),h=s.return;while(h)}return s.tag===b?u:null}function _b(i){if(i.tag===H){var s=i.memoizedState;if(s===null){var u=i.alternate;u!==null&&(s=u.memoizedState)}if(s!==null)return s.dehydrated}return null}function xG(i){return i.tag===b?i.stateNode.containerInfo:null}function kb(i){return nu(i)===i}function ow(i){{var s=wC.current;if(s!==null&&s.tag===d){var u=s,h=u.stateNode;h._warnedAboutRefsInRender||c("%s is accessing isMounted inside its render() function. render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",Xn(u)||"A component"),h._warnedAboutRefsInRender=!0}}var p=_a(i);return p?nu(p)===p:!1}function Ub(i){if(nu(i)!==i)throw new Error("Unable to find node on an unmounted component.")}function Db(i){var s=i.alternate;if(!s){var u=nu(i);if(u===null)throw new Error("Unable to find node on an unmounted component.");return u!==i?null:i}for(var h=i,p=s;;){var B=h.return;if(B===null)break;var x=B.alternate;if(x===null){var Y=B.return;if(Y!==null){h=p=Y;continue}break}if(B.child===x.child){for(var z=B.child;z;){if(z===h)return Ub(B),i;if(z===p)return Ub(B),s;z=z.sibling}throw new Error("Unable to find node on an unmounted component.")}if(h.return!==p.return)h=B,p=x;else{for(var J=!1,j=B.child;j;){if(j===h){J=!0,h=B,p=x;break}if(j===p){J=!0,p=B,h=x;break}j=j.sibling}if(!J){for(j=x.child;j;){if(j===h){J=!0,h=x,p=B;break}if(j===p){J=!0,p=x,h=B;break}j=j.sibling}if(!J)throw new Error("Child was not found in either parent set. This indicates a bug in React related to the return pointer. Please file an issue.")}}if(h.alternate!==p)throw new Error("Return fibers should always be each others' alternates. This error is likely caused by a bug in React. Please file an issue.")}if(h.tag!==b)throw new Error("Unable to find node on an unmounted component.");return h.stateNode.current===h?i:s}function Er(i){var s=Db(i);return s!==null?XI(s):null}function XI(i){if(i.tag===y||i.tag===Z)return i;for(var s=i.child;s!==null;){var u=XI(s);if(u!==null)return u;s=s.sibling}return null}function WC(i){var s=Db(i);return s!==null?uf(s):null}function uf(i){if(i.tag===y||i.tag===Z)return i;for(var s=i.child;s!==null;){if(s.tag!==v){var u=uf(s);if(u!==null)return u}s=s.sibling}return null}var YI=e.unstable_scheduleCallback,Tr=e.unstable_cancelCallback,ka=e.unstable_shouldYield,rw=e.unstable_requestPaint,Ua=e.unstable_now,lw=e.unstable_getCurrentPriorityLevel,xC=e.unstable_ImmediatePriority,If=e.unstable_UserBlockingPriority,jg=e.unstable_NormalPriority,gw=e.unstable_LowPriority,Jb=e.unstable_IdlePriority,cw=e.unstable_yieldValue,Da=e.unstable_setDisableYieldValue,sg=null,rs=null,zt=null,zr=!1,Lr=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u";function uw(i){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")return!1;var s=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(s.isDisabled)return!0;if(!s.supportsFiber)return c("The installed version of React DevTools is too old and will not work with the current version of React. Please update React DevTools. https://reactjs.org/link/react-devtools"),!0;try{de&&(i=Mt({},i,{getLaneLabelMap:dw,injectProfilingHooks:Iw})),sg=s.inject(i),rs=s}catch(u){c("React instrumentation encountered an error: %s.",u)}return!!s.checkDCE}function MI(i,s){if(rs&&typeof rs.onScheduleFiberRoot=="function")try{rs.onScheduleFiberRoot(sg,i,s)}catch(u){zr||(zr=!0,c("React instrumentation encountered an error: %s",u))}}function bs(i,s){if(rs&&typeof rs.onCommitFiberRoot=="function")try{var u=(i.current.flags&ai)===ai;if(Ee){var h;switch(s){case Fs:h=xC;break;case kr:h=If;break;case Ur:h=jg;break;case kI:h=Jb;break;default:h=jg;break}rs.onCommitFiberRoot(sg,i,h,u)}}catch(p){zr||(zr=!0,c("React instrumentation encountered an error: %s",p))}}function Pt(i){if(rs&&typeof rs.onPostCommitFiberRoot=="function")try{rs.onPostCommitFiberRoot(sg,i)}catch(s){zr||(zr=!0,c("React instrumentation encountered an error: %s",s))}}function Il(i){if(rs&&typeof rs.onCommitFiberUnmount=="function")try{rs.onCommitFiberUnmount(sg,i)}catch(s){zr||(zr=!0,c("React instrumentation encountered an error: %s",s))}}function wi(i){if(typeof cw=="function"&&(Da(i),a(i)),rs&&typeof rs.setStrictMode=="function")try{rs.setStrictMode(sg,i)}catch(s){zr||(zr=!0,c("React instrumentation encountered an error: %s",s))}}function Iw(i){zt=i}function dw(){{for(var i=new Map,s=1,u=0;u<XC;u++){var h=_r(s);i.set(s,h),s*=2}return i}}function Cw(i){zt!==null&&typeof zt.markCommitStarted=="function"&&zt.markCommitStarted(i)}function VG(){zt!==null&&typeof zt.markCommitStopped=="function"&&zt.markCommitStopped()}function VC(i){zt!==null&&typeof zt.markComponentRenderStarted=="function"&&zt.markComponentRenderStarted(i)}function ia(){zt!==null&&typeof zt.markComponentRenderStopped=="function"&&zt.markComponentRenderStopped()}function hw(i){zt!==null&&typeof zt.markComponentPassiveEffectMountStarted=="function"&&zt.markComponentPassiveEffectMountStarted(i)}function Aw(){zt!==null&&typeof zt.markComponentPassiveEffectMountStopped=="function"&&zt.markComponentPassiveEffectMountStopped()}function fw(i){zt!==null&&typeof zt.markComponentPassiveEffectUnmountStarted=="function"&&zt.markComponentPassiveEffectUnmountStarted(i)}function NG(){zt!==null&&typeof zt.markComponentPassiveEffectUnmountStopped=="function"&&zt.markComponentPassiveEffectUnmountStopped()}function NC(i){zt!==null&&typeof zt.markComponentLayoutEffectMountStarted=="function"&&zt.markComponentLayoutEffectMountStarted(i)}function HI(){zt!==null&&typeof zt.markComponentLayoutEffectMountStopped=="function"&&zt.markComponentLayoutEffectMountStopped()}function XG(i){zt!==null&&typeof zt.markComponentLayoutEffectUnmountStarted=="function"&&zt.markComponentLayoutEffectUnmountStarted(i)}function YG(){zt!==null&&typeof zt.markComponentLayoutEffectUnmountStopped=="function"&&zt.markComponentLayoutEffectUnmountStopped()}function pw(i,s,u){zt!==null&&typeof zt.markComponentErrored=="function"&&zt.markComponentErrored(i,s,u)}function mw(i,s,u){zt!==null&&typeof zt.markComponentSuspended=="function"&&zt.markComponentSuspended(i,s,u)}function bw(i){zt!==null&&typeof zt.markLayoutEffectsStarted=="function"&&zt.markLayoutEffectsStarted(i)}function vw(){zt!==null&&typeof zt.markLayoutEffectsStopped=="function"&&zt.markLayoutEffectsStopped()}function MG(i){zt!==null&&typeof zt.markPassiveEffectsStarted=="function"&&zt.markPassiveEffectsStarted(i)}function HG(){zt!==null&&typeof zt.markPassiveEffectsStopped=="function"&&zt.markPassiveEffectsStopped()}function FG(i){zt!==null&&typeof zt.markRenderStarted=="function"&&zt.markRenderStarted(i)}function yw(){zt!==null&&typeof zt.markRenderYielded=="function"&&zt.markRenderYielded()}function KG(){zt!==null&&typeof zt.markRenderStopped=="function"&&zt.markRenderStopped()}function Gw(i){zt!==null&&typeof zt.markRenderScheduled=="function"&&zt.markRenderScheduled(i)}function Bw(i,s){zt!==null&&typeof zt.markForceUpdateScheduled=="function"&&zt.markForceUpdateScheduled(i,s)}function Ob(i,s){zt!==null&&typeof zt.markStateUpdateScheduled=="function"&&zt.markStateUpdateScheduled(i,s)}var pn=0,jn=1,pi=2,ca=8,dl=16,df=Math.clz32?Math.clz32:og,Zw=Math.log,$o=Math.LN2;function og(i){var s=i>>>0;return s===0?32:31-(Zw(s)/$o|0)|0}var XC=31,It=0,xa=0,wn=1,iu=2,Ja=4,qg=8,Cl=16,YC=32,FI=4194240,$g=64,Pb=128,Cf=256,hf=512,ao=1024,au=2048,Qb=4096,jb=8192,Oa=16384,va=32768,er=65536,xo=131072,qb=262144,rg=524288,su=1048576,ou=2097152,ec=130023424,hl=4194304,ru=8388608,lu=16777216,lg=33554432,KI=67108864,$b=hl,EI=134217728,ev=268435455,gu=268435456,cu=536870912,Vo=1073741824;function _r(i){{if(i&wn)return"Sync";if(i&iu)return"InputContinuousHydration";if(i&Ja)return"InputContinuous";if(i&qg)return"DefaultHydration";if(i&Cl)return"Default";if(i&YC)return"TransitionHydration";if(i&FI)return"Transition";if(i&ec)return"Retry";if(i&EI)return"SelectiveHydration";if(i&gu)return"IdleHydration";if(i&cu)return"Idle";if(i&Vo)return"Offscreen"}}var Bi=-1,tc=$g,uu=hl;function Al(i){switch(nc(i)){case wn:return wn;case iu:return iu;case Ja:return Ja;case qg:return qg;case Cl:return Cl;case YC:return YC;case $g:case Pb:case Cf:case hf:case ao:case au:case Qb:case jb:case Oa:case va:case er:case xo:case qb:case rg:case su:case ou:return i&FI;case hl:case ru:case lu:case lg:case KI:return i&ec;case EI:return EI;case gu:return gu;case cu:return cu;case Vo:return Vo;default:return c("Should have found matching lanes. This is a bug in React."),i}}function TI(i,s){var u=i.pendingLanes;if(u===It)return It;var h=It,p=i.suspendedLanes,B=i.pingedLanes,x=u&ev;if(x!==It){var Y=x&~p;if(Y!==It)h=Al(Y);else{var z=x&B;z!==It&&(h=Al(z))}}else{var J=u&~p;J!==It?h=Al(J):B!==It&&(h=Al(B))}if(h===It)return It;if(s!==It&&s!==h&&(s&p)===It){var j=nc(h),pe=nc(s);if(j>=pe||j===Cl&&(pe&FI)!==It)return s}(h&Ja)!==It&&(h|=u&Cl);var fe=i.entangledLanes;if(fe!==It)for(var He=i.entanglements,ze=h&fe;ze>0;){var je=gg(ze),Jt=1<<je;h|=He[je],ze&=~Jt}return h}function Af(i,s){for(var u=i.eventTimes,h=Bi;s>0;){var p=gg(s),B=1<<p,x=u[p];x>h&&(h=x),s&=~B}return h}function ff(i,s){switch(i){case wn:case iu:case Ja:return s+250;case qg:case Cl:case YC:case $g:case Pb:case Cf:case hf:case ao:case au:case Qb:case jb:case Oa:case va:case er:case xo:case qb:case rg:case su:case ou:return s+5e3;case hl:case ru:case lu:case lg:case KI:return Bi;case EI:case gu:case cu:case Vo:return Bi;default:return c("Should have found matching lanes. This is a bug in React."),Bi}}function EG(i,s){for(var u=i.pendingLanes,h=i.suspendedLanes,p=i.pingedLanes,B=i.expirationTimes,x=u;x>0;){var Y=gg(x),z=1<<Y,J=B[Y];J===Bi?((z&h)===It||(z&p)!==It)&&(B[Y]=ff(z,s)):J<=s&&(i.expiredLanes|=z),x&=~z}}function TG(i){return Al(i.pendingLanes)}function pf(i){var s=i.pendingLanes&~Vo;return s!==It?s:s&Vo?Vo:It}function tv(i){return(i&wn)!==It}function MC(i){return(i&ev)!==It}function zG(i){return(i&ec)===i}function Sw(i){var s=wn|Ja|Cl;return(i&s)===It}function zI(i){return(i&FI)===i}function aa(i,s){var u=iu|Ja|qg|Cl;return(s&u)!==It}function Iu(i,s){return(s&i.expiredLanes)!==It}function nv(i){return(i&FI)!==It}function LG(){var i=tc;return tc<<=1,(tc&FI)===It&&(tc=$g),i}function _G(){var i=uu;return uu<<=1,(uu&ec)===It&&(uu=hl),i}function nc(i){return i&-i}function ic(i){return nc(i)}function gg(i){return 31-df(i)}function LI(i){return gg(i)}function Hs(i,s){return(i&s)!==It}function cg(i,s){return(i&s)===s}function Fn(i,s){return i|s}function HC(i,s){return i&~s}function fl(i,s){return i&s}function du(i){return i}function mf(i,s){return i!==xa&&i<s?i:s}function FC(i){for(var s=[],u=0;u<XC;u++)s.push(i);return s}function KC(i,s,u){i.pendingLanes|=s,s!==cu&&(i.suspendedLanes=It,i.pingedLanes=It);var h=i.eventTimes,p=LI(s);h[p]=u}function bf(i,s){i.suspendedLanes|=s,i.pingedLanes&=~s;for(var u=i.expirationTimes,h=s;h>0;){var p=gg(h),B=1<<p;u[p]=Bi,h&=~B}}function kG(i,s,u){i.pingedLanes|=i.suspendedLanes&s}function UG(i,s){var u=i.pendingLanes&~s;i.pendingLanes=s,i.suspendedLanes=It,i.pingedLanes=It,i.expiredLanes&=s,i.mutableReadLanes&=s,i.entangledLanes&=s;for(var h=i.entanglements,p=i.eventTimes,B=i.expirationTimes,x=u;x>0;){var Y=gg(x),z=1<<Y;h[Y]=It,p[Y]=Bi,B[Y]=Bi,x&=~z}}function _I(i,s){for(var u=i.entangledLanes|=s,h=i.entanglements,p=u;p;){var B=gg(p),x=1<<B;x&s|h[B]&s&&(h[B]|=s),p&=~x}}function DG(i,s){var u=nc(s),h;switch(u){case Ja:h=iu;break;case Cl:h=qg;break;case $g:case Pb:case Cf:case hf:case ao:case au:case Qb:case jb:case Oa:case va:case er:case xo:case qb:case rg:case su:case ou:case hl:case ru:case lu:case lg:case KI:h=YC;break;case cu:h=gu;break;default:h=xa;break}return(h&(i.suspendedLanes|s))!==xa?xa:h}function vf(i,s,u){if(Lr)for(var h=i.pendingUpdatersLaneMap;u>0;){var p=LI(u),B=1<<p,x=h[p];x.add(s),u&=~B}}function iv(i,s){if(Lr)for(var u=i.pendingUpdatersLaneMap,h=i.memoizedUpdaters;s>0;){var p=LI(s),B=1<<p,x=u[p];x.size>0&&(x.forEach(function(Y){var z=Y.alternate;(z===null||!h.has(z))&&h.add(Y)}),x.clear()),s&=~B}}function yf(i,s){return null}var Fs=wn,kr=Ja,Ur=Cl,kI=cu,UI=xa;function so(){return UI}function ya(i){UI=i}function av(i,s){var u=UI;try{return UI=i,s()}finally{UI=u}}function sv(i,s){return i!==0&&i<s?i:s}function JG(i,s){return i>s?i:s}function EC(i,s){return i!==0&&i<s}function Gf(i){var s=nc(i);return EC(Fs,s)?EC(kr,s)?MC(s)?Ur:kI:kr:Fs}function TC(i){var s=i.current.memoizedState;return s.isDehydrated}var OG;function PG(i){OG=i}function QG(i){OG(i)}var ov;function jG(i){ov=i}var Bf;function Rw(i){Bf=i}var qG;function DI(i){qG=i}var Cu;function Zf(i){Cu=i}var JI=!1,Ks=[],Va=null,oo=null,vs=null,No=new Map,zC=new Map,ac=[],ww=["mousedown","mouseup","touchcancel","touchend","touchstart","auxclick","dblclick","pointercancel","pointerdown","pointerup","dragend","dragstart","drop","compositionend","compositionstart","keydown","keypress","keyup","input","textInput","copy","cut","paste","click","change","contextmenu","reset","submit"];function hu(i){return ww.indexOf(i)>-1}function $G(i,s,u,h,p){return{blockedOn:i,domEventName:s,eventSystemFlags:u,nativeEvent:p,targetContainers:[h]}}function Sf(i,s){switch(i){case"focusin":case"focusout":Va=null;break;case"dragenter":case"dragleave":oo=null;break;case"mouseover":case"mouseout":vs=null;break;case"pointerover":case"pointerout":{var u=s.pointerId;No.delete(u);break}case"gotpointercapture":case"lostpointercapture":{var h=s.pointerId;zC.delete(h);break}}}function sc(i,s,u,h,p,B){if(i===null||i.nativeEvent!==B){var x=$G(s,u,h,p,B);if(s!==null){var Y=da(s);Y!==null&&ov(Y)}return x}i.eventSystemFlags|=h;var z=i.targetContainers;return p!==null&&z.indexOf(p)===-1&&z.push(p),i}function Ww(i,s,u,h,p){switch(s){case"focusin":{var B=p;return Va=sc(Va,i,s,u,h,B),!0}case"dragenter":{var x=p;return oo=sc(oo,i,s,u,h,x),!0}case"mouseover":{var Y=p;return vs=sc(vs,i,s,u,h,Y),!0}case"pointerover":{var z=p,J=z.pointerId;return No.set(J,sc(No.get(J)||null,i,s,u,h,z)),!0}case"gotpointercapture":{var j=p,pe=j.pointerId;return zC.set(pe,sc(zC.get(pe)||null,i,s,u,h,j)),!0}}return!1}function Rf(i){var s=Su(i.target);if(s!==null){var u=nu(s);if(u!==null){var h=u.tag;if(h===H){var p=_b(u);if(p!==null){i.blockedOn=p,Cu(i.priority,function(){Bf(u)});return}}else if(h===b){var B=u.stateNode;if(TC(B)){i.blockedOn=xG(u);return}}}}i.blockedOn=null}function xw(i){for(var s=qG(),u={blockedOn:null,target:i,priority:s},h=0;h<ac.length&&EC(s,ac[h].priority);h++);ac.splice(h,0,u),h===0&&Rf(u)}function wf(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;s.length>0;){var u=s[0],h=xf(i.domEventName,i.eventSystemFlags,u,i.nativeEvent);if(h===null){var p=i.nativeEvent,B=new p.constructor(p.type,p);Hb(B),p.target.dispatchEvent(B),yt()}else{var x=da(h);return x!==null&&ov(x),i.blockedOn=h,!1}s.shift()}return!0}function oc(i,s,u){wf(i)&&u.delete(s)}function ls(){JI=!1,Va!==null&&wf(Va)&&(Va=null),oo!==null&&wf(oo)&&(oo=null),vs!==null&&wf(vs)&&(vs=null),No.forEach(oc),zC.forEach(oc)}function ys(i,s){i.blockedOn===s&&(i.blockedOn=null,JI||(JI=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,ls)))}function Es(i){if(Ks.length>0){ys(Ks[0],i);for(var s=1;s<Ks.length;s++){var u=Ks[s];u.blockedOn===i&&(u.blockedOn=null)}}Va!==null&&ys(Va,i),oo!==null&&ys(oo,i),vs!==null&&ys(vs,i);var h=function(Y){return ys(Y,i)};No.forEach(h),zC.forEach(h);for(var p=0;p<ac.length;p++){var B=ac[p];B.blockedOn===i&&(B.blockedOn=null)}for(;ac.length>0;){var x=ac[0];if(x.blockedOn!==null)break;Rf(x),x.blockedOn===null&&ac.shift()}}var tr=t.ReactCurrentBatchConfig,pl=!0;function eB(i){pl=!!i}function Vw(){return pl}function Nw(i,s,u){var h=Vf(s),p;switch(h){case Fs:p=Xw;break;case kr:p=tB;break;case Ur:default:p=Wf;break}return p.bind(null,s,u,i)}function Xw(i,s,u,h){var p=so(),B=tr.transition;tr.transition=null;try{ya(Fs),Wf(i,s,u,h)}finally{ya(p),tr.transition=B}}function tB(i,s,u,h){var p=so(),B=tr.transition;tr.transition=null;try{ya(kr),Wf(i,s,u,h)}finally{ya(p),tr.transition=B}}function Wf(i,s,u,h){pl&&rv(i,s,u,h)}function rv(i,s,u,h){var p=xf(i,s,u,h);if(p===null){vl(i,s,h,LC,u),Sf(i,h);return}if(Ww(p,i,s,u,h)){h.stopPropagation();return}if(Sf(i,h),s&fC&&hu(i)){for(;p!==null;){var B=da(p);B!==null&&QG(B);var x=xf(i,s,u,h);if(x===null&&vl(i,s,h,LC,u),x===p)break;p=x}p!==null&&h.stopPropagation();return}vl(i,s,h,null,u)}var LC=null;function xf(i,s,u,h){LC=null;var p=On(h),B=Su(p);if(B!==null){var x=nu(B);if(x===null)B=null;else{var Y=x.tag;if(Y===H){var z=_b(x);if(z!==null)return z;B=null}else if(Y===b){var J=x.stateNode;if(TC(J))return xG(x);B=null}else x!==B&&(B=null)}}return LC=B,null}function Vf(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return Fs;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return kr;case"message":{var s=lw();switch(s){case xC:return Fs;case If:return kr;case jg:case gw:return Ur;case Jb:return kI;default:return Ur}}default:return Ur}}function lv(i,s,u){return i.addEventListener(s,u,!1),u}function gv(i,s,u){return i.addEventListener(s,u,!0),u}function Yw(i,s,u,h){return i.addEventListener(s,u,{capture:!0,passive:h}),u}function Mw(i,s,u,h){return i.addEventListener(s,u,{passive:h}),u}var _C=null,cv=null,OI=null;function kC(i){return _C=i,cv=Au(),!0}function Hw(){_C=null,cv=null,OI=null}function uv(){if(OI)return OI;var i,s=cv,u=s.length,h,p=Au(),B=p.length;for(i=0;i<u&&s[i]===p[i];i++);var x=u-i;for(h=1;h<=x&&s[u-h]===p[B-h];h++);var Y=h>1?1-h:void 0;return OI=p.slice(i,Y),OI}function Au(){return"value"in _C?_C.value:_C.textContent}function UC(i){var s,u=i.keyCode;return"charCode"in i?(s=i.charCode,s===0&&u===13&&(s=13)):s=u,s===10&&(s=13),s>=32||s===13?s:0}function Na(){return!0}function Nf(){return!1}function Ts(i){function s(u,h,p,B,x){this._reactName=u,this._targetInst=p,this.type=h,this.nativeEvent=B,this.target=x,this.currentTarget=null;for(var Y in i)if(i.hasOwnProperty(Y)){var z=i[Y];z?this[Y]=z(B):this[Y]=B[Y]}var J=B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1;return J?this.isDefaultPrevented=Na:this.isDefaultPrevented=Nf,this.isPropagationStopped=Nf,this}return Mt(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Na)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Na)},persist:function(){},isPersistent:Na}),s}var rc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},DC=Ts(rc),fu=Mt({},rc,{view:0,detail:0}),Iv=Ts(fu),Xf,pu,lc;function Yf(i){i!==lc&&(lc&&i.type==="mousemove"?(Xf=i.screenX-lc.screenX,pu=i.screenY-lc.screenY):(Xf=0,pu=0),lc=i)}var JC=Mt({},fu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Kf,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(Yf(i),Xf)},movementY:function(i){return"movementY"in i?i.movementY:pu}}),dv=Ts(JC),PI=Mt({},JC,{dataTransfer:0}),nB=Ts(PI),Fw=Mt({},fu,{relatedTarget:0}),Cv=Ts(Fw),OC=Mt({},rc,{animationName:0,elapsedTime:0,pseudoElement:0}),gc=Ts(OC),PC=Mt({},rc,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Mf=Ts(PC),Hf=Mt({},rc,{data:0}),Ff=Ts(Hf),hv=Ff,QI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},QC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};function iB(i){if(i.key){var s=QI[i.key]||i.key;if(s!=="Unidentified")return s}if(i.type==="keypress"){var u=UC(i);return u===13?"Enter":String.fromCharCode(u)}return i.type==="keydown"||i.type==="keyup"?QC[i.keyCode]||"Unidentified":""}var Av={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Kw(i){var s=this,u=s.nativeEvent;if(u.getModifierState)return u.getModifierState(i);var h=Av[i];return h?!!u[h]:!1}function Kf(i){return Kw}var aB=Mt({},fu,{key:iB,code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Kf,charCode:function(i){return i.type==="keypress"?UC(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?UC(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),jC=Ts(aB),Dr=Mt({},JC,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ef=Ts(Dr),jI=Mt({},fu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Kf}),fv=Ts(jI),Ew=Mt({},rc,{propertyName:0,elapsedTime:0,pseudoElement:0}),cc=Ts(Ew),qI=Mt({},JC,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Tw=Ts(qI),Tf=[9,13,27,32],Jr=229,Li=Ot&&"CompositionEvent"in window,nr=null;Ot&&"documentMode"in document&&(nr=document.documentMode);var Ia=Ot&&"TextEvent"in window&&!nr,Pa=Ot&&(!Li||nr&&nr>8&&nr<=11),zf=32,Lf=String.fromCharCode(zf);function zw(){$t("onBeforeInput",["compositionend","keypress","textInput","paste"]),$t("onCompositionEnd",["compositionend","focusout","keydown","keypress","keyup","mousedown"]),$t("onCompositionStart",["compositionstart","focusout","keydown","keypress","keyup","mousedown"]),$t("onCompositionUpdate",["compositionupdate","focusout","keydown","keypress","keyup","mousedown"])}var Qt=!1;function ro(i){return(i.ctrlKey||i.altKey||i.metaKey)&&!(i.ctrlKey&&i.altKey)}function pv(i){switch(i){case"compositionstart":return"onCompositionStart";case"compositionend":return"onCompositionEnd";case"compositionupdate":return"onCompositionUpdate"}}function $I(i,s){return i==="keydown"&&s.keyCode===Jr}function mu(i,s){switch(i){case"keyup":return Tf.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==Jr;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Zi(i){var s=i.detail;return typeof s=="object"&&"data"in s?s.data:null}function gs(i){return i.locale==="ko"}var qi=!1;function _f(i,s,u,h,p){var B,x;if(Li?B=pv(s):qi?mu(s,h)&&(B="onCompositionEnd"):$I(s,h)&&(B="onCompositionStart"),!B)return null;Pa&&!gs(h)&&(!qi&&B==="onCompositionStart"?qi=kC(p):B==="onCompositionEnd"&&qi&&(x=uv()));var Y=hc(u,B);if(Y.length>0){var z=new Ff(B,s,null,h,p);if(i.push({event:z,listeners:Y}),x)z.data=x;else{var J=Zi(h);J!==null&&(z.data=J)}}}function qC(i,s){switch(i){case"compositionend":return Zi(s);case"keypress":var u=s.which;return u!==zf?null:(Qt=!0,Lf);case"textInput":var h=s.data;return h===Lf&&Qt?null:h;default:return null}}function $C(i,s){if(qi){if(i==="compositionend"||!Li&&mu(i,s)){var u=uv();return Hw(),qi=!1,u}return null}switch(i){case"paste":return null;case"keypress":if(!ro(s)){if(s.char&&s.char.length>1)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Pa&&!gs(s)?null:s.data;default:return null}}function Lw(i,s,u,h,p){var B;if(Ia?B=qC(s,h):B=$C(s,h),!B)return null;var x=hc(u,"onBeforeInput");if(x.length>0){var Y=new hv("onBeforeInput","beforeinput",null,h,p);i.push({event:Y,listeners:x}),Y.data=B}}function _w(i,s,u,h,p,B,x){_f(i,s,u,h,p),Lw(i,s,u,h,p)}var st={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xo(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!st[i.type]:s==="textarea"}/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function uc(i){if(!Ot)return!1;var s="on"+i,u=s in document;if(!u){var h=document.createElement("div");h.setAttribute(s,"return;"),u=typeof h[s]=="function"}return u}function mv(){$t("onChange",["change","click","focusin","focusout","input","keydown","keyup","selectionchange"])}function si(i,s,u,h){jc(h);var p=hc(s,"onChange");if(p.length>0){var B=new DC("onChange","change",null,u,h);i.push({event:B,listeners:p})}}var Ht=null,ml=null;function kw(i){var s=i.nodeName&&i.nodeName.toLowerCase();return s==="select"||s==="input"&&i.type==="file"}function Gs(i){var s=[];si(s,ml,i,On(i)),nf(bv,s)}function bv(i){Fv(i,0)}function ug(i){var s=uo(i);if(uC(s))return i}function ed(i,s){if(i==="change")return s}var vv=!1;Ot&&(vv=uc("input")&&(!document.documentMode||document.documentMode>9));function sB(i,s){Ht=i,ml=s,Ht.attachEvent("onpropertychange",Or)}function bl(){Ht&&(Ht.detachEvent("onpropertychange",Or),Ht=null,ml=null)}function Or(i){i.propertyName==="value"&&ug(ml)&&Gs(i)}function oB(i,s,u){i==="focusin"?(bl(),sB(s,u)):i==="focusout"&&bl()}function yv(i,s){if(i==="selectionchange"||i==="keyup"||i==="keydown")return ug(ml)}function Gv(i){var s=i.nodeName;return s&&s.toLowerCase()==="input"&&(i.type==="checkbox"||i.type==="radio")}function Bv(i,s){if(i==="click")return ug(s)}function Zv(i,s){if(i==="input"||i==="change")return ug(s)}function k2(i){var s=i._wrapperState;!s||!s.controlled||i.type!=="number"||yn(i,"number",i.value)}function U2(i,s,u,h,p,B,x){var Y=u?uo(u):window,z,J;if(kw(Y)?z=ed:Xo(Y)?vv?z=Zv:(z=yv,J=oB):Gv(Y)&&(z=Bv),z){var j=z(s,u);if(j){si(i,j,h,p);return}}J&&J(s,Y,u),s==="focusout"&&k2(Y)}function Sv(){Xt("onMouseEnter",["mouseout","mouseover"]),Xt("onMouseLeave",["mouseout","mouseover"]),Xt("onPointerEnter",["pointerout","pointerover"]),Xt("onPointerLeave",["pointerout","pointerover"])}function kf(i,s,u,h,p,B,x){var Y=s==="mouseover"||s==="pointerover",z=s==="mouseout"||s==="pointerout";if(Y&&!La(h)){var J=h.relatedTarget||h.fromElement;if(J&&(Su(J)||Gh(J)))return}if(!(!z&&!Y)){var j;if(p.window===p)j=p;else{var pe=p.ownerDocument;pe?j=pe.defaultView||pe.parentWindow:j=window}var fe,He;if(z){var ze=h.relatedTarget||h.toElement;if(fe=u,He=ze?Su(ze):null,He!==null){var je=nu(He);(He!==je||He.tag!==y&&He.tag!==Z)&&(He=null)}}else fe=null,He=u;if(fe!==He){var Jt=dv,bn="onMouseLeave",gn="onMouseEnter",ii="mouse";(s==="pointerout"||s==="pointerover")&&(Jt=Ef,bn="onPointerLeave",gn="onPointerEnter",ii="pointer");var $n=fe==null?j:uo(fe),We=He==null?j:uo(He),qe=new Jt(bn,ii+"leave",fe,h,p);qe.target=$n,qe.relatedTarget=We;var xe=null,St=Su(p);if(St===u){var en=new Jt(gn,ii+"enter",He,h,p);en.target=We,en.relatedTarget=$n,xe=en}fB(i,qe,xe,fe,He)}}}function rB(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var lo=typeof Object.is=="function"?Object.is:rB;function td(i,s){if(lo(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var u=Object.keys(i),h=Object.keys(s);if(u.length!==h.length)return!1;for(var p=0;p<u.length;p++){var B=u[p];if(!oe.call(s,B)||!lo(i[B],s[B]))return!1}return!0}function Rv(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function lB(i){for(;i;){if(i.nextSibling)return i.nextSibling;i=i.parentNode}}function nd(i,s){for(var u=Rv(i),h=0,p=0;u;){if(u.nodeType===Ol){if(p=h+u.textContent.length,h<=s&&p>=s)return{node:u,offset:s-h};h=p}u=Rv(lB(u))}}function Uf(i){var s=i.ownerDocument,u=s&&s.defaultView||window,h=u.getSelection&&u.getSelection();if(!h||h.rangeCount===0)return null;var p=h.anchorNode,B=h.anchorOffset,x=h.focusNode,Y=h.focusOffset;try{p.nodeType,x.nodeType}catch{return null}return Df(i,p,B,x,Y)}function Df(i,s,u,h,p){var B=0,x=-1,Y=-1,z=0,J=0,j=i,pe=null;e:for(;;){for(var fe=null;j===s&&(u===0||j.nodeType===Ol)&&(x=B+u),j===h&&(p===0||j.nodeType===Ol)&&(Y=B+p),j.nodeType===Ol&&(B+=j.nodeValue.length),(fe=j.firstChild)!==null;)pe=j,j=fe;for(;;){if(j===i)break e;if(pe===s&&++z===u&&(x=B),pe===h&&++J===p&&(Y=B),(fe=j.nextSibling)!==null)break;j=pe,pe=j.parentNode}j=fe}return x===-1||Y===-1?null:{start:x,end:Y}}function eh(i,s){var u=i.ownerDocument||document,h=u&&u.defaultView||window;if(h.getSelection){var p=h.getSelection(),B=i.textContent.length,x=Math.min(s.start,B),Y=s.end===void 0?x:Math.min(s.end,B);if(!p.extend&&x>Y){var z=Y;Y=x,x=z}var J=nd(i,x),j=nd(i,Y);if(J&&j){if(p.rangeCount===1&&p.anchorNode===J.node&&p.anchorOffset===J.offset&&p.focusNode===j.node&&p.focusOffset===j.offset)return;var pe=u.createRange();pe.setStart(J.node,J.offset),p.removeAllRanges(),x>Y?(p.addRange(pe),p.extend(j.node,j.offset)):(pe.setEnd(j.node,j.offset),p.addRange(pe))}}}function Jf(i){return i&&i.nodeType===Ol}function th(i,s){return!i||!s?!1:i===s?!0:Jf(i)?!1:Jf(s)?th(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1}function nh(i){return i&&i.ownerDocument&&th(i.ownerDocument.documentElement,i)}function Of(i){try{return typeof i.contentWindow.location.href=="string"}catch{return!1}}function id(){for(var i=window,s=ol();s instanceof i.HTMLIFrameElement;){if(Of(s))i=s.contentWindow;else return s;s=ol(i.document)}return s}function Ig(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}function wv(){var i=id();return{focusedElem:i,selectionRange:Ig(i)?Wv(i):null}}function Pf(i){var s=id(),u=i.focusedElem,h=i.selectionRange;if(s!==u&&nh(u)){h!==null&&Ig(u)&&Qf(u,h);for(var p=[],B=u;B=B.parentNode;)B.nodeType===io&&p.push({element:B,left:B.scrollLeft,top:B.scrollTop});typeof u.focus=="function"&&u.focus();for(var x=0;x<p.length;x++){var Y=p[x];Y.element.scrollLeft=Y.left,Y.element.scrollTop=Y.top}}}function Wv(i){var s;return"selectionStart"in i?s={start:i.selectionStart,end:i.selectionEnd}:s=Uf(i),s||{start:0,end:0}}function Qf(i,s){var u=s.start,h=s.end;h===void 0&&(h=u),"selectionStart"in i?(i.selectionStart=u,i.selectionEnd=Math.min(h,i.value.length)):eh(i,s)}var gB=Ot&&"documentMode"in document&&document.documentMode<=11;function xv(){$t("onSelect",["focusout","contextmenu","dragend","focusin","keydown","keyup","mousedown","mouseup","selectionchange"])}var dg=null,Vv=null,Ic=null,ih=!1;function jf(i){if("selectionStart"in i&&Ig(i))return{start:i.selectionStart,end:i.selectionEnd};var s=i.ownerDocument&&i.ownerDocument.defaultView||window,u=s.getSelection();return{anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}}function Nv(i){return i.window===i?i.document:i.nodeType===rl?i:i.ownerDocument}function ah(i,s,u){var h=Nv(u);if(!(ih||dg==null||dg!==ol(h))){var p=jf(dg);if(!Ic||!td(Ic,p)){Ic=p;var B=hc(Vv,"onSelect");if(B.length>0){var x=new DC("onSelect","select",null,s,u);i.push({event:x,listeners:B}),x.target=dg}}}}function Xv(i,s,u,h,p,B,x){var Y=u?uo(u):window;switch(s){case"focusin":(Xo(Y)||Y.contentEditable==="true")&&(dg=Y,Vv=u,Ic=null);break;case"focusout":dg=null,Vv=null,Ic=null;break;case"mousedown":ih=!0;break;case"contextmenu":case"mouseup":case"dragend":ih=!1,ah(i,h,p);break;case"selectionchange":if(gB)break;case"keydown":case"keyup":ah(i,h,p)}}function sh(i,s){var u={};return u[i.toLowerCase()]=s.toLowerCase(),u["Webkit"+i]="webkit"+s,u["Moz"+i]="moz"+s,u}var bu={animationend:sh("Animation","AnimationEnd"),animationiteration:sh("Animation","AnimationIteration"),animationstart:sh("Animation","AnimationStart"),transitionend:sh("Transition","TransitionEnd")},Yv={},qf={};Ot&&(qf=document.createElement("div").style,"AnimationEvent"in window||(delete bu.animationend.animation,delete bu.animationiteration.animation,delete bu.animationstart.animation),"TransitionEvent"in window||delete bu.transitionend.transition);function oh(i){if(Yv[i])return Yv[i];if(!bu[i])return i;var s=bu[i];for(var u in s)if(s.hasOwnProperty(u)&&u in qf)return Yv[i]=s[u];return i}var Mv=oh("animationend"),Hv=oh("animationiteration"),cB=oh("animationstart"),$f=oh("transitionend"),rh=new Map,uB=["abort","auxClick","cancel","canPlay","canPlayThrough","click","close","contextMenu","copy","cut","drag","dragEnd","dragEnter","dragExit","dragLeave","dragOver","dragStart","drop","durationChange","emptied","encrypted","ended","error","gotPointerCapture","input","invalid","keyDown","keyPress","keyUp","load","loadedData","loadedMetadata","loadStart","lostPointerCapture","mouseDown","mouseMove","mouseOut","mouseOver","mouseUp","paste","pause","play","playing","pointerCancel","pointerDown","pointerMove","pointerOut","pointerOver","pointerUp","progress","rateChange","reset","resize","seeked","seeking","stalled","submit","suspend","timeUpdate","touchCancel","touchEnd","touchStart","volumeChange","scroll","toggle","touchMove","waiting","wheel"];function dc(i,s){rh.set(i,s),$t(s,[i])}function IB(){for(var i=0;i<uB.length;i++){var s=uB[i],u=s.toLowerCase(),h=s[0].toUpperCase()+s.slice(1);dc(u,"on"+h)}dc(Mv,"onAnimationEnd"),dc(Hv,"onAnimationIteration"),dc(cB,"onAnimationStart"),dc("dblclick","onDoubleClick"),dc("focusin","onFocus"),dc("focusout","onBlur"),dc($f,"onTransitionEnd")}function dB(i,s,u,h,p,B,x){var Y=rh.get(s);if(Y!==void 0){var z=DC,J=s;switch(s){case"keypress":if(UC(h)===0)return;case"keydown":case"keyup":z=jC;break;case"focusin":J="focus",z=Cv;break;case"focusout":J="blur",z=Cv;break;case"beforeblur":case"afterblur":z=Cv;break;case"click":if(h.button===2)return;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":z=dv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":z=nB;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":z=fv;break;case Mv:case Hv:case cB:z=gc;break;case $f:z=cc;break;case"scroll":z=Iv;break;case"wheel":z=Tw;break;case"copy":case"cut":case"paste":z=Mf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":z=Ef;break}var j=(B&fC)!==0;{var pe=!j&&s==="scroll",fe=np(u,Y,h.type,j,pe);if(fe.length>0){var He=new z(Y,J,null,h,p);i.push({event:He,listeners:fe})}}}}IB(),Sv(),mv(),xv(),zw();function CB(i,s,u,h,p,B,x){dB(i,s,u,h,p,B);var Y=(B&aw)===0;Y&&(kf(i,s,u,h,p),U2(i,s,u,h,p),Xv(i,s,u,h,p),_w(i,s,u,h,p))}var ad=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","resize","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],ep=new Set(["cancel","close","invalid","load","scroll","toggle"].concat(ad));function lh(i,s,u){var h=i.type||"unknown-event";i.currentTarget=u,ZC(h,s,void 0,i),i.currentTarget=null}function hB(i,s,u){var h;if(u)for(var p=s.length-1;p>=0;p--){var B=s[p],x=B.instance,Y=B.currentTarget,z=B.listener;if(x!==h&&i.isPropagationStopped())return;lh(i,z,Y),h=x}else for(var J=0;J<s.length;J++){var j=s[J],pe=j.instance,fe=j.currentTarget,He=j.listener;if(pe!==h&&i.isPropagationStopped())return;lh(i,He,fe),h=pe}}function Fv(i,s){for(var u=(s&fC)!==0,h=0;h<i.length;h++){var p=i[h],B=p.event,x=p.listeners;hB(B,x,u)}RG()}function AB(i,s,u,h,p){var B=On(u),x=[];CB(x,i,h,u,B,s),Fv(x,s)}function Ki(i,s){ep.has(i)||c('Did not expect a listenToNonDelegatedEvent() call for "%s". This is a bug in React. Please file an issue.',i);var u=!1,h=mW(s),p=Uw(i);h.has(p)||(tp(s,i,qA,u),h.add(p))}function ir(i,s,u){ep.has(i)&&!s&&c('Did not expect a listenToNativeEvent() call for "%s" in the bubble phase. This is a bug in React. Please file an issue.',i);var h=0;s&&(h|=fC),tp(u,i,h,s)}var go="_reactListening"+Math.random().toString(36).slice(2);function Cc(i){if(!i[go]){i[go]=!0,Zt.forEach(function(u){u!=="selectionchange"&&(ep.has(u)||ir(u,!1,i),ir(u,!0,i))});var s=i.nodeType===rl?i:i.ownerDocument;s!==null&&(s[go]||(s[go]=!0,ir("selectionchange",!1,s)))}}function tp(i,s,u,h,p){var B=Nw(i,s,u),x=void 0;yC&&(s==="touchstart"||s==="touchmove"||s==="wheel")&&(x=!0),i=i,h?x!==void 0?Yw(i,s,B,x):gv(i,s,B):x!==void 0?Mw(i,s,B,x):lv(i,s,B)}function Sn(i,s){return i===s||i.nodeType===Qi&&i.parentNode===s}function vl(i,s,u,h,p){var B=h;if(!(s&Mr)&&!(s&qA)){var x=p;if(h!==null){var Y=h;e:for(;;){if(Y===null)return;var z=Y.tag;if(z===b||z===v){var J=Y.stateNode.containerInfo;if(Sn(J,x))break;if(z===v)for(var j=Y.return;j!==null;){var pe=j.tag;if(pe===b||pe===v){var fe=j.stateNode.containerInfo;if(Sn(fe,x))return}j=j.return}for(;J!==null;){var He=Su(J);if(He===null)return;var ze=He.tag;if(ze===y||ze===Z){Y=B=He;continue e}J=J.parentNode}}Y=Y.return}}}nf(function(){return AB(i,s,u,B)})}function sd(i,s,u){return{instance:i,listener:s,currentTarget:u}}function np(i,s,u,h,p,B){for(var x=s!==null?s+"Capture":null,Y=h?x:s,z=[],J=i,j=null;J!==null;){var pe=J,fe=pe.stateNode,He=pe.tag;if(He===y&&fe!==null&&(j=fe,Y!==null)){var ze=qc(J,Y);ze!=null&&z.push(sd(J,ze,j))}if(p)break;J=J.return}return z}function hc(i,s){for(var u=s+"Capture",h=[],p=i;p!==null;){var B=p,x=B.stateNode,Y=B.tag;if(Y===y&&x!==null){var z=x,J=qc(p,u);J!=null&&h.unshift(sd(p,J,z));var j=qc(p,s);j!=null&&h.push(sd(p,j,z))}p=p.return}return h}function Cg(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==y);return i||null}function Kv(i,s){for(var u=i,h=s,p=0,B=u;B;B=Cg(B))p++;for(var x=0,Y=h;Y;Y=Cg(Y))x++;for(;p-x>0;)u=Cg(u),p--;for(;x-p>0;)h=Cg(h),x--;for(var z=p;z--;){if(u===h||h!==null&&u===h.alternate)return u;u=Cg(u),h=Cg(h)}return null}function gh(i,s,u,h,p){for(var B=s._reactName,x=[],Y=u;Y!==null&&Y!==h;){var z=Y,J=z.alternate,j=z.stateNode,pe=z.tag;if(J!==null&&J===h)break;if(pe===y&&j!==null){var fe=j;if(p){var He=qc(Y,B);He!=null&&x.unshift(sd(Y,He,fe))}else if(!p){var ze=qc(Y,B);ze!=null&&x.push(sd(Y,ze,fe))}}Y=Y.return}x.length!==0&&i.push({event:s,listeners:x})}function fB(i,s,u,h,p){var B=h&&p?Kv(h,p):null;h!==null&&gh(i,s,h,B,!1),p!==null&&u!==null&&gh(i,u,p,B,!0)}function Uw(i,s){return i+"__bubble"}var co=!1,ch="dangerouslySetInnerHTML",uh="suppressContentEditableWarning",hg="suppressHydrationWarning",ip="autoFocus",Ac="children",yl="style",zs="__html",Ih,Ls,vu,ap,yu,pB,sp;Ih={dialog:!0,webview:!0},Ls=function(i,s){ZG(i,s),jA(i,s),ba(i,s,{registrationNameDependencies:Bt,possibleRegistrationNames:kt})},pB=Ot&&!document.documentMode,vu=function(i,s,u){if(!co){var h=od(u),p=od(s);p!==h&&(co=!0,c("Prop `%s` did not match. Server: %s Client: %s",i,JSON.stringify(p),JSON.stringify(h)))}},ap=function(i){if(!co){co=!0;var s=[];i.forEach(function(u){s.push(u)}),c("Extra attributes from the server: %s",s)}},yu=function(i,s){s===!1?c("Expected `%s` listener to be a function, instead got `false`.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.",i,i,i):c("Expected `%s` listener to be a function, instead got a value of `%s` type.",i,typeof s)},sp=function(i,s){var u=i.namespaceURI===Jl?i.ownerDocument.createElement(i.tagName):i.ownerDocument.createElementNS(i.namespaceURI,i.tagName);return u.innerHTML=s,u.innerHTML};var Dw=/\r\n?/g,mB=/\u0000|\uFFFD/g;function od(i){k(i);var s=typeof i=="string"?i:""+i;return s.replace(Dw,`
`).replace(mB,"")}function dh(i,s,u,h){var p=od(s),B=od(i);if(B!==p&&(h&&(co||(co=!0,c('Text content did not match. Server: "%s" Client: "%s"',B,p))),u&&Be))throw new Error("Text content does not match server-rendered HTML.")}function bB(i){return i.nodeType===rl?i:i.ownerDocument}function Jw(){}function Ch(i){i.onclick=Jw}function vB(i,s,u,h,p){for(var B in h)if(h.hasOwnProperty(B)){var x=h[B];if(B===yl)x&&Object.freeze(x),ll(s,x);else if(B===ch){var Y=x?x[zs]:void 0;Y!=null&&AG(s,Y)}else if(B===Ac)if(typeof x=="string"){var z=i!=="textarea"||x!=="";z&&AC(s,x)}else typeof x=="number"&&AC(s,""+x);else B===uh||B===hg||B===ip||(Bt.hasOwnProperty(B)?x!=null&&(typeof x!="function"&&yu(B,x),B==="onScroll"&&Ki("scroll",s)):x!=null&&In(s,B,x,p))}}function Ow(i,s,u,h){for(var p=0;p<s.length;p+=2){var B=s[p],x=s[p+1];B===yl?ll(i,x):B===ch?AG(i,x):B===Ac?AC(i,x):In(i,B,x,h)}}function Pw(i,s,u,h){var p,B=bB(u),x,Y=h;if(Y===Jl&&(Y=Bb(i)),Y===Jl){if(p=Ql(i,s),!p&&i!==i.toLowerCase()&&c("<%s /> is using incorrect casing. Use PascalCase for React components, or lowercase for HTML elements.",i),i==="script"){var z=B.createElement("div");z.innerHTML="<script><\/script>";var J=z.firstChild;x=z.removeChild(J)}else if(typeof s.is=="string")x=B.createElement(i,{is:s.is});else if(x=B.createElement(i),i==="select"){var j=x;s.multiple?j.multiple=!0:s.size&&(j.size=s.size)}}else x=B.createElementNS(Y,i);return Y===Jl&&!p&&Object.prototype.toString.call(x)==="[object HTMLUnknownElement]"&&!oe.call(Ih,i)&&(Ih[i]=!0,c("The tag <%s> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.",i)),x}function Gl(i,s){return bB(s).createTextNode(i)}function yB(i,s,u,h){var p=Ql(s,u);Ls(s,u);var B;switch(s){case"dialog":Ki("cancel",i),Ki("close",i),B=u;break;case"iframe":case"object":case"embed":Ki("load",i),B=u;break;case"video":case"audio":for(var x=0;x<ad.length;x++)Ki(ad[x],i);B=u;break;case"source":Ki("error",i),B=u;break;case"img":case"image":case"link":Ki("error",i),Ki("load",i),B=u;break;case"details":Ki("toggle",i),B=u;break;case"input":dC(i,u),B=IC(i,u),Ki("invalid",i);break;case"option":ui(i,u),B=u;break;case"select":SI(i,u),B=hC(i,u),Ki("invalid",i);break;case"textarea":dG(i,u),B=yb(i,u),Ki("invalid",i);break;default:B=u}switch(jo(s,B),vB(s,i,h,B,p),s){case"input":Oc(i),Ke(i,u,!1);break;case"textarea":Oc(i),hG(i);break;case"option":Hi(i,u);break;case"select":bb(i,u);break;default:typeof B.onClick=="function"&&Ch(i);break}}function GB(i,s,u,h,p){Ls(s,h);var B=null,x,Y;switch(s){case"input":x=IC(i,u),Y=IC(i,h),B=[];break;case"select":x=hC(i,u),Y=hC(i,h),B=[];break;case"textarea":x=yb(i,u),Y=yb(i,h),B=[];break;default:x=u,Y=h,typeof x.onClick!="function"&&typeof Y.onClick=="function"&&Ch(i);break}jo(s,Y);var z,J,j=null;for(z in x)if(!(Y.hasOwnProperty(z)||!x.hasOwnProperty(z)||x[z]==null))if(z===yl){var pe=x[z];for(J in pe)pe.hasOwnProperty(J)&&(j||(j={}),j[J]="")}else z===ch||z===Ac||z===uh||z===hg||z===ip||(Bt.hasOwnProperty(z)?B||(B=[]):(B=B||[]).push(z,null));for(z in Y){var fe=Y[z],He=x!=null?x[z]:void 0;if(!(!Y.hasOwnProperty(z)||fe===He||fe==null&&He==null))if(z===yl)if(fe&&Object.freeze(fe),He){for(J in He)He.hasOwnProperty(J)&&(!fe||!fe.hasOwnProperty(J))&&(j||(j={}),j[J]="");for(J in fe)fe.hasOwnProperty(J)&&He[J]!==fe[J]&&(j||(j={}),j[J]=fe[J])}else j||(B||(B=[]),B.push(z,j)),j=fe;else if(z===ch){var ze=fe?fe[zs]:void 0,je=He?He[zs]:void 0;ze!=null&&je!==ze&&(B=B||[]).push(z,ze)}else z===Ac?(typeof fe=="string"||typeof fe=="number")&&(B=B||[]).push(z,""+fe):z===uh||z===hg||(Bt.hasOwnProperty(z)?(fe!=null&&(typeof fe!="function"&&yu(z,fe),z==="onScroll"&&Ki("scroll",i)),!B&&He!==fe&&(B=[])):(B=B||[]).push(z,fe))}return j&&(os(j,Y[yl]),(B=B||[]).push(yl,j)),B}function hh(i,s,u,h,p){u==="input"&&p.type==="radio"&&p.name!=null&&L(i,p);var B=Ql(u,h),x=Ql(u,p);switch(Ow(i,s,B,x),u){case"input":le(i,p);break;case"textarea":CG(i,p);break;case"select":TA(i,p);break}}function Ah(i){{var s=i.toLowerCase();return jl.hasOwnProperty(s)&&jl[s]||null}}function op(i,s,u,h,p,B,x){var Y,z;switch(Y=Ql(s,u),Ls(s,u),s){case"dialog":Ki("cancel",i),Ki("close",i);break;case"iframe":case"object":case"embed":Ki("load",i);break;case"video":case"audio":for(var J=0;J<ad.length;J++)Ki(ad[J],i);break;case"source":Ki("error",i);break;case"img":case"image":case"link":Ki("error",i),Ki("load",i);break;case"details":Ki("toggle",i);break;case"input":dC(i,u),Ki("invalid",i);break;case"option":ui(i,u);break;case"select":SI(i,u),Ki("invalid",i);break;case"textarea":dG(i,u),Ki("invalid",i);break}jo(s,u);{z=new Set;for(var j=i.attributes,pe=0;pe<j.length;pe++){var fe=j[pe].name.toLowerCase();switch(fe){case"value":break;case"checked":break;case"selected":break;default:z.add(j[pe].name)}}}var He=null;for(var ze in u)if(u.hasOwnProperty(ze)){var je=u[ze];if(ze===Ac)typeof je=="string"?i.textContent!==je&&(u[hg]!==!0&&dh(i.textContent,je,B,x),He=[Ac,je]):typeof je=="number"&&i.textContent!==""+je&&(u[hg]!==!0&&dh(i.textContent,je,B,x),He=[Ac,""+je]);else if(Bt.hasOwnProperty(ze))je!=null&&(typeof je!="function"&&yu(ze,je),ze==="onScroll"&&Ki("scroll",i));else if(x&&typeof Y=="boolean"){var Jt=void 0,bn=gt(ze);if(u[hg]!==!0){if(!(ze===uh||ze===hg||ze==="value"||ze==="checked"||ze==="selected")){if(ze===ch){var gn=i.innerHTML,ii=je?je[zs]:void 0;if(ii!=null){var $n=sp(i,ii);$n!==gn&&vu(ze,gn,$n)}}else if(ze===yl){if(z.delete(ze),pB){var We=OA(je);Jt=i.getAttribute("style"),We!==Jt&&vu(ze,Jt,We)}}else if(Y&&!Xe)z.delete(ze.toLowerCase()),Jt=Dn(i,ze,je),je!==Jt&&vu(ze,Jt,je);else if(!Ct(ze,bn,Y)&&!ye(ze,je,bn,Y)){var qe=!1;if(bn!==null)z.delete(bn.attributeName),Jt=zn(i,ze,je,bn);else{var xe=h;if(xe===Jl&&(xe=Bb(s)),xe===Jl)z.delete(ze.toLowerCase());else{var St=Ah(ze);St!==null&&St!==ze&&(qe=!0,z.delete(St)),z.delete(ze)}Jt=Dn(i,ze,je)}var en=Xe;!en&&je!==Jt&&!qe&&vu(ze,Jt,je)}}}}}switch(x&&z.size>0&&u[hg]!==!0&&ap(z),s){case"input":Oc(i),Ke(i,u,!0);break;case"textarea":Oc(i),hG(i);break;case"select":case"option":break;default:typeof u.onClick=="function"&&Ch(i);break}return He}function rp(i,s,u){var h=i.nodeValue!==s;return h}function lp(i,s){{if(co)return;co=!0,c("Did not expect server HTML to contain a <%s> in <%s>.",s.nodeName.toLowerCase(),i.nodeName.toLowerCase())}}function Gu(i,s){{if(co)return;co=!0,c('Did not expect server HTML to contain the text node "%s" in <%s>.',s.nodeValue,i.nodeName.toLowerCase())}}function Xa(i,s,u){{if(co)return;co=!0,c("Expected server HTML to contain a matching <%s> in <%s>.",s,i.nodeName.toLowerCase())}}function gp(i,s){{if(s===""||co)return;co=!0,c('Expected server HTML to contain a matching text node for "%s" in <%s>.',s,i.nodeName.toLowerCase())}}function fh(i,s,u){switch(s){case"input":Je(i,u);return;case"textarea":$R(i,u);return;case"select":vb(i,u);return}}var _s=function(){},Bu=function(){};{var ph=["address","applet","area","article","aside","base","basefont","bgsound","blockquote","body","br","button","caption","center","col","colgroup","dd","details","dir","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","isindex","li","link","listing","main","marquee","menu","menuitem","meta","nav","noembed","noframes","noscript","object","ol","p","param","plaintext","pre","script","section","select","source","style","summary","table","tbody","td","template","textarea","tfoot","th","thead","title","tr","track","ul","wbr","xmp"],cp=["applet","caption","html","table","td","th","marquee","object","template","foreignObject","desc","title"],Ev=cp.concat(["button"]),Tv=["dd","dt","li","option","optgroup","p","rp","rt"],fc={current:null,formTag:null,aTagInScope:null,buttonTagInScope:null,nobrTagInScope:null,pTagInButtonScope:null,listItemTagAutoclosing:null,dlItemTagAutoclosing:null};Bu=function(i,s){var u=Mt({},i||fc),h={tag:s};return cp.indexOf(s)!==-1&&(u.aTagInScope=null,u.buttonTagInScope=null,u.nobrTagInScope=null),Ev.indexOf(s)!==-1&&(u.pTagInButtonScope=null),ph.indexOf(s)!==-1&&s!=="address"&&s!=="div"&&s!=="p"&&(u.listItemTagAutoclosing=null,u.dlItemTagAutoclosing=null),u.current=h,s==="form"&&(u.formTag=h),s==="a"&&(u.aTagInScope=h),s==="button"&&(u.buttonTagInScope=h),s==="nobr"&&(u.nobrTagInScope=h),s==="p"&&(u.pTagInButtonScope=h),s==="li"&&(u.listItemTagAutoclosing=h),(s==="dd"||s==="dt")&&(u.dlItemTagAutoclosing=h),u};var zv=function(i,s){switch(s){case"select":return i==="option"||i==="optgroup"||i==="#text";case"optgroup":return i==="option"||i==="#text";case"option":return i==="#text";case"tr":return i==="th"||i==="td"||i==="style"||i==="script"||i==="template";case"tbody":case"thead":case"tfoot":return i==="tr"||i==="style"||i==="script"||i==="template";case"colgroup":return i==="col"||i==="template";case"table":return i==="caption"||i==="colgroup"||i==="tbody"||i==="tfoot"||i==="thead"||i==="style"||i==="script"||i==="template";case"head":return i==="base"||i==="basefont"||i==="bgsound"||i==="link"||i==="meta"||i==="title"||i==="noscript"||i==="noframes"||i==="style"||i==="script"||i==="template";case"html":return i==="head"||i==="body"||i==="frameset";case"frameset":return i==="frame";case"#document":return i==="html"}switch(i){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return s!=="h1"&&s!=="h2"&&s!=="h3"&&s!=="h4"&&s!=="h5"&&s!=="h6";case"rp":case"rt":return Tv.indexOf(s)===-1;case"body":case"caption":case"col":case"colgroup":case"frameset":case"frame":case"head":case"html":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":return s==null}return!0},up=function(i,s){switch(i){case"address":case"article":case"aside":case"blockquote":case"center":case"details":case"dialog":case"dir":case"div":case"dl":case"fieldset":case"figcaption":case"figure":case"footer":case"header":case"hgroup":case"main":case"menu":case"nav":case"ol":case"p":case"section":case"summary":case"ul":case"pre":case"listing":case"table":case"hr":case"xmp":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return s.pTagInButtonScope;case"form":return s.formTag||s.pTagInButtonScope;case"li":return s.listItemTagAutoclosing;case"dd":case"dt":return s.dlItemTagAutoclosing;case"button":return s.buttonTagInScope;case"a":return s.aTagInScope;case"nobr":return s.nobrTagInScope}return null},Bs={};_s=function(i,s,u){u=u||fc;var h=u.current,p=h&&h.tag;s!=null&&(i!=null&&c("validateDOMNesting: when childText is passed, childTag should be null"),i="#text");var B=zv(i,p)?null:h,x=B?null:up(i,u),Y=B||x;if(Y){var z=Y.tag,J=!!B+"|"+i+"|"+z;if(!Bs[J]){Bs[J]=!0;var j=i,pe="";if(i==="#text"?/\S/.test(s)?j="Text nodes":(j="Whitespace text nodes",pe=" Make sure you don't have any extra whitespace between tags on each line of your source code."):j="<"+i+">",B){var fe="";z==="table"&&i==="tr"&&(fe+=" Add a <tbody>, <thead> or <tfoot> to your code to match the DOM tree generated by the browser."),c("validateDOMNesting(...): %s cannot appear as a child of <%s>.%s%s",j,z,pe,fe)}else c("validateDOMNesting(...): %s cannot appear as a descendant of <%s>.",j,z)}}}}var Ip="suppressHydrationWarning",mh="$",bh="/$",rd="$?",ld="$!",Qw="style",Lv=null,_v=null;function BB(i){var s,u,h=i.nodeType;switch(h){case rl:case LA:{s=h===rl?"#document":"#fragment";var p=i.documentElement;u=p?p.namespaceURI:Zb(null,"");break}default:{var B=h===Qi?i.parentNode:i,x=B.namespaceURI||null;s=B.tagName,u=Zb(x,s);break}}{var Y=s.toLowerCase(),z=Bu(null,Y);return{namespace:u,ancestorInfo:z}}}function kv(i,s,u){{var h=i,p=Zb(h.namespace,s),B=Bu(h.ancestorInfo,s);return{namespace:p,ancestorInfo:B}}}function jw(i){return i}function Uv(i){Lv=Vw(),_v=wv();var s=null;return eB(!1),s}function ZB(i){Pf(_v),eB(Lv),Lv=null,_v=null}function qw(i,s,u,h,p){var B;{var x=h;if(_s(i,null,x.ancestorInfo),typeof s.children=="string"||typeof s.children=="number"){var Y=""+s.children,z=Bu(x.ancestorInfo,i);_s(null,Y,z)}B=x.namespace}var J=Pw(i,s,u,B);return dd(p,J),ny(J,s),J}function SB(i,s){i.appendChild(s)}function $w(i,s,u,h,p){switch(yB(i,s,u,h),s){case"button":case"input":case"select":case"textarea":return!!u.autoFocus;case"img":return!0;default:return!1}}function eW(i,s,u,h,p,B){{var x=B;if(typeof h.children!=typeof u.children&&(typeof h.children=="string"||typeof h.children=="number")){var Y=""+h.children,z=Bu(x.ancestorInfo,s);_s(null,Y,z)}}return GB(i,s,u,h)}function Dv(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}function tW(i,s,u,h){{var p=u;_s(null,i,p.ancestorInfo)}var B=Gl(i,s);return dd(h,B),B}function nW(){var i=window.event;return i===void 0?Ur:Vf(i.type)}var vh=typeof setTimeout=="function"?setTimeout:void 0,dp=typeof clearTimeout=="function"?clearTimeout:void 0,gd=-1,Jv=typeof Promise=="function"?Promise:void 0,iW=typeof queueMicrotask=="function"?queueMicrotask:typeof Jv<"u"?function(i){return Jv.resolve(null).then(i).catch(RB)}:vh;function RB(i){setTimeout(function(){throw i})}function wB(i,s,u,h){switch(s){case"button":case"input":case"select":case"textarea":u.autoFocus&&i.focus();return;case"img":{u.src&&(i.src=u.src);return}}}function Ov(i,s,u,h,p,B){hh(i,s,u,h,p),ny(i,p)}function WB(i){AC(i,"")}function Pv(i,s,u){i.nodeValue=u}function xB(i,s){i.appendChild(s)}function VB(i,s){var u;i.nodeType===Qi?(u=i.parentNode,u.insertBefore(s,i)):(u=i,u.appendChild(s));var h=i._reactRootContainer;h==null&&u.onclick===null&&Ch(u)}function NB(i,s,u){i.insertBefore(s,u)}function Cp(i,s,u){i.nodeType===Qi?i.parentNode.insertBefore(s,u):i.insertBefore(s,u)}function aW(i,s){i.removeChild(s)}function sW(i,s){i.nodeType===Qi?i.parentNode.removeChild(s):i.removeChild(s)}function Qv(i,s){var u=s,h=0;do{var p=u.nextSibling;if(i.removeChild(u),p&&p.nodeType===Qi){var B=p.data;if(B===bh)if(h===0){i.removeChild(p),Es(s);return}else h--;else(B===mh||B===rd||B===ld)&&h++}u=p}while(u);Es(s)}function XB(i,s){i.nodeType===Qi?Qv(i.parentNode,s):i.nodeType===io&&Qv(i,s),Es(i)}function oW(i){i=i;var s=i.style;typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"}function rW(i){i.nodeValue=""}function lW(i,s){i=i;var u=s[Qw],h=u!=null&&u.hasOwnProperty("display")?u.display:null;i.style.display=_A("display",h)}function gW(i,s){i.nodeValue=s}function YB(i){i.nodeType===io?i.textContent="":i.nodeType===rl&&i.documentElement&&i.removeChild(i.documentElement)}function cW(i,s,u){return i.nodeType!==io||s.toLowerCase()!==i.nodeName.toLowerCase()?null:i}function jv(i,s){return s===""||i.nodeType!==Ol?null:i}function MB(i){return i.nodeType!==Qi?null:i}function HB(i){return i.data===rd}function hp(i){return i.data===ld}function uW(i){var s=i.nextSibling&&i.nextSibling.dataset,u,h,p;return s&&(u=s.dgst,h=s.msg,p=s.stck),{message:h,digest:u,stack:p}}function FB(i,s){i._reactRetry=s}function Ap(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===io||s===Ol)break;if(s===Qi){var u=i.data;if(u===mh||u===ld||u===rd)break;if(u===bh)return null}}return i}function pc(i){return Ap(i.nextSibling)}function Ag(i){return Ap(i.firstChild)}function IW(i){return Ap(i.firstChild)}function qv(i){return Ap(i.nextSibling)}function dW(i,s,u,h,p,B,x){dd(B,i),ny(i,u);var Y;{var z=p;Y=z.namespace}var J=(B.mode&jn)!==pn;return op(i,s,u,Y,h,J,x)}function KB(i,s,u,h){return dd(u,i),u.mode&jn,rp(i,s)}function CW(i,s){dd(s,i)}function EB(i){for(var s=i.nextSibling,u=0;s;){if(s.nodeType===Qi){var h=s.data;if(h===bh){if(u===0)return pc(s);u--}else(h===mh||h===ld||h===rd)&&u++}s=s.nextSibling}return null}function $v(i){for(var s=i.previousSibling,u=0;s;){if(s.nodeType===Qi){var h=s.data;if(h===mh||h===ld||h===rd){if(u===0)return s;u--}else h===bh&&u++}s=s.previousSibling}return null}function TB(i){Es(i)}function ey(i){Es(i)}function hW(i){return i!=="head"&&i!=="body"}function yh(i,s,u,h){var p=!0;dh(s.nodeValue,u,h,p)}function fp(i,s,u,h,p,B){if(s[Ip]!==!0){var x=!0;dh(h.nodeValue,p,B,x)}}function AW(i,s){s.nodeType===io?lp(i,s):s.nodeType===Qi||Gu(i,s)}function zB(i,s){{var u=i.parentNode;u!==null&&(s.nodeType===io?lp(u,s):s.nodeType===Qi||Gu(u,s))}}function fW(i,s,u,h,p){(p||s[Ip]!==!0)&&(h.nodeType===io?lp(u,h):h.nodeType===Qi||Gu(u,h))}function LB(i,s,u){Xa(i,s)}function _B(i,s){gp(i,s)}function pp(i,s,u){{var h=i.parentNode;h!==null&&Xa(h,s)}}function mc(i,s){{var u=i.parentNode;u!==null&&gp(u,s)}}function pW(i,s,u,h,p,B){(B||s[Ip]!==!0)&&Xa(u,h)}function Ut(i,s,u,h,p){(p||s[Ip]!==!0)&&gp(u,h)}function cd(i){c("An error occurred during hydration. The server HTML was replaced with client content in <%s>.",i.nodeName.toLowerCase())}function ud(i){Cc(i)}var ua=Math.random().toString(36).slice(2),Id="__reactFiber$"+ua,mp="__reactProps$"+ua,Zu="__reactContainer$"+ua,ty="__reactEvents$"+ua,kB="__reactListeners$"+ua,bp="__reactHandles$"+ua;function vp(i){delete i[Id],delete i[mp],delete i[ty],delete i[kB],delete i[bp]}function dd(i,s){s[Id]=i}function yp(i,s){s[Zu]=i}function UB(i){i[Zu]=null}function Gh(i){return!!i[Zu]}function Su(i){var s=i[Id];if(s)return s;for(var u=i.parentNode;u;){if(s=u[Zu]||u[Id],s){var h=s.alternate;if(s.child!==null||h!==null&&h.child!==null)for(var p=$v(i);p!==null;){var B=p[Id];if(B)return B;p=$v(p)}return s}i=u,u=i.parentNode}return null}function da(i){var s=i[Id]||i[Zu];return s&&(s.tag===y||s.tag===Z||s.tag===H||s.tag===b)?s:null}function uo(i){if(i.tag===y||i.tag===Z)return i.stateNode;throw new Error("getNodeFromInstance: Invalid argument.")}function Gp(i){return i[mp]||null}function ny(i,s){i[mp]=s}function mW(i){var s=i[ty];return s===void 0&&(s=i[ty]=new Set),s}var DB={},iy=t.ReactDebugCurrentFrame;function Bp(i){if(i){var s=i._owner,u=Uc(i.type,i._source,s?s.type:null);iy.setExtraStackFrame(u)}else iy.setExtraStackFrame(null)}function ar(i,s,u,h,p){{var B=Function.call.bind(oe);for(var x in i)if(B(i,x)){var Y=void 0;try{if(typeof i[x]!="function"){var z=Error((h||"React class")+": "+u+" type `"+x+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof i[x]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw z.name="Invariant Violation",z}Y=i[x](s,x,h,u,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(J){Y=J}Y&&!(Y instanceof Error)&&(Bp(p),c("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",h||"React class",u,x,typeof Y),Bp(null)),Y instanceof Error&&!(Y.message in DB)&&(DB[Y.message]=!0,Bp(p),c("Failed %s type: %s",u,Y.message),Bp(null))}}}var Zp=[],Sp;Sp=[];var Bl=-1;function bc(i){return{current:i}}function Zs(i,s){if(Bl<0){c("Unexpected pop.");return}s!==Sp[Bl]&&c("Unexpected Fiber popped."),i.current=Zp[Bl],Zp[Bl]=null,Sp[Bl]=null,Bl--}function Ss(i,s,u){Bl++,Zp[Bl]=i.current,Sp[Bl]=u,i.current=s}var Rp;Rp={};var Io={};Object.freeze(Io);var Zl=bc(Io),sr=bc(!1),Bh=Io;function Ru(i,s,u){return u&&Sl(s)?Bh:Zl.current}function JB(i,s,u){{var h=i.stateNode;h.__reactInternalMemoizedUnmaskedChildContext=s,h.__reactInternalMemoizedMaskedChildContext=u}}function vc(i,s){{var u=i.type,h=u.contextTypes;if(!h)return Io;var p=i.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===s)return p.__reactInternalMemoizedMaskedChildContext;var B={};for(var x in h)B[x]=s[x];{var Y=Xn(i)||"Unknown";ar(h,B,"context",Y)}return p&&JB(i,s,B),B}}function Zh(){return sr.current}function Sl(i){{var s=i.childContextTypes;return s!=null}}function wu(i){Zs(sr,i),Zs(Zl,i)}function ay(i){Zs(sr,i),Zs(Zl,i)}function OB(i,s,u){{if(Zl.current!==Io)throw new Error("Unexpected context found on stack. This error is likely caused by a bug in React. Please file an issue.");Ss(Zl,s,i),Ss(sr,u,i)}}function PB(i,s,u){{var h=i.stateNode,p=s.childContextTypes;if(typeof h.getChildContext!="function"){{var B=Xn(i)||"Unknown";Rp[B]||(Rp[B]=!0,c("%s.childContextTypes is specified but there is no getChildContext() method on the instance. You can either define getChildContext() on %s or remove childContextTypes from it.",B,B))}return u}var x=h.getChildContext();for(var Y in x)if(!(Y in p))throw new Error((Xn(i)||"Unknown")+'.getChildContext(): key "'+Y+'" is not defined in childContextTypes.');{var z=Xn(i)||"Unknown";ar(p,x,"child context",z)}return Mt({},u,x)}}function wp(i){{var s=i.stateNode,u=s&&s.__reactInternalMemoizedMergedChildContext||Io;return Bh=Zl.current,Ss(Zl,u,i),Ss(sr,sr.current,i),!0}}function QB(i,s,u){{var h=i.stateNode;if(!h)throw new Error("Expected to have an instance by this point. This error is likely caused by a bug in React. Please file an issue.");if(u){var p=PB(i,s,Bh);h.__reactInternalMemoizedMergedChildContext=p,Zs(sr,i),Zs(Zl,i),Ss(Zl,p,i),Ss(sr,u,i)}else Zs(sr,i),Ss(sr,u,i)}}function bW(i){{if(!kb(i)||i.tag!==d)throw new Error("Expected subtree parent to be a mounted class component. This error is likely caused by a bug in React. Please file an issue.");var s=i;do{switch(s.tag){case b:return s.stateNode.context;case d:{var u=s.type;if(Sl(u))return s.stateNode.__reactInternalMemoizedMergedChildContext;break}}s=s.return}while(s!==null);throw new Error("Found unexpected detached subtree parent. This error is likely caused by a bug in React. Please file an issue.")}}var fg=0,Cd=1,pg=null,Wp=!1,sy=!1;function oy(i){pg===null?pg=[i]:pg.push(i)}function vW(i){Wp=!0,oy(i)}function jB(){Wp&&yc()}function yc(){if(!sy&&pg!==null){sy=!0;var i=0,s=so();try{var u=!0,h=pg;for(ya(Fs);i<h.length;i++){var p=h[i];do p=p(u);while(p!==null)}pg=null,Wp=!1}catch(B){throw pg!==null&&(pg=pg.slice(i+1)),YI(xC,yc),B}finally{ya(s),sy=!1}}return null}var hd=[],Ad=0,xp=null,Vp=0,or=[],rr=0,Wu=null,mg=1,Rl="";function lr(i){return Nu(),(i.flags&xI)!==fn}function yW(i){return Nu(),Vp}function GW(){var i=Rl,s=mg,u=s&~Np(s);return u.toString(32)+i}function xu(i,s){Nu(),hd[Ad++]=Vp,hd[Ad++]=xp,xp=i,Vp=s}function qB(i,s,u){Nu(),or[rr++]=mg,or[rr++]=Rl,or[rr++]=Wu,Wu=i;var h=mg,p=Rl,B=Vu(h)-1,x=h&~(1<<B),Y=u+1,z=Vu(s)+B;if(z>30){var J=B-B%5,j=(1<<J)-1,pe=(x&j).toString(32),fe=x>>J,He=B-J,ze=Vu(s)+He,je=Y<<He,Jt=je|fe,bn=pe+p;mg=1<<ze|Jt,Rl=bn}else{var gn=Y<<B,ii=gn|x,$n=p;mg=1<<z|ii,Rl=$n}}function fd(i){Nu();var s=i.return;if(s!==null){var u=1,h=0;xu(i,u),qB(i,u,h)}}function Vu(i){return 32-df(i)}function Np(i){return 1<<Vu(i)-1}function pd(i){for(;i===xp;)xp=hd[--Ad],hd[Ad]=null,Vp=hd[--Ad],hd[Ad]=null;for(;i===Wu;)Wu=or[--rr],or[rr]=null,Rl=or[--rr],or[rr]=null,mg=or[--rr],or[rr]=null}function Xp(){return Nu(),Wu!==null?{id:mg,overflow:Rl}:null}function Sh(i,s){Nu(),or[rr++]=mg,or[rr++]=Rl,or[rr++]=Wu,mg=s.id,Rl=s.overflow,Wu=i}function Nu(){_i()||c("Expected to be hydrating. This is a bug in React. Please file an issue.")}var cs=null,gr=null,Pr=!1,Xu=!1,wl=null;function ry(){Pr&&c("We should not be hydrating here. This is a bug in React. Please file a bug.")}function Yp(){Xu=!0}function $B(){return Xu}function BW(i){var s=i.stateNode.containerInfo;return gr=IW(s),cs=i,Pr=!0,wl=null,Xu=!1,!0}function Mp(i,s,u){return gr=qv(s),cs=i,Pr=!0,wl=null,Xu=!1,u!==null&&Sh(i,u),!0}function eZ(i,s){switch(i.tag){case b:{AW(i.stateNode.containerInfo,s);break}case y:{var u=(i.mode&jn)!==pn;fW(i.type,i.memoizedProps,i.stateNode,s,u);break}case H:{var h=i.memoizedState;h.dehydrated!==null&&zB(h.dehydrated,s);break}}}function tZ(i,s){eZ(i,s);var u=$L();u.stateNode=s,u.return=i;var h=i.deletions;h===null?(i.deletions=[u],i.flags|=eu):h.push(u)}function ly(i,s){{if(Xu)return;switch(i.tag){case b:{var u=i.stateNode.containerInfo;switch(s.tag){case y:var h=s.type;s.pendingProps,LB(u,h);break;case Z:var p=s.pendingProps;_B(u,p);break}break}case y:{var B=i.type,x=i.memoizedProps,Y=i.stateNode;switch(s.tag){case y:{var z=s.type,J=s.pendingProps,j=(i.mode&jn)!==pn;pW(B,x,Y,z,J,j);break}case Z:{var pe=s.pendingProps,fe=(i.mode&jn)!==pn;Ut(B,x,Y,pe,fe);break}}break}case H:{var He=i.memoizedState,ze=He.dehydrated;if(ze!==null)switch(s.tag){case y:var je=s.type;s.pendingProps,pp(ze,je);break;case Z:var Jt=s.pendingProps;mc(ze,Jt);break}break}default:return}}}function Rh(i,s){s.flags=s.flags&~tg|ji,ly(i,s)}function nZ(i,s){switch(i.tag){case y:{var u=i.type;i.pendingProps;var h=cW(s,u);return h!==null?(i.stateNode=h,cs=i,gr=Ag(h),!0):!1}case Z:{var p=i.pendingProps,B=jv(s,p);return B!==null?(i.stateNode=B,cs=i,gr=null,!0):!1}case H:{var x=MB(s);if(x!==null){var Y={dehydrated:x,treeContext:Xp(),retryLane:Vo};i.memoizedState=Y;var z=e9(x);return z.return=i,i.child=z,cs=i,gr=null,!0}return!1}default:return!1}}function gy(i){return(i.mode&jn)!==pn&&(i.flags&ai)===fn}function cy(i){throw new Error("Hydration failed because the initial UI does not match what was rendered on the server.")}function uy(i){if(Pr){var s=gr;if(!s){gy(i)&&(ly(cs,i),cy()),Rh(cs,i),Pr=!1,cs=i;return}var u=s;if(!nZ(i,s)){gy(i)&&(ly(cs,i),cy()),s=pc(u);var h=cs;if(!s||!nZ(i,s)){Rh(cs,i),Pr=!1,cs=i;return}tZ(h,u)}}}function iZ(i,s,u){var h=i.stateNode,p=!Xu,B=dW(h,i.type,i.memoizedProps,s,u,i,p);return i.updateQueue=B,B!==null}function ZW(i){var s=i.stateNode,u=i.memoizedProps,h=KB(s,u,i);if(h){var p=cs;if(p!==null)switch(p.tag){case b:{var B=p.stateNode.containerInfo,x=(p.mode&jn)!==pn;yh(B,s,u,x);break}case y:{var Y=p.type,z=p.memoizedProps,J=p.stateNode,j=(p.mode&jn)!==pn;fp(Y,z,J,s,u,j);break}}}return h}function Iy(i){var s=i.memoizedState,u=s!==null?s.dehydrated:null;if(!u)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");CW(u,i)}function dy(i){var s=i.memoizedState,u=s!==null?s.dehydrated:null;if(!u)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");return EB(u)}function $i(i){for(var s=i.return;s!==null&&s.tag!==y&&s.tag!==b&&s.tag!==H;)s=s.return;cs=s}function Co(i){if(i!==cs)return!1;if(!Pr)return $i(i),Pr=!0,!1;if(i.tag!==b&&(i.tag!==y||hW(i.type)&&!Dv(i.type,i.memoizedProps))){var s=gr;if(s)if(gy(i))Hp(i),cy();else for(;s;)tZ(i,s),s=pc(s)}return $i(i),i.tag===H?gr=dy(i):gr=cs?pc(i.stateNode):null,!0}function Ga(){return Pr&&gr!==null}function Hp(i){for(var s=gr;s;)eZ(i,s),s=pc(s)}function Ca(){cs=null,gr=null,Pr=!1,Xu=!1}function cr(){wl!==null&&(_X(wl),wl=null)}function _i(){return Pr}function Yu(i){wl===null?wl=[i]:wl.push(i)}var Mu=t.ReactCurrentBatchConfig,Fp=null;function wh(){return Mu.transition}var ur={recordUnsafeLifecycleWarnings:function(i,s){},flushPendingUnsafeLifecycleWarnings:function(){},recordLegacyContextWarning:function(i,s){},flushLegacyContextWarning:function(){},discardPendingWarnings:function(){}};{var Cy=function(i){for(var s=null,u=i;u!==null;)u.mode&ca&&(s=u),u=u.return;return s},Vn=function(i){var s=[];return i.forEach(function(u){s.push(u)}),s.sort().join(", ")},Ba=[],Vi=[],sa=[],ho=[],Hu=[],oa=[],Qr=new Set;ur.recordUnsafeLifecycleWarnings=function(i,s){Qr.has(i.type)||(typeof s.componentWillMount=="function"&&s.componentWillMount.__suppressDeprecationWarning!==!0&&Ba.push(i),i.mode&ca&&typeof s.UNSAFE_componentWillMount=="function"&&Vi.push(i),typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps.__suppressDeprecationWarning!==!0&&sa.push(i),i.mode&ca&&typeof s.UNSAFE_componentWillReceiveProps=="function"&&ho.push(i),typeof s.componentWillUpdate=="function"&&s.componentWillUpdate.__suppressDeprecationWarning!==!0&&Hu.push(i),i.mode&ca&&typeof s.UNSAFE_componentWillUpdate=="function"&&oa.push(i))},ur.flushPendingUnsafeLifecycleWarnings=function(){var i=new Set;Ba.length>0&&(Ba.forEach(function(fe){i.add(Xn(fe)||"Component"),Qr.add(fe.type)}),Ba=[]);var s=new Set;Vi.length>0&&(Vi.forEach(function(fe){s.add(Xn(fe)||"Component"),Qr.add(fe.type)}),Vi=[]);var u=new Set;sa.length>0&&(sa.forEach(function(fe){u.add(Xn(fe)||"Component"),Qr.add(fe.type)}),sa=[]);var h=new Set;ho.length>0&&(ho.forEach(function(fe){h.add(Xn(fe)||"Component"),Qr.add(fe.type)}),ho=[]);var p=new Set;Hu.length>0&&(Hu.forEach(function(fe){p.add(Xn(fe)||"Component"),Qr.add(fe.type)}),Hu=[]);var B=new Set;if(oa.length>0&&(oa.forEach(function(fe){B.add(Xn(fe)||"Component"),Qr.add(fe.type)}),oa=[]),s.size>0){var x=Vn(s);c(`Using UNSAFE_componentWillMount in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.

Please update the following components: %s`,x)}if(h.size>0){var Y=Vn(h);c(`Using UNSAFE_componentWillReceiveProps in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state

Please update the following components: %s`,Y)}if(B.size>0){var z=Vn(B);c(`Using UNSAFE_componentWillUpdate in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.

Please update the following components: %s`,z)}if(i.size>0){var J=Vn(i);o(`componentWillMount has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.
* Rename componentWillMount to UNSAFE_componentWillMount to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,J)}if(u.size>0){var j=Vn(u);o(`componentWillReceiveProps has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state
* Rename componentWillReceiveProps to UNSAFE_componentWillReceiveProps to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,j)}if(p.size>0){var pe=Vn(p);o(`componentWillUpdate has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* Rename componentWillUpdate to UNSAFE_componentWillUpdate to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,pe)}};var Fu=new Map,md=new Set;ur.recordLegacyContextWarning=function(i,s){var u=Cy(i);if(u===null){c("Expected to find a StrictMode component in a strict mode tree. This error is likely caused by a bug in React. Please file an issue.");return}if(!md.has(i.type)){var h=Fu.get(u);(i.type.contextTypes!=null||i.type.childContextTypes!=null||s!==null&&typeof s.getChildContext=="function")&&(h===void 0&&(h=[],Fu.set(u,h)),h.push(i))}},ur.flushLegacyContextWarning=function(){Fu.forEach(function(i,s){if(i.length!==0){var u=i[0],h=new Set;i.forEach(function(B){h.add(Xn(B)||"Component"),md.add(B.type)});var p=Vn(h);try{Oi(u),c(`Legacy context API has been detected within a strict-mode tree.

The old API will be supported in all 16.x releases, but applications using it should migrate to the new version.

Please update the following components: %s

Learn more about this warning here: https://reactjs.org/link/legacy-context`,p)}finally{za()}}})},ur.discardPendingWarnings=function(){Ba=[],Vi=[],sa=[],ho=[],Hu=[],oa=[],Fu=new Map}}var bd,Ku,Rs,Wh,Kp,hy=function(i,s){};bd=!1,Ku=!1,Rs={},Wh={},Kp={},hy=function(i,s){if(!(i===null||typeof i!="object")&&!(!i._store||i._store.validated||i.key!=null)){if(typeof i._store!="object")throw new Error("React Component in warnForMissingKey should have a _store. This error is likely caused by a bug in React. Please file an issue.");i._store.validated=!0;var u=Xn(s)||"Component";Wh[u]||(Wh[u]=!0,c('Each child in a list should have a unique "key" prop. See https://reactjs.org/link/warning-keys for more information.'))}};function SW(i){return i.prototype&&i.prototype.isReactComponent}function Wl(i,s,u){var h=u.ref;if(h!==null&&typeof h!="function"&&typeof h!="object"){if((i.mode&ca||Ue)&&!(u._owner&&u._self&&u._owner.stateNode!==u._self)&&!(u._owner&&u._owner.tag!==d)&&!(typeof u.type=="function"&&!SW(u.type))&&u._owner){var p=Xn(i)||"Component";Rs[p]||(c('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. We recommend using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',p,h),Rs[p]=!0)}if(u._owner){var B=u._owner,x;if(B){var Y=B;if(Y.tag!==d)throw new Error("Function components cannot have string refs. We recommend using useRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref");x=Y.stateNode}if(!x)throw new Error("Missing owner for string ref "+h+". This error is likely caused by a bug in React. Please file an issue.");var z=x;Wt(h,"ref");var J=""+h;if(s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===J)return s.ref;var j=function(pe){var fe=z.refs;pe===null?delete fe[J]:fe[J]=pe};return j._stringRef=J,j}else{if(typeof h!="string")throw new Error("Expected ref to be a function, a string, an object returned by React.createRef(), or null.");if(!u._owner)throw new Error("Element ref was specified as a string ("+h+`) but no owner was set. This could happen for one of the following reasons:
1. You may be adding a ref to a function component
2. You may be adding a ref to a component that was not created inside a component's render method
3. You have multiple copies of React loaded
See https://reactjs.org/link/refs-must-have-owner for more information.`)}}return h}function xh(i,s){var u=Object.prototype.toString.call(s);throw new Error("Objects are not valid as a React child (found: "+(u==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":u)+"). If you meant to render a collection of children, use an array instead.")}function Eu(i){{var s=Xn(i)||"Component";if(Kp[s])return;Kp[s]=!0,c("Functions are not valid as a React child. This may happen if you return a Component instead of <Component /> from render. Or maybe you meant to call this function rather than return it.")}}function Ep(i){var s=i._payload,u=i._init;return u(s)}function Tu(i){function s(We,qe){if(i){var xe=We.deletions;xe===null?(We.deletions=[qe],We.flags|=eu):xe.push(qe)}}function u(We,qe){if(!i)return null;for(var xe=qe;xe!==null;)s(We,xe),xe=xe.sibling;return null}function h(We,qe){for(var xe=new Map,St=qe;St!==null;)St.key!==null?xe.set(St.key,St):xe.set(St.index,St),St=St.sibling;return xe}function p(We,qe){var xe=nA(We,qe);return xe.index=0,xe.sibling=null,xe}function B(We,qe,xe){if(We.index=xe,!i)return We.flags|=xI,qe;var St=We.alternate;if(St!==null){var en=St.index;return en<qe?(We.flags|=ji,qe):en}else return We.flags|=ji,qe}function x(We){return i&&We.alternate===null&&(We.flags|=ji),We}function Y(We,qe,xe,St){if(qe===null||qe.tag!==Z){var en=Vx(xe,We.mode,St);return en.return=We,en}else{var qt=p(qe,xe);return qt.return=We,qt}}function z(We,qe,xe,St){var en=xe.type;if(en===is)return j(We,qe,xe.props.children,St,xe.key);if(qe!==null&&(qe.elementType===en||sY(qe,xe)||typeof en=="object"&&en!==null&&en.$$typeof===xt&&Ep(en)===qe.type)){var qt=p(qe,xe.props);return qt.ref=Wl(We,qe,xe),qt.return=We,qt._debugSource=xe._source,qt._debugOwner=xe._owner,qt}var Rn=xx(xe,We.mode,St);return Rn.ref=Wl(We,qe,xe),Rn.return=We,Rn}function J(We,qe,xe,St){if(qe===null||qe.tag!==v||qe.stateNode.containerInfo!==xe.containerInfo||qe.stateNode.implementation!==xe.implementation){var en=Nx(xe,We.mode,St);return en.return=We,en}else{var qt=p(qe,xe.children||[]);return qt.return=We,qt}}function j(We,qe,xe,St,en){if(qe===null||qe.tag!==V){var qt=zd(xe,We.mode,St,en);return qt.return=We,qt}else{var Rn=p(qe,xe);return Rn.return=We,Rn}}function pe(We,qe,xe){if(typeof qe=="string"&&qe!==""||typeof qe=="number"){var St=Vx(""+qe,We.mode,xe);return St.return=We,St}if(typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case fi:{var en=xx(qe,We.mode,xe);return en.ref=Wl(We,null,qe),en.return=We,en}case ci:{var qt=Nx(qe,We.mode,xe);return qt.return=We,qt}case xt:{var Rn=qe._payload,Hn=qe._init;return pe(We,Hn(Rn),xe)}}if(Ln(qe)||jt(qe)){var Wi=zd(qe,We.mode,xe,null);return Wi.return=We,Wi}xh(We,qe)}return typeof qe=="function"&&Eu(We),null}function fe(We,qe,xe,St){var en=qe!==null?qe.key:null;if(typeof xe=="string"&&xe!==""||typeof xe=="number")return en!==null?null:Y(We,qe,""+xe,St);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case fi:return xe.key===en?z(We,qe,xe,St):null;case ci:return xe.key===en?J(We,qe,xe,St):null;case xt:{var qt=xe._payload,Rn=xe._init;return fe(We,qe,Rn(qt),St)}}if(Ln(xe)||jt(xe))return en!==null?null:j(We,qe,xe,St,null);xh(We,xe)}return typeof xe=="function"&&Eu(We),null}function He(We,qe,xe,St,en){if(typeof St=="string"&&St!==""||typeof St=="number"){var qt=We.get(xe)||null;return Y(qe,qt,""+St,en)}if(typeof St=="object"&&St!==null){switch(St.$$typeof){case fi:{var Rn=We.get(St.key===null?xe:St.key)||null;return z(qe,Rn,St,en)}case ci:{var Hn=We.get(St.key===null?xe:St.key)||null;return J(qe,Hn,St,en)}case xt:var Wi=St._payload,Ci=St._init;return He(We,qe,xe,Ci(Wi),en)}if(Ln(St)||jt(St)){var Ma=We.get(xe)||null;return j(qe,Ma,St,en,null)}xh(qe,St)}return typeof St=="function"&&Eu(qe),null}function ze(We,qe,xe){{if(typeof We!="object"||We===null)return qe;switch(We.$$typeof){case fi:case ci:hy(We,xe);var St=We.key;if(typeof St!="string")break;if(qe===null){qe=new Set,qe.add(St);break}if(!qe.has(St)){qe.add(St);break}c("Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted  the behavior is unsupported and could change in a future version.",St);break;case xt:var en=We._payload,qt=We._init;ze(qt(en),qe,xe);break}}return qe}function je(We,qe,xe,St){for(var en=null,qt=0;qt<xe.length;qt++){var Rn=xe[qt];en=ze(Rn,en,We)}for(var Hn=null,Wi=null,Ci=qe,Ma=0,hi=0,Ra=null;Ci!==null&&hi<xe.length;hi++){Ci.index>hi?(Ra=Ci,Ci=null):Ra=Ci.sibling;var Ao=fe(We,Ci,xe[hi],St);if(Ao===null){Ci===null&&(Ci=Ra);break}i&&Ci&&Ao.alternate===null&&s(We,Ci),Ma=B(Ao,Ma,hi),Wi===null?Hn=Ao:Wi.sibling=Ao,Wi=Ao,Ci=Ra}if(hi===xe.length){if(u(We,Ci),_i()){var $s=hi;xu(We,$s)}return Hn}if(Ci===null){for(;hi<xe.length;hi++){var $r=pe(We,xe[hi],St);$r!==null&&(Ma=B($r,Ma,hi),Wi===null?Hn=$r:Wi.sibling=$r,Wi=$r)}if(_i()){var Ko=hi;xu(We,Ko)}return Hn}for(var Eo=h(We,Ci);hi<xe.length;hi++){var fo=He(Eo,We,hi,xe[hi],St);fo!==null&&(i&&fo.alternate!==null&&Eo.delete(fo.key===null?hi:fo.key),Ma=B(fo,Ma,hi),Wi===null?Hn=fo:Wi.sibling=fo,Wi=fo)}if(i&&Eo.forEach(function(bm){return s(We,bm)}),_i()){var nI=hi;xu(We,nI)}return Hn}function Jt(We,qe,xe,St){var en=jt(xe);if(typeof en!="function")throw new Error("An object is not an iterable. This error is likely caused by a bug in React. Please file an issue.");{typeof Symbol=="function"&&xe[Symbol.toStringTag]==="Generator"&&(Ku||c("Using Generators as children is unsupported and will likely yield unexpected results because enumerating a generator mutates it. You may convert it to an array with `Array.from()` or the `[...spread]` operator before rendering. Keep in mind you might need to polyfill these features for older browsers."),Ku=!0),xe.entries===en&&(bd||c("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),bd=!0);var qt=en.call(xe);if(qt)for(var Rn=null,Hn=qt.next();!Hn.done;Hn=qt.next()){var Wi=Hn.value;Rn=ze(Wi,Rn,We)}}var Ci=en.call(xe);if(Ci==null)throw new Error("An iterable object provided no iterator.");for(var Ma=null,hi=null,Ra=qe,Ao=0,$s=0,$r=null,Ko=Ci.next();Ra!==null&&!Ko.done;$s++,Ko=Ci.next()){Ra.index>$s?($r=Ra,Ra=null):$r=Ra.sibling;var Eo=fe(We,Ra,Ko.value,St);if(Eo===null){Ra===null&&(Ra=$r);break}i&&Ra&&Eo.alternate===null&&s(We,Ra),Ao=B(Eo,Ao,$s),hi===null?Ma=Eo:hi.sibling=Eo,hi=Eo,Ra=$r}if(Ko.done){if(u(We,Ra),_i()){var fo=$s;xu(We,fo)}return Ma}if(Ra===null){for(;!Ko.done;$s++,Ko=Ci.next()){var nI=pe(We,Ko.value,St);nI!==null&&(Ao=B(nI,Ao,$s),hi===null?Ma=nI:hi.sibling=nI,hi=nI)}if(_i()){var bm=$s;xu(We,bm)}return Ma}for(var l0=h(We,Ra);!Ko.done;$s++,Ko=Ci.next()){var Nc=He(l0,We,$s,Ko.value,St);Nc!==null&&(i&&Nc.alternate!==null&&l0.delete(Nc.key===null?$s:Nc.key),Ao=B(Nc,Ao,$s),hi===null?Ma=Nc:hi.sibling=Nc,hi=Nc)}if(i&&l0.forEach(function(V9){return s(We,V9)}),_i()){var x9=$s;xu(We,x9)}return Ma}function bn(We,qe,xe,St){if(qe!==null&&qe.tag===Z){u(We,qe.sibling);var en=p(qe,xe);return en.return=We,en}u(We,qe);var qt=Vx(xe,We.mode,St);return qt.return=We,qt}function gn(We,qe,xe,St){for(var en=xe.key,qt=qe;qt!==null;){if(qt.key===en){var Rn=xe.type;if(Rn===is){if(qt.tag===V){u(We,qt.sibling);var Hn=p(qt,xe.props.children);return Hn.return=We,Hn._debugSource=xe._source,Hn._debugOwner=xe._owner,Hn}}else if(qt.elementType===Rn||sY(qt,xe)||typeof Rn=="object"&&Rn!==null&&Rn.$$typeof===xt&&Ep(Rn)===qt.type){u(We,qt.sibling);var Wi=p(qt,xe.props);return Wi.ref=Wl(We,qt,xe),Wi.return=We,Wi._debugSource=xe._source,Wi._debugOwner=xe._owner,Wi}u(We,qt);break}else s(We,qt);qt=qt.sibling}if(xe.type===is){var Ci=zd(xe.props.children,We.mode,St,xe.key);return Ci.return=We,Ci}else{var Ma=xx(xe,We.mode,St);return Ma.ref=Wl(We,qe,xe),Ma.return=We,Ma}}function ii(We,qe,xe,St){for(var en=xe.key,qt=qe;qt!==null;){if(qt.key===en)if(qt.tag===v&&qt.stateNode.containerInfo===xe.containerInfo&&qt.stateNode.implementation===xe.implementation){u(We,qt.sibling);var Rn=p(qt,xe.children||[]);return Rn.return=We,Rn}else{u(We,qt);break}else s(We,qt);qt=qt.sibling}var Hn=Nx(xe,We.mode,St);return Hn.return=We,Hn}function $n(We,qe,xe,St){var en=typeof xe=="object"&&xe!==null&&xe.type===is&&xe.key===null;if(en&&(xe=xe.props.children),typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case fi:return x(gn(We,qe,xe,St));case ci:return x(ii(We,qe,xe,St));case xt:var qt=xe._payload,Rn=xe._init;return $n(We,qe,Rn(qt),St)}if(Ln(xe))return je(We,qe,xe,St);if(jt(xe))return Jt(We,qe,xe,St);xh(We,xe)}return typeof xe=="string"&&xe!==""||typeof xe=="number"?x(bn(We,qe,""+xe,St)):(typeof xe=="function"&&Eu(We),u(We,qe))}return $n}var Ir=Tu(!0),xl=Tu(!1);function Vh(i,s){if(i!==null&&s.child!==i.child)throw new Error("Resuming work not yet implemented.");if(s.child!==null){var u=s.child,h=nA(u,u.pendingProps);for(s.child=h,h.return=s;u.sibling!==null;)u=u.sibling,h=h.sibling=nA(u,u.pendingProps),h.return=s;h.sibling=null}}function Ay(i,s){for(var u=i.child;u!==null;)OL(u,s),u=u.sibling}var fy=bc(null),zu;zu={};var vd=null,yd=null,Gd=null,Gc=!1;function Lu(){vd=null,yd=null,Gd=null,Gc=!1}function Nh(){Gc=!0}function ws(){Gc=!1}function bg(i,s,u){Ss(fy,s._currentValue,i),s._currentValue=u,s._currentRenderer!==void 0&&s._currentRenderer!==null&&s._currentRenderer!==zu&&c("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),s._currentRenderer=zu}function py(i,s){var u=fy.current;Zs(fy,s),i._currentValue=u}function ha(i,s,u){for(var h=i;h!==null;){var p=h.alternate;if(cg(h.childLanes,s)?p!==null&&!cg(p.childLanes,s)&&(p.childLanes=Fn(p.childLanes,s)):(h.childLanes=Fn(h.childLanes,s),p!==null&&(p.childLanes=Fn(p.childLanes,s))),h===u)break;h=h.return}h!==u&&c("Expected to find the propagation root when scheduling context work. This error is likely caused by a bug in React. Please file an issue.")}function RW(i,s,u){Tp(i,s,u)}function Tp(i,s,u){var h=i.child;for(h!==null&&(h.return=i);h!==null;){var p=void 0,B=h.dependencies;if(B!==null){p=h.child;for(var x=B.firstContext;x!==null;){if(x.context===s){if(h.tag===d){var Y=ic(u),z=Vl(Bi,Y);z.tag=ku;var J=h.updateQueue;if(J!==null){var j=J.shared,pe=j.pending;pe===null?z.next=z:(z.next=pe.next,pe.next=z),j.pending=z}}h.lanes=Fn(h.lanes,u);var fe=h.alternate;fe!==null&&(fe.lanes=Fn(fe.lanes,u)),ha(h.return,u,i),B.lanes=Fn(B.lanes,u);break}x=x.next}}else if(h.tag===N)p=h.type===i.type?null:h.child;else if(h.tag===E){var He=h.return;if(He===null)throw new Error("We just came from a parent so we must have had a parent. This is a bug in React.");He.lanes=Fn(He.lanes,u);var ze=He.alternate;ze!==null&&(ze.lanes=Fn(ze.lanes,u)),ha(He,u,i),p=h.sibling}else p=h.child;if(p!==null)p.return=h;else for(p=h;p!==null;){if(p===i){p=null;break}var je=p.sibling;if(je!==null){je.return=p.return,p=je;break}p=p.return}h=p}}function _u(i,s){vd=i,yd=null,Gd=null;var u=i.dependencies;if(u!==null){var h=u.firstContext;h!==null&&(Hs(u.lanes,s)&&Uy(),u.firstContext=null)}}function oi(i){Gc&&c("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");var s=i._currentValue;if(Gd!==i){var u={context:i,memoizedValue:s,next:null};if(yd===null){if(vd===null)throw new Error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");yd=u,vd.dependencies={lanes:It,firstContext:u}}else yd=yd.next=u}return s}var Bc=null;function Xh(i){Bc===null?Bc=[i]:Bc.push(i)}function aZ(){if(Bc!==null){for(var i=0;i<Bc.length;i++){var s=Bc[i],u=s.interleaved;if(u!==null){s.interleaved=null;var h=u.next,p=s.pending;if(p!==null){var B=p.next;p.next=h,u.next=B}s.pending=u}}Bc=null}}function sZ(i,s,u,h){var p=s.interleaved;return p===null?(u.next=u,Xh(s)):(u.next=p.next,p.next=u),s.interleaved=u,zp(i,h)}function wW(i,s,u,h){var p=s.interleaved;p===null?(u.next=u,Xh(s)):(u.next=p.next,p.next=u),s.interleaved=u}function Zc(i,s,u,h){var p=s.interleaved;return p===null?(u.next=u,Xh(s)):(u.next=p.next,p.next=u),s.interleaved=u,zp(i,h)}function ks(i,s){return zp(i,s)}var WW=zp;function zp(i,s){i.lanes=Fn(i.lanes,s);var u=i.alternate;u!==null&&(u.lanes=Fn(u.lanes,s)),u===null&&(i.flags&(ji|tg))!==fn&&tY(i);for(var h=i,p=i.return;p!==null;)p.childLanes=Fn(p.childLanes,s),u=p.alternate,u!==null?u.childLanes=Fn(u.childLanes,s):(p.flags&(ji|tg))!==fn&&tY(i),h=p,p=p.return;if(h.tag===b){var B=h.stateNode;return B}else return null}var oZ=0,rZ=1,ku=2,my=3,Lp=!1,Bd,Zd;Bd=!1,Zd=null;function vg(i){var s={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:It},effects:null};i.updateQueue=s}function by(i,s){var u=s.updateQueue,h=i.updateQueue;if(u===h){var p={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects};s.updateQueue=p}}function Vl(i,s){var u={eventTime:i,lane:s,tag:oZ,payload:null,callback:null,next:null};return u}function yg(i,s,u){var h=i.updateQueue;if(h===null)return null;var p=h.shared;if(Zd===p&&!Bd&&(c("An update (setState, replaceState, or forceUpdate) was scheduled from inside an update function. Update functions should be pure, with zero side-effects. Consider using componentDidUpdate or a callback."),Bd=!0),uL()){var B=p.pending;return B===null?s.next=s:(s.next=B.next,B.next=s),p.pending=s,WW(i,u)}else return Zc(i,p,s,u)}function _p(i,s,u){var h=s.updateQueue;if(h!==null){var p=h.shared;if(nv(u)){var B=p.lanes;B=fl(B,i.pendingLanes);var x=Fn(B,u);p.lanes=x,_I(i,x)}}}function Sd(i,s){var u=i.updateQueue,h=i.alternate;if(h!==null){var p=h.updateQueue;if(u===p){var B=null,x=null,Y=u.firstBaseUpdate;if(Y!==null){var z=Y;do{var J={eventTime:z.eventTime,lane:z.lane,tag:z.tag,payload:z.payload,callback:z.callback,next:null};x===null?B=x=J:(x.next=J,x=J),z=z.next}while(z!==null);x===null?B=x=s:(x.next=s,x=s)}else B=x=s;u={baseState:p.baseState,firstBaseUpdate:B,lastBaseUpdate:x,shared:p.shared,effects:p.effects},i.updateQueue=u;return}}var j=u.lastBaseUpdate;j===null?u.firstBaseUpdate=s:j.next=s,u.lastBaseUpdate=s}function xW(i,s,u,h,p,B){switch(u.tag){case rZ:{var x=u.payload;if(typeof x=="function"){Nh();var Y=x.call(B,h,p);{if(i.mode&ca){wi(!0);try{x.call(B,h,p)}finally{wi(!1)}}ws()}return Y}return x}case my:i.flags=i.flags&~Ys|ai;case oZ:{var z=u.payload,J;if(typeof z=="function"){Nh(),J=z.call(B,h,p);{if(i.mode&ca){wi(!0);try{z.call(B,h,p)}finally{wi(!1)}}ws()}}else J=z;return J==null?h:Mt({},h,J)}case ku:return Lp=!0,h}return h}function Rd(i,s,u,h){var p=i.updateQueue;Lp=!1,Zd=p.shared;var B=p.firstBaseUpdate,x=p.lastBaseUpdate,Y=p.shared.pending;if(Y!==null){p.shared.pending=null;var z=Y,J=z.next;z.next=null,x===null?B=J:x.next=J,x=z;var j=i.alternate;if(j!==null){var pe=j.updateQueue,fe=pe.lastBaseUpdate;fe!==x&&(fe===null?pe.firstBaseUpdate=J:fe.next=J,pe.lastBaseUpdate=z)}}if(B!==null){var He=p.baseState,ze=It,je=null,Jt=null,bn=null,gn=B;do{var ii=gn.lane,$n=gn.eventTime;if(cg(h,ii)){if(bn!==null){var qe={eventTime:$n,lane:xa,tag:gn.tag,payload:gn.payload,callback:gn.callback,next:null};bn=bn.next=qe}He=xW(i,p,gn,He,s,u);var xe=gn.callback;if(xe!==null&&gn.lane!==xa){i.flags|=wG;var St=p.effects;St===null?p.effects=[gn]:St.push(gn)}}else{var We={eventTime:$n,lane:ii,tag:gn.tag,payload:gn.payload,callback:gn.callback,next:null};bn===null?(Jt=bn=We,je=He):bn=bn.next=We,ze=Fn(ze,ii)}if(gn=gn.next,gn===null){if(Y=p.shared.pending,Y===null)break;var en=Y,qt=en.next;en.next=null,gn=qt,p.lastBaseUpdate=en,p.shared.pending=null}}while(!0);bn===null&&(je=He),p.baseState=je,p.firstBaseUpdate=Jt,p.lastBaseUpdate=bn;var Rn=p.shared.interleaved;if(Rn!==null){var Hn=Rn;do ze=Fn(ze,Hn.lane),Hn=Hn.next;while(Hn!==Rn)}else B===null&&(p.shared.lanes=It);i0(ze),i.lanes=ze,i.memoizedState=He}Zd=null}function VW(i,s){if(typeof i!="function")throw new Error("Invalid argument passed as callback. Expected a function. Instead "+("received: "+i));i.call(s)}function lZ(){Lp=!1}function Uu(){return Lp}function gZ(i,s,u){var h=s.effects;if(s.effects=null,h!==null)for(var p=0;p<h.length;p++){var B=h[p],x=B.callback;x!==null&&(B.callback=null,VW(x,u))}}var Yh={},Sc=bc(Yh),wd=bc(Yh),Mh=bc(Yh);function Nl(i){if(i===Yh)throw new Error("Expected host context to exist. This error is likely caused by a bug in React. Please file an issue.");return i}function cZ(){var i=Nl(Mh.current);return i}function dr(i,s){Ss(Mh,s,i),Ss(wd,i,i),Ss(Sc,Yh,i);var u=BB(s);Zs(Sc,i),Ss(Sc,u,i)}function Wd(i){Zs(Sc,i),Zs(wd,i),Zs(Mh,i)}function vy(){var i=Nl(Sc.current);return i}function yy(i){Nl(Mh.current);var s=Nl(Sc.current),u=kv(s,i.type);s!==u&&(Ss(wd,i,i),Ss(Sc,u,i))}function Gy(i){wd.current===i&&(Zs(Sc,i),Zs(wd,i))}var NW=0,uZ=1,By=1,Aa=2,jr=bc(NW);function kp(i,s){return(i&s)!==0}function xd(i){return i&uZ}function Zy(i,s){return i&uZ|s}function XW(i,s){return i|s}function Rc(i,s){Ss(jr,s,i)}function Vd(i){Zs(jr,i)}function IZ(i,s){var u=i.memoizedState;return u!==null?u.dehydrated!==null:(i.memoizedProps,!0)}function Du(i){for(var s=i;s!==null;){if(s.tag===H){var u=s.memoizedState;if(u!==null){var h=u.dehydrated;if(h===null||HB(h)||hp(h))return s}}else if(s.tag===ee&&s.memoizedProps.revealOrder!==void 0){var p=(s.flags&ai)!==fn;if(p)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)return null;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var us=0,Za=1,Cr=2,Ya=4,Qa=8,Hh=[];function Sy(){for(var i=0;i<Hh.length;i++){var s=Hh[i];s._workInProgressVersionPrimary=null}Hh.length=0}function Fh(i,s){var u=s._getVersion,h=u(s._source);i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[s,h]:i.mutableSourceEagerHydrationData.push(s,h)}var Dt=t.ReactCurrentDispatcher,wc=t.ReactCurrentBatchConfig,Up,Ju;Up=new Set;var Ou=It,bi=null,vi=null,ea=null,Dp=!1,Xl=!1,Pu=0,Ry=0,dZ=25,nt=null,hr=null,Wc=-1,Kh=!1;function di(){{var i=nt;hr===null?hr=[i]:hr.push(i)}}function Kt(){{var i=nt;hr!==null&&(Wc++,hr[Wc]!==i&&YW(i))}}function Nd(i){i!=null&&!Ln(i)&&c("%s received a final argument that is not an array (instead, received `%s`). When specified, the final argument must be an array.",nt,typeof i)}function YW(i){{var s=Xn(bi);if(!Up.has(s)&&(Up.add(s),hr!==null)){for(var u="",h=30,p=0;p<=Wc;p++){for(var B=hr[p],x=p===Wc?i:B,Y=p+1+". "+B;Y.length<h;)Y+=" ";Y+=x+`
`,u+=Y}c(`React has detected a change in the order of Hooks called by %s. This will lead to bugs and errors if not fixed. For more information, read the Rules of Hooks: https://reactjs.org/link/rules-of-hooks

   Previous render            Next render
   ------------------------------------------------------
%s   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
`,s,u)}}}function ja(){throw new Error(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.`)}function Jp(i,s){if(Kh)return!1;if(s===null)return c("%s received a final argument during this render, but not during the previous render. Even though the final argument is optional, its type cannot change between renders.",nt),!1;i.length!==s.length&&c(`The final argument passed to %s changed size between renders. The order and size of this array must remain constant.

Previous: %s
Incoming: %s`,nt,"["+s.join(", ")+"]","["+i.join(", ")+"]");for(var u=0;u<s.length&&u<i.length;u++)if(!lo(i[u],s[u]))return!1;return!0}function Xd(i,s,u,h,p,B){Ou=B,bi=s,hr=i!==null?i._debugHookTypes:null,Wc=-1,Kh=i!==null&&i.type!==s.type,s.memoizedState=null,s.updateQueue=null,s.lanes=It,i!==null&&i.memoizedState!==null?Dt.current=g:hr!==null?Dt.current=l:Dt.current=BZ;var x=u(h,p);if(Xl){var Y=0;do{if(Xl=!1,Pu=0,Y>=dZ)throw new Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");Y+=1,Kh=!1,vi=null,ea=null,s.updateQueue=null,Wc=-1,Dt.current=A,x=u(h,p)}while(Xl)}Dt.current=cm,s._debugHookTypes=hr;var z=vi!==null&&vi.next!==null;if(Ou=It,bi=null,vi=null,ea=null,nt=null,hr=null,Wc=-1,i!==null&&(i.flags&Kr)!==(s.flags&Kr)&&(i.mode&jn)!==pn&&c("Internal React error: Expected static flag was missing. Please notify the React team."),Dp=!1,z)throw new Error("Rendered fewer hooks than expected. This may be caused by an accidental early return statement.");return x}function qa(){var i=Pu!==0;return Pu=0,i}function Op(i,s,u){s.updateQueue=i.updateQueue,(s.mode&dl)!==pn?s.flags&=-50333701:s.flags&=-2053,i.lanes=HC(i.lanes,u)}function CZ(){if(Dt.current=cm,Dp){for(var i=bi.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}Dp=!1}Ou=It,bi=null,vi=null,ea=null,hr=null,Wc=-1,nt=null,Ty=!1,Xl=!1,Pu=0}function Yl(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ea===null?bi.memoizedState=ea=i:ea=ea.next=i,ea}function $a(){var i;if(vi===null){var s=bi.alternate;s!==null?i=s.memoizedState:i=null}else i=vi.next;var u;if(ea===null?u=bi.memoizedState:u=ea.next,u!==null)ea=u,u=ea.next,vi=i;else{if(i===null)throw new Error("Rendered more hooks than during the previous render.");vi=i;var h={memoizedState:vi.memoizedState,baseState:vi.baseState,baseQueue:vi.baseQueue,queue:vi.queue,next:null};ea===null?bi.memoizedState=ea=h:ea=ea.next=h}return ea}function hZ(){return{lastEffect:null,stores:null}}function wy(i,s){return typeof s=="function"?s(i):s}function Eh(i,s,u){var h=Yl(),p;u!==void 0?p=u(s):p=s,h.memoizedState=h.baseState=p;var B={pending:null,interleaved:null,lanes:It,dispatch:null,lastRenderedReducer:i,lastRenderedState:p};h.queue=B;var x=B.dispatch=bZ.bind(null,bi,B);return[h.memoizedState,x]}function Th(i,s,u){var h=$a(),p=h.queue;if(p===null)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");p.lastRenderedReducer=i;var B=vi,x=B.baseQueue,Y=p.pending;if(Y!==null){if(x!==null){var z=x.next,J=Y.next;x.next=J,Y.next=z}B.baseQueue!==x&&c("Internal error: Expected work-in-progress queue to be a clone. This is a bug in React."),B.baseQueue=x=Y,p.pending=null}if(x!==null){var j=x.next,pe=B.baseState,fe=null,He=null,ze=null,je=j;do{var Jt=je.lane;if(cg(Ou,Jt)){if(ze!==null){var gn={lane:xa,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null};ze=ze.next=gn}if(je.hasEagerState)pe=je.eagerState;else{var ii=je.action;pe=i(pe,ii)}}else{var bn={lane:Jt,action:je.action,hasEagerState:je.hasEagerState,eagerState:je.eagerState,next:null};ze===null?(He=ze=bn,fe=pe):ze=ze.next=bn,bi.lanes=Fn(bi.lanes,Jt),i0(Jt)}je=je.next}while(je!==null&&je!==j);ze===null?fe=pe:ze.next=He,lo(pe,h.memoizedState)||Uy(),h.memoizedState=pe,h.baseState=fe,h.baseQueue=ze,p.lastRenderedState=pe}var $n=p.interleaved;if($n!==null){var We=$n;do{var qe=We.lane;bi.lanes=Fn(bi.lanes,qe),i0(qe),We=We.next}while(We!==$n)}else x===null&&(p.lanes=It);var xe=p.dispatch;return[h.memoizedState,xe]}function Ml(i,s,u){var h=$a(),p=h.queue;if(p===null)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");p.lastRenderedReducer=i;var B=p.dispatch,x=p.pending,Y=h.memoizedState;if(x!==null){p.pending=null;var z=x.next,J=z;do{var j=J.action;Y=i(Y,j),J=J.next}while(J!==z);lo(Y,h.memoizedState)||Uy(),h.memoizedState=Y,h.baseQueue===null&&(h.baseState=Y),p.lastRenderedState=Y}return[Y,B]}function D2(i,s,u){}function J2(i,s,u){}function Wy(i,s,u){var h=bi,p=Yl(),B,x=_i();if(x){if(u===void 0)throw new Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");B=u(),Ju||B!==u()&&(c("The result of getServerSnapshot should be cached to avoid an infinite loop"),Ju=!0)}else{if(B=s(),!Ju){var Y=s();lo(B,Y)||(c("The result of getSnapshot should be cached to avoid an infinite loop"),Ju=!0)}var z=TZ();if(z===null)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");aa(z,Ou)||Pp(h,s,B)}p.memoizedState=B;var J={value:B,getSnapshot:s};return p.queue=J,em(fZ.bind(null,h,J,i),[i]),h.flags|=eg,Lh(Za|Qa,AZ.bind(null,h,J,B,s),void 0,null),B}function zh(i,s,u){var h=bi,p=$a(),B=s();if(!Ju){var x=s();lo(B,x)||(c("The result of getSnapshot should be cached to avoid an infinite loop"),Ju=!0)}var Y=p.memoizedState,z=!lo(Y,B);z&&(p.memoizedState=B,Uy());var J=p.queue;if(kh(fZ.bind(null,h,J,i),[i]),J.getSnapshot!==s||z||ea!==null&&ea.memoizedState.tag&Za){h.flags|=eg,Lh(Za|Qa,AZ.bind(null,h,J,B,s),void 0,null);var j=TZ();if(j===null)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");aa(j,Ou)||Pp(h,s,B)}return B}function Pp(i,s,u){i.flags|=Lb;var h={getSnapshot:s,value:u},p=bi.updateQueue;if(p===null)p=hZ(),bi.updateQueue=p,p.stores=[h];else{var B=p.stores;B===null?p.stores=[h]:B.push(h)}}function AZ(i,s,u,h){s.value=u,s.getSnapshot=h,Qp(s)&&xy(i)}function fZ(i,s,u){var h=function(){Qp(s)&&xy(i)};return u(h)}function Qp(i){var s=i.getSnapshot,u=i.value;try{var h=s();return!lo(u,h)}catch{return!0}}function xy(i){var s=ks(i,wn);s!==null&&hs(s,i,wn,Bi)}function jp(i){var s=Yl();typeof i=="function"&&(i=i()),s.memoizedState=s.baseState=i;var u={pending:null,interleaved:null,lanes:It,dispatch:null,lastRenderedReducer:wy,lastRenderedState:i};s.queue=u;var h=u.dispatch=vZ.bind(null,bi,u);return[s.memoizedState,h]}function qp(i){return Th(wy)}function Vy(i){return Ml(wy)}function Lh(i,s,u,h){var p={tag:i,create:s,destroy:u,deps:h,next:null},B=bi.updateQueue;if(B===null)B=hZ(),bi.updateQueue=B,B.lastEffect=p.next=p;else{var x=B.lastEffect;if(x===null)B.lastEffect=p.next=p;else{var Y=x.next;x.next=p,p.next=Y,B.lastEffect=p}}return p}function _h(i){var s=Yl();{var u={current:i};return s.memoizedState=u,u}}function Yd(i){var s=$a();return s.memoizedState}function Md(i,s,u,h){var p=Yl(),B=h===void 0?null:h;bi.flags|=i,p.memoizedState=Lh(Za|s,u,void 0,B)}function $p(i,s,u,h){var p=$a(),B=h===void 0?null:h,x=void 0;if(vi!==null){var Y=vi.memoizedState;if(x=Y.destroy,B!==null){var z=Y.deps;if(Jp(B,z)){p.memoizedState=Lh(s,u,x,B);return}}}bi.flags|=i,p.memoizedState=Lh(Za|s,u,x,B)}function em(i,s){return(bi.mode&dl)!==pn?Md(Kn|eg|Ms,Qa,i,s):Md(eg|Ms,Qa,i,s)}function kh(i,s){return $p(eg,Qa,i,s)}function Ny(i,s){return Md(ei,Cr,i,s)}function Uh(i,s){return $p(ei,Cr,i,s)}function Xy(i,s){var u=ei;return u|=ag,(bi.mode&dl)!==pn&&(u|=Wo),Md(u,Ya,i,s)}function tm(i,s){return $p(ei,Ya,i,s)}function Yy(i,s){if(typeof s=="function"){var u=s,h=i();return u(h),function(){u(null)}}else if(s!=null){var p=s;p.hasOwnProperty("current")||c("Expected useImperativeHandle() first argument to either be a ref callback or React.createRef() object. Instead received: %s.","an object with keys {"+Object.keys(p).join(", ")+"}");var B=i();return p.current=B,function(){p.current=null}}}function Dh(i,s,u){typeof s!="function"&&c("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",s!==null?typeof s:"null");var h=u!=null?u.concat([i]):null,p=ei;return p|=ag,(bi.mode&dl)!==pn&&(p|=Wo),Md(p,Ya,Yy.bind(null,s,i),h)}function nm(i,s,u){typeof s!="function"&&c("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",s!==null?typeof s:"null");var h=u!=null?u.concat([i]):null;return $p(ei,Ya,Yy.bind(null,s,i),h)}function MW(i,s){}var im=MW;function am(i,s){var u=Yl(),h=s===void 0?null:s;return u.memoizedState=[i,h],i}function Jh(i,s){var u=$a(),h=s===void 0?null:s,p=u.memoizedState;if(p!==null&&h!==null){var B=p[1];if(Jp(h,B))return p[0]}return u.memoizedState=[i,h],i}function sm(i,s){var u=Yl(),h=s===void 0?null:s,p=i();return u.memoizedState=[p,h],p}function Oh(i,s){var u=$a(),h=s===void 0?null:s,p=u.memoizedState;if(p!==null&&h!==null){var B=p[1];if(Jp(h,B))return p[0]}var x=i();return u.memoizedState=[x,h],x}function om(i){var s=Yl();return s.memoizedState=i,i}function My(i){var s=$a(),u=vi,h=u.memoizedState;return Fy(s,h,i)}function Hy(i){var s=$a();if(vi===null)return s.memoizedState=i,i;var u=vi.memoizedState;return Fy(s,u,i)}function Fy(i,s,u){var h=!Sw(Ou);if(h){if(!lo(u,s)){var p=LG();bi.lanes=Fn(bi.lanes,p),i0(p),i.baseState=!0}return s}else return i.baseState&&(i.baseState=!1,Uy()),i.memoizedState=u,u}function pZ(i,s,u){var h=so();ya(sv(h,kr)),i(!0);var p=wc.transition;wc.transition={};var B=wc.transition;wc.transition._updatedFibers=new Set;try{i(!1),s()}finally{if(ya(h),wc.transition=p,p===null&&B._updatedFibers){var x=B._updatedFibers.size;x>10&&o("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),B._updatedFibers.clear()}}}function rm(){var i=jp(!1),s=i[0],u=i[1],h=pZ.bind(null,u),p=Yl();return p.memoizedState=h,[s,h]}function Ky(){var i=qp(),s=i[0],u=$a(),h=u.memoizedState;return[s,h]}function Ey(){var i=Vy(),s=i[0],u=$a(),h=u.memoizedState;return[s,h]}var Ty=!1;function mZ(){return Ty}function lm(){var i=Yl(),s=TZ(),u=s.identifierPrefix,h;if(_i()){var p=GW();h=":"+u+"R"+p;var B=Pu++;B>0&&(h+="H"+B.toString(32)),h+=":"}else{var x=Ry++;h=":"+u+"r"+x.toString(32)+":"}return i.memoizedState=h,h}function Ph(){var i=$a(),s=i.memoizedState;return s}function bZ(i,s,u){typeof arguments[3]=="function"&&c("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var h=Ed(i),p={lane:h,action:u,hasEagerState:!1,eagerState:null,next:null};if(zy(i))gm(s,p);else{var B=sZ(i,s,p,h);if(B!==null){var x=Fo();hs(B,i,h,x),yZ(B,s,h)}}GZ(i,h)}function vZ(i,s,u){typeof arguments[3]=="function"&&c("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var h=Ed(i),p={lane:h,action:u,hasEagerState:!1,eagerState:null,next:null};if(zy(i))gm(s,p);else{var B=i.alternate;if(i.lanes===It&&(B===null||B.lanes===It)){var x=s.lastRenderedReducer;if(x!==null){var Y;Y=Dt.current,Dt.current=G;try{var z=s.lastRenderedState,J=x(z,u);if(p.hasEagerState=!0,p.eagerState=J,lo(J,z)){wW(i,s,p,h);return}}catch{}finally{Dt.current=Y}}}var j=sZ(i,s,p,h);if(j!==null){var pe=Fo();hs(j,i,h,pe),yZ(j,s,h)}}GZ(i,h)}function zy(i){var s=i.alternate;return i===bi||s!==null&&s===bi}function gm(i,s){Xl=Dp=!0;var u=i.pending;u===null?s.next=s:(s.next=u.next,u.next=s),i.pending=s}function yZ(i,s,u){if(nv(u)){var h=s.lanes;h=fl(h,i.pendingLanes);var p=Fn(h,u);s.lanes=p,_I(i,p)}}function GZ(i,s,u){Ob(i,s)}var cm={readContext:oi,useCallback:ja,useContext:ja,useEffect:ja,useImperativeHandle:ja,useInsertionEffect:ja,useLayoutEffect:ja,useMemo:ja,useReducer:ja,useRef:ja,useState:ja,useDebugValue:ja,useDeferredValue:ja,useTransition:ja,useMutableSource:ja,useSyncExternalStore:ja,useId:ja,unstable_isNewReconciler:ve},BZ=null,l=null,g=null,A=null,m=null,G=null,W=null;{var M=function(){c("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().")},T=function(){c("Do not call Hooks inside useEffect(...), useMemo(...), or other built-in Hooks. You can only call Hooks at the top level of your React function. For more information, see https://reactjs.org/link/rules-of-hooks")};BZ={readContext:function(i){return oi(i)},useCallback:function(i,s){return nt="useCallback",di(),Nd(s),am(i,s)},useContext:function(i){return nt="useContext",di(),oi(i)},useEffect:function(i,s){return nt="useEffect",di(),Nd(s),em(i,s)},useImperativeHandle:function(i,s,u){return nt="useImperativeHandle",di(),Nd(u),Dh(i,s,u)},useInsertionEffect:function(i,s){return nt="useInsertionEffect",di(),Nd(s),Ny(i,s)},useLayoutEffect:function(i,s){return nt="useLayoutEffect",di(),Nd(s),Xy(i,s)},useMemo:function(i,s){nt="useMemo",di(),Nd(s);var u=Dt.current;Dt.current=m;try{return sm(i,s)}finally{Dt.current=u}},useReducer:function(i,s,u){nt="useReducer",di();var h=Dt.current;Dt.current=m;try{return Eh(i,s,u)}finally{Dt.current=h}},useRef:function(i){return nt="useRef",di(),_h(i)},useState:function(i){nt="useState",di();var s=Dt.current;Dt.current=m;try{return jp(i)}finally{Dt.current=s}},useDebugValue:function(i,s){return nt="useDebugValue",di(),void 0},useDeferredValue:function(i){return nt="useDeferredValue",di(),om(i)},useTransition:function(){return nt="useTransition",di(),rm()},useMutableSource:function(i,s,u){return nt="useMutableSource",di(),void 0},useSyncExternalStore:function(i,s,u){return nt="useSyncExternalStore",di(),Wy(i,s,u)},useId:function(){return nt="useId",di(),lm()},unstable_isNewReconciler:ve},l={readContext:function(i){return oi(i)},useCallback:function(i,s){return nt="useCallback",Kt(),am(i,s)},useContext:function(i){return nt="useContext",Kt(),oi(i)},useEffect:function(i,s){return nt="useEffect",Kt(),em(i,s)},useImperativeHandle:function(i,s,u){return nt="useImperativeHandle",Kt(),Dh(i,s,u)},useInsertionEffect:function(i,s){return nt="useInsertionEffect",Kt(),Ny(i,s)},useLayoutEffect:function(i,s){return nt="useLayoutEffect",Kt(),Xy(i,s)},useMemo:function(i,s){nt="useMemo",Kt();var u=Dt.current;Dt.current=m;try{return sm(i,s)}finally{Dt.current=u}},useReducer:function(i,s,u){nt="useReducer",Kt();var h=Dt.current;Dt.current=m;try{return Eh(i,s,u)}finally{Dt.current=h}},useRef:function(i){return nt="useRef",Kt(),_h(i)},useState:function(i){nt="useState",Kt();var s=Dt.current;Dt.current=m;try{return jp(i)}finally{Dt.current=s}},useDebugValue:function(i,s){return nt="useDebugValue",Kt(),void 0},useDeferredValue:function(i){return nt="useDeferredValue",Kt(),om(i)},useTransition:function(){return nt="useTransition",Kt(),rm()},useMutableSource:function(i,s,u){return nt="useMutableSource",Kt(),void 0},useSyncExternalStore:function(i,s,u){return nt="useSyncExternalStore",Kt(),Wy(i,s,u)},useId:function(){return nt="useId",Kt(),lm()},unstable_isNewReconciler:ve},g={readContext:function(i){return oi(i)},useCallback:function(i,s){return nt="useCallback",Kt(),Jh(i,s)},useContext:function(i){return nt="useContext",Kt(),oi(i)},useEffect:function(i,s){return nt="useEffect",Kt(),kh(i,s)},useImperativeHandle:function(i,s,u){return nt="useImperativeHandle",Kt(),nm(i,s,u)},useInsertionEffect:function(i,s){return nt="useInsertionEffect",Kt(),Uh(i,s)},useLayoutEffect:function(i,s){return nt="useLayoutEffect",Kt(),tm(i,s)},useMemo:function(i,s){nt="useMemo",Kt();var u=Dt.current;Dt.current=G;try{return Oh(i,s)}finally{Dt.current=u}},useReducer:function(i,s,u){nt="useReducer",Kt();var h=Dt.current;Dt.current=G;try{return Th(i,s,u)}finally{Dt.current=h}},useRef:function(i){return nt="useRef",Kt(),Yd()},useState:function(i){nt="useState",Kt();var s=Dt.current;Dt.current=G;try{return qp(i)}finally{Dt.current=s}},useDebugValue:function(i,s){return nt="useDebugValue",Kt(),im()},useDeferredValue:function(i){return nt="useDeferredValue",Kt(),My(i)},useTransition:function(){return nt="useTransition",Kt(),Ky()},useMutableSource:function(i,s,u){return nt="useMutableSource",Kt(),void 0},useSyncExternalStore:function(i,s,u){return nt="useSyncExternalStore",Kt(),zh(i,s)},useId:function(){return nt="useId",Kt(),Ph()},unstable_isNewReconciler:ve},A={readContext:function(i){return oi(i)},useCallback:function(i,s){return nt="useCallback",Kt(),Jh(i,s)},useContext:function(i){return nt="useContext",Kt(),oi(i)},useEffect:function(i,s){return nt="useEffect",Kt(),kh(i,s)},useImperativeHandle:function(i,s,u){return nt="useImperativeHandle",Kt(),nm(i,s,u)},useInsertionEffect:function(i,s){return nt="useInsertionEffect",Kt(),Uh(i,s)},useLayoutEffect:function(i,s){return nt="useLayoutEffect",Kt(),tm(i,s)},useMemo:function(i,s){nt="useMemo",Kt();var u=Dt.current;Dt.current=W;try{return Oh(i,s)}finally{Dt.current=u}},useReducer:function(i,s,u){nt="useReducer",Kt();var h=Dt.current;Dt.current=W;try{return Ml(i,s,u)}finally{Dt.current=h}},useRef:function(i){return nt="useRef",Kt(),Yd()},useState:function(i){nt="useState",Kt();var s=Dt.current;Dt.current=W;try{return Vy(i)}finally{Dt.current=s}},useDebugValue:function(i,s){return nt="useDebugValue",Kt(),im()},useDeferredValue:function(i){return nt="useDeferredValue",Kt(),Hy(i)},useTransition:function(){return nt="useTransition",Kt(),Ey()},useMutableSource:function(i,s,u){return nt="useMutableSource",Kt(),void 0},useSyncExternalStore:function(i,s,u){return nt="useSyncExternalStore",Kt(),zh(i,s)},useId:function(){return nt="useId",Kt(),Ph()},unstable_isNewReconciler:ve},m={readContext:function(i){return M(),oi(i)},useCallback:function(i,s){return nt="useCallback",T(),di(),am(i,s)},useContext:function(i){return nt="useContext",T(),di(),oi(i)},useEffect:function(i,s){return nt="useEffect",T(),di(),em(i,s)},useImperativeHandle:function(i,s,u){return nt="useImperativeHandle",T(),di(),Dh(i,s,u)},useInsertionEffect:function(i,s){return nt="useInsertionEffect",T(),di(),Ny(i,s)},useLayoutEffect:function(i,s){return nt="useLayoutEffect",T(),di(),Xy(i,s)},useMemo:function(i,s){nt="useMemo",T(),di();var u=Dt.current;Dt.current=m;try{return sm(i,s)}finally{Dt.current=u}},useReducer:function(i,s,u){nt="useReducer",T(),di();var h=Dt.current;Dt.current=m;try{return Eh(i,s,u)}finally{Dt.current=h}},useRef:function(i){return nt="useRef",T(),di(),_h(i)},useState:function(i){nt="useState",T(),di();var s=Dt.current;Dt.current=m;try{return jp(i)}finally{Dt.current=s}},useDebugValue:function(i,s){return nt="useDebugValue",T(),di(),void 0},useDeferredValue:function(i){return nt="useDeferredValue",T(),di(),om(i)},useTransition:function(){return nt="useTransition",T(),di(),rm()},useMutableSource:function(i,s,u){return nt="useMutableSource",T(),di(),void 0},useSyncExternalStore:function(i,s,u){return nt="useSyncExternalStore",T(),di(),Wy(i,s,u)},useId:function(){return nt="useId",T(),di(),lm()},unstable_isNewReconciler:ve},G={readContext:function(i){return M(),oi(i)},useCallback:function(i,s){return nt="useCallback",T(),Kt(),Jh(i,s)},useContext:function(i){return nt="useContext",T(),Kt(),oi(i)},useEffect:function(i,s){return nt="useEffect",T(),Kt(),kh(i,s)},useImperativeHandle:function(i,s,u){return nt="useImperativeHandle",T(),Kt(),nm(i,s,u)},useInsertionEffect:function(i,s){return nt="useInsertionEffect",T(),Kt(),Uh(i,s)},useLayoutEffect:function(i,s){return nt="useLayoutEffect",T(),Kt(),tm(i,s)},useMemo:function(i,s){nt="useMemo",T(),Kt();var u=Dt.current;Dt.current=G;try{return Oh(i,s)}finally{Dt.current=u}},useReducer:function(i,s,u){nt="useReducer",T(),Kt();var h=Dt.current;Dt.current=G;try{return Th(i,s,u)}finally{Dt.current=h}},useRef:function(i){return nt="useRef",T(),Kt(),Yd()},useState:function(i){nt="useState",T(),Kt();var s=Dt.current;Dt.current=G;try{return qp(i)}finally{Dt.current=s}},useDebugValue:function(i,s){return nt="useDebugValue",T(),Kt(),im()},useDeferredValue:function(i){return nt="useDeferredValue",T(),Kt(),My(i)},useTransition:function(){return nt="useTransition",T(),Kt(),Ky()},useMutableSource:function(i,s,u){return nt="useMutableSource",T(),Kt(),void 0},useSyncExternalStore:function(i,s,u){return nt="useSyncExternalStore",T(),Kt(),zh(i,s)},useId:function(){return nt="useId",T(),Kt(),Ph()},unstable_isNewReconciler:ve},W={readContext:function(i){return M(),oi(i)},useCallback:function(i,s){return nt="useCallback",T(),Kt(),Jh(i,s)},useContext:function(i){return nt="useContext",T(),Kt(),oi(i)},useEffect:function(i,s){return nt="useEffect",T(),Kt(),kh(i,s)},useImperativeHandle:function(i,s,u){return nt="useImperativeHandle",T(),Kt(),nm(i,s,u)},useInsertionEffect:function(i,s){return nt="useInsertionEffect",T(),Kt(),Uh(i,s)},useLayoutEffect:function(i,s){return nt="useLayoutEffect",T(),Kt(),tm(i,s)},useMemo:function(i,s){nt="useMemo",T(),Kt();var u=Dt.current;Dt.current=G;try{return Oh(i,s)}finally{Dt.current=u}},useReducer:function(i,s,u){nt="useReducer",T(),Kt();var h=Dt.current;Dt.current=G;try{return Ml(i,s,u)}finally{Dt.current=h}},useRef:function(i){return nt="useRef",T(),Kt(),Yd()},useState:function(i){nt="useState",T(),Kt();var s=Dt.current;Dt.current=G;try{return Vy(i)}finally{Dt.current=s}},useDebugValue:function(i,s){return nt="useDebugValue",T(),Kt(),im()},useDeferredValue:function(i){return nt="useDeferredValue",T(),Kt(),Hy(i)},useTransition:function(){return nt="useTransition",T(),Kt(),Ey()},useMutableSource:function(i,s,u){return nt="useMutableSource",T(),Kt(),void 0},useSyncExternalStore:function(i,s,u){return nt="useSyncExternalStore",T(),Kt(),zh(i,s)},useId:function(){return nt="useId",T(),Kt(),Ph()},unstable_isNewReconciler:ve}}var U=e.unstable_now,ie=0,ue=-1,Re=-1,ke=-1,Qe=!1,ht=!1;function Rt(){return Qe}function Cn(){ht=!0}function En(){Qe=!1,ht=!1}function Gn(){Qe=ht,ht=!1}function Ei(){return ie}function Ti(){ie=U()}function Me(i){Re=U(),i.actualStartTime<0&&(i.actualStartTime=U())}function tt(i){Re=-1}function Ve(i,s){if(Re>=0){var u=U()-Re;i.actualDuration+=u,s&&(i.selfBaseDuration=u),Re=-1}}function Gt(i){if(ue>=0){var s=U()-ue;ue=-1;for(var u=i.return;u!==null;){switch(u.tag){case b:var h=u.stateNode;h.effectDuration+=s;return;case X:var p=u.stateNode;p.effectDuration+=s;return}u=u.return}}}function ln(i){if(ke>=0){var s=U()-ke;ke=-1;for(var u=i.return;u!==null;){switch(u.tag){case b:var h=u.stateNode;h!==null&&(h.passiveEffectDuration+=s);return;case X:var p=u.stateNode;p!==null&&(p.passiveEffectDuration+=s);return}u=u.return}}}function Tt(){ue=U()}function _n(){ke=U()}function ri(i){for(var s=i.child;s;)i.actualDuration+=s.actualDuration,s=s.sibling}function qn(i,s){if(i&&i.defaultProps){var u=Mt({},s),h=i.defaultProps;for(var p in h)u[p]===void 0&&(u[p]=h[p]);return u}return s}var li={},ki,ti,Tn,ra,Ui,Yo,Sa,Us,Ds,Ar,Hl;{ki=new Set,ti=new Set,Tn=new Set,ra=new Set,Us=new Set,Ui=new Set,Ds=new Set,Ar=new Set,Hl=new Set;var Qu=new Set;Sa=function(i,s){if(!(i===null||typeof i=="function")){var u=s+"_"+i;Qu.has(u)||(Qu.add(u),c("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",s,i))}},Yo=function(i,s){if(s===void 0){var u=Mn(i)||"Component";Ui.has(u)||(Ui.add(u),c("%s.getDerivedStateFromProps(): A valid state object (or null) must be returned. You have returned undefined.",u))}},Object.defineProperty(li,"_processChildContext",{enumerable:!1,value:function(){throw new Error("_processChildContext is not available in React 16+. This likely means you have multiple copies of React and are attempting to nest a React 15 tree inside a React 16 tree using unstable_renderSubtreeIntoContainer, which isn't supported. Try to make sure you have only one copy of React (and ideally, switch to ReactDOM.createPortal).")}}),Object.freeze(li)}function Js(i,s,u,h){var p=i.memoizedState,B=u(h,p);{if(i.mode&ca){wi(!0);try{B=u(h,p)}finally{wi(!1)}}Yo(s,B)}var x=B==null?p:Mt({},p,B);if(i.memoizedState=x,i.lanes===It){var Y=i.updateQueue;Y.baseState=x}}var Gg={isMounted:ow,enqueueSetState:function(i,s,u){var h=_a(i),p=Fo(),B=Ed(h),x=Vl(p,B);x.payload=s,u!=null&&(Sa(u,"setState"),x.callback=u);var Y=yg(h,x,B);Y!==null&&(hs(Y,h,B,p),_p(Y,h,B)),Ob(h,B)},enqueueReplaceState:function(i,s,u){var h=_a(i),p=Fo(),B=Ed(h),x=Vl(p,B);x.tag=rZ,x.payload=s,u!=null&&(Sa(u,"replaceState"),x.callback=u);var Y=yg(h,x,B);Y!==null&&(hs(Y,h,B,p),_p(Y,h,B)),Ob(h,B)},enqueueForceUpdate:function(i,s){var u=_a(i),h=Fo(),p=Ed(u),B=Vl(h,p);B.tag=ku,s!=null&&(Sa(s,"forceUpdate"),B.callback=s);var x=yg(u,B,p);x!==null&&(hs(x,u,p,h),_p(x,u,p)),Bw(u,p)}};function um(i,s,u,h,p,B,x){var Y=i.stateNode;if(typeof Y.shouldComponentUpdate=="function"){var z=Y.shouldComponentUpdate(h,B,x);{if(i.mode&ca){wi(!0);try{z=Y.shouldComponentUpdate(h,B,x)}finally{wi(!1)}}z===void 0&&c("%s.shouldComponentUpdate(): Returned undefined instead of a boolean value. Make sure to return true or false.",Mn(s)||"Component")}return z}return s.prototype&&s.prototype.isPureReactComponent?!td(u,h)||!td(p,B):!0}function ZZ(i,s,u){var h=i.stateNode;{var p=Mn(s)||"Component",B=h.render;B||(s.prototype&&typeof s.prototype.render=="function"?c("%s(...): No `render` method found on the returned component instance: did you accidentally return an object from the constructor?",p):c("%s(...): No `render` method found on the returned component instance: you may have forgotten to define `render`.",p)),h.getInitialState&&!h.getInitialState.isReactClassApproved&&!h.state&&c("getInitialState was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?",p),h.getDefaultProps&&!h.getDefaultProps.isReactClassApproved&&c("getDefaultProps was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.",p),h.propTypes&&c("propTypes was defined as an instance property on %s. Use a static property to define propTypes instead.",p),h.contextType&&c("contextType was defined as an instance property on %s. Use a static property to define contextType instead.",p),s.childContextTypes&&!Hl.has(s)&&(i.mode&ca)===pn&&(Hl.add(s),c(`%s uses the legacy childContextTypes API which is no longer supported and will be removed in the next major release. Use React.createContext() instead

.Learn more about this warning here: https://reactjs.org/link/legacy-context`,p)),s.contextTypes&&!Hl.has(s)&&(i.mode&ca)===pn&&(Hl.add(s),c(`%s uses the legacy contextTypes API which is no longer supported and will be removed in the next major release. Use React.createContext() with static contextType instead.

Learn more about this warning here: https://reactjs.org/link/legacy-context`,p)),h.contextTypes&&c("contextTypes was defined as an instance property on %s. Use a static property to define contextTypes instead.",p),s.contextType&&s.contextTypes&&!Ds.has(s)&&(Ds.add(s),c("%s declares both contextTypes and contextType static properties. The legacy contextTypes property will be ignored.",p)),typeof h.componentShouldUpdate=="function"&&c("%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",p),s.prototype&&s.prototype.isPureReactComponent&&typeof h.shouldComponentUpdate<"u"&&c("%s has a method called shouldComponentUpdate(). shouldComponentUpdate should not be used when extending React.PureComponent. Please extend React.Component if shouldComponentUpdate is used.",Mn(s)||"A pure component"),typeof h.componentDidUnmount=="function"&&c("%s has a method called componentDidUnmount(). But there is no such lifecycle method. Did you mean componentWillUnmount()?",p),typeof h.componentDidReceiveProps=="function"&&c("%s has a method called componentDidReceiveProps(). But there is no such lifecycle method. If you meant to update the state in response to changing props, use componentWillReceiveProps(). If you meant to fetch data or run side-effects or mutations after React has updated the UI, use componentDidUpdate().",p),typeof h.componentWillRecieveProps=="function"&&c("%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",p),typeof h.UNSAFE_componentWillRecieveProps=="function"&&c("%s has a method called UNSAFE_componentWillRecieveProps(). Did you mean UNSAFE_componentWillReceiveProps()?",p);var x=h.props!==u;h.props!==void 0&&x&&c("%s(...): When calling super() in `%s`, make sure to pass up the same props that your component's constructor was passed.",p,p),h.defaultProps&&c("Setting defaultProps as an instance property on %s is not supported and will be ignored. Instead, define defaultProps as a static property on %s.",p,p),typeof h.getSnapshotBeforeUpdate=="function"&&typeof h.componentDidUpdate!="function"&&!Tn.has(s)&&(Tn.add(s),c("%s: getSnapshotBeforeUpdate() should be used with componentDidUpdate(). This component defines getSnapshotBeforeUpdate() only.",Mn(s))),typeof h.getDerivedStateFromProps=="function"&&c("%s: getDerivedStateFromProps() is defined as an instance method and will be ignored. Instead, declare it as a static method.",p),typeof h.getDerivedStateFromError=="function"&&c("%s: getDerivedStateFromError() is defined as an instance method and will be ignored. Instead, declare it as a static method.",p),typeof s.getSnapshotBeforeUpdate=="function"&&c("%s: getSnapshotBeforeUpdate() is defined as a static method and will be ignored. Instead, declare it as an instance method.",p);var Y=h.state;Y&&(typeof Y!="object"||Ln(Y))&&c("%s.state: must be set to an object or null",p),typeof h.getChildContext=="function"&&typeof s.childContextTypes!="object"&&c("%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",p)}}function SZ(i,s){s.updater=Gg,i.stateNode=s,Fi(s,i),s._reactInternalInstance=li}function RZ(i,s,u){var h=!1,p=Io,B=Io,x=s.contextType;if("contextType"in s){var Y=x===null||x!==void 0&&x.$$typeof===Q&&x._context===void 0;if(!Y&&!Ar.has(s)){Ar.add(s);var z="";x===void 0?z=" However, it is set to undefined. This can be caused by a typo or by mixing up named and default imports. This can also happen due to a circular dependency, so try moving the createContext() call to a separate file.":typeof x!="object"?z=" However, it is set to a "+typeof x+".":x.$$typeof===ot?z=" Did you accidentally pass the Context.Provider instead?":x._context!==void 0?z=" Did you accidentally pass the Context.Consumer instead?":z=" However, it is set to an object with keys {"+Object.keys(x).join(", ")+"}.",c("%s defines an invalid contextType. contextType should point to the Context object returned by React.createContext().%s",Mn(s)||"Component",z)}}if(typeof x=="object"&&x!==null)B=oi(x);else{p=Ru(i,s,!0);var J=s.contextTypes;h=J!=null,B=h?vc(i,p):Io}var j=new s(u,B);if(i.mode&ca){wi(!0);try{j=new s(u,B)}finally{wi(!1)}}var pe=i.memoizedState=j.state!==null&&j.state!==void 0?j.state:null;SZ(i,j);{if(typeof s.getDerivedStateFromProps=="function"&&pe===null){var fe=Mn(s)||"Component";ti.has(fe)||(ti.add(fe),c("`%s` uses `getDerivedStateFromProps` but its initial state is %s. This is not recommended. Instead, define the initial state by assigning an object to `this.state` in the constructor of `%s`. This ensures that `getDerivedStateFromProps` arguments have a consistent shape.",fe,j.state===null?"null":"undefined",fe))}if(typeof s.getDerivedStateFromProps=="function"||typeof j.getSnapshotBeforeUpdate=="function"){var He=null,ze=null,je=null;if(typeof j.componentWillMount=="function"&&j.componentWillMount.__suppressDeprecationWarning!==!0?He="componentWillMount":typeof j.UNSAFE_componentWillMount=="function"&&(He="UNSAFE_componentWillMount"),typeof j.componentWillReceiveProps=="function"&&j.componentWillReceiveProps.__suppressDeprecationWarning!==!0?ze="componentWillReceiveProps":typeof j.UNSAFE_componentWillReceiveProps=="function"&&(ze="UNSAFE_componentWillReceiveProps"),typeof j.componentWillUpdate=="function"&&j.componentWillUpdate.__suppressDeprecationWarning!==!0?je="componentWillUpdate":typeof j.UNSAFE_componentWillUpdate=="function"&&(je="UNSAFE_componentWillUpdate"),He!==null||ze!==null||je!==null){var Jt=Mn(s)||"Component",bn=typeof s.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";ra.has(Jt)||(ra.add(Jt),c(`Unsafe legacy lifecycles will not be called for components using new component APIs.

%s uses %s but also contains the following legacy lifecycles:%s%s%s

The above lifecycles should be removed. Learn more about this warning here:
https://reactjs.org/link/unsafe-component-lifecycles`,Jt,bn,He!==null?`
  `+He:"",ze!==null?`
  `+ze:"",je!==null?`
  `+je:""))}}}return h&&JB(i,p,B),j}function NT(i,s){var u=s.state;typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),u!==s.state&&(c("%s.componentWillMount(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",Xn(i)||"Component"),Gg.enqueueReplaceState(s,s.state,null))}function O2(i,s,u,h){var p=s.state;if(typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(u,h),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(u,h),s.state!==p){{var B=Xn(i)||"Component";ki.has(B)||(ki.add(B),c("%s.componentWillReceiveProps(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",B))}Gg.enqueueReplaceState(s,s.state,null)}}function HW(i,s,u,h){ZZ(i,s,u);var p=i.stateNode;p.props=u,p.state=i.memoizedState,p.refs={},vg(i);var B=s.contextType;if(typeof B=="object"&&B!==null)p.context=oi(B);else{var x=Ru(i,s,!0);p.context=vc(i,x)}{if(p.state===u){var Y=Mn(s)||"Component";Us.has(Y)||(Us.add(Y),c("%s: It is not recommended to assign props directly to state because updates to props won't be reflected in state. In most cases, it is better to use props directly.",Y))}i.mode&ca&&ur.recordLegacyContextWarning(i,p),ur.recordUnsafeLifecycleWarnings(i,p)}p.state=i.memoizedState;var z=s.getDerivedStateFromProps;if(typeof z=="function"&&(Js(i,s,z,u),p.state=i.memoizedState),typeof s.getDerivedStateFromProps!="function"&&typeof p.getSnapshotBeforeUpdate!="function"&&(typeof p.UNSAFE_componentWillMount=="function"||typeof p.componentWillMount=="function")&&(NT(i,p),Rd(i,u,p,h),p.state=i.memoizedState),typeof p.componentDidMount=="function"){var J=ei;J|=ag,(i.mode&dl)!==pn&&(J|=Wo),i.flags|=J}}function XT(i,s,u,h){var p=i.stateNode,B=i.memoizedProps;p.props=B;var x=p.context,Y=s.contextType,z=Io;if(typeof Y=="object"&&Y!==null)z=oi(Y);else{var J=Ru(i,s,!0);z=vc(i,J)}var j=s.getDerivedStateFromProps,pe=typeof j=="function"||typeof p.getSnapshotBeforeUpdate=="function";!pe&&(typeof p.UNSAFE_componentWillReceiveProps=="function"||typeof p.componentWillReceiveProps=="function")&&(B!==u||x!==z)&&O2(i,p,u,z),lZ();var fe=i.memoizedState,He=p.state=fe;if(Rd(i,u,p,h),He=i.memoizedState,B===u&&fe===He&&!Zh()&&!Uu()){if(typeof p.componentDidMount=="function"){var ze=ei;ze|=ag,(i.mode&dl)!==pn&&(ze|=Wo),i.flags|=ze}return!1}typeof j=="function"&&(Js(i,s,j,u),He=i.memoizedState);var je=Uu()||um(i,s,B,u,fe,He,z);if(je){if(!pe&&(typeof p.UNSAFE_componentWillMount=="function"||typeof p.componentWillMount=="function")&&(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"){var Jt=ei;Jt|=ag,(i.mode&dl)!==pn&&(Jt|=Wo),i.flags|=Jt}}else{if(typeof p.componentDidMount=="function"){var bn=ei;bn|=ag,(i.mode&dl)!==pn&&(bn|=Wo),i.flags|=bn}i.memoizedProps=u,i.memoizedState=He}return p.props=u,p.state=He,p.context=z,je}function YT(i,s,u,h,p){var B=s.stateNode;by(i,s);var x=s.memoizedProps,Y=s.type===s.elementType?x:qn(s.type,x);B.props=Y;var z=s.pendingProps,J=B.context,j=u.contextType,pe=Io;if(typeof j=="object"&&j!==null)pe=oi(j);else{var fe=Ru(s,u,!0);pe=vc(s,fe)}var He=u.getDerivedStateFromProps,ze=typeof He=="function"||typeof B.getSnapshotBeforeUpdate=="function";!ze&&(typeof B.UNSAFE_componentWillReceiveProps=="function"||typeof B.componentWillReceiveProps=="function")&&(x!==z||J!==pe)&&O2(s,B,h,pe),lZ();var je=s.memoizedState,Jt=B.state=je;if(Rd(s,h,B,p),Jt=s.memoizedState,x===z&&je===Jt&&!Zh()&&!Uu()&&!we)return typeof B.componentDidUpdate=="function"&&(x!==i.memoizedProps||je!==i.memoizedState)&&(s.flags|=ei),typeof B.getSnapshotBeforeUpdate=="function"&&(x!==i.memoizedProps||je!==i.memoizedState)&&(s.flags|=Qg),!1;typeof He=="function"&&(Js(s,u,He,h),Jt=s.memoizedState);var bn=Uu()||um(s,u,Y,h,je,Jt,pe)||we;return bn?(!ze&&(typeof B.UNSAFE_componentWillUpdate=="function"||typeof B.componentWillUpdate=="function")&&(typeof B.componentWillUpdate=="function"&&B.componentWillUpdate(h,Jt,pe),typeof B.UNSAFE_componentWillUpdate=="function"&&B.UNSAFE_componentWillUpdate(h,Jt,pe)),typeof B.componentDidUpdate=="function"&&(s.flags|=ei),typeof B.getSnapshotBeforeUpdate=="function"&&(s.flags|=Qg)):(typeof B.componentDidUpdate=="function"&&(x!==i.memoizedProps||je!==i.memoizedState)&&(s.flags|=ei),typeof B.getSnapshotBeforeUpdate=="function"&&(x!==i.memoizedProps||je!==i.memoizedState)&&(s.flags|=Qg),s.memoizedProps=h,s.memoizedState=Jt),B.props=h,B.state=Jt,B.context=pe,bn}function Qh(i,s){return{value:i,source:s,stack:Dc(s),digest:null}}function FW(i,s,u){return{value:i,source:null,stack:u??null,digest:s??null}}function MT(i,s){return!0}function KW(i,s){try{var u=MT(i,s);if(u===!1)return;var h=s.value,p=s.source,B=s.stack,x=B!==null?B:"";if(h!=null&&h._suppressLogging){if(i.tag===d)return;console.error(h)}var Y=p?Xn(p):null,z=Y?"The above error occurred in the <"+Y+"> component:":"The above error occurred in one of your React components:",J;if(i.tag===b)J=`Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.`;else{var j=Xn(i)||"Anonymous";J="React will try to recreate this component tree from scratch "+("using the error boundary you provided, "+j+".")}var pe=z+`
`+x+`

`+(""+J);console.error(pe)}catch(fe){setTimeout(function(){throw fe})}}var HT=typeof WeakMap=="function"?WeakMap:Map;function P2(i,s,u){var h=Vl(Bi,u);h.tag=my,h.payload={element:null};var p=s.value;return h.callback=function(){wL(p),KW(i,s)},h}function EW(i,s,u){var h=Vl(Bi,u);h.tag=my;var p=i.type.getDerivedStateFromError;if(typeof p=="function"){var B=s.value;h.payload=function(){return p(B)},h.callback=function(){oY(i),KW(i,s)}}var x=i.stateNode;return x!==null&&typeof x.componentDidCatch=="function"&&(h.callback=function(){oY(i),KW(i,s),typeof p!="function"&&SL(this);var z=s.value,J=s.stack;this.componentDidCatch(z,{componentStack:J!==null?J:""}),typeof p!="function"&&(Hs(i.lanes,wn)||c("%s: Error boundaries should implement getDerivedStateFromError(). In that method, return a state update to display an error message or fallback UI.",Xn(i)||"Unknown"))}),h}function Q2(i,s,u){var h=i.pingCache,p;if(h===null?(h=i.pingCache=new HT,p=new Set,h.set(s,p)):(p=h.get(s),p===void 0&&(p=new Set,h.set(s,p))),!p.has(u)){p.add(u);var B=WL.bind(null,i,s,u);Lr&&a0(i,u),s.then(B,B)}}function FT(i,s,u,h){var p=i.updateQueue;if(p===null){var B=new Set;B.add(u),i.updateQueue=B}else p.add(u)}function KT(i,s){var u=i.tag;if((i.mode&jn)===pn&&(u===C||u===w||u===_)){var h=i.alternate;h?(i.updateQueue=h.updateQueue,i.memoizedState=h.memoizedState,i.lanes=h.lanes):(i.updateQueue=null,i.memoizedState=null)}}function j2(i){var s=i;do{if(s.tag===H&&IZ(s))return s;s=s.return}while(s!==null);return null}function q2(i,s,u,h,p){if((i.mode&jn)===pn){if(i===s)i.flags|=Ys;else{if(i.flags|=ai,u.flags|=ng,u.flags&=-52805,u.tag===d){var B=u.alternate;if(B===null)u.tag=K;else{var x=Vl(Bi,wn);x.tag=ku,yg(u,x,wn)}}u.lanes=Fn(u.lanes,wn)}return i}return i.flags|=Ys,i.lanes=p,i}function ET(i,s,u,h,p){if(u.flags|=lf,Lr&&a0(i,p),h!==null&&typeof h=="object"&&typeof h.then=="function"){var B=h;KT(u),_i()&&u.mode&jn&&Yp();var x=j2(s);if(x!==null){x.flags&=~Fr,q2(x,s,u,i,p),x.mode&jn&&Q2(i,B,p),FT(x,i,B);return}else{if(!tv(p)){Q2(i,B,p),px();return}var Y=new Error("A component suspended while responding to synchronous input. This will cause the UI to be replaced with a loading indicator. To fix, updates that suspend should be wrapped with startTransition.");h=Y}}else if(_i()&&u.mode&jn){Yp();var z=j2(s);if(z!==null){(z.flags&Ys)===fn&&(z.flags|=Fr),q2(z,s,u,i,p),Yu(Qh(h,u));return}}h=Qh(h,u),pL(h);var J=s;do{switch(J.tag){case b:{var j=h;J.flags|=Ys;var pe=ic(p);J.lanes=Fn(J.lanes,pe);var fe=P2(J,j,pe);Sd(J,fe);return}case d:var He=h,ze=J.type,je=J.stateNode;if((J.flags&ai)===fn&&(typeof ze.getDerivedStateFromError=="function"||je!==null&&typeof je.componentDidCatch=="function"&&!jX(je))){J.flags|=Ys;var Jt=ic(p);J.lanes=Fn(J.lanes,Jt);var bn=EW(J,He,Jt);Sd(J,bn);return}break}J=J.return}while(J!==null)}function TT(){return null}var Ly=t.ReactCurrentOwner,Bg=!1,TW,_y,zW,LW,_W,jh,kW,wZ,ky;TW={},_y={},zW={},LW={},_W={},jh=!1,kW={},wZ={},ky={};function Mo(i,s,u,h){i===null?s.child=xl(s,null,u,h):s.child=Ir(s,i.child,u,h)}function zT(i,s,u,h){s.child=Ir(s,i.child,null,h),s.child=Ir(s,null,u,h)}function $2(i,s,u,h,p){if(s.type!==s.elementType){var B=u.propTypes;B&&ar(B,h,"prop",Mn(u))}var x=u.render,Y=s.ref,z,J;_u(s,p),VC(s);{if(Ly.current=s,Qo(!0),z=Xd(i,s,x,h,Y,p),J=qa(),s.mode&ca){wi(!0);try{z=Xd(i,s,x,h,Y,p),J=qa()}finally{wi(!1)}}Qo(!1)}return ia(),i!==null&&!Bg?(Op(i,s,p),ju(i,s,p)):(_i()&&J&&fd(s),s.flags|=$l,Mo(i,s,z,p),s.child)}function eX(i,s,u,h,p){if(i===null){var B=u.type;if(DL(B)&&u.compare===null&&u.defaultProps===void 0){var x=B;return x=mm(B),s.tag=_,s.type=x,JW(s,B),tX(i,s,x,h,p)}{var Y=B.propTypes;if(Y&&ar(Y,h,"prop",Mn(B)),u.defaultProps!==void 0){var z=Mn(B)||"Unknown";ky[z]||(c("%s: Support for defaultProps will be removed from memo components in a future major release. Use JavaScript default parameters instead.",z),ky[z]=!0)}}var J=Wx(u.type,null,h,s,s.mode,p);return J.ref=s.ref,J.return=s,s.child=J,J}{var j=u.type,pe=j.propTypes;pe&&ar(pe,h,"prop",Mn(j))}var fe=i.child,He=$W(i,p);if(!He){var ze=fe.memoizedProps,je=u.compare;if(je=je!==null?je:td,je(ze,h)&&i.ref===s.ref)return ju(i,s,p)}s.flags|=$l;var Jt=nA(fe,h);return Jt.ref=s.ref,Jt.return=s,s.child=Jt,Jt}function tX(i,s,u,h,p){if(s.type!==s.elementType){var B=s.elementType;if(B.$$typeof===xt){var x=B,Y=x._payload,z=x._init;try{B=z(Y)}catch{B=null}var J=B&&B.propTypes;J&&ar(J,h,"prop",Mn(B))}}if(i!==null){var j=i.memoizedProps;if(td(j,h)&&i.ref===s.ref&&s.type===i.type)if(Bg=!1,s.pendingProps=h=j,$W(i,p))(i.flags&ng)!==fn&&(Bg=!0);else return s.lanes=i.lanes,ju(i,s,p)}return UW(i,s,u,h,p)}function nX(i,s,u){var h=s.pendingProps,p=h.children,B=i!==null?i.memoizedState:null;if(h.mode==="hidden"||me)if((s.mode&jn)===pn){var x={baseLanes:It,cachePool:null,transitions:null};s.memoizedState=x,zZ(s,u)}else if(Hs(u,Vo)){var pe={baseLanes:It,cachePool:null,transitions:null};s.memoizedState=pe;var fe=B!==null?B.baseLanes:u;zZ(s,fe)}else{var Y=null,z;if(B!==null){var J=B.baseLanes;z=Fn(J,u)}else z=u;s.lanes=s.childLanes=Vo;var j={baseLanes:z,cachePool:Y,transitions:null};return s.memoizedState=j,s.updateQueue=null,zZ(s,z),null}else{var He;B!==null?(He=Fn(B.baseLanes,u),s.memoizedState=null):He=u,zZ(s,He)}return Mo(i,s,p,u),s.child}function LT(i,s,u){var h=s.pendingProps;return Mo(i,s,h,u),s.child}function _T(i,s,u){var h=s.pendingProps.children;return Mo(i,s,h,u),s.child}function kT(i,s,u){{s.flags|=ei;{var h=s.stateNode;h.effectDuration=0,h.passiveEffectDuration=0}}var p=s.pendingProps,B=p.children;return Mo(i,s,B,u),s.child}function iX(i,s){var u=s.ref;(i===null&&u!==null||i!==null&&i.ref!==u)&&(s.flags|=tu,s.flags|=ig)}function UW(i,s,u,h,p){if(s.type!==s.elementType){var B=u.propTypes;B&&ar(B,h,"prop",Mn(u))}var x;{var Y=Ru(s,u,!0);x=vc(s,Y)}var z,J;_u(s,p),VC(s);{if(Ly.current=s,Qo(!0),z=Xd(i,s,u,h,x,p),J=qa(),s.mode&ca){wi(!0);try{z=Xd(i,s,u,h,x,p),J=qa()}finally{wi(!1)}}Qo(!1)}return ia(),i!==null&&!Bg?(Op(i,s,p),ju(i,s,p)):(_i()&&J&&fd(s),s.flags|=$l,Mo(i,s,z,p),s.child)}function aX(i,s,u,h,p){{switch(r9(s)){case!1:{var B=s.stateNode,x=s.type,Y=new x(s.memoizedProps,B.context),z=Y.state;B.updater.enqueueSetState(B,z,null);break}case!0:{s.flags|=ai,s.flags|=Ys;var J=new Error("Simulated error coming from DevTools"),j=ic(p);s.lanes=Fn(s.lanes,j);var pe=EW(s,Qh(J,s),j);Sd(s,pe);break}}if(s.type!==s.elementType){var fe=u.propTypes;fe&&ar(fe,h,"prop",Mn(u))}}var He;Sl(u)?(He=!0,wp(s)):He=!1,_u(s,p);var ze=s.stateNode,je;ze===null?(xZ(i,s),RZ(s,u,h),HW(s,u,h,p),je=!0):i===null?je=XT(s,u,h,p):je=YT(i,s,u,h,p);var Jt=DW(i,s,u,je,He,p);{var bn=s.stateNode;je&&bn.props!==h&&(jh||c("It looks like %s is reassigning its own `this.props` while rendering. This is not supported and can lead to confusing bugs.",Xn(s)||"a component"),jh=!0)}return Jt}function DW(i,s,u,h,p,B){iX(i,s);var x=(s.flags&ai)!==fn;if(!h&&!x)return p&&QB(s,u,!1),ju(i,s,B);var Y=s.stateNode;Ly.current=s;var z;if(x&&typeof u.getDerivedStateFromError!="function")z=null,tt();else{VC(s);{if(Qo(!0),z=Y.render(),s.mode&ca){wi(!0);try{Y.render()}finally{wi(!1)}}Qo(!1)}ia()}return s.flags|=$l,i!==null&&x?zT(i,s,z,B):Mo(i,s,z,B),s.memoizedState=Y.state,p&&QB(s,u,!0),s.child}function sX(i){var s=i.stateNode;s.pendingContext?OB(i,s.pendingContext,s.pendingContext!==s.context):s.context&&OB(i,s.context,!1),dr(i,s.containerInfo)}function UT(i,s,u){if(sX(s),i===null)throw new Error("Should have a current fiber. This is a bug in React.");var h=s.pendingProps,p=s.memoizedState,B=p.element;by(i,s),Rd(s,h,null,u);var x=s.memoizedState;s.stateNode;var Y=x.element;if(p.isDehydrated){var z={element:Y,isDehydrated:!1,cache:x.cache,pendingSuspenseBoundaries:x.pendingSuspenseBoundaries,transitions:x.transitions},J=s.updateQueue;if(J.baseState=z,s.memoizedState=z,s.flags&Fr){var j=Qh(new Error("There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering."),s);return oX(i,s,Y,u,j)}else if(Y!==B){var pe=Qh(new Error("This root received an early update, before anything was able hydrate. Switched the entire root to client rendering."),s);return oX(i,s,Y,u,pe)}else{BW(s);var fe=xl(s,null,Y,u);s.child=fe;for(var He=fe;He;)He.flags=He.flags&~ji|tg,He=He.sibling}}else{if(Ca(),Y===B)return ju(i,s,u);Mo(i,s,Y,u)}return s.child}function oX(i,s,u,h,p){return Ca(),Yu(p),s.flags|=Fr,Mo(i,s,u,h),s.child}function DT(i,s,u){yy(s),i===null&&uy(s);var h=s.type,p=s.pendingProps,B=i!==null?i.memoizedProps:null,x=p.children,Y=Dv(h,p);return Y?x=null:B!==null&&Dv(h,B)&&(s.flags|=RC),iX(i,s),Mo(i,s,x,u),s.child}function JT(i,s){return i===null&&uy(s),null}function OT(i,s,u,h){xZ(i,s);var p=s.pendingProps,B=u,x=B._payload,Y=B._init,z=Y(x);s.type=z;var J=s.tag=JL(z),j=qn(z,p),pe;switch(J){case C:return JW(s,z),s.type=z=mm(z),pe=UW(null,s,z,j,h),pe;case d:return s.type=z=Gx(z),pe=aX(null,s,z,j,h),pe;case w:return s.type=z=Bx(z),pe=$2(null,s,z,j,h),pe;case F:{if(s.type!==s.elementType){var fe=z.propTypes;fe&&ar(fe,j,"prop",Mn(z))}return pe=eX(null,s,z,qn(z.type,j),h),pe}}var He="";throw z!==null&&typeof z=="object"&&z.$$typeof===xt&&(He=" Did you wrap a component in React.lazy() more than once?"),new Error("Element type is invalid. Received a promise that resolves to: "+z+". "+("Lazy element type must resolve to a class or function."+He))}function PT(i,s,u,h,p){xZ(i,s),s.tag=d;var B;return Sl(u)?(B=!0,wp(s)):B=!1,_u(s,p),RZ(s,u,h),HW(s,u,h,p),DW(null,s,u,!0,B,p)}function QT(i,s,u,h){xZ(i,s);var p=s.pendingProps,B;{var x=Ru(s,u,!1);B=vc(s,x)}_u(s,h);var Y,z;VC(s);{if(u.prototype&&typeof u.prototype.render=="function"){var J=Mn(u)||"Unknown";TW[J]||(c("The <%s /> component appears to have a render method, but doesn't extend React.Component. This is likely to cause errors. Change %s to extend React.Component instead.",J,J),TW[J]=!0)}s.mode&ca&&ur.recordLegacyContextWarning(s,null),Qo(!0),Ly.current=s,Y=Xd(null,s,u,p,B,h),z=qa(),Qo(!1)}if(ia(),s.flags|=$l,typeof Y=="object"&&Y!==null&&typeof Y.render=="function"&&Y.$$typeof===void 0){var j=Mn(u)||"Unknown";_y[j]||(c("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",j,j,j),_y[j]=!0)}if(typeof Y=="object"&&Y!==null&&typeof Y.render=="function"&&Y.$$typeof===void 0){{var pe=Mn(u)||"Unknown";_y[pe]||(c("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",pe,pe,pe),_y[pe]=!0)}s.tag=d,s.memoizedState=null,s.updateQueue=null;var fe=!1;return Sl(u)?(fe=!0,wp(s)):fe=!1,s.memoizedState=Y.state!==null&&Y.state!==void 0?Y.state:null,vg(s),SZ(s,Y),HW(s,u,p,h),DW(null,s,u,!0,fe,h)}else{if(s.tag=C,s.mode&ca){wi(!0);try{Y=Xd(null,s,u,p,B,h),z=qa()}finally{wi(!1)}}return _i()&&z&&fd(s),Mo(null,s,Y,h),JW(s,u),s.child}}function JW(i,s){{if(s&&s.childContextTypes&&c("%s(...): childContextTypes cannot be defined on a function component.",s.displayName||s.name||"Component"),i.ref!==null){var u="",h=So();h&&(u+=`

Check the render method of \``+h+"`.");var p=h||"",B=i._debugSource;B&&(p=B.fileName+":"+B.lineNumber),_W[p]||(_W[p]=!0,c("Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s",u))}if(s.defaultProps!==void 0){var x=Mn(s)||"Unknown";ky[x]||(c("%s: Support for defaultProps will be removed from function components in a future major release. Use JavaScript default parameters instead.",x),ky[x]=!0)}if(typeof s.getDerivedStateFromProps=="function"){var Y=Mn(s)||"Unknown";LW[Y]||(c("%s: Function components do not support getDerivedStateFromProps.",Y),LW[Y]=!0)}if(typeof s.contextType=="object"&&s.contextType!==null){var z=Mn(s)||"Unknown";zW[z]||(c("%s: Function components do not support contextType.",z),zW[z]=!0)}}}var OW={dehydrated:null,treeContext:null,retryLane:xa};function PW(i){return{baseLanes:i,cachePool:TT(),transitions:null}}function jT(i,s){var u=null;return{baseLanes:Fn(i.baseLanes,s),cachePool:u,transitions:i.transitions}}function qT(i,s,u,h){if(s!==null){var p=s.memoizedState;if(p===null)return!1}return kp(i,Aa)}function $T(i,s){return HC(i.childLanes,s)}function rX(i,s,u){var h=s.pendingProps;l9(s)&&(s.flags|=ai);var p=jr.current,B=!1,x=(s.flags&ai)!==fn;if(x||qT(p,i)?(B=!0,s.flags&=~ai):(i===null||i.memoizedState!==null)&&(p=XW(p,By)),p=xd(p),Rc(s,p),i===null){uy(s);var Y=s.memoizedState;if(Y!==null){var z=Y.dehydrated;if(z!==null)return az(s,z)}var J=h.children,j=h.fallback;if(B){var pe=ez(s,J,j,u),fe=s.child;return fe.memoizedState=PW(u),s.memoizedState=OW,pe}else return QW(s,J)}else{var He=i.memoizedState;if(He!==null){var ze=He.dehydrated;if(ze!==null)return sz(i,s,x,h,ze,He,u)}if(B){var je=h.fallback,Jt=h.children,bn=nz(i,s,Jt,je,u),gn=s.child,ii=i.child.memoizedState;return gn.memoizedState=ii===null?PW(u):jT(ii,u),gn.childLanes=$T(i,u),s.memoizedState=OW,bn}else{var $n=h.children,We=tz(i,s,$n,u);return s.memoizedState=null,We}}}function QW(i,s,u){var h=i.mode,p={mode:"visible",children:s},B=jW(p,h);return B.return=i,i.child=B,B}function ez(i,s,u,h){var p=i.mode,B=i.child,x={mode:"hidden",children:s},Y,z;return(p&jn)===pn&&B!==null?(Y=B,Y.childLanes=It,Y.pendingProps=x,i.mode&pi&&(Y.actualDuration=0,Y.actualStartTime=-1,Y.selfBaseDuration=0,Y.treeBaseDuration=0),z=zd(u,p,h,null)):(Y=jW(x,p),z=zd(u,p,h,null)),Y.return=i,z.return=i,Y.sibling=z,i.child=Y,z}function jW(i,s,u){return lY(i,s,It,null)}function lX(i,s){return nA(i,s)}function tz(i,s,u,h){var p=i.child,B=p.sibling,x=lX(p,{mode:"visible",children:u});if((s.mode&jn)===pn&&(x.lanes=h),x.return=s,x.sibling=null,B!==null){var Y=s.deletions;Y===null?(s.deletions=[B],s.flags|=eu):Y.push(B)}return s.child=x,x}function nz(i,s,u,h,p){var B=s.mode,x=i.child,Y=x.sibling,z={mode:"hidden",children:u},J;if((B&jn)===pn&&s.child!==x){var j=s.child;J=j,J.childLanes=It,J.pendingProps=z,s.mode&pi&&(J.actualDuration=0,J.actualStartTime=-1,J.selfBaseDuration=x.selfBaseDuration,J.treeBaseDuration=x.treeBaseDuration),s.deletions=null}else J=lX(x,z),J.subtreeFlags=x.subtreeFlags&Kr;var pe;return Y!==null?pe=nA(Y,h):(pe=zd(h,B,p,null),pe.flags|=ji),pe.return=s,J.return=s,J.sibling=pe,s.child=J,pe}function WZ(i,s,u,h){h!==null&&Yu(h),Ir(s,i.child,null,u);var p=s.pendingProps,B=p.children,x=QW(s,B);return x.flags|=ji,s.memoizedState=null,x}function iz(i,s,u,h,p){var B=s.mode,x={mode:"visible",children:u},Y=jW(x,B),z=zd(h,B,p,null);return z.flags|=ji,Y.return=s,z.return=s,Y.sibling=z,s.child=Y,(s.mode&jn)!==pn&&Ir(s,i.child,null,p),z}function az(i,s,u){return(i.mode&jn)===pn?(c("Cannot hydrate Suspense in legacy mode. Switch from ReactDOM.hydrate(element, container) to ReactDOMClient.hydrateRoot(container, <App />).render(element) or remove the Suspense components from the server rendered components."),i.lanes=wn):hp(s)?i.lanes=qg:i.lanes=Vo,null}function sz(i,s,u,h,p,B,x){if(u)if(s.flags&Fr){s.flags&=~Fr;var We=FW(new Error("There was an error while hydrating this Suspense boundary. Switched to client rendering."));return WZ(i,s,x,We)}else{if(s.memoizedState!==null)return s.child=i.child,s.flags|=ai,null;var qe=h.children,xe=h.fallback,St=iz(i,s,qe,xe,x),en=s.child;return en.memoizedState=PW(x),s.memoizedState=OW,St}else{if(ry(),(s.mode&jn)===pn)return WZ(i,s,x,null);if(hp(p)){var Y,z,J;{var j=uW(p);Y=j.digest,z=j.message,J=j.stack}var pe;z?pe=new Error(z):pe=new Error("The server could not finish this Suspense boundary, likely due to an error during server rendering. Switched to client rendering.");var fe=FW(pe,Y,J);return WZ(i,s,x,fe)}var He=Hs(x,i.childLanes);if(Bg||He){var ze=TZ();if(ze!==null){var je=DG(ze,x);if(je!==xa&&je!==B.retryLane){B.retryLane=je;var Jt=Bi;ks(i,je),hs(ze,i,je,Jt)}}px();var bn=FW(new Error("This Suspense boundary received an update before it finished hydrating. This caused the boundary to switch to client rendering. The usual way to fix this is to wrap the original update in startTransition."));return WZ(i,s,x,bn)}else if(HB(p)){s.flags|=ai,s.child=i.child;var gn=xL.bind(null,i);return FB(p,gn),null}else{Mp(s,p,B.treeContext);var ii=h.children,$n=QW(s,ii);return $n.flags|=tg,$n}}}function gX(i,s,u){i.lanes=Fn(i.lanes,s);var h=i.alternate;h!==null&&(h.lanes=Fn(h.lanes,s)),ha(i.return,s,u)}function oz(i,s,u){for(var h=s;h!==null;){if(h.tag===H){var p=h.memoizedState;p!==null&&gX(h,u,i)}else if(h.tag===ee)gX(h,u,i);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===i)return;for(;h.sibling===null;){if(h.return===null||h.return===i)return;h=h.return}h.sibling.return=h.return,h=h.sibling}}function rz(i){for(var s=i,u=null;s!==null;){var h=s.alternate;h!==null&&Du(h)===null&&(u=s),s=s.sibling}return u}function lz(i){if(i!==void 0&&i!=="forwards"&&i!=="backwards"&&i!=="together"&&!kW[i])if(kW[i]=!0,typeof i=="string")switch(i.toLowerCase()){case"together":case"forwards":case"backwards":{c('"%s" is not a valid value for revealOrder on <SuspenseList />. Use lowercase "%s" instead.',i,i.toLowerCase());break}case"forward":case"backward":{c('"%s" is not a valid value for revealOrder on <SuspenseList />. React uses the -s suffix in the spelling. Use "%ss" instead.',i,i.toLowerCase());break}default:c('"%s" is not a supported revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',i);break}else c('%s is not a supported value for revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',i)}function gz(i,s){i!==void 0&&!wZ[i]&&(i!=="collapsed"&&i!=="hidden"?(wZ[i]=!0,c('"%s" is not a supported value for tail on <SuspenseList />. Did you mean "collapsed" or "hidden"?',i)):s!=="forwards"&&s!=="backwards"&&(wZ[i]=!0,c('<SuspenseList tail="%s" /> is only valid if revealOrder is "forwards" or "backwards". Did you mean to specify revealOrder="forwards"?',i)))}function cX(i,s){{var u=Ln(i),h=!u&&typeof jt(i)=="function";if(u||h){var p=u?"array":"iterable";return c("A nested %s was passed to row #%s in <SuspenseList />. Wrap it in an additional SuspenseList to configure its revealOrder: <SuspenseList revealOrder=...> ... <SuspenseList revealOrder=...>{%s}</SuspenseList> ... </SuspenseList>",p,s,p),!1}}return!0}function cz(i,s){if((s==="forwards"||s==="backwards")&&i!==void 0&&i!==null&&i!==!1)if(Ln(i)){for(var u=0;u<i.length;u++)if(!cX(i[u],u))return}else{var h=jt(i);if(typeof h=="function"){var p=h.call(i);if(p)for(var B=p.next(),x=0;!B.done;B=p.next()){if(!cX(B.value,x))return;x++}}else c('A single row was passed to a <SuspenseList revealOrder="%s" />. This is not useful since it needs multiple rows. Did you mean to pass multiple children or an array?',s)}}function qW(i,s,u,h,p){var B=i.memoizedState;B===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:h,tail:u,tailMode:p}:(B.isBackwards=s,B.rendering=null,B.renderingStartTime=0,B.last=h,B.tail=u,B.tailMode=p)}function uX(i,s,u){var h=s.pendingProps,p=h.revealOrder,B=h.tail,x=h.children;lz(p),gz(B,p),cz(x,p),Mo(i,s,x,u);var Y=jr.current,z=kp(Y,Aa);if(z)Y=Zy(Y,Aa),s.flags|=ai;else{var J=i!==null&&(i.flags&ai)!==fn;J&&oz(s,s.child,u),Y=xd(Y)}if(Rc(s,Y),(s.mode&jn)===pn)s.memoizedState=null;else switch(p){case"forwards":{var j=rz(s.child),pe;j===null?(pe=s.child,s.child=null):(pe=j.sibling,j.sibling=null),qW(s,!1,pe,j,B);break}case"backwards":{var fe=null,He=s.child;for(s.child=null;He!==null;){var ze=He.alternate;if(ze!==null&&Du(ze)===null){s.child=He;break}var je=He.sibling;He.sibling=fe,fe=He,He=je}qW(s,!0,fe,null,B);break}case"together":{qW(s,!1,null,null,void 0);break}default:s.memoizedState=null}return s.child}function uz(i,s,u){dr(s,s.stateNode.containerInfo);var h=s.pendingProps;return i===null?s.child=Ir(s,null,h,u):Mo(i,s,h,u),s.child}var IX=!1;function Iz(i,s,u){var h=s.type,p=h._context,B=s.pendingProps,x=s.memoizedProps,Y=B.value;{"value"in B||IX||(IX=!0,c("The `value` prop is required for the `<Context.Provider>`. Did you misspell it or forget to pass it?"));var z=s.type.propTypes;z&&ar(z,B,"prop","Context.Provider")}if(bg(s,p,Y),x!==null){var J=x.value;if(lo(J,Y)){if(x.children===B.children&&!Zh())return ju(i,s,u)}else RW(s,p,u)}var j=B.children;return Mo(i,s,j,u),s.child}var dX=!1;function dz(i,s,u){var h=s.type;h._context===void 0?h!==h.Consumer&&(dX||(dX=!0,c("Rendering <Context> directly is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?"))):h=h._context;var p=s.pendingProps,B=p.children;typeof B!="function"&&c("A context consumer was rendered with multiple children, or a child that isn't a function. A context consumer expects a single child that is a function. If you did pass a function, make sure there is no trailing or leading whitespace around it."),_u(s,u);var x=oi(h);VC(s);var Y;return Ly.current=s,Qo(!0),Y=B(x),Qo(!1),ia(),s.flags|=$l,Mo(i,s,Y,u),s.child}function Uy(){Bg=!0}function xZ(i,s){(s.mode&jn)===pn&&i!==null&&(i.alternate=null,s.alternate=null,s.flags|=ji)}function ju(i,s,u){return i!==null&&(s.dependencies=i.dependencies),tt(),i0(s.lanes),Hs(u,s.childLanes)?(Vh(i,s),s.child):null}function Cz(i,s,u){{var h=s.return;if(h===null)throw new Error("Cannot swap the root fiber.");if(i.alternate=null,s.alternate=null,u.index=s.index,u.sibling=s.sibling,u.return=s.return,u.ref=s.ref,s===h.child)h.child=u;else{var p=h.child;if(p===null)throw new Error("Expected parent to have a child.");for(;p.sibling!==s;)if(p=p.sibling,p===null)throw new Error("Expected to find the previous sibling.");p.sibling=u}var B=h.deletions;return B===null?(h.deletions=[i],h.flags|=eu):B.push(i),u.flags|=ji,u}}function $W(i,s){var u=i.lanes;return!!Hs(u,s)}function hz(i,s,u){switch(s.tag){case b:sX(s),s.stateNode,Ca();break;case y:yy(s);break;case d:{var h=s.type;Sl(h)&&wp(s);break}case v:dr(s,s.stateNode.containerInfo);break;case N:{var p=s.memoizedProps.value,B=s.type._context;bg(s,B,p);break}case X:{var x=Hs(u,s.childLanes);x&&(s.flags|=ei);{var Y=s.stateNode;Y.effectDuration=0,Y.passiveEffectDuration=0}}break;case H:{var z=s.memoizedState;if(z!==null){if(z.dehydrated!==null)return Rc(s,xd(jr.current)),s.flags|=ai,null;var J=s.child,j=J.childLanes;if(Hs(u,j))return rX(i,s,u);Rc(s,xd(jr.current));var pe=ju(i,s,u);return pe!==null?pe.sibling:null}else Rc(s,xd(jr.current));break}case ee:{var fe=(i.flags&ai)!==fn,He=Hs(u,s.childLanes);if(fe){if(He)return uX(i,s,u);s.flags|=ai}var ze=s.memoizedState;if(ze!==null&&(ze.rendering=null,ze.tail=null,ze.lastEffect=null),Rc(s,jr.current),He)break;return null}case be:case se:return s.lanes=It,nX(i,s,u)}return ju(i,s,u)}function CX(i,s,u){if(s._debugNeedsRemount&&i!==null)return Cz(i,s,Wx(s.type,s.key,s.pendingProps,s._debugOwner||null,s.mode,s.lanes));if(i!==null){var h=i.memoizedProps,p=s.pendingProps;if(h!==p||Zh()||s.type!==i.type)Bg=!0;else{var B=$W(i,u);if(!B&&(s.flags&ai)===fn)return Bg=!1,hz(i,s,u);(i.flags&ng)!==fn?Bg=!0:Bg=!1}}else if(Bg=!1,_i()&&lr(s)){var x=s.index,Y=yW();qB(s,Y,x)}switch(s.lanes=It,s.tag){case f:return QT(i,s,s.type,u);case P:{var z=s.elementType;return OT(i,s,z,u)}case C:{var J=s.type,j=s.pendingProps,pe=s.elementType===J?j:qn(J,j);return UW(i,s,J,pe,u)}case d:{var fe=s.type,He=s.pendingProps,ze=s.elementType===fe?He:qn(fe,He);return aX(i,s,fe,ze,u)}case b:return UT(i,s,u);case y:return DT(i,s,u);case Z:return JT(i,s);case H:return rX(i,s,u);case v:return uz(i,s,u);case w:{var je=s.type,Jt=s.pendingProps,bn=s.elementType===je?Jt:qn(je,Jt);return $2(i,s,je,bn,u)}case V:return LT(i,s,u);case R:return _T(i,s,u);case X:return kT(i,s,u);case N:return Iz(i,s,u);case S:return dz(i,s,u);case F:{var gn=s.type,ii=s.pendingProps,$n=qn(gn,ii);if(s.type!==s.elementType){var We=gn.propTypes;We&&ar(We,$n,"prop",Mn(gn))}return $n=qn(gn.type,$n),eX(i,s,gn,$n,u)}case _:return tX(i,s,s.type,s.pendingProps,u);case K:{var qe=s.type,xe=s.pendingProps,St=s.elementType===qe?xe:qn(qe,xe);return PT(i,s,qe,St,u)}case ee:return uX(i,s,u);case Ie:break;case be:return nX(i,s,u)}throw new Error("Unknown unit of work tag ("+s.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function Im(i){i.flags|=ei}function hX(i){i.flags|=tu,i.flags|=ig}var AX,ex,fX,pX;AX=function(i,s,u,h){for(var p=s.child;p!==null;){if(p.tag===y||p.tag===Z)SB(i,p.stateNode);else if(p.tag!==v){if(p.child!==null){p.child.return=p,p=p.child;continue}}if(p===s)return;for(;p.sibling===null;){if(p.return===null||p.return===s)return;p=p.return}p.sibling.return=p.return,p=p.sibling}},ex=function(i,s){},fX=function(i,s,u,h,p){var B=i.memoizedProps;if(B!==h){var x=s.stateNode,Y=vy(),z=eW(x,u,B,h,p,Y);s.updateQueue=z,z&&Im(s)}},pX=function(i,s,u,h){u!==h&&Im(s)};function Dy(i,s){if(!_i())switch(i.tailMode){case"hidden":{for(var u=i.tail,h=null;u!==null;)u.alternate!==null&&(h=u),u=u.sibling;h===null?i.tail=null:h.sibling=null;break}case"collapsed":{for(var p=i.tail,B=null;p!==null;)p.alternate!==null&&(B=p),p=p.sibling;B===null?!s&&i.tail!==null?i.tail.sibling=null:i.tail=null:B.sibling=null;break}}}function Os(i){var s=i.alternate!==null&&i.alternate.child===i.child,u=It,h=fn;if(s){if((i.mode&pi)!==pn){for(var z=i.selfBaseDuration,J=i.child;J!==null;)u=Fn(u,Fn(J.lanes,J.childLanes)),h|=J.subtreeFlags&Kr,h|=J.flags&Kr,z+=J.treeBaseDuration,J=J.sibling;i.treeBaseDuration=z}else for(var j=i.child;j!==null;)u=Fn(u,Fn(j.lanes,j.childLanes)),h|=j.subtreeFlags&Kr,h|=j.flags&Kr,j.return=i,j=j.sibling;i.subtreeFlags|=h}else{if((i.mode&pi)!==pn){for(var p=i.actualDuration,B=i.selfBaseDuration,x=i.child;x!==null;)u=Fn(u,Fn(x.lanes,x.childLanes)),h|=x.subtreeFlags,h|=x.flags,p+=x.actualDuration,B+=x.treeBaseDuration,x=x.sibling;i.actualDuration=p,i.treeBaseDuration=B}else for(var Y=i.child;Y!==null;)u=Fn(u,Fn(Y.lanes,Y.childLanes)),h|=Y.subtreeFlags,h|=Y.flags,Y.return=i,Y=Y.sibling;i.subtreeFlags|=h}return i.childLanes=u,s}function Az(i,s,u){if(Ga()&&(s.mode&jn)!==pn&&(s.flags&ai)===fn)return Hp(s),Ca(),s.flags|=Fr|lf|Ys,!1;var h=Co(s);if(u!==null&&u.dehydrated!==null)if(i===null){if(!h)throw new Error("A dehydrated suspense component was completed without a hydrated node. This is probably a bug in React.");if(Iy(s),Os(s),(s.mode&pi)!==pn){var p=u!==null;if(p){var B=s.child;B!==null&&(s.treeBaseDuration-=B.treeBaseDuration)}}return!1}else{if(Ca(),(s.flags&ai)===fn&&(s.memoizedState=null),s.flags|=ei,Os(s),(s.mode&pi)!==pn){var x=u!==null;if(x){var Y=s.child;Y!==null&&(s.treeBaseDuration-=Y.treeBaseDuration)}}return!1}else return cr(),!0}function mX(i,s,u){var h=s.pendingProps;switch(pd(s),s.tag){case f:case P:case _:case C:case w:case V:case R:case X:case S:case F:return Os(s),null;case d:{var p=s.type;return Sl(p)&&wu(s),Os(s),null}case b:{var B=s.stateNode;if(Wd(s),ay(s),Sy(),B.pendingContext&&(B.context=B.pendingContext,B.pendingContext=null),i===null||i.child===null){var x=Co(s);if(x)Im(s);else if(i!==null){var Y=i.memoizedState;(!Y.isDehydrated||(s.flags&Fr)!==fn)&&(s.flags|=Qg,cr())}}return ex(i,s),Os(s),null}case y:{Gy(s);var z=cZ(),J=s.type;if(i!==null&&s.stateNode!=null)fX(i,s,J,h,z),i.ref!==s.ref&&hX(s);else{if(!h){if(s.stateNode===null)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return Os(s),null}var j=vy(),pe=Co(s);if(pe)iZ(s,z,j)&&Im(s);else{var fe=qw(J,h,z,j,s);AX(fe,s,!1,!1),s.stateNode=fe,$w(fe,J,h,z)&&Im(s)}s.ref!==null&&hX(s)}return Os(s),null}case Z:{var He=h;if(i&&s.stateNode!=null){var ze=i.memoizedProps;pX(i,s,ze,He)}else{if(typeof He!="string"&&s.stateNode===null)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");var je=cZ(),Jt=vy(),bn=Co(s);bn?ZW(s)&&Im(s):s.stateNode=tW(He,je,Jt,s)}return Os(s),null}case H:{Vd(s);var gn=s.memoizedState;if(i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){var ii=Az(i,s,gn);if(!ii)return s.flags&Ys?s:null}if((s.flags&ai)!==fn)return s.lanes=u,(s.mode&pi)!==pn&&ri(s),s;var $n=gn!==null,We=i!==null&&i.memoizedState!==null;if($n!==We&&$n){var qe=s.child;if(qe.flags|=ul,(s.mode&jn)!==pn){var xe=i===null&&(s.memoizedProps.unstable_avoidThisFallback!==!0||!0);xe||kp(jr.current,By)?fL():px()}}var St=s.updateQueue;if(St!==null&&(s.flags|=ei),Os(s),(s.mode&pi)!==pn&&$n){var en=s.child;en!==null&&(s.treeBaseDuration-=en.treeBaseDuration)}return null}case v:return Wd(s),ex(i,s),i===null&&ud(s.stateNode.containerInfo),Os(s),null;case N:var qt=s.type._context;return py(qt,s),Os(s),null;case K:{var Rn=s.type;return Sl(Rn)&&wu(s),Os(s),null}case ee:{Vd(s);var Hn=s.memoizedState;if(Hn===null)return Os(s),null;var Wi=(s.flags&ai)!==fn,Ci=Hn.rendering;if(Ci===null)if(Wi)Dy(Hn,!1);else{var Ma=mL()&&(i===null||(i.flags&ai)===fn);if(!Ma)for(var hi=s.child;hi!==null;){var Ra=Du(hi);if(Ra!==null){Wi=!0,s.flags|=ai,Dy(Hn,!1);var Ao=Ra.updateQueue;return Ao!==null&&(s.updateQueue=Ao,s.flags|=ei),s.subtreeFlags=fn,Ay(s,u),Rc(s,Zy(jr.current,Aa)),s.child}hi=hi.sibling}Hn.tail!==null&&Ua()>TX()&&(s.flags|=ai,Wi=!0,Dy(Hn,!1),s.lanes=$b)}else{if(!Wi){var $s=Du(Ci);if($s!==null){s.flags|=ai,Wi=!0;var $r=$s.updateQueue;if($r!==null&&(s.updateQueue=$r,s.flags|=ei),Dy(Hn,!0),Hn.tail===null&&Hn.tailMode==="hidden"&&!Ci.alternate&&!_i())return Os(s),null}else Ua()*2-Hn.renderingStartTime>TX()&&u!==Vo&&(s.flags|=ai,Wi=!0,Dy(Hn,!1),s.lanes=$b)}if(Hn.isBackwards)Ci.sibling=s.child,s.child=Ci;else{var Ko=Hn.last;Ko!==null?Ko.sibling=Ci:s.child=Ci,Hn.last=Ci}}if(Hn.tail!==null){var Eo=Hn.tail;Hn.rendering=Eo,Hn.tail=Eo.sibling,Hn.renderingStartTime=Ua(),Eo.sibling=null;var fo=jr.current;return Wi?fo=Zy(fo,Aa):fo=xd(fo),Rc(s,fo),Eo}return Os(s),null}case Ie:break;case be:case se:{fx(s);var nI=s.memoizedState,bm=nI!==null;if(i!==null){var l0=i.memoizedState,Nc=l0!==null;Nc!==bm&&!me&&(s.flags|=ul)}return!bm||(s.mode&jn)===pn?Os(s):Hs(Vc,Vo)&&(Os(s),s.subtreeFlags&(ji|ei)&&(s.flags|=ul)),null}case Ce:return null;case he:return null}throw new Error("Unknown unit of work tag ("+s.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function fz(i,s,u){switch(pd(s),s.tag){case d:{var h=s.type;Sl(h)&&wu(s);var p=s.flags;return p&Ys?(s.flags=p&~Ys|ai,(s.mode&pi)!==pn&&ri(s),s):null}case b:{s.stateNode,Wd(s),ay(s),Sy();var B=s.flags;return(B&Ys)!==fn&&(B&ai)===fn?(s.flags=B&~Ys|ai,s):null}case y:return Gy(s),null;case H:{Vd(s);var x=s.memoizedState;if(x!==null&&x.dehydrated!==null){if(s.alternate===null)throw new Error("Threw in newly mounted dehydrated component. This is likely a bug in React. Please file an issue.");Ca()}var Y=s.flags;return Y&Ys?(s.flags=Y&~Ys|ai,(s.mode&pi)!==pn&&ri(s),s):null}case ee:return Vd(s),null;case v:return Wd(s),null;case N:var z=s.type._context;return py(z,s),null;case be:case se:return fx(s),null;case Ce:return null;default:return null}}function bX(i,s,u){switch(pd(s),s.tag){case d:{var h=s.type.childContextTypes;h!=null&&wu(s);break}case b:{s.stateNode,Wd(s),ay(s),Sy();break}case y:{Gy(s);break}case v:Wd(s);break;case H:Vd(s);break;case ee:Vd(s);break;case N:var p=s.type._context;py(p,s);break;case be:case se:fx(s);break}}var vX=null;vX=new Set;var VZ=!1,Ps=!1,pz=typeof WeakSet=="function"?WeakSet:Set,on=null,dm=null,Cm=null;function mz(i){rf(null,function(){throw i}),ql()}var bz=function(i,s){if(s.props=i.memoizedProps,s.state=i.memoizedState,i.mode&pi)try{Tt(),s.componentWillUnmount()}finally{Gt(i)}else s.componentWillUnmount()};function yX(i,s){try{Hd(Ya,i)}catch(u){Di(i,s,u)}}function tx(i,s,u){try{bz(i,u)}catch(h){Di(i,s,h)}}function vz(i,s,u){try{u.componentDidMount()}catch(h){Di(i,s,h)}}function GX(i,s){try{ZX(i)}catch(u){Di(i,s,u)}}function hm(i,s){var u=i.ref;if(u!==null)if(typeof u=="function"){var h;try{if(Ee&&At&&i.mode&pi)try{Tt(),h=u(null)}finally{Gt(i)}else h=u(null)}catch(p){Di(i,s,p)}typeof h=="function"&&c("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",Xn(i))}else u.current=null}function NZ(i,s,u){try{u()}catch(h){Di(i,s,h)}}var BX=!1;function yz(i,s){Uv(i.containerInfo),on=s,Gz();var u=BX;return BX=!1,u}function Gz(){for(;on!==null;){var i=on,s=i.child;(i.subtreeFlags&VI)!==fn&&s!==null?(s.return=i,on=s):Bz()}}function Bz(){for(;on!==null;){var i=on;Oi(i);try{Zz(i)}catch(u){Di(i,i.return,u)}za();var s=i.sibling;if(s!==null){s.return=i.return,on=s;return}on=i.return}}function Zz(i){var s=i.alternate,u=i.flags;if((u&Qg)!==fn){switch(Oi(i),i.tag){case C:case w:case _:break;case d:{if(s!==null){var h=s.memoizedProps,p=s.memoizedState,B=i.stateNode;i.type===i.elementType&&!jh&&(B.props!==i.memoizedProps&&c("Expected %s props to match memoized props before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Xn(i)||"instance"),B.state!==i.memoizedState&&c("Expected %s state to match memoized state before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Xn(i)||"instance"));var x=B.getSnapshotBeforeUpdate(i.elementType===i.type?h:qn(i.type,h),p);{var Y=vX;x===void 0&&!Y.has(i.type)&&(Y.add(i.type),c("%s.getSnapshotBeforeUpdate(): A snapshot value (or null) must be returned. You have returned undefined.",Xn(i)))}B.__reactInternalSnapshotBeforeUpdate=x}break}case b:{{var z=i.stateNode;YB(z.containerInfo)}break}case y:case Z:case v:case K:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}za()}}function Zg(i,s,u){var h=s.updateQueue,p=h!==null?h.lastEffect:null;if(p!==null){var B=p.next,x=B;do{if((x.tag&i)===i){var Y=x.destroy;x.destroy=void 0,Y!==void 0&&((i&Qa)!==us?fw(s):(i&Ya)!==us&&XG(s),(i&Cr)!==us&&s0(!0),NZ(s,u,Y),(i&Cr)!==us&&s0(!1),(i&Qa)!==us?NG():(i&Ya)!==us&&YG())}x=x.next}while(x!==B)}}function Hd(i,s){var u=s.updateQueue,h=u!==null?u.lastEffect:null;if(h!==null){var p=h.next,B=p;do{if((B.tag&i)===i){(i&Qa)!==us?hw(s):(i&Ya)!==us&&NC(s);var x=B.create;(i&Cr)!==us&&s0(!0),B.destroy=x(),(i&Cr)!==us&&s0(!1),(i&Qa)!==us?Aw():(i&Ya)!==us&&HI();{var Y=B.destroy;if(Y!==void 0&&typeof Y!="function"){var z=void 0;(B.tag&Ya)!==fn?z="useLayoutEffect":(B.tag&Cr)!==fn?z="useInsertionEffect":z="useEffect";var J=void 0;Y===null?J=" You returned null. If your effect does not require clean up, return undefined (or nothing).":typeof Y.then=="function"?J=`

It looks like you wrote `+z+`(async () => ...) or returned a Promise. Instead, write the async function inside your effect and call it immediately:

`+z+`(() => {
  async function fetchData() {
    // You can await here
    const response = await MyAPI.getData(someId);
    // ...
  }
  fetchData();
}, [someId]); // Or [] if effect doesn't need props or state

Learn more about data fetching with Hooks: https://reactjs.org/link/hooks-data-fetching`:J=" You returned: "+Y,c("%s must not return anything besides a function, which is used for clean-up.%s",z,J)}}}B=B.next}while(B!==p)}}function Sz(i,s){if((s.flags&ei)!==fn)switch(s.tag){case X:{var u=s.stateNode.passiveEffectDuration,h=s.memoizedProps,p=h.id,B=h.onPostCommit,x=Ei(),Y=s.alternate===null?"mount":"update";Rt()&&(Y="nested-update"),typeof B=="function"&&B(p,Y,u,x);var z=s.return;e:for(;z!==null;){switch(z.tag){case b:var J=z.stateNode;J.passiveEffectDuration+=u;break e;case X:var j=z.stateNode;j.passiveEffectDuration+=u;break e}z=z.return}break}}}function Rz(i,s,u,h){if((u.flags&cf)!==fn)switch(u.tag){case C:case w:case _:{if(!Ps)if(u.mode&pi)try{Tt(),Hd(Ya|Za,u)}finally{Gt(u)}else Hd(Ya|Za,u);break}case d:{var p=u.stateNode;if(u.flags&ei&&!Ps)if(s===null)if(u.type===u.elementType&&!jh&&(p.props!==u.memoizedProps&&c("Expected %s props to match memoized props before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Xn(u)||"instance"),p.state!==u.memoizedState&&c("Expected %s state to match memoized state before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Xn(u)||"instance")),u.mode&pi)try{Tt(),p.componentDidMount()}finally{Gt(u)}else p.componentDidMount();else{var B=u.elementType===u.type?s.memoizedProps:qn(u.type,s.memoizedProps),x=s.memoizedState;if(u.type===u.elementType&&!jh&&(p.props!==u.memoizedProps&&c("Expected %s props to match memoized props before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Xn(u)||"instance"),p.state!==u.memoizedState&&c("Expected %s state to match memoized state before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Xn(u)||"instance")),u.mode&pi)try{Tt(),p.componentDidUpdate(B,x,p.__reactInternalSnapshotBeforeUpdate)}finally{Gt(u)}else p.componentDidUpdate(B,x,p.__reactInternalSnapshotBeforeUpdate)}var Y=u.updateQueue;Y!==null&&(u.type===u.elementType&&!jh&&(p.props!==u.memoizedProps&&c("Expected %s props to match memoized props before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Xn(u)||"instance"),p.state!==u.memoizedState&&c("Expected %s state to match memoized state before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Xn(u)||"instance")),gZ(u,Y,p));break}case b:{var z=u.updateQueue;if(z!==null){var J=null;if(u.child!==null)switch(u.child.tag){case y:J=u.child.stateNode;break;case d:J=u.child.stateNode;break}gZ(u,z,J)}break}case y:{var j=u.stateNode;if(s===null&&u.flags&ei){var pe=u.type,fe=u.memoizedProps;wB(j,pe,fe)}break}case Z:break;case v:break;case X:{{var He=u.memoizedProps,ze=He.onCommit,je=He.onRender,Jt=u.stateNode.effectDuration,bn=Ei(),gn=s===null?"mount":"update";Rt()&&(gn="nested-update"),typeof je=="function"&&je(u.memoizedProps.id,gn,u.actualDuration,u.treeBaseDuration,u.actualStartTime,bn);{typeof ze=="function"&&ze(u.memoizedProps.id,gn,Jt,bn),BL(u);var ii=u.return;e:for(;ii!==null;){switch(ii.tag){case b:var $n=ii.stateNode;$n.effectDuration+=Jt;break e;case X:var We=ii.stateNode;We.effectDuration+=Jt;break e}ii=ii.return}}}break}case H:{Mz(i,u);break}case ee:case K:case Ie:case be:case se:case he:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}Ps||u.flags&tu&&ZX(u)}function wz(i){switch(i.tag){case C:case w:case _:{if(i.mode&pi)try{Tt(),yX(i,i.return)}finally{Gt(i)}else yX(i,i.return);break}case d:{var s=i.stateNode;typeof s.componentDidMount=="function"&&vz(i,i.return,s),GX(i,i.return);break}case y:{GX(i,i.return);break}}}function Wz(i,s){for(var u=null,h=i;;){if(h.tag===y){if(u===null){u=h;try{var p=h.stateNode;s?oW(p):lW(h.stateNode,h.memoizedProps)}catch(x){Di(i,i.return,x)}}}else if(h.tag===Z){if(u===null)try{var B=h.stateNode;s?rW(B):gW(B,h.memoizedProps)}catch(x){Di(i,i.return,x)}}else if(!((h.tag===be||h.tag===se)&&h.memoizedState!==null&&h!==i)){if(h.child!==null){h.child.return=h,h=h.child;continue}}if(h===i)return;for(;h.sibling===null;){if(h.return===null||h.return===i)return;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}function ZX(i){var s=i.ref;if(s!==null){var u=i.stateNode,h;switch(i.tag){case y:h=u;break;default:h=u}if(typeof s=="function"){var p;if(i.mode&pi)try{Tt(),p=s(h)}finally{Gt(i)}else p=s(h);typeof p=="function"&&c("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",Xn(i))}else s.hasOwnProperty("current")||c("Unexpected ref object provided for %s. Use either a ref-setter function or React.createRef().",Xn(i)),s.current=h}}function xz(i){var s=i.alternate;s!==null&&(s.return=null),i.return=null}function SX(i){var s=i.alternate;s!==null&&(i.alternate=null,SX(s));{if(i.child=null,i.deletions=null,i.sibling=null,i.tag===y){var u=i.stateNode;u!==null&&vp(u)}i.stateNode=null,i._debugOwner=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}}function Vz(i){for(var s=i.return;s!==null;){if(RX(s))return s;s=s.return}throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.")}function RX(i){return i.tag===y||i.tag===b||i.tag===v}function wX(i){var s=i;e:for(;;){for(;s.sibling===null;){if(s.return===null||RX(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==y&&s.tag!==Z&&s.tag!==E;){if(s.flags&ji||s.child===null||s.tag===v)continue e;s.child.return=s,s=s.child}if(!(s.flags&ji))return s.stateNode}}function Nz(i){var s=Vz(i);switch(s.tag){case y:{var u=s.stateNode;s.flags&RC&&(WB(u),s.flags&=~RC);var h=wX(i);ix(i,h,u);break}case b:case v:{var p=s.stateNode.containerInfo,B=wX(i);nx(i,B,p);break}default:throw new Error("Invalid host parent fiber. This error is likely caused by a bug in React. Please file an issue.")}}function nx(i,s,u){var h=i.tag,p=h===y||h===Z;if(p){var B=i.stateNode;s?Cp(u,B,s):VB(u,B)}else if(h!==v){var x=i.child;if(x!==null){nx(x,s,u);for(var Y=x.sibling;Y!==null;)nx(Y,s,u),Y=Y.sibling}}}function ix(i,s,u){var h=i.tag,p=h===y||h===Z;if(p){var B=i.stateNode;s?NB(u,B,s):xB(u,B)}else if(h!==v){var x=i.child;if(x!==null){ix(x,s,u);for(var Y=x.sibling;Y!==null;)ix(Y,s,u),Y=Y.sibling}}}var Qs=null,Sg=!1;function Xz(i,s,u){{var h=s;e:for(;h!==null;){switch(h.tag){case y:{Qs=h.stateNode,Sg=!1;break e}case b:{Qs=h.stateNode.containerInfo,Sg=!0;break e}case v:{Qs=h.stateNode.containerInfo,Sg=!0;break e}}h=h.return}if(Qs===null)throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");WX(i,s,u),Qs=null,Sg=!1}xz(u)}function Fd(i,s,u){for(var h=u.child;h!==null;)WX(i,s,h),h=h.sibling}function WX(i,s,u){switch(Il(u),u.tag){case y:Ps||hm(u,s);case Z:{{var h=Qs,p=Sg;Qs=null,Fd(i,s,u),Qs=h,Sg=p,Qs!==null&&(Sg?sW(Qs,u.stateNode):aW(Qs,u.stateNode))}return}case E:{Qs!==null&&(Sg?XB(Qs,u.stateNode):Qv(Qs,u.stateNode));return}case v:{{var B=Qs,x=Sg;Qs=u.stateNode.containerInfo,Sg=!0,Fd(i,s,u),Qs=B,Sg=x}return}case C:case w:case F:case _:{if(!Ps){var Y=u.updateQueue;if(Y!==null){var z=Y.lastEffect;if(z!==null){var J=z.next,j=J;do{var pe=j,fe=pe.destroy,He=pe.tag;fe!==void 0&&((He&Cr)!==us?NZ(u,s,fe):(He&Ya)!==us&&(XG(u),u.mode&pi?(Tt(),NZ(u,s,fe),Gt(u)):NZ(u,s,fe),YG())),j=j.next}while(j!==J)}}}Fd(i,s,u);return}case d:{if(!Ps){hm(u,s);var ze=u.stateNode;typeof ze.componentWillUnmount=="function"&&tx(u,s,ze)}Fd(i,s,u);return}case Ie:{Fd(i,s,u);return}case be:{if(u.mode&jn){var je=Ps;Ps=je||u.memoizedState!==null,Fd(i,s,u),Ps=je}else Fd(i,s,u);break}default:{Fd(i,s,u);return}}}function Yz(i){i.memoizedState}function Mz(i,s){var u=s.memoizedState;if(u===null){var h=s.alternate;if(h!==null){var p=h.memoizedState;if(p!==null){var B=p.dehydrated;B!==null&&ey(B)}}}}function xX(i){var s=i.updateQueue;if(s!==null){i.updateQueue=null;var u=i.stateNode;u===null&&(u=i.stateNode=new pz),s.forEach(function(h){var p=VL.bind(null,i,h);if(!u.has(h)){if(u.add(h),Lr)if(dm!==null&&Cm!==null)a0(Cm,dm);else throw Error("Expected finished root and lanes to be set. This is a bug in React.");h.then(p,p)}})}}function Hz(i,s,u){dm=u,Cm=i,Oi(s),VX(s,i),Oi(s),dm=null,Cm=null}function Rg(i,s,u){var h=s.deletions;if(h!==null)for(var p=0;p<h.length;p++){var B=h[p];try{Xz(i,s,B)}catch(z){Di(B,s,z)}}var x=kg();if(s.subtreeFlags&gf)for(var Y=s.child;Y!==null;)Oi(Y),VX(Y,i),Y=Y.sibling;Oi(x)}function VX(i,s,u){var h=i.alternate,p=i.flags;switch(i.tag){case C:case w:case F:case _:{if(Rg(s,i),xc(i),p&ei){try{Zg(Cr|Za,i,i.return),Hd(Cr|Za,i)}catch(Rn){Di(i,i.return,Rn)}if(i.mode&pi){try{Tt(),Zg(Ya|Za,i,i.return)}catch(Rn){Di(i,i.return,Rn)}Gt(i)}else try{Zg(Ya|Za,i,i.return)}catch(Rn){Di(i,i.return,Rn)}}return}case d:{Rg(s,i),xc(i),p&tu&&h!==null&&hm(h,h.return);return}case y:{Rg(s,i),xc(i),p&tu&&h!==null&&hm(h,h.return);{if(i.flags&RC){var B=i.stateNode;try{WB(B)}catch(Rn){Di(i,i.return,Rn)}}if(p&ei){var x=i.stateNode;if(x!=null){var Y=i.memoizedProps,z=h!==null?h.memoizedProps:Y,J=i.type,j=i.updateQueue;if(i.updateQueue=null,j!==null)try{Ov(x,j,J,z,Y,i)}catch(Rn){Di(i,i.return,Rn)}}}}return}case Z:{if(Rg(s,i),xc(i),p&ei){if(i.stateNode===null)throw new Error("This should have a text node initialized. This error is likely caused by a bug in React. Please file an issue.");var pe=i.stateNode,fe=i.memoizedProps,He=h!==null?h.memoizedProps:fe;try{Pv(pe,He,fe)}catch(Rn){Di(i,i.return,Rn)}}return}case b:{if(Rg(s,i),xc(i),p&ei&&h!==null){var ze=h.memoizedState;if(ze.isDehydrated)try{TB(s.containerInfo)}catch(Rn){Di(i,i.return,Rn)}}return}case v:{Rg(s,i),xc(i);return}case H:{Rg(s,i),xc(i);var je=i.child;if(je.flags&ul){var Jt=je.stateNode,bn=je.memoizedState,gn=bn!==null;if(Jt.isHidden=gn,gn){var ii=je.alternate!==null&&je.alternate.memoizedState!==null;ii||AL()}}if(p&ei){try{Yz(i)}catch(Rn){Di(i,i.return,Rn)}xX(i)}return}case be:{var $n=h!==null&&h.memoizedState!==null;if(i.mode&jn){var We=Ps;Ps=We||$n,Rg(s,i),Ps=We}else Rg(s,i);if(xc(i),p&ul){var qe=i.stateNode,xe=i.memoizedState,St=xe!==null,en=i;if(qe.isHidden=St,St&&!$n&&(en.mode&jn)!==pn){on=en;for(var qt=en.child;qt!==null;)on=qt,Kz(qt),qt=qt.sibling}Wz(en,St)}return}case ee:{Rg(s,i),xc(i),p&ei&&xX(i);return}case Ie:return;default:{Rg(s,i),xc(i);return}}}function xc(i){var s=i.flags;if(s&ji){try{Nz(i)}catch(u){Di(i,i.return,u)}i.flags&=~ji}s&tg&&(i.flags&=~tg)}function Fz(i,s,u){dm=u,Cm=s,on=i,NX(i,s,u),dm=null,Cm=null}function NX(i,s,u){for(var h=(i.mode&jn)!==pn;on!==null;){var p=on,B=p.child;if(p.tag===be&&h){var x=p.memoizedState!==null,Y=x||VZ;if(Y){ax(i,s,u);continue}else{var z=p.alternate,J=z!==null&&z.memoizedState!==null,j=J||Ps,pe=VZ,fe=Ps;VZ=Y,Ps=j,Ps&&!fe&&(on=p,Ez(p));for(var He=B;He!==null;)on=He,NX(He,s,u),He=He.sibling;on=p,VZ=pe,Ps=fe,ax(i,s,u);continue}}(p.subtreeFlags&cf)!==fn&&B!==null?(B.return=p,on=B):ax(i,s,u)}}function ax(i,s,u){for(;on!==null;){var h=on;if((h.flags&cf)!==fn){var p=h.alternate;Oi(h);try{Rz(s,p,h,u)}catch(x){Di(h,h.return,x)}za()}if(h===i){on=null;return}var B=h.sibling;if(B!==null){B.return=h.return,on=B;return}on=h.return}}function Kz(i){for(;on!==null;){var s=on,u=s.child;switch(s.tag){case C:case w:case F:case _:{if(s.mode&pi)try{Tt(),Zg(Ya,s,s.return)}finally{Gt(s)}else Zg(Ya,s,s.return);break}case d:{hm(s,s.return);var h=s.stateNode;typeof h.componentWillUnmount=="function"&&tx(s,s.return,h);break}case y:{hm(s,s.return);break}case be:{var p=s.memoizedState!==null;if(p){XX(i);continue}break}}u!==null?(u.return=s,on=u):XX(i)}}function XX(i){for(;on!==null;){var s=on;if(s===i){on=null;return}var u=s.sibling;if(u!==null){u.return=s.return,on=u;return}on=s.return}}function Ez(i){for(;on!==null;){var s=on,u=s.child;if(s.tag===be){var h=s.memoizedState!==null;if(h){YX(i);continue}}u!==null?(u.return=s,on=u):YX(i)}}function YX(i){for(;on!==null;){var s=on;Oi(s);try{wz(s)}catch(h){Di(s,s.return,h)}if(za(),s===i){on=null;return}var u=s.sibling;if(u!==null){u.return=s.return,on=u;return}on=s.return}}function Tz(i,s,u,h){on=s,zz(s,i,u,h)}function zz(i,s,u,h){for(;on!==null;){var p=on,B=p.child;(p.subtreeFlags&NI)!==fn&&B!==null?(B.return=p,on=B):Lz(i,s,u,h)}}function Lz(i,s,u,h){for(;on!==null;){var p=on;if((p.flags&eg)!==fn){Oi(p);try{_z(s,p,u,h)}catch(x){Di(p,p.return,x)}za()}if(p===i){on=null;return}var B=p.sibling;if(B!==null){B.return=p.return,on=B;return}on=p.return}}function _z(i,s,u,h){switch(s.tag){case C:case w:case _:{if(s.mode&pi){_n();try{Hd(Qa|Za,s)}finally{ln(s)}}else Hd(Qa|Za,s);break}}}function kz(i){on=i,Uz()}function Uz(){for(;on!==null;){var i=on,s=i.child;if((on.flags&eu)!==fn){var u=i.deletions;if(u!==null){for(var h=0;h<u.length;h++){var p=u[h];on=p,Oz(p,i)}{var B=i.alternate;if(B!==null){var x=B.child;if(x!==null){B.child=null;do{var Y=x.sibling;x.sibling=null,x=Y}while(x!==null)}}}on=i}}(i.subtreeFlags&NI)!==fn&&s!==null?(s.return=i,on=s):Dz()}}function Dz(){for(;on!==null;){var i=on;(i.flags&eg)!==fn&&(Oi(i),Jz(i),za());var s=i.sibling;if(s!==null){s.return=i.return,on=s;return}on=i.return}}function Jz(i){switch(i.tag){case C:case w:case _:{i.mode&pi?(_n(),Zg(Qa|Za,i,i.return),ln(i)):Zg(Qa|Za,i,i.return);break}}}function Oz(i,s){for(;on!==null;){var u=on;Oi(u),Qz(u,s),za();var h=u.child;h!==null?(h.return=u,on=h):Pz(i)}}function Pz(i){for(;on!==null;){var s=on,u=s.sibling,h=s.return;if(SX(s),s===i){on=null;return}if(u!==null){u.return=h,on=u;return}on=h}}function Qz(i,s){switch(i.tag){case C:case w:case _:{i.mode&pi?(_n(),Zg(Qa,i,s),ln(i)):Zg(Qa,i,s);break}}}function jz(i){switch(i.tag){case C:case w:case _:{try{Hd(Ya|Za,i)}catch(u){Di(i,i.return,u)}break}case d:{var s=i.stateNode;try{s.componentDidMount()}catch(u){Di(i,i.return,u)}break}}}function qz(i){switch(i.tag){case C:case w:case _:{try{Hd(Qa|Za,i)}catch(s){Di(i,i.return,s)}break}}}function $z(i){switch(i.tag){case C:case w:case _:{try{Zg(Ya|Za,i,i.return)}catch(u){Di(i,i.return,u)}break}case d:{var s=i.stateNode;typeof s.componentWillUnmount=="function"&&tx(i,i.return,s);break}}}function eL(i){switch(i.tag){case C:case w:case _:try{Zg(Qa|Za,i,i.return)}catch(s){Di(i,i.return,s)}}}if(typeof Symbol=="function"&&Symbol.for){var Jy=Symbol.for;Jy("selector.component"),Jy("selector.has_pseudo_class"),Jy("selector.role"),Jy("selector.test_id"),Jy("selector.text")}var tL=[];function nL(){tL.forEach(function(i){return i()})}var iL=t.ReactCurrentActQueue;function aL(i){{var s=typeof IS_REACT_ACT_ENVIRONMENT<"u"?IS_REACT_ACT_ENVIRONMENT:void 0,u=typeof jest<"u";return u&&s!==!1}}function MX(){{var i=typeof IS_REACT_ACT_ENVIRONMENT<"u"?IS_REACT_ACT_ENVIRONMENT:void 0;return!i&&iL.current!==null&&c("The current testing environment is not configured to support act(...)"),i}}var sL=Math.ceil,sx=t.ReactCurrentDispatcher,ox=t.ReactCurrentOwner,js=t.ReactCurrentBatchConfig,wg=t.ReactCurrentActQueue,Is=0,HX=1,qs=2,Fl=4,qu=0,Oy=1,qh=2,XZ=3,Py=4,FX=5,rx=6,ni=Is,Ho=null,fa=null,ds=It,Vc=It,lx=bc(It),Cs=qu,Qy=null,YZ=It,jy=It,MZ=It,qy=null,fr=null,gx=0,KX=500,EX=1/0,oL=500,$u=null;function $y(){EX=Ua()+oL}function TX(){return EX}var HZ=!1,cx=null,Am=null,$h=!1,Kd=null,e0=It,ux=[],Ix=null,rL=50,t0=0,dx=null,Cx=!1,FZ=!1,lL=50,fm=0,KZ=null,n0=Bi,EZ=It,zX=!1;function TZ(){return Ho}function Fo(){return(ni&(qs|Fl))!==Is?Ua():(n0!==Bi||(n0=Ua()),n0)}function Ed(i){var s=i.mode;if((s&jn)===pn)return wn;if((ni&qs)!==Is&&ds!==It)return ic(ds);var u=wh()!==Fp;if(u){if(js.transition!==null){var h=js.transition;h._updatedFibers||(h._updatedFibers=new Set),h._updatedFibers.add(i)}return EZ===xa&&(EZ=LG()),EZ}var p=so();if(p!==xa)return p;var B=nW();return B}function gL(i){var s=i.mode;return(s&jn)===pn?wn:_G()}function hs(i,s,u,h){XL(),zX&&c("useInsertionEffect must not schedule updates."),Cx&&(FZ=!0),KC(i,u,h),(ni&qs)!==It&&i===Ho?HL(s):(Lr&&vf(i,s,u),FL(s),i===Ho&&((ni&qs)===Is&&(jy=Fn(jy,u)),Cs===Py&&Td(i,ds)),pr(i,h),u===wn&&ni===Is&&(s.mode&jn)===pn&&!wg.isBatchingLegacy&&($y(),jB()))}function cL(i,s,u){var h=i.current;h.lanes=s,KC(i,s,u),pr(i,u)}function uL(i){return(ni&qs)!==Is}function pr(i,s){var u=i.callbackNode;EG(i,s);var h=TI(i,i===Ho?ds:It);if(h===It){u!==null&&iY(u),i.callbackNode=null,i.callbackPriority=xa;return}var p=nc(h),B=i.callbackPriority;if(B===p&&!(wg.current!==null&&u!==vx)){u==null&&B!==wn&&c("Expected scheduled callback to exist. This error is likely caused by a bug in React. Please file an issue.");return}u!=null&&iY(u);var x;if(p===wn)i.tag===fg?(wg.isBatchingLegacy!==null&&(wg.didScheduleLegacyUpdate=!0),vW(kX.bind(null,i))):oy(kX.bind(null,i)),wg.current!==null?wg.current.push(yc):iW(function(){(ni&(qs|Fl))===Is&&yc()}),x=null;else{var Y;switch(Gf(h)){case Fs:Y=xC;break;case kr:Y=If;break;case Ur:Y=jg;break;case kI:Y=Jb;break;default:Y=jg;break}x=yx(Y,LX.bind(null,i))}i.callbackPriority=p,i.callbackNode=x}function LX(i,s){if(En(),n0=Bi,EZ=It,(ni&(qs|Fl))!==Is)throw new Error("Should not already be working.");var u=i.callbackNode,h=tI();if(h&&i.callbackNode!==u)return null;var p=TI(i,i===Ho?ds:It);if(p===It)return null;var B=!aa(i,p)&&!Iu(i,p)&&!s,x=B?vL(i,p):LZ(i,p);if(x!==qu){if(x===qh){var Y=pf(i);Y!==It&&(p=Y,x=hx(i,Y))}if(x===Oy){var z=Qy;throw eA(i,It),Td(i,p),pr(i,Ua()),z}if(x===rx)Td(i,p);else{var J=!aa(i,p),j=i.current.alternate;if(J&&!dL(j)){if(x=LZ(i,p),x===qh){var pe=pf(i);pe!==It&&(p=pe,x=hx(i,pe))}if(x===Oy){var fe=Qy;throw eA(i,It),Td(i,p),pr(i,Ua()),fe}}i.finishedWork=j,i.finishedLanes=p,IL(i,x,p)}}return pr(i,Ua()),i.callbackNode===u?LX.bind(null,i):null}function hx(i,s){var u=qy;if(TC(i)){var h=eA(i,s);h.flags|=Fr,cd(i.containerInfo)}var p=LZ(i,s);if(p!==qh){var B=fr;fr=u,B!==null&&_X(B)}return p}function _X(i){fr===null?fr=i:fr.push.apply(fr,i)}function IL(i,s,u){switch(s){case qu:case Oy:throw new Error("Root did not complete. This is a bug in React.");case qh:{tA(i,fr,$u);break}case XZ:{if(Td(i,u),zG(u)&&!aY()){var h=gx+KX-Ua();if(h>10){var p=TI(i,It);if(p!==It)break;var B=i.suspendedLanes;if(!cg(B,u)){Fo(),kG(i,B);break}i.timeoutHandle=vh(tA.bind(null,i,fr,$u),h);break}}tA(i,fr,$u);break}case Py:{if(Td(i,u),zI(u))break;if(!aY()){var x=Af(i,u),Y=x,z=Ua()-Y,J=NL(z)-z;if(J>10){i.timeoutHandle=vh(tA.bind(null,i,fr,$u),J);break}}tA(i,fr,$u);break}case FX:{tA(i,fr,$u);break}default:throw new Error("Unknown root exit status.")}}function dL(i){for(var s=i;;){if(s.flags&Lb){var u=s.updateQueue;if(u!==null){var h=u.stores;if(h!==null)for(var p=0;p<h.length;p++){var B=h[p],x=B.getSnapshot,Y=B.value;try{if(!lo(x(),Y))return!1}catch{return!1}}}}var z=s.child;if(s.subtreeFlags&Lb&&z!==null){z.return=s,s=z;continue}if(s===i)return!0;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}return!0}function Td(i,s){s=HC(s,MZ),s=HC(s,jy),bf(i,s)}function kX(i){if(Gn(),(ni&(qs|Fl))!==Is)throw new Error("Should not already be working.");tI();var s=TI(i,It);if(!Hs(s,wn))return pr(i,Ua()),null;var u=LZ(i,s);if(i.tag!==fg&&u===qh){var h=pf(i);h!==It&&(s=h,u=hx(i,h))}if(u===Oy){var p=Qy;throw eA(i,It),Td(i,s),pr(i,Ua()),p}if(u===rx)throw new Error("Root did not complete. This is a bug in React.");var B=i.current.alternate;return i.finishedWork=B,i.finishedLanes=s,tA(i,fr,$u),pr(i,Ua()),null}function CL(i,s){s!==It&&(_I(i,Fn(s,wn)),pr(i,Ua()),(ni&(qs|Fl))===Is&&($y(),yc()))}function Ax(i,s){var u=ni;ni|=HX;try{return i(s)}finally{ni=u,ni===Is&&!wg.isBatchingLegacy&&($y(),jB())}}function hL(i,s,u,h,p){var B=so(),x=js.transition;try{return js.transition=null,ya(Fs),i(s,u,h,p)}finally{ya(B),js.transition=x,ni===Is&&$y()}}function eI(i){Kd!==null&&Kd.tag===fg&&(ni&(qs|Fl))===Is&&tI();var s=ni;ni|=HX;var u=js.transition,h=so();try{return js.transition=null,ya(Fs),i?i():void 0}finally{ya(h),js.transition=u,ni=s,(ni&(qs|Fl))===Is&&yc()}}function UX(){return(ni&(qs|Fl))!==Is}function zZ(i,s){Ss(lx,Vc,i),Vc=Fn(Vc,s)}function fx(i){Vc=lx.current,Zs(lx,i)}function eA(i,s){i.finishedWork=null,i.finishedLanes=It;var u=i.timeoutHandle;if(u!==gd&&(i.timeoutHandle=gd,dp(u)),fa!==null)for(var h=fa.return;h!==null;){var p=h.alternate;bX(p,h),h=h.return}Ho=i;var B=nA(i.current,null);return fa=B,ds=Vc=s,Cs=qu,Qy=null,YZ=It,jy=It,MZ=It,qy=null,fr=null,aZ(),ur.discardPendingWarnings(),B}function DX(i,s){do{var u=fa;try{if(Lu(),CZ(),za(),ox.current=null,u===null||u.return===null){Cs=Oy,Qy=s,fa=null;return}if(Ee&&u.mode&pi&&Ve(u,!0),de)if(ia(),s!==null&&typeof s=="object"&&typeof s.then=="function"){var h=s;mw(u,h,ds)}else pw(u,s,ds);ET(i,u.return,u,s,ds),QX(u)}catch(p){s=p,fa===u&&u!==null?(u=u.return,fa=u):u=fa;continue}return}while(!0)}function JX(){var i=sx.current;return sx.current=cm,i===null?cm:i}function OX(i){sx.current=i}function AL(){gx=Ua()}function i0(i){YZ=Fn(i,YZ)}function fL(){Cs===qu&&(Cs=XZ)}function px(){(Cs===qu||Cs===XZ||Cs===qh)&&(Cs=Py),Ho!==null&&(MC(YZ)||MC(jy))&&Td(Ho,ds)}function pL(i){Cs!==Py&&(Cs=qh),qy===null?qy=[i]:qy.push(i)}function mL(){return Cs===qu}function LZ(i,s){var u=ni;ni|=qs;var h=JX();if(Ho!==i||ds!==s){if(Lr){var p=i.memoizedUpdaters;p.size>0&&(a0(i,ds),p.clear()),iv(i,s)}$u=yf(),eA(i,s)}FG(s);do try{bL();break}catch(B){DX(i,B)}while(!0);if(Lu(),ni=u,OX(h),fa!==null)throw new Error("Cannot commit an incomplete root. This error is likely caused by a bug in React. Please file an issue.");return KG(),Ho=null,ds=It,Cs}function bL(){for(;fa!==null;)PX(fa)}function vL(i,s){var u=ni;ni|=qs;var h=JX();if(Ho!==i||ds!==s){if(Lr){var p=i.memoizedUpdaters;p.size>0&&(a0(i,ds),p.clear()),iv(i,s)}$u=yf(),$y(),eA(i,s)}FG(s);do try{yL();break}catch(B){DX(i,B)}while(!0);return Lu(),OX(h),ni=u,fa!==null?(yw(),qu):(KG(),Ho=null,ds=It,Cs)}function yL(){for(;fa!==null&&!ka();)PX(fa)}function PX(i){var s=i.alternate;Oi(i);var u;(i.mode&pi)!==pn?(Me(i),u=mx(s,i,Vc),Ve(i,!0)):u=mx(s,i,Vc),za(),i.memoizedProps=i.pendingProps,u===null?QX(i):fa=u,ox.current=null}function QX(i){var s=i;do{var u=s.alternate,h=s.return;if((s.flags&lf)===fn){Oi(s);var p=void 0;if((s.mode&pi)===pn?p=mX(u,s,Vc):(Me(s),p=mX(u,s,Vc),Ve(s,!1)),za(),p!==null){fa=p;return}}else{var B=fz(u,s);if(B!==null){B.flags&=WG,fa=B;return}if((s.mode&pi)!==pn){Ve(s,!1);for(var x=s.actualDuration,Y=s.child;Y!==null;)x+=Y.actualDuration,Y=Y.sibling;s.actualDuration=x}if(h!==null)h.flags|=lf,h.subtreeFlags=fn,h.deletions=null;else{Cs=rx,fa=null;return}}var z=s.sibling;if(z!==null){fa=z;return}s=h,fa=s}while(s!==null);Cs===qu&&(Cs=FX)}function tA(i,s,u){var h=so(),p=js.transition;try{js.transition=null,ya(Fs),GL(i,s,u,h)}finally{js.transition=p,ya(h)}return null}function GL(i,s,u,h){do tI();while(Kd!==null);if(YL(),(ni&(qs|Fl))!==Is)throw new Error("Should not already be working.");var p=i.finishedWork,B=i.finishedLanes;if(Cw(B),p===null)return VG(),null;if(B===It&&c("root.finishedLanes should not be empty during a commit. This is a bug in React."),i.finishedWork=null,i.finishedLanes=It,p===i.current)throw new Error("Cannot commit the same tree as before. This error is likely caused by a bug in React. Please file an issue.");i.callbackNode=null,i.callbackPriority=xa;var x=Fn(p.lanes,p.childLanes);UG(i,x),i===Ho&&(Ho=null,fa=null,ds=It),((p.subtreeFlags&NI)!==fn||(p.flags&NI)!==fn)&&($h||($h=!0,Ix=u,yx(jg,function(){return tI(),null})));var Y=(p.subtreeFlags&(VI|gf|cf|NI))!==fn,z=(p.flags&(VI|gf|cf|NI))!==fn;if(Y||z){var J=js.transition;js.transition=null;var j=so();ya(Fs);var pe=ni;ni|=Fl,ox.current=null,yz(i,p),Ti(),Hz(i,p,B),ZB(i.containerInfo),i.current=p,bw(B),Fz(p,i,B),vw(),rw(),ni=pe,ya(j),js.transition=J}else i.current=p,Ti();var fe=$h;if($h?($h=!1,Kd=i,e0=B):(fm=0,KZ=null),x=i.pendingLanes,x===It&&(Am=null),fe||eY(i.current,!1),bs(p.stateNode,h),Lr&&i.memoizedUpdaters.clear(),nL(),pr(i,Ua()),s!==null)for(var He=i.onRecoverableError,ze=0;ze<s.length;ze++){var je=s[ze],Jt=je.stack,bn=je.digest;He(je.value,{componentStack:Jt,digest:bn})}if(HZ){HZ=!1;var gn=cx;throw cx=null,gn}return Hs(e0,wn)&&i.tag!==fg&&tI(),x=i.pendingLanes,Hs(x,wn)?(Cn(),i===dx?t0++:(t0=0,dx=i)):t0=0,yc(),VG(),null}function tI(){if(Kd!==null){var i=Gf(e0),s=JG(Ur,i),u=js.transition,h=so();try{return js.transition=null,ya(s),ZL()}finally{ya(h),js.transition=u}}return!1}function BL(i){ux.push(i),$h||($h=!0,yx(jg,function(){return tI(),null}))}function ZL(){if(Kd===null)return!1;var i=Ix;Ix=null;var s=Kd,u=e0;if(Kd=null,e0=It,(ni&(qs|Fl))!==Is)throw new Error("Cannot flush passive effects while already rendering.");Cx=!0,FZ=!1,MG(u);var h=ni;ni|=Fl,kz(s.current),Tz(s,s.current,u,i);{var p=ux;ux=[];for(var B=0;B<p.length;B++){var x=p[B];Sz(s,x)}}HG(),eY(s.current,!0),ni=h,yc(),FZ?s===KZ?fm++:(fm=0,KZ=s):fm=0,Cx=!1,FZ=!1,Pt(s);{var Y=s.current.stateNode;Y.effectDuration=0,Y.passiveEffectDuration=0}return!0}function jX(i){return Am!==null&&Am.has(i)}function SL(i){Am===null?Am=new Set([i]):Am.add(i)}function RL(i){HZ||(HZ=!0,cx=i)}var wL=RL;function qX(i,s,u){var h=Qh(u,s),p=P2(i,h,wn),B=yg(i,p,wn),x=Fo();B!==null&&(KC(B,wn,x),pr(B,x))}function Di(i,s,u){if(mz(u),s0(!1),i.tag===b){qX(i,i,u);return}var h=null;for(h=s;h!==null;){if(h.tag===b){qX(h,i,u);return}else if(h.tag===d){var p=h.type,B=h.stateNode;if(typeof p.getDerivedStateFromError=="function"||typeof B.componentDidCatch=="function"&&!jX(B)){var x=Qh(u,i),Y=EW(h,x,wn),z=yg(h,Y,wn),J=Fo();z!==null&&(KC(z,wn,J),pr(z,J));return}}h=h.return}c(`Internal React error: Attempted to capture a commit phase error inside a detached tree. This indicates a bug in React. Likely causes include deleting the same fiber more than once, committing an already-finished tree, or an inconsistent return pointer.

Error message:

%s`,u)}function WL(i,s,u){var h=i.pingCache;h!==null&&h.delete(s);var p=Fo();kG(i,u),KL(i),Ho===i&&cg(ds,u)&&(Cs===Py||Cs===XZ&&zG(ds)&&Ua()-gx<KX?eA(i,It):MZ=Fn(MZ,u)),pr(i,p)}function $X(i,s){s===xa&&(s=gL(i));var u=Fo(),h=ks(i,s);h!==null&&(KC(h,s,u),pr(h,u))}function xL(i){var s=i.memoizedState,u=xa;s!==null&&(u=s.retryLane),$X(i,u)}function VL(i,s){var u=xa,h;switch(i.tag){case H:h=i.stateNode;var p=i.memoizedState;p!==null&&(u=p.retryLane);break;case ee:h=i.stateNode;break;default:throw new Error("Pinged unknown suspense boundary type. This is probably a bug in React.")}h!==null&&h.delete(s),$X(i,u)}function NL(i){return i<120?120:i<480?480:i<1080?1080:i<1920?1920:i<3e3?3e3:i<4320?4320:sL(i/1960)*1960}function XL(){if(t0>rL)throw t0=0,dx=null,new Error("Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.");fm>lL&&(fm=0,KZ=null,c("Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render."))}function YL(){ur.flushLegacyContextWarning(),ur.flushPendingUnsafeLifecycleWarnings()}function eY(i,s){Oi(i),_Z(i,Wo,$z),s&&_Z(i,Kn,eL),_Z(i,Wo,jz),s&&_Z(i,Kn,qz),za()}function _Z(i,s,u){for(var h=i,p=null;h!==null;){var B=h.subtreeFlags&s;h!==p&&h.child!==null&&B!==fn?h=h.child:((h.flags&s)!==fn&&u(h),h.sibling!==null?h=h.sibling:h=p=h.return)}}var kZ=null;function tY(i){{if((ni&qs)!==Is||!(i.mode&jn))return;var s=i.tag;if(s!==f&&s!==b&&s!==d&&s!==C&&s!==w&&s!==F&&s!==_)return;var u=Xn(i)||"ReactComponent";if(kZ!==null){if(kZ.has(u))return;kZ.add(u)}else kZ=new Set([u]);var h=Vs;try{Oi(i),c("Can't perform a React state update on a component that hasn't mounted yet. This indicates that you have a side-effect in your render function that asynchronously later calls tries to update the component. Move this work to useEffect instead.")}finally{h?Oi(i):za()}}}var mx;{var ML=null;mx=function(i,s,u){var h=gY(ML,s);try{return CX(i,s,u)}catch(B){if($B()||B!==null&&typeof B=="object"&&typeof B.then=="function")throw B;if(Lu(),CZ(),bX(i,s),gY(s,h),s.mode&pi&&Me(s),rf(null,CX,null,i,s,u),SC()){var p=ql();typeof p=="object"&&p!==null&&p._suppressLogging&&typeof B=="object"&&B!==null&&!B._suppressLogging&&(B._suppressLogging=!0)}throw B}}}var nY=!1,bx;bx=new Set;function HL(i){if(Jc&&!mZ())switch(i.tag){case C:case w:case _:{var s=fa&&Xn(fa)||"Unknown",u=s;if(!bx.has(u)){bx.add(u);var h=Xn(i)||"Unknown";c("Cannot update a component (`%s`) while rendering a different component (`%s`). To locate the bad setState() call inside `%s`, follow the stack trace as described in https://reactjs.org/link/setstate-in-render",h,s,s)}break}case d:{nY||(c("Cannot update during an existing state transition (such as within `render`). Render methods should be a pure function of props and state."),nY=!0);break}}}function a0(i,s){if(Lr){var u=i.memoizedUpdaters;u.forEach(function(h){vf(i,h,s)})}}var vx={};function yx(i,s){{var u=wg.current;return u!==null?(u.push(s),vx):YI(i,s)}}function iY(i){if(i!==vx)return Tr(i)}function aY(){return wg.current!==null}function FL(i){{if(i.mode&jn){if(!MX())return}else if(!aL()||ni!==Is||i.tag!==C&&i.tag!==w&&i.tag!==_)return;if(wg.current===null){var s=Vs;try{Oi(i),c(`An update to %s inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act`,Xn(i))}finally{s?Oi(i):za()}}}}function KL(i){i.tag!==fg&&MX()&&wg.current===null&&c(`A suspended resource finished loading inside a test, but the event was not wrapped in act(...).

When testing, code that resolves suspended data should be wrapped into act(...):

act(() => {
  /* finish loading suspended data */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act`)}function s0(i){zX=i}var Kl=null,pm=null,EL=function(i){Kl=i};function mm(i){{if(Kl===null)return i;var s=Kl(i);return s===void 0?i:s.current}}function Gx(i){return mm(i)}function Bx(i){{if(Kl===null)return i;var s=Kl(i);if(s===void 0){if(i!=null&&typeof i.render=="function"){var u=mm(i.render);if(i.render!==u){var h={$$typeof:Ye,render:u};return i.displayName!==void 0&&(h.displayName=i.displayName),h}}return i}return s.current}}function sY(i,s){{if(Kl===null)return!1;var u=i.elementType,h=s.type,p=!1,B=typeof h=="object"&&h!==null?h.$$typeof:null;switch(i.tag){case d:{typeof h=="function"&&(p=!0);break}case C:{(typeof h=="function"||B===xt)&&(p=!0);break}case w:{(B===Ye||B===xt)&&(p=!0);break}case F:case _:{(B===_t||B===xt)&&(p=!0);break}default:return!1}if(p){var x=Kl(u);if(x!==void 0&&x===Kl(h))return!0}return!1}}function oY(i){{if(Kl===null||typeof WeakSet!="function")return;pm===null&&(pm=new WeakSet),pm.add(i)}}var TL=function(i,s){{if(Kl===null)return;var u=s.staleFamilies,h=s.updatedFamilies;tI(),eI(function(){Zx(i.current,h,u)})}},zL=function(i,s){{if(i.context!==Io)return;tI(),eI(function(){o0(s,i,null,null)})}};function Zx(i,s,u){{var h=i.alternate,p=i.child,B=i.sibling,x=i.tag,Y=i.type,z=null;switch(x){case C:case _:case d:z=Y;break;case w:z=Y.render;break}if(Kl===null)throw new Error("Expected resolveFamily to be set during hot reload.");var J=!1,j=!1;if(z!==null){var pe=Kl(z);pe!==void 0&&(u.has(pe)?j=!0:s.has(pe)&&(x===d?j=!0:J=!0))}if(pm!==null&&(pm.has(i)||h!==null&&pm.has(h))&&(j=!0),j&&(i._debugNeedsRemount=!0),j||J){var fe=ks(i,wn);fe!==null&&hs(fe,i,wn,Bi)}p!==null&&!j&&Zx(p,s,u),B!==null&&Zx(B,s,u)}}var LL=function(i,s){{var u=new Set,h=new Set(s.map(function(p){return p.current}));return Sx(i.current,h,u),u}};function Sx(i,s,u){{var h=i.child,p=i.sibling,B=i.tag,x=i.type,Y=null;switch(B){case C:case _:case d:Y=x;break;case w:Y=x.render;break}var z=!1;Y!==null&&s.has(Y)&&(z=!0),z?_L(i,u):h!==null&&Sx(h,s,u),p!==null&&Sx(p,s,u)}}function _L(i,s){{var u=kL(i,s);if(u)return;for(var h=i;;){switch(h.tag){case y:s.add(h.stateNode);return;case v:s.add(h.stateNode.containerInfo);return;case b:s.add(h.stateNode.containerInfo);return}if(h.return===null)throw new Error("Expected to reach root first.");h=h.return}}}function kL(i,s){for(var u=i,h=!1;;){if(u.tag===y)h=!0,s.add(u.stateNode);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===i)return h;for(;u.sibling===null;){if(u.return===null||u.return===i)return h;u=u.return}u.sibling.return=u.return,u=u.sibling}return!1}var Rx;{Rx=!1;try{var rY=Object.preventExtensions({})}catch{Rx=!0}}function UL(i,s,u,h){this.tag=i,this.key=u,this.elementType=null,this.type=null,this.stateNode=null,this.return=null,this.child=null,this.sibling=null,this.index=0,this.ref=null,this.pendingProps=s,this.memoizedProps=null,this.updateQueue=null,this.memoizedState=null,this.dependencies=null,this.mode=h,this.flags=fn,this.subtreeFlags=fn,this.deletions=null,this.lanes=It,this.childLanes=It,this.alternate=null,this.actualDuration=Number.NaN,this.actualStartTime=Number.NaN,this.selfBaseDuration=Number.NaN,this.treeBaseDuration=Number.NaN,this.actualDuration=0,this.actualStartTime=-1,this.selfBaseDuration=0,this.treeBaseDuration=0,this._debugSource=null,this._debugOwner=null,this._debugNeedsRemount=!1,this._debugHookTypes=null,!Rx&&typeof Object.preventExtensions=="function"&&Object.preventExtensions(this)}var qr=function(i,s,u,h){return new UL(i,s,u,h)};function wx(i){var s=i.prototype;return!!(s&&s.isReactComponent)}function DL(i){return typeof i=="function"&&!wx(i)&&i.defaultProps===void 0}function JL(i){if(typeof i=="function")return wx(i)?d:C;if(i!=null){var s=i.$$typeof;if(s===Ye)return w;if(s===_t)return F}return f}function nA(i,s){var u=i.alternate;u===null?(u=qr(i.tag,s,i.key,i.mode),u.elementType=i.elementType,u.type=i.type,u.stateNode=i.stateNode,u._debugSource=i._debugSource,u._debugOwner=i._debugOwner,u._debugHookTypes=i._debugHookTypes,u.alternate=i,i.alternate=u):(u.pendingProps=s,u.type=i.type,u.flags=fn,u.subtreeFlags=fn,u.deletions=null,u.actualDuration=0,u.actualStartTime=-1),u.flags=i.flags&Kr,u.childLanes=i.childLanes,u.lanes=i.lanes,u.child=i.child,u.memoizedProps=i.memoizedProps,u.memoizedState=i.memoizedState,u.updateQueue=i.updateQueue;var h=i.dependencies;switch(u.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},u.sibling=i.sibling,u.index=i.index,u.ref=i.ref,u.selfBaseDuration=i.selfBaseDuration,u.treeBaseDuration=i.treeBaseDuration,u._debugNeedsRemount=i._debugNeedsRemount,u.tag){case f:case C:case _:u.type=mm(i.type);break;case d:u.type=Gx(i.type);break;case w:u.type=Bx(i.type);break}return u}function OL(i,s){i.flags&=Kr|ji;var u=i.alternate;if(u===null)i.childLanes=It,i.lanes=s,i.child=null,i.subtreeFlags=fn,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null,i.selfBaseDuration=0,i.treeBaseDuration=0;else{i.childLanes=u.childLanes,i.lanes=u.lanes,i.child=u.child,i.subtreeFlags=fn,i.deletions=null,i.memoizedProps=u.memoizedProps,i.memoizedState=u.memoizedState,i.updateQueue=u.updateQueue,i.type=u.type;var h=u.dependencies;i.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},i.selfBaseDuration=u.selfBaseDuration,i.treeBaseDuration=u.treeBaseDuration}return i}function PL(i,s,u){var h;return i===Cd?(h=jn,s===!0&&(h|=ca,h|=dl)):h=pn,Lr&&(h|=pi),qr(b,null,null,h)}function Wx(i,s,u,h,p,B){var x=f,Y=i;if(typeof i=="function")wx(i)?(x=d,Y=Gx(Y)):Y=mm(Y);else if(typeof i=="string")x=y;else e:switch(i){case is:return zd(u.children,p,B,s);case Rr:x=R,p|=ca,(p&jn)!==pn&&(p|=dl);break;case re:return QL(u,p,B,s);case ct:return jL(u,p,B,s);case ft:return qL(u,p,B,s);case Ge:return lY(u,p,B,s);case Se:case D:case Ze:case bt:case ge:default:{if(typeof i=="object"&&i!==null)switch(i.$$typeof){case ot:x=N;break e;case Q:x=S;break e;case Ye:x=w,Y=Bx(Y);break e;case _t:x=F;break e;case xt:x=P,Y=null;break e}var z="";{(i===void 0||typeof i=="object"&&i!==null&&Object.keys(i).length===0)&&(z+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var J=h?Xn(h):null;J&&(z+=`

Check the render method of \``+J+"`.")}throw new Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) "+("but got: "+(i==null?i:typeof i)+"."+z))}}var j=qr(x,u,s,p);return j.elementType=i,j.type=Y,j.lanes=B,j._debugOwner=h,j}function xx(i,s,u){var h=null;h=i._owner;var p=i.type,B=i.key,x=i.props,Y=Wx(p,B,x,h,s,u);return Y._debugSource=i._source,Y._debugOwner=i._owner,Y}function zd(i,s,u,h){var p=qr(V,i,h,s);return p.lanes=u,p}function QL(i,s,u,h){typeof i.id!="string"&&c('Profiler must specify an "id" of type `string` as a prop. Received the type `%s` instead.',typeof i.id);var p=qr(X,i,h,s|pi);return p.elementType=re,p.lanes=u,p.stateNode={effectDuration:0,passiveEffectDuration:0},p}function jL(i,s,u,h){var p=qr(H,i,h,s);return p.elementType=ct,p.lanes=u,p}function qL(i,s,u,h){var p=qr(ee,i,h,s);return p.elementType=ft,p.lanes=u,p}function lY(i,s,u,h){var p=qr(be,i,h,s);p.elementType=Ge,p.lanes=u;var B={isHidden:!1};return p.stateNode=B,p}function Vx(i,s,u){var h=qr(Z,i,null,s);return h.lanes=u,h}function $L(){var i=qr(y,null,null,pn);return i.elementType="DELETED",i}function e9(i){var s=qr(E,null,null,pn);return s.stateNode=i,s}function Nx(i,s,u){var h=i.children!==null?i.children:[],p=qr(v,h,i.key,s);return p.lanes=u,p.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},p}function gY(i,s){return i===null&&(i=qr(f,null,null,pn)),i.tag=s.tag,i.key=s.key,i.elementType=s.elementType,i.type=s.type,i.stateNode=s.stateNode,i.return=s.return,i.child=s.child,i.sibling=s.sibling,i.index=s.index,i.ref=s.ref,i.pendingProps=s.pendingProps,i.memoizedProps=s.memoizedProps,i.updateQueue=s.updateQueue,i.memoizedState=s.memoizedState,i.dependencies=s.dependencies,i.mode=s.mode,i.flags=s.flags,i.subtreeFlags=s.subtreeFlags,i.deletions=s.deletions,i.lanes=s.lanes,i.childLanes=s.childLanes,i.alternate=s.alternate,i.actualDuration=s.actualDuration,i.actualStartTime=s.actualStartTime,i.selfBaseDuration=s.selfBaseDuration,i.treeBaseDuration=s.treeBaseDuration,i._debugSource=s._debugSource,i._debugOwner=s._debugOwner,i._debugNeedsRemount=s._debugNeedsRemount,i._debugHookTypes=s._debugHookTypes,i}function t9(i,s,u,h,p){this.tag=s,this.containerInfo=i,this.pendingChildren=null,this.current=null,this.pingCache=null,this.finishedWork=null,this.timeoutHandle=gd,this.context=null,this.pendingContext=null,this.callbackNode=null,this.callbackPriority=xa,this.eventTimes=FC(It),this.expirationTimes=FC(Bi),this.pendingLanes=It,this.suspendedLanes=It,this.pingedLanes=It,this.expiredLanes=It,this.mutableReadLanes=It,this.finishedLanes=It,this.entangledLanes=It,this.entanglements=FC(It),this.identifierPrefix=h,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null,this.effectDuration=0,this.passiveEffectDuration=0;{this.memoizedUpdaters=new Set;for(var B=this.pendingUpdatersLaneMap=[],x=0;x<XC;x++)B.push(new Set)}switch(s){case Cd:this._debugRootType=u?"hydrateRoot()":"createRoot()";break;case fg:this._debugRootType=u?"hydrate()":"render()";break}}function cY(i,s,u,h,p,B,x,Y,z,J){var j=new t9(i,s,u,Y,z),pe=PL(s,B);j.current=pe,pe.stateNode=j;{var fe={element:h,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null};pe.memoizedState=fe}return vg(pe),j}var Xx="18.3.1";function n9(i,s,u){var h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return Et(h),{$$typeof:ci,key:h==null?null:""+h,children:i,containerInfo:s,implementation:u}}var Yx,Mx;Yx=!1,Mx={};function uY(i){if(!i)return Io;var s=_a(i),u=bW(s);if(s.tag===d){var h=s.type;if(Sl(h))return PB(s,h,u)}return u}function i9(i,s){{var u=_a(i);if(u===void 0){if(typeof i.render=="function")throw new Error("Unable to find node on an unmounted component.");var h=Object.keys(i).join(",");throw new Error("Argument appears to not be a ReactComponent. Keys: "+h)}var p=Er(u);if(p===null)return null;if(p.mode&ca){var B=Xn(u)||"Component";if(!Mx[B]){Mx[B]=!0;var x=Vs;try{Oi(p),u.mode&ca?c("%s is deprecated in StrictMode. %s was passed an instance of %s which is inside StrictMode. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",s,s,B):c("%s is deprecated in StrictMode. %s was passed an instance of %s which renders StrictMode children. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",s,s,B)}finally{x?Oi(x):za()}}}return p.stateNode}}function IY(i,s,u,h,p,B,x,Y){var z=!1,J=null;return cY(i,s,z,J,u,h,p,B,x)}function dY(i,s,u,h,p,B,x,Y,z,J){var j=!0,pe=cY(u,h,j,i,p,B,x,Y,z);pe.context=uY(null);var fe=pe.current,He=Fo(),ze=Ed(fe),je=Vl(He,ze);return je.callback=s??null,yg(fe,je,ze),cL(pe,ze,He),pe}function o0(i,s,u,h){MI(s,i);var p=s.current,B=Fo(),x=Ed(p);Gw(x);var Y=uY(u);s.context===null?s.context=Y:s.pendingContext=Y,Jc&&Vs!==null&&!Yx&&(Yx=!0,c(`Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate.

Check the render method of %s.`,Xn(Vs)||"Unknown"));var z=Vl(B,x);z.payload={element:i},h=h===void 0?null:h,h!==null&&(typeof h!="function"&&c("render(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",h),z.callback=h);var J=yg(p,z,x);return J!==null&&(hs(J,p,x,B),_p(J,p,x)),x}function UZ(i){var s=i.current;if(!s.child)return null;switch(s.child.tag){case y:return s.child.stateNode;default:return s.child.stateNode}}function a9(i){switch(i.tag){case b:{var s=i.stateNode;if(TC(s)){var u=TG(s);CL(s,u)}break}case H:{eI(function(){var p=ks(i,wn);if(p!==null){var B=Fo();hs(p,i,wn,B)}});var h=wn;Hx(i,h);break}}}function CY(i,s){var u=i.memoizedState;u!==null&&u.dehydrated!==null&&(u.retryLane=mf(u.retryLane,s))}function Hx(i,s){CY(i,s);var u=i.alternate;u&&CY(u,s)}function s9(i){if(i.tag===H){var s=EI,u=ks(i,s);if(u!==null){var h=Fo();hs(u,i,s,h)}Hx(i,s)}}function o9(i){if(i.tag===H){var s=Ed(i),u=ks(i,s);if(u!==null){var h=Fo();hs(u,i,s,h)}Hx(i,s)}}function hY(i){var s=WC(i);return s===null?null:s.stateNode}var AY=function(i){return null};function r9(i){return AY(i)}var fY=function(i){return!1};function l9(i){return fY(i)}var pY=null,mY=null,bY=null,vY=null,yY=null,GY=null,BY=null,ZY=null,SY=null;{var RY=function(i,s,u){var h=s[u],p=Ln(i)?i.slice():Mt({},i);return u+1===s.length?(Ln(p)?p.splice(h,1):delete p[h],p):(p[h]=RY(i[h],s,u+1),p)},wY=function(i,s){return RY(i,s,0)},WY=function(i,s,u,h){var p=s[h],B=Ln(i)?i.slice():Mt({},i);if(h+1===s.length){var x=u[h];B[x]=B[p],Ln(B)?B.splice(p,1):delete B[p]}else B[p]=WY(i[p],s,u,h+1);return B},xY=function(i,s,u){if(s.length!==u.length){o("copyWithRename() expects paths of the same length");return}else for(var h=0;h<u.length-1;h++)if(s[h]!==u[h]){o("copyWithRename() expects paths to be the same except for the deepest key");return}return WY(i,s,u,0)},VY=function(i,s,u,h){if(u>=s.length)return h;var p=s[u],B=Ln(i)?i.slice():Mt({},i);return B[p]=VY(i[p],s,u+1,h),B},NY=function(i,s,u){return VY(i,s,0,u)},Fx=function(i,s){for(var u=i.memoizedState;u!==null&&s>0;)u=u.next,s--;return u};pY=function(i,s,u,h){var p=Fx(i,s);if(p!==null){var B=NY(p.memoizedState,u,h);p.memoizedState=B,p.baseState=B,i.memoizedProps=Mt({},i.memoizedProps);var x=ks(i,wn);x!==null&&hs(x,i,wn,Bi)}},mY=function(i,s,u){var h=Fx(i,s);if(h!==null){var p=wY(h.memoizedState,u);h.memoizedState=p,h.baseState=p,i.memoizedProps=Mt({},i.memoizedProps);var B=ks(i,wn);B!==null&&hs(B,i,wn,Bi)}},bY=function(i,s,u,h){var p=Fx(i,s);if(p!==null){var B=xY(p.memoizedState,u,h);p.memoizedState=B,p.baseState=B,i.memoizedProps=Mt({},i.memoizedProps);var x=ks(i,wn);x!==null&&hs(x,i,wn,Bi)}},vY=function(i,s,u){i.pendingProps=NY(i.memoizedProps,s,u),i.alternate&&(i.alternate.pendingProps=i.pendingProps);var h=ks(i,wn);h!==null&&hs(h,i,wn,Bi)},yY=function(i,s){i.pendingProps=wY(i.memoizedProps,s),i.alternate&&(i.alternate.pendingProps=i.pendingProps);var u=ks(i,wn);u!==null&&hs(u,i,wn,Bi)},GY=function(i,s,u){i.pendingProps=xY(i.memoizedProps,s,u),i.alternate&&(i.alternate.pendingProps=i.pendingProps);var h=ks(i,wn);h!==null&&hs(h,i,wn,Bi)},BY=function(i){var s=ks(i,wn);s!==null&&hs(s,i,wn,Bi)},ZY=function(i){AY=i},SY=function(i){fY=i}}function g9(i){var s=Er(i);return s===null?null:s.stateNode}function c9(i){return null}function u9(){return Vs}function I9(i){var s=i.findFiberByHostInstance,u=t.ReactCurrentDispatcher;return uw({bundleType:i.bundleType,version:i.version,rendererPackageName:i.rendererPackageName,rendererConfig:i.rendererConfig,overrideHookState:pY,overrideHookStateDeletePath:mY,overrideHookStateRenamePath:bY,overrideProps:vY,overridePropsDeletePath:yY,overridePropsRenamePath:GY,setErrorHandler:ZY,setSuspenseHandler:SY,scheduleUpdate:BY,currentDispatcherRef:u,findHostInstanceByFiber:g9,findFiberByHostInstance:s||c9,findHostInstancesForRefresh:LL,scheduleRefresh:TL,scheduleRoot:zL,setRefreshHandler:EL,getCurrentFiber:u9,reconcilerVersion:Xx})}var XY=typeof reportError=="function"?reportError:function(i){console.error(i)};function Kx(i){this._internalRoot=i}DZ.prototype.render=Kx.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw new Error("Cannot update an unmounted root.");{typeof arguments[1]=="function"?c("render(...): does not support the second callback argument. To execute a side effect after rendering, declare it in a component body with useEffect()."):JZ(arguments[1])?c("You passed a container to the second argument of root.render(...). You don't need to pass it again since you already passed it to create the root."):typeof arguments[1]<"u"&&c("You passed a second argument to root.render(...) but it only accepts one argument.");var u=s.containerInfo;if(u.nodeType!==Qi){var h=hY(s.current);h&&h.parentNode!==u&&c("render(...): It looks like the React-rendered content of the root container was removed without using React. This is not supported and will cause errors. Instead, call root.unmount() to empty a root's container.")}}o0(i,s,null,null)},DZ.prototype.unmount=Kx.prototype.unmount=function(){typeof arguments[0]=="function"&&c("unmount(...): does not support a callback argument. To execute a side effect after rendering, declare it in a component body with useEffect().");var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;UX()&&c("Attempted to synchronously unmount a root while React was already rendering. React cannot finish unmounting the root until the current render has completed, which may lead to a race condition."),eI(function(){o0(null,i,null,null)}),UB(s)}};function d9(i,s){if(!JZ(i))throw new Error("createRoot(...): Target container is not a DOM element.");YY(i);var u=!1,h=!1,p="",B=XY;s!=null&&(s.hydrate?o("hydrate through createRoot is deprecated. Use ReactDOMClient.hydrateRoot(container, <App />) instead."):typeof s=="object"&&s!==null&&s.$$typeof===fi&&c(`You passed a JSX element to createRoot. You probably meant to call root.render instead. Example usage:

  let root = createRoot(domContainer);
  root.render(<App />);`),s.unstable_strictMode===!0&&(u=!0),s.identifierPrefix!==void 0&&(p=s.identifierPrefix),s.onRecoverableError!==void 0&&(B=s.onRecoverableError),s.transitionCallbacks!==void 0&&s.transitionCallbacks);var x=IY(i,Cd,null,u,h,p,B);yp(x.current,i);var Y=i.nodeType===Qi?i.parentNode:i;return Cc(Y),new Kx(x)}function DZ(i){this._internalRoot=i}function C9(i){i&&xw(i)}DZ.prototype.unstable_scheduleHydration=C9;function h9(i,s,u){if(!JZ(i))throw new Error("hydrateRoot(...): Target container is not a DOM element.");YY(i),s===void 0&&c("Must provide initial children as second argument to hydrateRoot. Example usage: hydrateRoot(domContainer, <App />)");var h=u??null,p=u!=null&&u.hydratedSources||null,B=!1,x=!1,Y="",z=XY;u!=null&&(u.unstable_strictMode===!0&&(B=!0),u.identifierPrefix!==void 0&&(Y=u.identifierPrefix),u.onRecoverableError!==void 0&&(z=u.onRecoverableError));var J=dY(s,null,i,Cd,h,B,x,Y,z);if(yp(J.current,i),Cc(i),p)for(var j=0;j<p.length;j++){var pe=p[j];Fh(J,pe)}return new DZ(J)}function JZ(i){return!!(i&&(i.nodeType===io||i.nodeType===rl||i.nodeType===LA))}function r0(i){return!!(i&&(i.nodeType===io||i.nodeType===rl||i.nodeType===LA||i.nodeType===Qi&&i.nodeValue===" react-mount-point-unstable "))}function YY(i){i.nodeType===io&&i.tagName&&i.tagName.toUpperCase()==="BODY"&&c("createRoot(): Creating roots directly with document.body is discouraged, since its children are often manipulated by third-party scripts and browser extensions. This may lead to subtle reconciliation issues. Try using a container element created for your app."),Gh(i)&&(i._reactRootContainer?c("You are calling ReactDOMClient.createRoot() on a container that was previously passed to ReactDOM.render(). This is not supported."):c("You are calling ReactDOMClient.createRoot() on a container that has already been passed to createRoot() before. Instead, call root.render() on the existing root instead if you want to update it."))}var A9=t.ReactCurrentOwner,MY;MY=function(i){if(i._reactRootContainer&&i.nodeType!==Qi){var s=hY(i._reactRootContainer.current);s&&s.parentNode!==i&&c("render(...): It looks like the React-rendered content of this container was removed without using React. This is not supported and will cause errors. Instead, call ReactDOM.unmountComponentAtNode to empty a container.")}var u=!!i._reactRootContainer,h=Ex(i),p=!!(h&&da(h));p&&!u&&c("render(...): Replacing React-rendered children with a new root component. If you intended to update the children of this node, you should instead have the existing children update their state and render the new components instead of calling ReactDOM.render."),i.nodeType===io&&i.tagName&&i.tagName.toUpperCase()==="BODY"&&c("render(): Rendering components directly into document.body is discouraged, since its children are often manipulated by third-party scripts and browser extensions. This may lead to subtle reconciliation issues. Try rendering into a container element created for your app.")};function Ex(i){return i?i.nodeType===rl?i.documentElement:i.firstChild:null}function HY(){}function f9(i,s,u,h,p){if(p){if(typeof h=="function"){var B=h;h=function(){var fe=UZ(x);B.call(fe)}}var x=dY(s,h,i,fg,null,!1,!1,"",HY);i._reactRootContainer=x,yp(x.current,i);var Y=i.nodeType===Qi?i.parentNode:i;return Cc(Y),eI(),x}else{for(var z;z=i.lastChild;)i.removeChild(z);if(typeof h=="function"){var J=h;h=function(){var fe=UZ(j);J.call(fe)}}var j=IY(i,fg,null,!1,!1,"",HY);i._reactRootContainer=j,yp(j.current,i);var pe=i.nodeType===Qi?i.parentNode:i;return Cc(pe),eI(function(){o0(s,j,u,h)}),j}}function p9(i,s){i!==null&&typeof i!="function"&&c("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",s,i)}function OZ(i,s,u,h,p){MY(u),p9(p===void 0?null:p,"render");var B=u._reactRootContainer,x;if(!B)x=f9(u,s,i,p,h);else{if(x=B,typeof p=="function"){var Y=p;p=function(){var z=UZ(x);Y.call(z)}}o0(s,x,i,p)}return UZ(x)}var FY=!1;function m9(i){{FY||(FY=!0,c("findDOMNode is deprecated and will be removed in the next major release. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node"));var s=A9.current;if(s!==null&&s.stateNode!==null){var u=s.stateNode._warnedAboutRefsInRender;u||c("%s is accessing findDOMNode inside its render(). render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",Mn(s.type)||"A component"),s.stateNode._warnedAboutRefsInRender=!0}}return i==null?null:i.nodeType===io?i:i9(i,"findDOMNode")}function b9(i,s,u){if(c("ReactDOM.hydrate is no longer supported in React 18. Use hydrateRoot instead. Until you switch to the new API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!r0(s))throw new Error("Target container is not a DOM element.");{var h=Gh(s)&&s._reactRootContainer===void 0;h&&c("You are calling ReactDOM.hydrate() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call hydrateRoot(container, element)?")}return OZ(null,i,s,!0,u)}function v9(i,s,u){if(c("ReactDOM.render is no longer supported in React 18. Use createRoot instead. Until you switch to the new API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!r0(s))throw new Error("Target container is not a DOM element.");{var h=Gh(s)&&s._reactRootContainer===void 0;h&&c("You are calling ReactDOM.render() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call root.render(element)?")}return OZ(null,i,s,!1,u)}function y9(i,s,u,h){if(c("ReactDOM.unstable_renderSubtreeIntoContainer() is no longer supported in React 18. Consider using a portal instead. Until you switch to the createRoot API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!r0(u))throw new Error("Target container is not a DOM element.");if(i==null||!sw(i))throw new Error("parentComponent must be a valid React Component");return OZ(i,s,u,!1,h)}var KY=!1;function G9(i){if(KY||(KY=!0,c("unmountComponentAtNode is deprecated and will be removed in the next major release. Switch to the createRoot API. Learn more: https://reactjs.org/link/switch-to-createroot")),!r0(i))throw new Error("unmountComponentAtNode(...): Target container is not a DOM element.");{var s=Gh(i)&&i._reactRootContainer===void 0;s&&c("You are calling ReactDOM.unmountComponentAtNode() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call root.unmount()?")}if(i._reactRootContainer){{var u=Ex(i),h=u&&!da(u);h&&c("unmountComponentAtNode(): The node you're attempting to unmount was rendered by another copy of React.")}return eI(function(){OZ(null,null,i,!1,function(){i._reactRootContainer=null,UB(i)})}),!0}else{{var p=Ex(i),B=!!(p&&da(p)),x=i.nodeType===io&&r0(i.parentNode)&&!!i.parentNode._reactRootContainer;B&&c("unmountComponentAtNode(): The node you're attempting to unmount was rendered by React and is not a top-level container. %s",x?"You may have accidentally passed in a React root node instead of its container.":"Instead, have the parent component update its state and rerender in order to remove this component.")}return!1}}PG(a9),jG(s9),Rw(o9),DI(so),Zf(av),(typeof Map!="function"||Map.prototype==null||typeof Map.prototype.forEach!="function"||typeof Set!="function"||Set.prototype==null||typeof Set.prototype.clear!="function"||typeof Set.prototype.forEach!="function")&&c("React depends on Map and Set built-in types. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),mC(fh),Kb(Ax,hL,eI);function B9(i,s){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!JZ(s))throw new Error("Target container is not a DOM element.");return n9(i,s,null,u)}function Z9(i,s,u,h){return y9(i,s,u,h)}var Tx={usingClientEntryPoint:!1,Events:[da,uo,Gp,jc,$A,Ax]};function S9(i,s){return Tx.usingClientEntryPoint||c('You are importing createRoot from "react-dom" which is not supported. You should instead import it from "react-dom/client".'),d9(i,s)}function R9(i,s,u){return Tx.usingClientEntryPoint||c('You are importing hydrateRoot from "react-dom" which is not supported. You should instead import it from "react-dom/client".'),h9(i,s,u)}function w9(i){return UX()&&c("flushSync was called from inside a lifecycle method. React cannot flush when React is already rendering. Consider moving this call to a scheduler task or micro task."),eI(i)}var W9=I9({findFiberByHostInstance:Su,bundleType:1,version:Xx,rendererPackageName:"react-dom"});if(!W9&&Ot&&window.top===window.self&&(navigator.userAgent.indexOf("Chrome")>-1&&navigator.userAgent.indexOf("Edge")===-1||navigator.userAgent.indexOf("Firefox")>-1)){var EY=window.location.protocol;/^(https?|file):$/.test(EY)&&console.info("%cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools"+(EY==="file:"?`
You might need to use a local HTTP server (instead of file://): https://reactjs.org/link/react-devtools-faq`:""),"font-weight:bold")}nl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Tx,nl.createPortal=B9,nl.createRoot=S9,nl.findDOMNode=m9,nl.flushSync=w9,nl.hydrate=b9,nl.hydrateRoot=R9,nl.render=v9,nl.unmountComponentAtNode=G9,nl.unstable_batchedUpdates=Ax,nl.unstable_renderSubtreeIntoContainer=Z9,nl.version=Xx,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})();oF.exports=nl;var K9=oF.exports,zx=K9;{var PZ=zx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;LV.createRoot=function(r,e){PZ.usingClientEntryPoint=!0;try{return zx.createRoot(r,e)}finally{PZ.usingClientEntryPoint=!1}},LV.hydrateRoot=function(r,e,t){PZ.usingClientEntryPoint=!0;try{return zx.hydrateRoot(r,e,t)}finally{PZ.usingClientEntryPoint=!1}}}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const vR="160",dA={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},CA={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},gF=0,_V=1,cF=2,E9=3,uF=0,yR=1,W0=2,Yg=3,fI=0,Do=1,il=2,T9=2,AI=0,ZA=1,kV=2,UV=3,DV=4,IF=5,Pd=100,dF=101,CF=102,JV=103,OV=104,hF=200,AF=201,fF=202,pF=203,CR=204,hR=205,mF=206,bF=207,vF=208,yF=209,GF=210,BF=211,ZF=212,SF=213,RF=214,wF=0,WF=1,xF=2,M0=3,VF=4,NF=5,XF=6,YF=7,nG=0,MF=1,HF=2,Fc=0,FF=1,KF=2,EF=3,DN=4,TF=5,zF=6,PV="attached",LF="detached",GR=300,pI=301,tC=302,H0=303,F0=304,lb=306,K0=1e3,Go=1001,E0=1002,Fa=1003,AR=1004,z9=1004,x0=1005,L9=1005,Ka=1006,JN=1007,_9=1007,nC=1008,k9=1008,Kc=1009,_F=1010,kF=1011,BR=1012,ON=1013,II=1014,Fg=1015,nb=1016,PN=1017,QN=1018,Qd=1020,UF=1021,Uo=1023,DF=1024,JF=1025,jd=1026,xA=1027,OF=1028,jN=1029,PF=1030,qN=1031,$N=1033,qS=33776,$S=33777,eR=33778,tR=33779,QV=35840,jV=35841,qV=35842,$V=35843,e2=36196,eN=37492,tN=37496,nN=37808,iN=37809,aN=37810,sN=37811,oN=37812,rN=37813,lN=37814,gN=37815,cN=37816,uN=37817,IN=37818,dN=37819,CN=37820,hN=37821,nR=36492,AN=36494,fN=36495,QF=36283,pN=36284,mN=36285,bN=36286,jF=2200,qF=2201,$F=2202,T0=2300,z0=2301,iR=2302,vA=2400,yA=2401,L0=2402,ZR=2500,t2=2501,U9=0,D9=1,J9=2,n2=3e3,qd=3001,eK=3200,tK=3201,aC=0,nK=1,al="",As="srgb",Tc="srgb-linear",SR="display-p3",iG="display-p3-linear",_0="linear",ta="srgb",k0="rec709",U0="p3",O9=0,hA=7680,P9=7681,Q9=7682,j9=7683,q9=34055,$9=34056,e5=5386,t5=512,n5=513,i5=514,a5=515,s5=516,o5=517,r5=518,vN=519,iK=512,aK=513,sK=514,i2=515,oK=516,rK=517,lK=518,gK=519,D0=35044,cK=35048,l5=35040,g5=35045,c5=35049,u5=35041,I5=35046,d5=35050,C5=35042,h5="100",yN="300 es",fR=1035,Kg=2e3,ib=2001;let bI=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const a=this._listeners[e];if(a!==void 0){const o=a.indexOf(t);o!==-1&&a.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const a=n.slice(0);for(let o=0,c=a.length;o<c;o++)a[o].call(this,e);e.target=null}}};const po=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let TY=1234567;const SA=Math.PI/180,ab=180/Math.PI;function sl(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(po[r&255]+po[r>>8&255]+po[r>>16&255]+po[r>>24&255]+"-"+po[e&255]+po[e>>8&255]+"-"+po[e>>16&15|64]+po[e>>24&255]+"-"+po[t&63|128]+po[t>>8&255]+"-"+po[t>>16&255]+po[t>>24&255]+po[n&255]+po[n>>8&255]+po[n>>16&255]+po[n>>24&255]).toLowerCase()}function Wa(r,e,t){return Math.max(e,Math.min(t,r))}function a2(r,e){return(r%e+e)%e}function A5(r,e,t,n,a){return n+(r-e)*(a-n)/(t-e)}function f5(r,e,t){return r!==e?(t-r)/(e-r):0}function V0(r,e,t){return(1-t)*r+t*e}function p5(r,e,t,n){return V0(r,e,1-Math.exp(-t*n))}function m5(r,e=1){return e-Math.abs(a2(r,e*2)-e)}function b5(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*(3-2*r))}function v5(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*r*(r*(r*6-15)+10))}function y5(r,e){return r+Math.floor(Math.random()*(e-r+1))}function G5(r,e){return r+Math.random()*(e-r)}function B5(r){return r*(.5-Math.random())}function Z5(r){r!==void 0&&(TY=r);let e=TY+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function S5(r){return r*SA}function R5(r){return r*ab}function GN(r){return(r&r-1)===0&&r!==0}function w5(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function pR(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function W5(r,e,t,n,a){const o=Math.cos,c=Math.sin,I=o(t/2),C=c(t/2),d=o((e+n)/2),f=c((e+n)/2),b=o((e-n)/2),v=c((e-n)/2),y=o((n-e)/2),Z=c((n-e)/2);switch(a){case"XYX":r.set(I*f,C*b,C*v,I*d);break;case"YZY":r.set(C*v,I*f,C*b,I*d);break;case"ZXZ":r.set(C*b,C*v,I*f,I*d);break;case"XZX":r.set(I*f,C*Z,C*y,I*d);break;case"YXY":r.set(C*y,I*f,C*Z,I*d);break;case"ZYZ":r.set(C*Z,C*y,I*f,I*d);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}}function Zr(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function Un(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const x5={DEG2RAD:SA,RAD2DEG:ab,generateUUID:sl,clamp:Wa,euclideanModulo:a2,mapLinear:A5,inverseLerp:f5,lerp:V0,damp:p5,pingpong:m5,smoothstep:b5,smootherstep:v5,randInt:y5,randFloat:G5,randFloatSpread:B5,seededRandom:Z5,degToRad:S5,radToDeg:R5,isPowerOfTwo:GN,ceilPowerOfTwo:w5,floorPowerOfTwo:pR,setQuaternionFromProperEuler:W5,normalize:Un,denormalize:Zr};class lt{constructor(e=0,t=0){lt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6],this.y=a[1]*t+a[4]*n+a[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Wa(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),a=Math.sin(t),o=this.x-e.x,c=this.y-e.y;return this.x=o*n-c*a+e.x,this.y=o*a+c*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Pn{constructor(e,t,n,a,o,c,I,C,d){Pn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,a,o,c,I,C,d)}set(e,t,n,a,o,c,I,C,d){const f=this.elements;return f[0]=e,f[1]=a,f[2]=I,f[3]=t,f[4]=o,f[5]=C,f[6]=n,f[7]=c,f[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,a=t.elements,o=this.elements,c=n[0],I=n[3],C=n[6],d=n[1],f=n[4],b=n[7],v=n[2],y=n[5],Z=n[8],V=a[0],R=a[3],S=a[6],N=a[1],w=a[4],X=a[7],H=a[2],F=a[5],_=a[8];return o[0]=c*V+I*N+C*H,o[3]=c*R+I*w+C*F,o[6]=c*S+I*X+C*_,o[1]=d*V+f*N+b*H,o[4]=d*R+f*w+b*F,o[7]=d*S+f*X+b*_,o[2]=v*V+y*N+Z*H,o[5]=v*R+y*w+Z*F,o[8]=v*S+y*X+Z*_,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],a=e[2],o=e[3],c=e[4],I=e[5],C=e[6],d=e[7],f=e[8];return t*c*f-t*I*d-n*o*f+n*I*C+a*o*d-a*c*C}invert(){const e=this.elements,t=e[0],n=e[1],a=e[2],o=e[3],c=e[4],I=e[5],C=e[6],d=e[7],f=e[8],b=f*c-I*d,v=I*C-f*o,y=d*o-c*C,Z=t*b+n*v+a*y;if(Z===0)return this.set(0,0,0,0,0,0,0,0,0);const V=1/Z;return e[0]=b*V,e[1]=(a*d-f*n)*V,e[2]=(I*n-a*c)*V,e[3]=v*V,e[4]=(f*t-a*C)*V,e[5]=(a*o-I*t)*V,e[6]=y*V,e[7]=(n*C-d*t)*V,e[8]=(c*t-n*o)*V,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,a,o,c,I){const C=Math.cos(o),d=Math.sin(o);return this.set(n*C,n*d,-n*(C*c+d*I)+c+e,-a*d,a*C,-a*(-d*c+C*I)+I+t,0,0,1),this}scale(e,t){return this.premultiply(Lx.makeScale(e,t)),this}rotate(e){return this.premultiply(Lx.makeRotation(-e)),this}translate(e,t){return this.premultiply(Lx.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let a=0;a<9;a++)if(t[a]!==n[a])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Lx=new Pn;function uK(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}const V5={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Dm(r,e){return new V5[r](e)}function J0(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function IK(){const r=J0("canvas");return r.style.display="block",r}const zY={};function N0(r){r in zY||(zY[r]=!0,console.warn(r))}const LY=new Pn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),_Y=new Pn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),QZ={[Tc]:{transfer:_0,primaries:k0,toReference:r=>r,fromReference:r=>r},[As]:{transfer:ta,primaries:k0,toReference:r=>r.convertSRGBToLinear(),fromReference:r=>r.convertLinearToSRGB()},[iG]:{transfer:_0,primaries:U0,toReference:r=>r.applyMatrix3(_Y),fromReference:r=>r.applyMatrix3(LY)},[SR]:{transfer:ta,primaries:U0,toReference:r=>r.convertSRGBToLinear().applyMatrix3(_Y),fromReference:r=>r.applyMatrix3(LY).convertLinearToSRGB()}},N5=new Set([Tc,iG]),Ni={enabled:!0,_workingColorSpace:Tc,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(r){if(!N5.has(r))throw new Error(`Unsupported working color space, "${r}".`);this._workingColorSpace=r},convert:function(r,e,t){if(this.enabled===!1||e===t||!e||!t)return r;const n=QZ[e].toReference,a=QZ[t].fromReference;return a(n(r))},fromWorkingColorSpace:function(r,e){return this.convert(r,this._workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this._workingColorSpace)},getPrimaries:function(r){return QZ[r].primaries},getTransfer:function(r){return r===al?_0:QZ[r].transfer}};function qm(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function _x(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let vm;class s2{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{vm===void 0&&(vm=J0("canvas")),vm.width=e.width,vm.height=e.height;const n=vm.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=vm}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=J0("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const a=n.getImageData(0,0,e.width,e.height),o=a.data;for(let c=0;c<o.length;c++)o[c]=qm(o[c]/255)*255;return n.putImageData(a,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(qm(t[n]/255)*255):t[n]=qm(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let X5=0;class GA{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:X5++}),this.uuid=sl(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},a=this.data;if(a!==null){let o;if(Array.isArray(a)){o=[];for(let c=0,I=a.length;c<I;c++)a[c].isDataTexture?o.push(kx(a[c].image)):o.push(kx(a[c]))}else o=kx(a);n.url=o}return t||(e.images[this.uuid]=n),n}}function kx(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?s2.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Y5=0;class Ta extends bI{constructor(e=Ta.DEFAULT_IMAGE,t=Ta.DEFAULT_MAPPING,n=Go,a=Go,o=Ka,c=nC,I=Uo,C=Kc,d=Ta.DEFAULT_ANISOTROPY,f=al){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Y5++}),this.uuid=sl(),this.name="",this.source=new GA(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=a,this.magFilter=o,this.minFilter=c,this.anisotropy=d,this.format=I,this.internalFormat=null,this.type=C,this.offset=new lt(0,0),this.repeat=new lt(1,1),this.center=new lt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Pn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof f=="string"?this.colorSpace=f:(N0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=f===qd?As:al),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==GR)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case K0:e.x=e.x-Math.floor(e.x);break;case Go:e.x=e.x<0?0:1;break;case E0:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case K0:e.y=e.y-Math.floor(e.y);break;case Go:e.y=e.y<0?0:1;break;case E0:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return N0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===As?qd:n2}set encoding(e){N0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===qd?As:al}}Ta.DEFAULT_IMAGE=null;Ta.DEFAULT_MAPPING=GR;Ta.DEFAULT_ANISOTROPY=1;class Xi{constructor(e=0,t=0,n=0,a=1){Xi.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=a}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,a=this.z,o=this.w,c=e.elements;return this.x=c[0]*t+c[4]*n+c[8]*a+c[12]*o,this.y=c[1]*t+c[5]*n+c[9]*a+c[13]*o,this.z=c[2]*t+c[6]*n+c[10]*a+c[14]*o,this.w=c[3]*t+c[7]*n+c[11]*a+c[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,a,o;const C=e.elements,d=C[0],f=C[4],b=C[8],v=C[1],y=C[5],Z=C[9],V=C[2],R=C[6],S=C[10];if(Math.abs(f-v)<.01&&Math.abs(b-V)<.01&&Math.abs(Z-R)<.01){if(Math.abs(f+v)<.1&&Math.abs(b+V)<.1&&Math.abs(Z+R)<.1&&Math.abs(d+y+S-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const w=(d+1)/2,X=(y+1)/2,H=(S+1)/2,F=(f+v)/4,_=(b+V)/4,P=(Z+R)/4;return w>X&&w>H?w<.01?(n=0,a=.707106781,o=.707106781):(n=Math.sqrt(w),a=F/n,o=_/n):X>H?X<.01?(n=.707106781,a=0,o=.707106781):(a=Math.sqrt(X),n=F/a,o=P/a):H<.01?(n=.707106781,a=.707106781,o=0):(o=Math.sqrt(H),n=_/o,a=P/o),this.set(n,a,o,t),this}let N=Math.sqrt((R-Z)*(R-Z)+(b-V)*(b-V)+(v-f)*(v-f));return Math.abs(N)<.001&&(N=1),this.x=(R-Z)/N,this.y=(b-V)/N,this.z=(v-f)/N,this.w=Math.acos((d+y+S-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class dK extends bI{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Xi(0,0,e,t),this.scissorTest=!1,this.viewport=new Xi(0,0,e,t);const a={width:e,height:t,depth:1};n.encoding!==void 0&&(N0("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===qd?As:al),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ka,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new Ta(a,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new GA(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Eg extends dK{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class RR extends Ta{constructor(e=null,t=1,n=1,a=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:a},this.magFilter=Fa,this.minFilter=Fa,this.wrapR=Go,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class M5 extends Eg{constructor(e=1,t=1,n=1,a={}){super(e,t,a),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new RR(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class o2 extends Ta{constructor(e=null,t=1,n=1,a=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:a},this.magFilter=Fa,this.minFilter=Fa,this.wrapR=Go,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class H5 extends Eg{constructor(e=1,t=1,n=1,a={}){super(e,t,a),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new o2(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class F5 extends Eg{constructor(e=1,t=1,n=1,a={}){super(e,t,a),this.isWebGLMultipleRenderTargets=!0;const o=this.texture;this.texture=[];for(let c=0;c<n;c++)this.texture[c]=o.clone(),this.texture[c].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let a=0,o=this.texture.length;a<o;a++)this.texture[a].image.width=e,this.texture[a].image.height=t,this.texture[a].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}let xs=class{constructor(e=0,t=0,n=0,a=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=a}static slerpFlat(e,t,n,a,o,c,I){let C=n[a+0],d=n[a+1],f=n[a+2],b=n[a+3];const v=o[c+0],y=o[c+1],Z=o[c+2],V=o[c+3];if(I===0){e[t+0]=C,e[t+1]=d,e[t+2]=f,e[t+3]=b;return}if(I===1){e[t+0]=v,e[t+1]=y,e[t+2]=Z,e[t+3]=V;return}if(b!==V||C!==v||d!==y||f!==Z){let R=1-I;const S=C*v+d*y+f*Z+b*V,N=S>=0?1:-1,w=1-S*S;if(w>Number.EPSILON){const H=Math.sqrt(w),F=Math.atan2(H,S*N);R=Math.sin(R*F)/H,I=Math.sin(I*F)/H}const X=I*N;if(C=C*R+v*X,d=d*R+y*X,f=f*R+Z*X,b=b*R+V*X,R===1-I){const H=1/Math.sqrt(C*C+d*d+f*f+b*b);C*=H,d*=H,f*=H,b*=H}}e[t]=C,e[t+1]=d,e[t+2]=f,e[t+3]=b}static multiplyQuaternionsFlat(e,t,n,a,o,c){const I=n[a],C=n[a+1],d=n[a+2],f=n[a+3],b=o[c],v=o[c+1],y=o[c+2],Z=o[c+3];return e[t]=I*Z+f*b+C*y-d*v,e[t+1]=C*Z+f*v+d*b-I*y,e[t+2]=d*Z+f*y+I*v-C*b,e[t+3]=f*Z-I*b-C*v-d*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,a){return this._x=e,this._y=t,this._z=n,this._w=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,a=e._y,o=e._z,c=e._order,I=Math.cos,C=Math.sin,d=I(n/2),f=I(a/2),b=I(o/2),v=C(n/2),y=C(a/2),Z=C(o/2);switch(c){case"XYZ":this._x=v*f*b+d*y*Z,this._y=d*y*b-v*f*Z,this._z=d*f*Z+v*y*b,this._w=d*f*b-v*y*Z;break;case"YXZ":this._x=v*f*b+d*y*Z,this._y=d*y*b-v*f*Z,this._z=d*f*Z-v*y*b,this._w=d*f*b+v*y*Z;break;case"ZXY":this._x=v*f*b-d*y*Z,this._y=d*y*b+v*f*Z,this._z=d*f*Z+v*y*b,this._w=d*f*b-v*y*Z;break;case"ZYX":this._x=v*f*b-d*y*Z,this._y=d*y*b+v*f*Z,this._z=d*f*Z-v*y*b,this._w=d*f*b+v*y*Z;break;case"YZX":this._x=v*f*b+d*y*Z,this._y=d*y*b+v*f*Z,this._z=d*f*Z-v*y*b,this._w=d*f*b-v*y*Z;break;case"XZY":this._x=v*f*b-d*y*Z,this._y=d*y*b-v*f*Z,this._z=d*f*Z+v*y*b,this._w=d*f*b+v*y*Z;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+c)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,a=Math.sin(n);return this._x=e.x*a,this._y=e.y*a,this._z=e.z*a,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],a=t[4],o=t[8],c=t[1],I=t[5],C=t[9],d=t[2],f=t[6],b=t[10],v=n+I+b;if(v>0){const y=.5/Math.sqrt(v+1);this._w=.25/y,this._x=(f-C)*y,this._y=(o-d)*y,this._z=(c-a)*y}else if(n>I&&n>b){const y=2*Math.sqrt(1+n-I-b);this._w=(f-C)/y,this._x=.25*y,this._y=(a+c)/y,this._z=(o+d)/y}else if(I>b){const y=2*Math.sqrt(1+I-n-b);this._w=(o-d)/y,this._x=(a+c)/y,this._y=.25*y,this._z=(C+f)/y}else{const y=2*Math.sqrt(1+b-n-I);this._w=(c-a)/y,this._x=(o+d)/y,this._y=(C+f)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Wa(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const a=Math.min(1,t/n);return this.slerp(e,a),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,a=e._y,o=e._z,c=e._w,I=t._x,C=t._y,d=t._z,f=t._w;return this._x=n*f+c*I+a*d-o*C,this._y=a*f+c*C+o*I-n*d,this._z=o*f+c*d+n*C-a*I,this._w=c*f-n*I-a*C-o*d,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,a=this._y,o=this._z,c=this._w;let I=c*e._w+n*e._x+a*e._y+o*e._z;if(I<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,I=-I):this.copy(e),I>=1)return this._w=c,this._x=n,this._y=a,this._z=o,this;const C=1-I*I;if(C<=Number.EPSILON){const y=1-t;return this._w=y*c+t*this._w,this._x=y*n+t*this._x,this._y=y*a+t*this._y,this._z=y*o+t*this._z,this.normalize(),this}const d=Math.sqrt(C),f=Math.atan2(d,I),b=Math.sin((1-t)*f)/d,v=Math.sin(t*f)/d;return this._w=c*b+this._w*v,this._x=n*b+this._x*v,this._y=a*b+this._y*v,this._z=o*b+this._z*v,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),a=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(a),n*Math.sin(o),n*Math.cos(o),t*Math.sin(a))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class ${constructor(e=0,t=0,n=0){$.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(kY.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(kY.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,a=this.z,o=e.elements;return this.x=o[0]*t+o[3]*n+o[6]*a,this.y=o[1]*t+o[4]*n+o[7]*a,this.z=o[2]*t+o[5]*n+o[8]*a,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,a=this.z,o=e.elements,c=1/(o[3]*t+o[7]*n+o[11]*a+o[15]);return this.x=(o[0]*t+o[4]*n+o[8]*a+o[12])*c,this.y=(o[1]*t+o[5]*n+o[9]*a+o[13])*c,this.z=(o[2]*t+o[6]*n+o[10]*a+o[14])*c,this}applyQuaternion(e){const t=this.x,n=this.y,a=this.z,o=e.x,c=e.y,I=e.z,C=e.w,d=2*(c*a-I*n),f=2*(I*t-o*a),b=2*(o*n-c*t);return this.x=t+C*d+c*b-I*f,this.y=n+C*f+I*d-o*b,this.z=a+C*b+o*f-c*d,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,a=this.z,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*a,this.y=o[1]*t+o[5]*n+o[9]*a,this.z=o[2]*t+o[6]*n+o[10]*a,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,a=e.y,o=e.z,c=t.x,I=t.y,C=t.z;return this.x=a*C-o*I,this.y=o*c-n*C,this.z=n*I-a*c,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Ux.copy(this).projectOnVector(e),this.sub(Ux)}reflect(e){return this.sub(Ux.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Wa(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,a=this.z-e.z;return t*t+n*n+a*a}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const a=Math.sin(t)*e;return this.x=a*Math.sin(n),this.y=Math.cos(t)*e,this.z=a*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=a,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ux=new $,kY=new xs;class Jo{constructor(e=new $(1/0,1/0,1/0),t=new $(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Wg.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Wg.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Wg.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const o=n.getAttribute("position");if(t===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let c=0,I=o.count;c<I;c++)e.isMesh===!0?e.getVertexPosition(c,Wg):Wg.fromBufferAttribute(o,c),Wg.applyMatrix4(e.matrixWorld),this.expandByPoint(Wg);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),jZ.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),jZ.copy(n.boundingBox)),jZ.applyMatrix4(e.matrixWorld),this.union(jZ)}const a=e.children;for(let o=0,c=a.length;o<c;o++)this.expandByObject(a[o],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Wg),Wg.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(g0),qZ.subVectors(this.max,g0),ym.subVectors(e.a,g0),Gm.subVectors(e.b,g0),Bm.subVectors(e.c,g0),Ld.subVectors(Gm,ym),_d.subVectors(Bm,Gm),iA.subVectors(ym,Bm);let t=[0,-Ld.z,Ld.y,0,-_d.z,_d.y,0,-iA.z,iA.y,Ld.z,0,-Ld.x,_d.z,0,-_d.x,iA.z,0,-iA.x,-Ld.y,Ld.x,0,-_d.y,_d.x,0,-iA.y,iA.x,0];return!Dx(t,ym,Gm,Bm,qZ)||(t=[1,0,0,0,1,0,0,0,1],!Dx(t,ym,Gm,Bm,qZ))?!1:($Z.crossVectors(Ld,_d),t=[$Z.x,$Z.y,$Z.z],Dx(t,ym,Gm,Bm,qZ))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Wg).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Wg).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(iI[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),iI[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),iI[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),iI[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),iI[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),iI[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),iI[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),iI[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(iI),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const iI=[new $,new $,new $,new $,new $,new $,new $,new $],Wg=new $,jZ=new Jo,ym=new $,Gm=new $,Bm=new $,Ld=new $,_d=new $,iA=new $,g0=new $,qZ=new $,$Z=new $,aA=new $;function Dx(r,e,t,n,a){for(let o=0,c=r.length-3;o<=c;o+=3){aA.fromArray(r,o);const I=a.x*Math.abs(aA.x)+a.y*Math.abs(aA.y)+a.z*Math.abs(aA.z),C=e.dot(aA),d=t.dot(aA),f=n.dot(aA);if(Math.max(-Math.max(C,d,f),Math.min(C,d,f))>I)return!1}return!0}const K5=new Jo,c0=new $,Jx=new $;class Bo{constructor(e=new $,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):K5.setFromPoints(e).getCenter(n);let a=0;for(let o=0,c=e.length;o<c;o++)a=Math.max(a,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(a),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;c0.subVectors(e,this.center);const t=c0.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),a=(n-this.radius)*.5;this.center.addScaledVector(c0,a/n),this.radius+=a}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Jx.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(c0.copy(e.center).add(Jx)),this.expandByPoint(c0.copy(e.center).sub(Jx))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const aI=new $,Ox=new $,eS=new $,kd=new $,Px=new $,tS=new $,Qx=new $;let XA=class{constructor(e=new $,t=new $(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,aI)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=aI.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(aI.copy(this.origin).addScaledVector(this.direction,t),aI.distanceToSquared(e))}distanceSqToSegment(e,t,n,a){Ox.copy(e).add(t).multiplyScalar(.5),eS.copy(t).sub(e).normalize(),kd.copy(this.origin).sub(Ox);const o=e.distanceTo(t)*.5,c=-this.direction.dot(eS),I=kd.dot(this.direction),C=-kd.dot(eS),d=kd.lengthSq(),f=Math.abs(1-c*c);let b,v,y,Z;if(f>0)if(b=c*C-I,v=c*I-C,Z=o*f,b>=0)if(v>=-Z)if(v<=Z){const V=1/f;b*=V,v*=V,y=b*(b+c*v+2*I)+v*(c*b+v+2*C)+d}else v=o,b=Math.max(0,-(c*v+I)),y=-b*b+v*(v+2*C)+d;else v=-o,b=Math.max(0,-(c*v+I)),y=-b*b+v*(v+2*C)+d;else v<=-Z?(b=Math.max(0,-(-c*o+I)),v=b>0?-o:Math.min(Math.max(-o,-C),o),y=-b*b+v*(v+2*C)+d):v<=Z?(b=0,v=Math.min(Math.max(-o,-C),o),y=v*(v+2*C)+d):(b=Math.max(0,-(c*o+I)),v=b>0?o:Math.min(Math.max(-o,-C),o),y=-b*b+v*(v+2*C)+d);else v=c>0?-o:o,b=Math.max(0,-(c*v+I)),y=-b*b+v*(v+2*C)+d;return n&&n.copy(this.origin).addScaledVector(this.direction,b),a&&a.copy(Ox).addScaledVector(eS,v),y}intersectSphere(e,t){aI.subVectors(e.center,this.origin);const n=aI.dot(this.direction),a=aI.dot(aI)-n*n,o=e.radius*e.radius;if(a>o)return null;const c=Math.sqrt(o-a),I=n-c,C=n+c;return C<0?null:I<0?this.at(C,t):this.at(I,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,a,o,c,I,C;const d=1/this.direction.x,f=1/this.direction.y,b=1/this.direction.z,v=this.origin;return d>=0?(n=(e.min.x-v.x)*d,a=(e.max.x-v.x)*d):(n=(e.max.x-v.x)*d,a=(e.min.x-v.x)*d),f>=0?(o=(e.min.y-v.y)*f,c=(e.max.y-v.y)*f):(o=(e.max.y-v.y)*f,c=(e.min.y-v.y)*f),n>c||o>a||((o>n||isNaN(n))&&(n=o),(c<a||isNaN(a))&&(a=c),b>=0?(I=(e.min.z-v.z)*b,C=(e.max.z-v.z)*b):(I=(e.max.z-v.z)*b,C=(e.min.z-v.z)*b),n>C||I>a)||((I>n||n!==n)&&(n=I),(C<a||a!==a)&&(a=C),a<0)?null:this.at(n>=0?n:a,t)}intersectsBox(e){return this.intersectBox(e,aI)!==null}intersectTriangle(e,t,n,a,o){Px.subVectors(t,e),tS.subVectors(n,e),Qx.crossVectors(Px,tS);let c=this.direction.dot(Qx),I;if(c>0){if(a)return null;I=1}else if(c<0)I=-1,c=-c;else return null;kd.subVectors(this.origin,e);const C=I*this.direction.dot(tS.crossVectors(kd,tS));if(C<0)return null;const d=I*this.direction.dot(Px.cross(kd));if(d<0||C+d>c)return null;const f=-I*kd.dot(Qx);return f<0?null:this.at(f/c,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Nn{constructor(e,t,n,a,o,c,I,C,d,f,b,v,y,Z,V,R){Nn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,a,o,c,I,C,d,f,b,v,y,Z,V,R)}set(e,t,n,a,o,c,I,C,d,f,b,v,y,Z,V,R){const S=this.elements;return S[0]=e,S[4]=t,S[8]=n,S[12]=a,S[1]=o,S[5]=c,S[9]=I,S[13]=C,S[2]=d,S[6]=f,S[10]=b,S[14]=v,S[3]=y,S[7]=Z,S[11]=V,S[15]=R,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Nn().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,a=1/Zm.setFromMatrixColumn(e,0).length(),o=1/Zm.setFromMatrixColumn(e,1).length(),c=1/Zm.setFromMatrixColumn(e,2).length();return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=0,t[4]=n[4]*o,t[5]=n[5]*o,t[6]=n[6]*o,t[7]=0,t[8]=n[8]*c,t[9]=n[9]*c,t[10]=n[10]*c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,a=e.y,o=e.z,c=Math.cos(n),I=Math.sin(n),C=Math.cos(a),d=Math.sin(a),f=Math.cos(o),b=Math.sin(o);if(e.order==="XYZ"){const v=c*f,y=c*b,Z=I*f,V=I*b;t[0]=C*f,t[4]=-C*b,t[8]=d,t[1]=y+Z*d,t[5]=v-V*d,t[9]=-I*C,t[2]=V-v*d,t[6]=Z+y*d,t[10]=c*C}else if(e.order==="YXZ"){const v=C*f,y=C*b,Z=d*f,V=d*b;t[0]=v+V*I,t[4]=Z*I-y,t[8]=c*d,t[1]=c*b,t[5]=c*f,t[9]=-I,t[2]=y*I-Z,t[6]=V+v*I,t[10]=c*C}else if(e.order==="ZXY"){const v=C*f,y=C*b,Z=d*f,V=d*b;t[0]=v-V*I,t[4]=-c*b,t[8]=Z+y*I,t[1]=y+Z*I,t[5]=c*f,t[9]=V-v*I,t[2]=-c*d,t[6]=I,t[10]=c*C}else if(e.order==="ZYX"){const v=c*f,y=c*b,Z=I*f,V=I*b;t[0]=C*f,t[4]=Z*d-y,t[8]=v*d+V,t[1]=C*b,t[5]=V*d+v,t[9]=y*d-Z,t[2]=-d,t[6]=I*C,t[10]=c*C}else if(e.order==="YZX"){const v=c*C,y=c*d,Z=I*C,V=I*d;t[0]=C*f,t[4]=V-v*b,t[8]=Z*b+y,t[1]=b,t[5]=c*f,t[9]=-I*f,t[2]=-d*f,t[6]=y*b+Z,t[10]=v-V*b}else if(e.order==="XZY"){const v=c*C,y=c*d,Z=I*C,V=I*d;t[0]=C*f,t[4]=-b,t[8]=d*f,t[1]=v*b+V,t[5]=c*f,t[9]=y*b-Z,t[2]=Z*b-y,t[6]=I*f,t[10]=V*b+v}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(E5,e,T5)}lookAt(e,t,n){const a=this.elements;return el.subVectors(e,t),el.lengthSq()===0&&(el.z=1),el.normalize(),Ud.crossVectors(n,el),Ud.lengthSq()===0&&(Math.abs(n.z)===1?el.x+=1e-4:el.z+=1e-4,el.normalize(),Ud.crossVectors(n,el)),Ud.normalize(),nS.crossVectors(el,Ud),a[0]=Ud.x,a[4]=nS.x,a[8]=el.x,a[1]=Ud.y,a[5]=nS.y,a[9]=el.y,a[2]=Ud.z,a[6]=nS.z,a[10]=el.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,a=t.elements,o=this.elements,c=n[0],I=n[4],C=n[8],d=n[12],f=n[1],b=n[5],v=n[9],y=n[13],Z=n[2],V=n[6],R=n[10],S=n[14],N=n[3],w=n[7],X=n[11],H=n[15],F=a[0],_=a[4],P=a[8],K=a[12],E=a[1],ee=a[5],Ie=a[9],be=a[13],se=a[2],Ce=a[6],he=a[10],Be=a[14],ve=a[3],we=a[7],me=a[11],Xe=a[15];return o[0]=c*F+I*E+C*se+d*ve,o[4]=c*_+I*ee+C*Ce+d*we,o[8]=c*P+I*Ie+C*he+d*me,o[12]=c*K+I*be+C*Be+d*Xe,o[1]=f*F+b*E+v*se+y*ve,o[5]=f*_+b*ee+v*Ce+y*we,o[9]=f*P+b*Ie+v*he+y*me,o[13]=f*K+b*be+v*Be+y*Xe,o[2]=Z*F+V*E+R*se+S*ve,o[6]=Z*_+V*ee+R*Ce+S*we,o[10]=Z*P+V*Ie+R*he+S*me,o[14]=Z*K+V*be+R*Be+S*Xe,o[3]=N*F+w*E+X*se+H*ve,o[7]=N*_+w*ee+X*Ce+H*we,o[11]=N*P+w*Ie+X*he+H*me,o[15]=N*K+w*be+X*Be+H*Xe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],a=e[8],o=e[12],c=e[1],I=e[5],C=e[9],d=e[13],f=e[2],b=e[6],v=e[10],y=e[14],Z=e[3],V=e[7],R=e[11],S=e[15];return Z*(+o*C*b-a*d*b-o*I*v+n*d*v+a*I*y-n*C*y)+V*(+t*C*y-t*d*v+o*c*v-a*c*y+a*d*f-o*C*f)+R*(+t*d*b-t*I*y-o*c*b+n*c*y+o*I*f-n*d*f)+S*(-a*I*f-t*C*b+t*I*v+a*c*b-n*c*v+n*C*f)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const a=this.elements;return e.isVector3?(a[12]=e.x,a[13]=e.y,a[14]=e.z):(a[12]=e,a[13]=t,a[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],a=e[2],o=e[3],c=e[4],I=e[5],C=e[6],d=e[7],f=e[8],b=e[9],v=e[10],y=e[11],Z=e[12],V=e[13],R=e[14],S=e[15],N=b*R*d-V*v*d+V*C*y-I*R*y-b*C*S+I*v*S,w=Z*v*d-f*R*d-Z*C*y+c*R*y+f*C*S-c*v*S,X=f*V*d-Z*b*d+Z*I*y-c*V*y-f*I*S+c*b*S,H=Z*b*C-f*V*C-Z*I*v+c*V*v+f*I*R-c*b*R,F=t*N+n*w+a*X+o*H;if(F===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/F;return e[0]=N*_,e[1]=(V*v*o-b*R*o-V*a*y+n*R*y+b*a*S-n*v*S)*_,e[2]=(I*R*o-V*C*o+V*a*d-n*R*d-I*a*S+n*C*S)*_,e[3]=(b*C*o-I*v*o-b*a*d+n*v*d+I*a*y-n*C*y)*_,e[4]=w*_,e[5]=(f*R*o-Z*v*o+Z*a*y-t*R*y-f*a*S+t*v*S)*_,e[6]=(Z*C*o-c*R*o-Z*a*d+t*R*d+c*a*S-t*C*S)*_,e[7]=(c*v*o-f*C*o+f*a*d-t*v*d-c*a*y+t*C*y)*_,e[8]=X*_,e[9]=(Z*b*o-f*V*o-Z*n*y+t*V*y+f*n*S-t*b*S)*_,e[10]=(c*V*o-Z*I*o+Z*n*d-t*V*d-c*n*S+t*I*S)*_,e[11]=(f*I*o-c*b*o-f*n*d+t*b*d+c*n*y-t*I*y)*_,e[12]=H*_,e[13]=(f*V*a-Z*b*a+Z*n*v-t*V*v-f*n*R+t*b*R)*_,e[14]=(Z*I*a-c*V*a-Z*n*C+t*V*C+c*n*R-t*I*R)*_,e[15]=(c*b*a-f*I*a+f*n*C-t*b*C-c*n*v+t*I*v)*_,this}scale(e){const t=this.elements,n=e.x,a=e.y,o=e.z;return t[0]*=n,t[4]*=a,t[8]*=o,t[1]*=n,t[5]*=a,t[9]*=o,t[2]*=n,t[6]*=a,t[10]*=o,t[3]*=n,t[7]*=a,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,a))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),a=Math.sin(t),o=1-n,c=e.x,I=e.y,C=e.z,d=o*c,f=o*I;return this.set(d*c+n,d*I-a*C,d*C+a*I,0,d*I+a*C,f*I+n,f*C-a*c,0,d*C-a*I,f*C+a*c,o*C*C+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,a,o,c){return this.set(1,n,o,0,e,1,c,0,t,a,1,0,0,0,0,1),this}compose(e,t,n){const a=this.elements,o=t._x,c=t._y,I=t._z,C=t._w,d=o+o,f=c+c,b=I+I,v=o*d,y=o*f,Z=o*b,V=c*f,R=c*b,S=I*b,N=C*d,w=C*f,X=C*b,H=n.x,F=n.y,_=n.z;return a[0]=(1-(V+S))*H,a[1]=(y+X)*H,a[2]=(Z-w)*H,a[3]=0,a[4]=(y-X)*F,a[5]=(1-(v+S))*F,a[6]=(R+N)*F,a[7]=0,a[8]=(Z+w)*_,a[9]=(R-N)*_,a[10]=(1-(v+V))*_,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}decompose(e,t,n){const a=this.elements;let o=Zm.set(a[0],a[1],a[2]).length();const c=Zm.set(a[4],a[5],a[6]).length(),I=Zm.set(a[8],a[9],a[10]).length();this.determinant()<0&&(o=-o),e.x=a[12],e.y=a[13],e.z=a[14],xg.copy(this);const d=1/o,f=1/c,b=1/I;return xg.elements[0]*=d,xg.elements[1]*=d,xg.elements[2]*=d,xg.elements[4]*=f,xg.elements[5]*=f,xg.elements[6]*=f,xg.elements[8]*=b,xg.elements[9]*=b,xg.elements[10]*=b,t.setFromRotationMatrix(xg),n.x=o,n.y=c,n.z=I,this}makePerspective(e,t,n,a,o,c,I=Kg){const C=this.elements,d=2*o/(t-e),f=2*o/(n-a),b=(t+e)/(t-e),v=(n+a)/(n-a);let y,Z;if(I===Kg)y=-(c+o)/(c-o),Z=-2*c*o/(c-o);else if(I===ib)y=-c/(c-o),Z=-c*o/(c-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+I);return C[0]=d,C[4]=0,C[8]=b,C[12]=0,C[1]=0,C[5]=f,C[9]=v,C[13]=0,C[2]=0,C[6]=0,C[10]=y,C[14]=Z,C[3]=0,C[7]=0,C[11]=-1,C[15]=0,this}makeOrthographic(e,t,n,a,o,c,I=Kg){const C=this.elements,d=1/(t-e),f=1/(n-a),b=1/(c-o),v=(t+e)*d,y=(n+a)*f;let Z,V;if(I===Kg)Z=(c+o)*b,V=-2*b;else if(I===ib)Z=o*b,V=-1*b;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+I);return C[0]=2*d,C[4]=0,C[8]=0,C[12]=-v,C[1]=0,C[5]=2*f,C[9]=0,C[13]=-y,C[2]=0,C[6]=0,C[10]=V,C[14]=-Z,C[3]=0,C[7]=0,C[11]=0,C[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let a=0;a<16;a++)if(t[a]!==n[a])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Zm=new $,xg=new Nn,E5=new $(0,0,0),T5=new $(1,1,1),Ud=new $,nS=new $,el=new $,UY=new Nn,DY=new xs;class gb{constructor(e=0,t=0,n=0,a=gb.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=a}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,a=this._order){return this._x=e,this._y=t,this._z=n,this._order=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const a=e.elements,o=a[0],c=a[4],I=a[8],C=a[1],d=a[5],f=a[9],b=a[2],v=a[6],y=a[10];switch(t){case"XYZ":this._y=Math.asin(Wa(I,-1,1)),Math.abs(I)<.9999999?(this._x=Math.atan2(-f,y),this._z=Math.atan2(-c,o)):(this._x=Math.atan2(v,d),this._z=0);break;case"YXZ":this._x=Math.asin(-Wa(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(I,y),this._z=Math.atan2(C,d)):(this._y=Math.atan2(-b,o),this._z=0);break;case"ZXY":this._x=Math.asin(Wa(v,-1,1)),Math.abs(v)<.9999999?(this._y=Math.atan2(-b,y),this._z=Math.atan2(-c,d)):(this._y=0,this._z=Math.atan2(C,o));break;case"ZYX":this._y=Math.asin(-Wa(b,-1,1)),Math.abs(b)<.9999999?(this._x=Math.atan2(v,y),this._z=Math.atan2(C,o)):(this._x=0,this._z=Math.atan2(-c,d));break;case"YZX":this._z=Math.asin(Wa(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(-f,d),this._y=Math.atan2(-b,o)):(this._x=0,this._y=Math.atan2(I,y));break;case"XZY":this._z=Math.asin(-Wa(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(v,d),this._y=Math.atan2(I,o)):(this._x=Math.atan2(-f,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return UY.makeRotationFromQuaternion(e),this.setFromRotationMatrix(UY,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return DY.setFromEuler(this),this.setFromQuaternion(DY,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}gb.DEFAULT_ORDER="XYZ";class RA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let z5=0;const JY=new $,Sm=new xs,sI=new Nn,iS=new $,u0=new $,L5=new $,_5=new xs,OY=new $(1,0,0),PY=new $(0,1,0),QY=new $(0,0,1),k5={type:"added"},U5={type:"removed"};class Ai extends bI{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:z5++}),this.uuid=sl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ai.DEFAULT_UP.clone();const e=new $,t=new gb,n=new xs,a=new $(1,1,1);function o(){n.setFromEuler(t,!1)}function c(){t.setFromQuaternion(n,void 0,!1)}t._onChange(o),n._onChange(c),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:a},modelViewMatrix:{value:new Nn},normalMatrix:{value:new Pn}}),this.matrix=new Nn,this.matrixWorld=new Nn,this.matrixAutoUpdate=Ai.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ai.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new RA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Sm.setFromAxisAngle(e,t),this.quaternion.multiply(Sm),this}rotateOnWorldAxis(e,t){return Sm.setFromAxisAngle(e,t),this.quaternion.premultiply(Sm),this}rotateX(e){return this.rotateOnAxis(OY,e)}rotateY(e){return this.rotateOnAxis(PY,e)}rotateZ(e){return this.rotateOnAxis(QY,e)}translateOnAxis(e,t){return JY.copy(e).applyQuaternion(this.quaternion),this.position.add(JY.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(OY,e)}translateY(e){return this.translateOnAxis(PY,e)}translateZ(e){return this.translateOnAxis(QY,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(sI.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?iS.copy(e):iS.set(e,t,n);const a=this.parent;this.updateWorldMatrix(!0,!1),u0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?sI.lookAt(u0,iS,this.up):sI.lookAt(iS,u0,this.up),this.quaternion.setFromRotationMatrix(sI),a&&(sI.extractRotation(a.matrixWorld),Sm.setFromRotationMatrix(sI),this.quaternion.premultiply(Sm.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(k5)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(U5)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),sI.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),sI.multiply(e.parent.matrixWorld)),e.applyMatrix4(sI),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,a=this.children.length;n<a;n++){const c=this.children[n].getObjectByProperty(e,t);if(c!==void 0)return c}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const a=this.children;for(let o=0,c=a.length;o<c;o++)a[o].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(u0,e,L5),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(u0,_5,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,a=t.length;n<a;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,a=t.length;n<a;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,a=t.length;n<a;n++){const o=t[n];(o.matrixWorldAutoUpdate===!0||e===!0)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const a=this.children;for(let o=0,c=a.length;o<c;o++){const I=a[o];I.matrixWorldAutoUpdate===!0&&I.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const a={};a.uuid=this.uuid,a.type=this.type,this.name!==""&&(a.name=this.name),this.castShadow===!0&&(a.castShadow=!0),this.receiveShadow===!0&&(a.receiveShadow=!0),this.visible===!1&&(a.visible=!1),this.frustumCulled===!1&&(a.frustumCulled=!1),this.renderOrder!==0&&(a.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(a.userData=this.userData),a.layers=this.layers.mask,a.matrix=this.matrix.toArray(),a.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(a.matrixAutoUpdate=!1),this.isInstancedMesh&&(a.type="InstancedMesh",a.count=this.count,a.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(a.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(a.type="BatchedMesh",a.perObjectFrustumCulled=this.perObjectFrustumCulled,a.sortObjects=this.sortObjects,a.drawRanges=this._drawRanges,a.reservedRanges=this._reservedRanges,a.visibility=this._visibility,a.active=this._active,a.bounds=this._bounds.map(I=>({boxInitialized:I.boxInitialized,boxMin:I.box.min.toArray(),boxMax:I.box.max.toArray(),sphereInitialized:I.sphereInitialized,sphereRadius:I.sphere.radius,sphereCenter:I.sphere.center.toArray()})),a.maxGeometryCount=this._maxGeometryCount,a.maxVertexCount=this._maxVertexCount,a.maxIndexCount=this._maxIndexCount,a.geometryInitialized=this._geometryInitialized,a.geometryCount=this._geometryCount,a.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(a.boundingSphere={center:a.boundingSphere.center.toArray(),radius:a.boundingSphere.radius}),this.boundingBox!==null&&(a.boundingBox={min:a.boundingBox.min.toArray(),max:a.boundingBox.max.toArray()}));function o(I,C){return I[C.uuid]===void 0&&(I[C.uuid]=C.toJSON(e)),C.uuid}if(this.isScene)this.background&&(this.background.isColor?a.background=this.background.toJSON():this.background.isTexture&&(a.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(a.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){a.geometry=o(e.geometries,this.geometry);const I=this.geometry.parameters;if(I!==void 0&&I.shapes!==void 0){const C=I.shapes;if(Array.isArray(C))for(let d=0,f=C.length;d<f;d++){const b=C[d];o(e.shapes,b)}else o(e.shapes,C)}}if(this.isSkinnedMesh&&(a.bindMode=this.bindMode,a.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),a.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const I=[];for(let C=0,d=this.material.length;C<d;C++)I.push(o(e.materials,this.material[C]));a.material=I}else a.material=o(e.materials,this.material);if(this.children.length>0){a.children=[];for(let I=0;I<this.children.length;I++)a.children.push(this.children[I].toJSON(e).object)}if(this.animations.length>0){a.animations=[];for(let I=0;I<this.animations.length;I++){const C=this.animations[I];a.animations.push(o(e.animations,C))}}if(t){const I=c(e.geometries),C=c(e.materials),d=c(e.textures),f=c(e.images),b=c(e.shapes),v=c(e.skeletons),y=c(e.animations),Z=c(e.nodes);I.length>0&&(n.geometries=I),C.length>0&&(n.materials=C),d.length>0&&(n.textures=d),f.length>0&&(n.images=f),b.length>0&&(n.shapes=b),v.length>0&&(n.skeletons=v),y.length>0&&(n.animations=y),Z.length>0&&(n.nodes=Z)}return n.object=a,n;function c(I){const C=[];for(const d in I){const f=I[d];delete f.metadata,C.push(f)}return C}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const a=e.children[n];this.add(a.clone())}return this}}Ai.DEFAULT_UP=new $(0,1,0);Ai.DEFAULT_MATRIX_AUTO_UPDATE=!0;Ai.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Vg=new $,oI=new $,jx=new $,rI=new $,Rm=new $,wm=new $,jY=new $,qx=new $,$x=new $,eV=new $;let aS=!1;class Br{constructor(e=new $,t=new $,n=new $){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,a){a.subVectors(n,t),Vg.subVectors(e,t),a.cross(Vg);const o=a.lengthSq();return o>0?a.multiplyScalar(1/Math.sqrt(o)):a.set(0,0,0)}static getBarycoord(e,t,n,a,o){Vg.subVectors(a,t),oI.subVectors(n,t),jx.subVectors(e,t);const c=Vg.dot(Vg),I=Vg.dot(oI),C=Vg.dot(jx),d=oI.dot(oI),f=oI.dot(jx),b=c*d-I*I;if(b===0)return o.set(0,0,0),null;const v=1/b,y=(d*C-I*f)*v,Z=(c*f-I*C)*v;return o.set(1-y-Z,Z,y)}static containsPoint(e,t,n,a){return this.getBarycoord(e,t,n,a,rI)===null?!1:rI.x>=0&&rI.y>=0&&rI.x+rI.y<=1}static getUV(e,t,n,a,o,c,I,C){return aS===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),aS=!0),this.getInterpolation(e,t,n,a,o,c,I,C)}static getInterpolation(e,t,n,a,o,c,I,C){return this.getBarycoord(e,t,n,a,rI)===null?(C.x=0,C.y=0,"z"in C&&(C.z=0),"w"in C&&(C.w=0),null):(C.setScalar(0),C.addScaledVector(o,rI.x),C.addScaledVector(c,rI.y),C.addScaledVector(I,rI.z),C)}static isFrontFacing(e,t,n,a){return Vg.subVectors(n,t),oI.subVectors(e,t),Vg.cross(oI).dot(a)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,a){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[a]),this}setFromAttributeAndIndices(e,t,n,a){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,a),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Vg.subVectors(this.c,this.b),oI.subVectors(this.a,this.b),Vg.cross(oI).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Br.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Br.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,a,o){return aS===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),aS=!0),Br.getInterpolation(e,this.a,this.b,this.c,t,n,a,o)}getInterpolation(e,t,n,a,o){return Br.getInterpolation(e,this.a,this.b,this.c,t,n,a,o)}containsPoint(e){return Br.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Br.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,a=this.b,o=this.c;let c,I;Rm.subVectors(a,n),wm.subVectors(o,n),qx.subVectors(e,n);const C=Rm.dot(qx),d=wm.dot(qx);if(C<=0&&d<=0)return t.copy(n);$x.subVectors(e,a);const f=Rm.dot($x),b=wm.dot($x);if(f>=0&&b<=f)return t.copy(a);const v=C*b-f*d;if(v<=0&&C>=0&&f<=0)return c=C/(C-f),t.copy(n).addScaledVector(Rm,c);eV.subVectors(e,o);const y=Rm.dot(eV),Z=wm.dot(eV);if(Z>=0&&y<=Z)return t.copy(o);const V=y*d-C*Z;if(V<=0&&d>=0&&Z<=0)return I=d/(d-Z),t.copy(n).addScaledVector(wm,I);const R=f*Z-y*b;if(R<=0&&b-f>=0&&y-Z>=0)return jY.subVectors(o,a),I=(b-f)/(b-f+(y-Z)),t.copy(a).addScaledVector(jY,I);const S=1/(R+V+v);return c=V*S,I=v*S,t.copy(n).addScaledVector(Rm,c).addScaledVector(wm,I)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const CK={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Dd={h:0,s:0,l:0},sS={h:0,s:0,l:0};function tV(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*6*(2/3-t):r}class an{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const a=e;a&&a.isColor?this.copy(a):typeof a=="number"?this.setHex(a):typeof a=="string"&&this.setStyle(a)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=As){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ni.toWorkingColorSpace(this,t),this}setRGB(e,t,n,a=Ni.workingColorSpace){return this.r=e,this.g=t,this.b=n,Ni.toWorkingColorSpace(this,a),this}setHSL(e,t,n,a=Ni.workingColorSpace){if(e=a2(e,1),t=Wa(t,0,1),n=Wa(n,0,1),t===0)this.r=this.g=this.b=n;else{const o=n<=.5?n*(1+t):n+t-n*t,c=2*n-o;this.r=tV(c,o,e+1/3),this.g=tV(c,o,e),this.b=tV(c,o,e-1/3)}return Ni.toWorkingColorSpace(this,a),this}setStyle(e,t=As){function n(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let a;if(a=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const c=a[1],I=a[2];switch(c){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(I))return n(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(I))return n(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(I))return n(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=a[1],c=o.length;if(c===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,t);if(c===6)return this.setHex(parseInt(o,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=As){const n=CK[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=qm(e.r),this.g=qm(e.g),this.b=qm(e.b),this}copyLinearToSRGB(e){return this.r=_x(e.r),this.g=_x(e.g),this.b=_x(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=As){return Ni.fromWorkingColorSpace(mo.copy(this),e),Math.round(Wa(mo.r*255,0,255))*65536+Math.round(Wa(mo.g*255,0,255))*256+Math.round(Wa(mo.b*255,0,255))}getHexString(e=As){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ni.workingColorSpace){Ni.fromWorkingColorSpace(mo.copy(this),t);const n=mo.r,a=mo.g,o=mo.b,c=Math.max(n,a,o),I=Math.min(n,a,o);let C,d;const f=(I+c)/2;if(I===c)C=0,d=0;else{const b=c-I;switch(d=f<=.5?b/(c+I):b/(2-c-I),c){case n:C=(a-o)/b+(a<o?6:0);break;case a:C=(o-n)/b+2;break;case o:C=(n-a)/b+4;break}C/=6}return e.h=C,e.s=d,e.l=f,e}getRGB(e,t=Ni.workingColorSpace){return Ni.fromWorkingColorSpace(mo.copy(this),t),e.r=mo.r,e.g=mo.g,e.b=mo.b,e}getStyle(e=As){Ni.fromWorkingColorSpace(mo.copy(this),e);const t=mo.r,n=mo.g,a=mo.b;return e!==As?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${a.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(a*255)})`}offsetHSL(e,t,n){return this.getHSL(Dd),this.setHSL(Dd.h+e,Dd.s+t,Dd.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Dd),e.getHSL(sS);const n=V0(Dd.h,sS.h,t),a=V0(Dd.s,sS.s,t),o=V0(Dd.l,sS.l,t);return this.setHSL(n,a,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,a=this.b,o=e.elements;return this.r=o[0]*t+o[3]*n+o[6]*a,this.g=o[1]*t+o[4]*n+o[7]*a,this.b=o[2]*t+o[5]*n+o[8]*a,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const mo=new an;an.NAMES=CK;let D5=0;class Zo extends bI{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:D5++}),this.uuid=sl(),this.name="",this.type="Material",this.blending=ZA,this.side=fI,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=CR,this.blendDst=hR,this.blendEquation=Pd,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new an(0,0,0),this.blendAlpha=0,this.depthFunc=M0,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=vN,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hA,this.stencilZFail=hA,this.stencilZPass=hA,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const a=this[t];if(a===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}a&&a.isColor?a.set(n):a&&a.isVector3&&n&&n.isVector3?a.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==ZA&&(n.blending=this.blending),this.side!==fI&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==CR&&(n.blendSrc=this.blendSrc),this.blendDst!==hR&&(n.blendDst=this.blendDst),this.blendEquation!==Pd&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==M0&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==vN&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==hA&&(n.stencilFail=this.stencilFail),this.stencilZFail!==hA&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==hA&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function a(o){const c=[];for(const I in o){const C=o[I];delete C.metadata,c.push(C)}return c}if(t){const o=a(e.textures),c=a(e.images);o.length>0&&(n.textures=o),c.length>0&&(n.images=c)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const a=t.length;n=new Array(a);for(let o=0;o!==a;++o)n[o]=t[o].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class sC extends Zo{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new an(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=nG,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const uI=J5();function J5(){const r=new ArrayBuffer(4),e=new Float32Array(r),t=new Uint32Array(r),n=new Uint32Array(512),a=new Uint32Array(512);for(let C=0;C<256;++C){const d=C-127;d<-27?(n[C]=0,n[C|256]=32768,a[C]=24,a[C|256]=24):d<-14?(n[C]=1024>>-d-14,n[C|256]=1024>>-d-14|32768,a[C]=-d-1,a[C|256]=-d-1):d<=15?(n[C]=d+15<<10,n[C|256]=d+15<<10|32768,a[C]=13,a[C|256]=13):d<128?(n[C]=31744,n[C|256]=64512,a[C]=24,a[C|256]=24):(n[C]=31744,n[C|256]=64512,a[C]=13,a[C|256]=13)}const o=new Uint32Array(2048),c=new Uint32Array(64),I=new Uint32Array(64);for(let C=1;C<1024;++C){let d=C<<13,f=0;for(;!(d&8388608);)d<<=1,f-=8388608;d&=-8388609,f+=947912704,o[C]=d|f}for(let C=1024;C<2048;++C)o[C]=939524096+(C-1024<<13);for(let C=1;C<31;++C)c[C]=C<<23;c[31]=1199570944,c[32]=2147483648;for(let C=33;C<63;++C)c[C]=2147483648+(C-32<<23);c[63]=3347054592;for(let C=1;C<64;++C)C!==32&&(I[C]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:a,mantissaTable:o,exponentTable:c,offsetTable:I}}function vr(r){Math.abs(r)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),r=Wa(r,-65504,65504),uI.floatView[0]=r;const e=uI.uint32View[0],t=e>>23&511;return uI.baseTable[t]+((e&8388607)>>uI.shiftTable[t])}function R0(r){const e=r>>10;return uI.uint32View[0]=uI.mantissaTable[uI.offsetTable[e]+(r&1023)]+uI.exponentTable[e],uI.floatView[0]}const O5={toHalfFloat:vr,fromHalfFloat:R0},es=new $,oS=new lt;class Yi{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=D0,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Fg,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let a=0,o=this.itemSize;a<o;a++)this.array[e+a]=t.array[n+a];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)oS.fromBufferAttribute(this,t),oS.applyMatrix3(e),this.setXY(t,oS.x,oS.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)es.fromBufferAttribute(this,t),es.applyMatrix3(e),this.setXYZ(t,es.x,es.y,es.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)es.fromBufferAttribute(this,t),es.applyMatrix4(e),this.setXYZ(t,es.x,es.y,es.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)es.fromBufferAttribute(this,t),es.applyNormalMatrix(e),this.setXYZ(t,es.x,es.y,es.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)es.fromBufferAttribute(this,t),es.transformDirection(e),this.setXYZ(t,es.x,es.y,es.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Zr(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Un(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Zr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Zr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Zr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Zr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,a){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),a=Un(a,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=a,this}setXYZW(e,t,n,a,o){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),a=Un(a,this.array),o=Un(o,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=a,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==D0&&(e.usage=this.usage),e}}class P5 extends Yi{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Q5 extends Yi{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class j5 extends Yi{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class q5 extends Yi{constructor(e,t,n){super(new Int16Array(e),t,n)}}class r2 extends Yi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class $5 extends Yi{constructor(e,t,n){super(new Int32Array(e),t,n)}}class l2 extends Yi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class e1 extends Yi{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=R0(this.array[e*this.itemSize]);return this.normalized&&(t=Zr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize]=vr(t),this}getY(e){let t=R0(this.array[e*this.itemSize+1]);return this.normalized&&(t=Zr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+1]=vr(t),this}getZ(e){let t=R0(this.array[e*this.itemSize+2]);return this.normalized&&(t=Zr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+2]=vr(t),this}getW(e){let t=R0(this.array[e*this.itemSize+3]);return this.normalized&&(t=Zr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+3]=vr(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array)),this.array[e+0]=vr(t),this.array[e+1]=vr(n),this}setXYZ(e,t,n,a){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),a=Un(a,this.array)),this.array[e+0]=vr(t),this.array[e+1]=vr(n),this.array[e+2]=vr(a),this}setXYZW(e,t,n,a,o){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),a=Un(a,this.array),o=Un(o,this.array)),this.array[e+0]=vr(t),this.array[e+1]=vr(n),this.array[e+2]=vr(a),this.array[e+3]=vr(o),this}}class cn extends Yi{constructor(e,t,n){super(new Float32Array(e),t,n)}}class t1 extends Yi{constructor(e,t,n){super(new Float64Array(e),t,n)}}let n1=0;const El=new Nn,nV=new Ai,Wm=new $,tl=new Jo,I0=new Jo,Ws=new $;class Qn extends bI{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:n1++}),this.uuid=sl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(uK(e)?l2:r2)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new Pn().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const a=this.attributes.tangent;return a!==void 0&&(a.transformDirection(e),a.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return El.makeRotationFromQuaternion(e),this.applyMatrix4(El),this}rotateX(e){return El.makeRotationX(e),this.applyMatrix4(El),this}rotateY(e){return El.makeRotationY(e),this.applyMatrix4(El),this}rotateZ(e){return El.makeRotationZ(e),this.applyMatrix4(El),this}translate(e,t,n){return El.makeTranslation(e,t,n),this.applyMatrix4(El),this}scale(e,t,n){return El.makeScale(e,t,n),this.applyMatrix4(El),this}lookAt(e){return nV.lookAt(e),nV.updateMatrix(),this.applyMatrix4(nV.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wm).negate(),this.translate(Wm.x,Wm.y,Wm.z),this}setFromPoints(e){const t=[];for(let n=0,a=e.length;n<a;n++){const o=e[n];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new cn(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Jo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new $(-1/0,-1/0,-1/0),new $(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,a=t.length;n<a;n++){const o=t[n];tl.setFromBufferAttribute(o),this.morphTargetsRelative?(Ws.addVectors(this.boundingBox.min,tl.min),this.boundingBox.expandByPoint(Ws),Ws.addVectors(this.boundingBox.max,tl.max),this.boundingBox.expandByPoint(Ws)):(this.boundingBox.expandByPoint(tl.min),this.boundingBox.expandByPoint(tl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Bo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new $,1/0);return}if(e){const n=this.boundingSphere.center;if(tl.setFromBufferAttribute(e),t)for(let o=0,c=t.length;o<c;o++){const I=t[o];I0.setFromBufferAttribute(I),this.morphTargetsRelative?(Ws.addVectors(tl.min,I0.min),tl.expandByPoint(Ws),Ws.addVectors(tl.max,I0.max),tl.expandByPoint(Ws)):(tl.expandByPoint(I0.min),tl.expandByPoint(I0.max))}tl.getCenter(n);let a=0;for(let o=0,c=e.count;o<c;o++)Ws.fromBufferAttribute(e,o),a=Math.max(a,n.distanceToSquared(Ws));if(t)for(let o=0,c=t.length;o<c;o++){const I=t[o],C=this.morphTargetsRelative;for(let d=0,f=I.count;d<f;d++)Ws.fromBufferAttribute(I,d),C&&(Wm.fromBufferAttribute(e,d),Ws.add(Wm)),a=Math.max(a,n.distanceToSquared(Ws))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,a=t.position.array,o=t.normal.array,c=t.uv.array,I=a.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Yi(new Float32Array(4*I),4));const C=this.getAttribute("tangent").array,d=[],f=[];for(let E=0;E<I;E++)d[E]=new $,f[E]=new $;const b=new $,v=new $,y=new $,Z=new lt,V=new lt,R=new lt,S=new $,N=new $;function w(E,ee,Ie){b.fromArray(a,E*3),v.fromArray(a,ee*3),y.fromArray(a,Ie*3),Z.fromArray(c,E*2),V.fromArray(c,ee*2),R.fromArray(c,Ie*2),v.sub(b),y.sub(b),V.sub(Z),R.sub(Z);const be=1/(V.x*R.y-R.x*V.y);isFinite(be)&&(S.copy(v).multiplyScalar(R.y).addScaledVector(y,-V.y).multiplyScalar(be),N.copy(y).multiplyScalar(V.x).addScaledVector(v,-R.x).multiplyScalar(be),d[E].add(S),d[ee].add(S),d[Ie].add(S),f[E].add(N),f[ee].add(N),f[Ie].add(N))}let X=this.groups;X.length===0&&(X=[{start:0,count:n.length}]);for(let E=0,ee=X.length;E<ee;++E){const Ie=X[E],be=Ie.start,se=Ie.count;for(let Ce=be,he=be+se;Ce<he;Ce+=3)w(n[Ce+0],n[Ce+1],n[Ce+2])}const H=new $,F=new $,_=new $,P=new $;function K(E){_.fromArray(o,E*3),P.copy(_);const ee=d[E];H.copy(ee),H.sub(_.multiplyScalar(_.dot(ee))).normalize(),F.crossVectors(P,ee);const be=F.dot(f[E])<0?-1:1;C[E*4]=H.x,C[E*4+1]=H.y,C[E*4+2]=H.z,C[E*4+3]=be}for(let E=0,ee=X.length;E<ee;++E){const Ie=X[E],be=Ie.start,se=Ie.count;for(let Ce=be,he=be+se;Ce<he;Ce+=3)K(n[Ce+0]),K(n[Ce+1]),K(n[Ce+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Yi(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let v=0,y=n.count;v<y;v++)n.setXYZ(v,0,0,0);const a=new $,o=new $,c=new $,I=new $,C=new $,d=new $,f=new $,b=new $;if(e)for(let v=0,y=e.count;v<y;v+=3){const Z=e.getX(v+0),V=e.getX(v+1),R=e.getX(v+2);a.fromBufferAttribute(t,Z),o.fromBufferAttribute(t,V),c.fromBufferAttribute(t,R),f.subVectors(c,o),b.subVectors(a,o),f.cross(b),I.fromBufferAttribute(n,Z),C.fromBufferAttribute(n,V),d.fromBufferAttribute(n,R),I.add(f),C.add(f),d.add(f),n.setXYZ(Z,I.x,I.y,I.z),n.setXYZ(V,C.x,C.y,C.z),n.setXYZ(R,d.x,d.y,d.z)}else for(let v=0,y=t.count;v<y;v+=3)a.fromBufferAttribute(t,v+0),o.fromBufferAttribute(t,v+1),c.fromBufferAttribute(t,v+2),f.subVectors(c,o),b.subVectors(a,o),f.cross(b),n.setXYZ(v+0,f.x,f.y,f.z),n.setXYZ(v+1,f.x,f.y,f.z),n.setXYZ(v+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ws.fromBufferAttribute(e,t),Ws.normalize(),e.setXYZ(t,Ws.x,Ws.y,Ws.z)}toNonIndexed(){function e(I,C){const d=I.array,f=I.itemSize,b=I.normalized,v=new d.constructor(C.length*f);let y=0,Z=0;for(let V=0,R=C.length;V<R;V++){I.isInterleavedBufferAttribute?y=C[V]*I.data.stride+I.offset:y=C[V]*f;for(let S=0;S<f;S++)v[Z++]=d[y++]}return new Yi(v,f,b)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Qn,n=this.index.array,a=this.attributes;for(const I in a){const C=a[I],d=e(C,n);t.setAttribute(I,d)}const o=this.morphAttributes;for(const I in o){const C=[],d=o[I];for(let f=0,b=d.length;f<b;f++){const v=d[f],y=e(v,n);C.push(y)}t.morphAttributes[I]=C}t.morphTargetsRelative=this.morphTargetsRelative;const c=this.groups;for(let I=0,C=c.length;I<C;I++){const d=c[I];t.addGroup(d.start,d.count,d.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const C=this.parameters;for(const d in C)C[d]!==void 0&&(e[d]=C[d]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const C in n){const d=n[C];e.data.attributes[C]=d.toJSON(e.data)}const a={};let o=!1;for(const C in this.morphAttributes){const d=this.morphAttributes[C],f=[];for(let b=0,v=d.length;b<v;b++){const y=d[b];f.push(y.toJSON(e.data))}f.length>0&&(a[C]=f,o=!0)}o&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);const c=this.groups;c.length>0&&(e.data.groups=JSON.parse(JSON.stringify(c)));const I=this.boundingSphere;return I!==null&&(e.data.boundingSphere={center:I.center.toArray(),radius:I.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const a=e.attributes;for(const d in a){const f=a[d];this.setAttribute(d,f.clone(t))}const o=e.morphAttributes;for(const d in o){const f=[],b=o[d];for(let v=0,y=b.length;v<y;v++)f.push(b[v].clone(t));this.morphAttributes[d]=f}this.morphTargetsRelative=e.morphTargetsRelative;const c=e.groups;for(let d=0,f=c.length;d<f;d++){const b=c[d];this.addGroup(b.start,b.count,b.materialIndex)}const I=e.boundingBox;I!==null&&(this.boundingBox=I.clone());const C=e.boundingSphere;return C!==null&&(this.boundingSphere=C.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const qY=new Nn,sA=new XA,rS=new Bo,$Y=new $,xm=new $,Vm=new $,Nm=new $,iV=new $,lS=new $,gS=new lt,cS=new lt,uS=new lt,eM=new $,tM=new $,nM=new $,IS=new $,dS=new $;class ts extends Ai{constructor(e=new Qn,t=new sC){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const a=t[n[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,c=a.length;o<c;o++){const I=a[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[I]=o}}}}getVertexPosition(e,t){const n=this.geometry,a=n.attributes.position,o=n.morphAttributes.position,c=n.morphTargetsRelative;t.fromBufferAttribute(a,e);const I=this.morphTargetInfluences;if(o&&I){lS.set(0,0,0);for(let C=0,d=o.length;C<d;C++){const f=I[C],b=o[C];f!==0&&(iV.fromBufferAttribute(b,e),c?lS.addScaledVector(iV,f):lS.addScaledVector(iV.sub(t),f))}t.add(lS)}return t}raycast(e,t){const n=this.geometry,a=this.material,o=this.matrixWorld;a!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),rS.copy(n.boundingSphere),rS.applyMatrix4(o),sA.copy(e.ray).recast(e.near),!(rS.containsPoint(sA.origin)===!1&&(sA.intersectSphere(rS,$Y)===null||sA.origin.distanceToSquared($Y)>(e.far-e.near)**2))&&(qY.copy(o).invert(),sA.copy(e.ray).applyMatrix4(qY),!(n.boundingBox!==null&&sA.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,sA)))}_computeIntersections(e,t,n){let a;const o=this.geometry,c=this.material,I=o.index,C=o.attributes.position,d=o.attributes.uv,f=o.attributes.uv1,b=o.attributes.normal,v=o.groups,y=o.drawRange;if(I!==null)if(Array.isArray(c))for(let Z=0,V=v.length;Z<V;Z++){const R=v[Z],S=c[R.materialIndex],N=Math.max(R.start,y.start),w=Math.min(I.count,Math.min(R.start+R.count,y.start+y.count));for(let X=N,H=w;X<H;X+=3){const F=I.getX(X),_=I.getX(X+1),P=I.getX(X+2);a=CS(this,S,e,n,d,f,b,F,_,P),a&&(a.faceIndex=Math.floor(X/3),a.face.materialIndex=R.materialIndex,t.push(a))}}else{const Z=Math.max(0,y.start),V=Math.min(I.count,y.start+y.count);for(let R=Z,S=V;R<S;R+=3){const N=I.getX(R),w=I.getX(R+1),X=I.getX(R+2);a=CS(this,c,e,n,d,f,b,N,w,X),a&&(a.faceIndex=Math.floor(R/3),t.push(a))}}else if(C!==void 0)if(Array.isArray(c))for(let Z=0,V=v.length;Z<V;Z++){const R=v[Z],S=c[R.materialIndex],N=Math.max(R.start,y.start),w=Math.min(C.count,Math.min(R.start+R.count,y.start+y.count));for(let X=N,H=w;X<H;X+=3){const F=X,_=X+1,P=X+2;a=CS(this,S,e,n,d,f,b,F,_,P),a&&(a.faceIndex=Math.floor(X/3),a.face.materialIndex=R.materialIndex,t.push(a))}}else{const Z=Math.max(0,y.start),V=Math.min(C.count,y.start+y.count);for(let R=Z,S=V;R<S;R+=3){const N=R,w=R+1,X=R+2;a=CS(this,c,e,n,d,f,b,N,w,X),a&&(a.faceIndex=Math.floor(R/3),t.push(a))}}}}function i1(r,e,t,n,a,o,c,I){let C;if(e.side===Do?C=n.intersectTriangle(c,o,a,!0,I):C=n.intersectTriangle(a,o,c,e.side===fI,I),C===null)return null;dS.copy(I),dS.applyMatrix4(r.matrixWorld);const d=t.ray.origin.distanceTo(dS);return d<t.near||d>t.far?null:{distance:d,point:dS.clone(),object:r}}function CS(r,e,t,n,a,o,c,I,C,d){r.getVertexPosition(I,xm),r.getVertexPosition(C,Vm),r.getVertexPosition(d,Nm);const f=i1(r,e,t,n,xm,Vm,Nm,IS);if(f){a&&(gS.fromBufferAttribute(a,I),cS.fromBufferAttribute(a,C),uS.fromBufferAttribute(a,d),f.uv=Br.getInterpolation(IS,xm,Vm,Nm,gS,cS,uS,new lt)),o&&(gS.fromBufferAttribute(o,I),cS.fromBufferAttribute(o,C),uS.fromBufferAttribute(o,d),f.uv1=Br.getInterpolation(IS,xm,Vm,Nm,gS,cS,uS,new lt),f.uv2=f.uv1),c&&(eM.fromBufferAttribute(c,I),tM.fromBufferAttribute(c,C),nM.fromBufferAttribute(c,d),f.normal=Br.getInterpolation(IS,xm,Vm,Nm,eM,tM,nM,new $),f.normal.dot(n.direction)>0&&f.normal.multiplyScalar(-1));const b={a:I,b:C,c:d,normal:new $,materialIndex:0};Br.getNormal(xm,Vm,Nm,b.normal),f.face=b}return f}class YA extends Qn{constructor(e=1,t=1,n=1,a=1,o=1,c=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:a,heightSegments:o,depthSegments:c};const I=this;a=Math.floor(a),o=Math.floor(o),c=Math.floor(c);const C=[],d=[],f=[],b=[];let v=0,y=0;Z("z","y","x",-1,-1,n,t,e,c,o,0),Z("z","y","x",1,-1,n,t,-e,c,o,1),Z("x","z","y",1,1,e,n,t,a,c,2),Z("x","z","y",1,-1,e,n,-t,a,c,3),Z("x","y","z",1,-1,e,t,n,a,o,4),Z("x","y","z",-1,-1,e,t,-n,a,o,5),this.setIndex(C),this.setAttribute("position",new cn(d,3)),this.setAttribute("normal",new cn(f,3)),this.setAttribute("uv",new cn(b,2));function Z(V,R,S,N,w,X,H,F,_,P,K){const E=X/_,ee=H/P,Ie=X/2,be=H/2,se=F/2,Ce=_+1,he=P+1;let Be=0,ve=0;const we=new $;for(let me=0;me<he;me++){const Xe=me*ee-be;for(let Ue=0;Ue<Ce;Ue++){const de=Ue*E-Ie;we[V]=de*N,we[R]=Xe*w,we[S]=se,d.push(we.x,we.y,we.z),we[V]=0,we[R]=0,we[S]=F>0?1:-1,f.push(we.x,we.y,we.z),b.push(Ue/_),b.push(1-me/P),Be+=1}}for(let me=0;me<P;me++)for(let Xe=0;Xe<_;Xe++){const Ue=v+Xe+Ce*me,de=v+Xe+Ce*(me+1),Ee=v+(Xe+1)+Ce*(me+1),At=v+(Xe+1)+Ce*me;C.push(Ue,de,At),C.push(de,Ee,At),ve+=6}I.addGroup(y,ve,K),y+=ve,v+=Be}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new YA(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function sb(r){const e={};for(const t in r){e[t]={};for(const n in r[t]){const a=r[t][n];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?a.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=a.clone():Array.isArray(a)?e[t][n]=a.slice():e[t][n]=a}}return e}function Lo(r){const e={};for(let t=0;t<r.length;t++){const n=sb(r[t]);for(const a in n)e[a]=n[a]}return e}function a1(r){const e=[];for(let t=0;t<r.length;t++)e.push(r[t].clone());return e}function hK(r){return r.getRenderTarget()===null?r.outputColorSpace:Ni.workingColorSpace}const AK={clone:sb,merge:Lo};var s1=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,o1=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class zc extends Zo{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=s1,this.fragmentShader=o1,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=sb(e.uniforms),this.uniformsGroups=a1(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const a in this.uniforms){const c=this.uniforms[a].value;c&&c.isTexture?t.uniforms[a]={type:"t",value:c.toJSON(e).uuid}:c&&c.isColor?t.uniforms[a]={type:"c",value:c.getHex()}:c&&c.isVector2?t.uniforms[a]={type:"v2",value:c.toArray()}:c&&c.isVector3?t.uniforms[a]={type:"v3",value:c.toArray()}:c&&c.isVector4?t.uniforms[a]={type:"v4",value:c.toArray()}:c&&c.isMatrix3?t.uniforms[a]={type:"m3",value:c.toArray()}:c&&c.isMatrix4?t.uniforms[a]={type:"m4",value:c.toArray()}:t.uniforms[a]={value:c}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const a in this.extensions)this.extensions[a]===!0&&(n[a]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class aG extends Ai{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Nn,this.projectionMatrix=new Nn,this.projectionMatrixInverse=new Nn,this.coordinateSystem=Kg}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Ea extends aG{constructor(e=50,t=1,n=.1,a=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=a,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=ab*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(SA*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return ab*2*Math.atan(Math.tan(SA*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,a,o,c){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=a,this.view.width=o,this.view.height=c,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(SA*.5*this.fov)/this.zoom,n=2*t,a=this.aspect*n,o=-.5*a;const c=this.view;if(this.view!==null&&this.view.enabled){const C=c.fullWidth,d=c.fullHeight;o+=c.offsetX*a/C,t-=c.offsetY*n/d,a*=c.width/C,n*=c.height/d}const I=this.filmOffset;I!==0&&(o+=e*I/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+a,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Xm=-90,Ym=1;class fK extends Ai{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const a=new Ea(Xm,Ym,e,t);a.layers=this.layers,this.add(a);const o=new Ea(Xm,Ym,e,t);o.layers=this.layers,this.add(o);const c=new Ea(Xm,Ym,e,t);c.layers=this.layers,this.add(c);const I=new Ea(Xm,Ym,e,t);I.layers=this.layers,this.add(I);const C=new Ea(Xm,Ym,e,t);C.layers=this.layers,this.add(C);const d=new Ea(Xm,Ym,e,t);d.layers=this.layers,this.add(d)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,a,o,c,I,C]=t;for(const d of t)this.remove(d);if(e===Kg)n.up.set(0,1,0),n.lookAt(1,0,0),a.up.set(0,1,0),a.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),c.up.set(0,0,1),c.lookAt(0,-1,0),I.up.set(0,1,0),I.lookAt(0,0,1),C.up.set(0,1,0),C.lookAt(0,0,-1);else if(e===ib)n.up.set(0,-1,0),n.lookAt(-1,0,0),a.up.set(0,-1,0),a.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),c.up.set(0,0,-1),c.lookAt(0,-1,0),I.up.set(0,-1,0),I.lookAt(0,0,1),C.up.set(0,-1,0),C.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const d of t)this.add(d),d.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:a}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,c,I,C,d,f]=this.children,b=e.getRenderTarget(),v=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),Z=e.xr.enabled;e.xr.enabled=!1;const V=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,a),e.render(t,o),e.setRenderTarget(n,1,a),e.render(t,c),e.setRenderTarget(n,2,a),e.render(t,I),e.setRenderTarget(n,3,a),e.render(t,C),e.setRenderTarget(n,4,a),e.render(t,d),n.texture.generateMipmaps=V,e.setRenderTarget(n,5,a),e.render(t,f),e.setRenderTarget(b,v,y),e.xr.enabled=Z,n.texture.needsPMREMUpdate=!0}}class sG extends Ta{constructor(e,t,n,a,o,c,I,C,d,f){e=e!==void 0?e:[],t=t!==void 0?t:pI,super(e,t,n,a,o,c,I,C,d,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class pK extends Eg{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},a=[n,n,n,n,n,n];t.encoding!==void 0&&(N0("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===qd?As:al),this.texture=new sG(a,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Ka}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},a=new YA(5,5,5),o=new zc({name:"CubemapFromEquirect",uniforms:sb(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Do,blending:AI});o.uniforms.tEquirect.value=t;const c=new ts(a,o),I=t.minFilter;return t.minFilter===nC&&(t.minFilter=Ka),new fK(1,10,this).update(e,c),t.minFilter=I,c.geometry.dispose(),c.material.dispose(),this}clear(e,t,n,a){const o=e.getRenderTarget();for(let c=0;c<6;c++)e.setRenderTarget(this,c),e.clear(t,n,a);e.setRenderTarget(o)}}const aV=new $,r1=new $,l1=new Pn;class cI{constructor(e=new $(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,a){return this.normal.set(e,t,n),this.constant=a,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const a=aV.subVectors(n,t).cross(r1.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(a,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(aV),a=this.normal.dot(n);if(a===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/a;return o<0||o>1?null:t.copy(e.start).addScaledVector(n,o)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||l1.getNormalMatrix(e),a=this.coplanarPoint(aV).applyMatrix4(e),o=this.normal.applyMatrix3(n).normalize();return this.constant=-a.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const oA=new Bo,hS=new $;class oG{constructor(e=new cI,t=new cI,n=new cI,a=new cI,o=new cI,c=new cI){this.planes=[e,t,n,a,o,c]}set(e,t,n,a,o,c){const I=this.planes;return I[0].copy(e),I[1].copy(t),I[2].copy(n),I[3].copy(a),I[4].copy(o),I[5].copy(c),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Kg){const n=this.planes,a=e.elements,o=a[0],c=a[1],I=a[2],C=a[3],d=a[4],f=a[5],b=a[6],v=a[7],y=a[8],Z=a[9],V=a[10],R=a[11],S=a[12],N=a[13],w=a[14],X=a[15];if(n[0].setComponents(C-o,v-d,R-y,X-S).normalize(),n[1].setComponents(C+o,v+d,R+y,X+S).normalize(),n[2].setComponents(C+c,v+f,R+Z,X+N).normalize(),n[3].setComponents(C-c,v-f,R-Z,X-N).normalize(),n[4].setComponents(C-I,v-b,R-V,X-w).normalize(),t===Kg)n[5].setComponents(C+I,v+b,R+V,X+w).normalize();else if(t===ib)n[5].setComponents(I,b,V,w).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),oA.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),oA.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(oA)}intersectsSprite(e){return oA.center.set(0,0,0),oA.radius=.7071067811865476,oA.applyMatrix4(e.matrixWorld),this.intersectsSphere(oA)}intersectsSphere(e){const t=this.planes,n=e.center,a=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(n)<a)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const a=t[n];if(hS.x=a.normal.x>0?e.max.x:e.min.x,hS.y=a.normal.y>0?e.max.y:e.min.y,hS.z=a.normal.z>0?e.max.z:e.min.z,a.distanceToPoint(hS)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function mK(){let r=null,e=!1,t=null,n=null;function a(o,c){t(o,c),n=r.requestAnimationFrame(a)}return{start:function(){e!==!0&&t!==null&&(n=r.requestAnimationFrame(a),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){r=o}}}function g1(r,e){const t=e.isWebGL2,n=new WeakMap;function a(d,f){const b=d.array,v=d.usage,y=b.byteLength,Z=r.createBuffer();r.bindBuffer(f,Z),r.bufferData(f,b,v),d.onUploadCallback();let V;if(b instanceof Float32Array)V=r.FLOAT;else if(b instanceof Uint16Array)if(d.isFloat16BufferAttribute)if(t)V=r.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else V=r.UNSIGNED_SHORT;else if(b instanceof Int16Array)V=r.SHORT;else if(b instanceof Uint32Array)V=r.UNSIGNED_INT;else if(b instanceof Int32Array)V=r.INT;else if(b instanceof Int8Array)V=r.BYTE;else if(b instanceof Uint8Array)V=r.UNSIGNED_BYTE;else if(b instanceof Uint8ClampedArray)V=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+b);return{buffer:Z,type:V,bytesPerElement:b.BYTES_PER_ELEMENT,version:d.version,size:y}}function o(d,f,b){const v=f.array,y=f._updateRange,Z=f.updateRanges;if(r.bindBuffer(b,d),y.count===-1&&Z.length===0&&r.bufferSubData(b,0,v),Z.length!==0){for(let V=0,R=Z.length;V<R;V++){const S=Z[V];t?r.bufferSubData(b,S.start*v.BYTES_PER_ELEMENT,v,S.start,S.count):r.bufferSubData(b,S.start*v.BYTES_PER_ELEMENT,v.subarray(S.start,S.start+S.count))}f.clearUpdateRanges()}y.count!==-1&&(t?r.bufferSubData(b,y.offset*v.BYTES_PER_ELEMENT,v,y.offset,y.count):r.bufferSubData(b,y.offset*v.BYTES_PER_ELEMENT,v.subarray(y.offset,y.offset+y.count)),y.count=-1),f.onUploadCallback()}function c(d){return d.isInterleavedBufferAttribute&&(d=d.data),n.get(d)}function I(d){d.isInterleavedBufferAttribute&&(d=d.data);const f=n.get(d);f&&(r.deleteBuffer(f.buffer),n.delete(d))}function C(d,f){if(d.isGLBufferAttribute){const v=n.get(d);(!v||v.version<d.version)&&n.set(d,{buffer:d.buffer,type:d.type,bytesPerElement:d.elementSize,version:d.version});return}d.isInterleavedBufferAttribute&&(d=d.data);const b=n.get(d);if(b===void 0)n.set(d,a(d,f));else if(b.version<d.version){if(b.size!==d.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");o(b.buffer,d,f),b.version=d.version}}return{get:c,remove:I,update:C}}class rG extends Qn{constructor(e=1,t=1,n=1,a=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:a};const o=e/2,c=t/2,I=Math.floor(n),C=Math.floor(a),d=I+1,f=C+1,b=e/I,v=t/C,y=[],Z=[],V=[],R=[];for(let S=0;S<f;S++){const N=S*v-c;for(let w=0;w<d;w++){const X=w*b-o;Z.push(X,-N,0),V.push(0,0,1),R.push(w/I),R.push(1-S/C)}}for(let S=0;S<C;S++)for(let N=0;N<I;N++){const w=N+d*S,X=N+d*(S+1),H=N+1+d*(S+1),F=N+1+d*S;y.push(w,X,F),y.push(X,H,F)}this.setIndex(y),this.setAttribute("position",new cn(Z,3)),this.setAttribute("normal",new cn(V,3)),this.setAttribute("uv",new cn(R,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new rG(e.width,e.height,e.widthSegments,e.heightSegments)}}var c1=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,u1=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,I1=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,d1=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,C1=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,h1=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,A1=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,f1=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,p1=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,m1=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,b1=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,v1=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,y1=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,G1=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,B1=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Z1=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,S1=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,R1=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,w1=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,W1=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,x1=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,V1=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,N1=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,X1=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Y1=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,M1=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,H1=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,F1=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,K1=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,E1=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,T1="gl_FragColor = linearToOutputTexel( gl_FragColor );",z1=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,L1=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,_1=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,k1=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,U1=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,D1=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,J1=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,O1=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,P1=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Q1=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,j1=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,q1=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,$1=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,e3=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,t3=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,n3=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,i3=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,a3=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,s3=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,o3=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,r3=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,l3=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,g3=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,c3=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,u3=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,I3=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,d3=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,C3=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,h3=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,A3=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,f3=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,p3=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,m3=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,b3=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,v3=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,y3=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,G3=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,B3=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Z3=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,S3=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,R3=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,w3=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,W3=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,x3=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,V3=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,N3=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,X3=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Y3=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,M3=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,H3=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,F3=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,K3=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,E3=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,T3=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,z3=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,L3=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,_3=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,k3=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,U3=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,D3=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,J3=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,O3=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,P3=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Q3=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,j3=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,q3=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,$3=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,e_=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,t_=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,n_=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color *= toneMappingExposure;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	return color;
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,i_=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,a_=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,s_=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,o_=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,r_=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,l_=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const g_=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,c_=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,u_=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,I_=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,d_=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,C_=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,h_=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,A_=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,f_=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,p_=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,m_=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,b_=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,v_=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,y_=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,G_=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,B_=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Z_=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,S_=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,R_=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,w_=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,W_=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,x_=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,V_=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,N_=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,X_=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Y_=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,M_=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,H_=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,F_=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,K_=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,E_=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,T_=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,z_=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,L_=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,kn={alphahash_fragment:c1,alphahash_pars_fragment:u1,alphamap_fragment:I1,alphamap_pars_fragment:d1,alphatest_fragment:C1,alphatest_pars_fragment:h1,aomap_fragment:A1,aomap_pars_fragment:f1,batching_pars_vertex:p1,batching_vertex:m1,begin_vertex:b1,beginnormal_vertex:v1,bsdfs:y1,iridescence_fragment:G1,bumpmap_pars_fragment:B1,clipping_planes_fragment:Z1,clipping_planes_pars_fragment:S1,clipping_planes_pars_vertex:R1,clipping_planes_vertex:w1,color_fragment:W1,color_pars_fragment:x1,color_pars_vertex:V1,color_vertex:N1,common:X1,cube_uv_reflection_fragment:Y1,defaultnormal_vertex:M1,displacementmap_pars_vertex:H1,displacementmap_vertex:F1,emissivemap_fragment:K1,emissivemap_pars_fragment:E1,colorspace_fragment:T1,colorspace_pars_fragment:z1,envmap_fragment:L1,envmap_common_pars_fragment:_1,envmap_pars_fragment:k1,envmap_pars_vertex:U1,envmap_physical_pars_fragment:i3,envmap_vertex:D1,fog_vertex:J1,fog_pars_vertex:O1,fog_fragment:P1,fog_pars_fragment:Q1,gradientmap_pars_fragment:j1,lightmap_fragment:q1,lightmap_pars_fragment:$1,lights_lambert_fragment:e3,lights_lambert_pars_fragment:t3,lights_pars_begin:n3,lights_toon_fragment:a3,lights_toon_pars_fragment:s3,lights_phong_fragment:o3,lights_phong_pars_fragment:r3,lights_physical_fragment:l3,lights_physical_pars_fragment:g3,lights_fragment_begin:c3,lights_fragment_maps:u3,lights_fragment_end:I3,logdepthbuf_fragment:d3,logdepthbuf_pars_fragment:C3,logdepthbuf_pars_vertex:h3,logdepthbuf_vertex:A3,map_fragment:f3,map_pars_fragment:p3,map_particle_fragment:m3,map_particle_pars_fragment:b3,metalnessmap_fragment:v3,metalnessmap_pars_fragment:y3,morphcolor_vertex:G3,morphnormal_vertex:B3,morphtarget_pars_vertex:Z3,morphtarget_vertex:S3,normal_fragment_begin:R3,normal_fragment_maps:w3,normal_pars_fragment:W3,normal_pars_vertex:x3,normal_vertex:V3,normalmap_pars_fragment:N3,clearcoat_normal_fragment_begin:X3,clearcoat_normal_fragment_maps:Y3,clearcoat_pars_fragment:M3,iridescence_pars_fragment:H3,opaque_fragment:F3,packing:K3,premultiplied_alpha_fragment:E3,project_vertex:T3,dithering_fragment:z3,dithering_pars_fragment:L3,roughnessmap_fragment:_3,roughnessmap_pars_fragment:k3,shadowmap_pars_fragment:U3,shadowmap_pars_vertex:D3,shadowmap_vertex:J3,shadowmask_pars_fragment:O3,skinbase_vertex:P3,skinning_pars_vertex:Q3,skinning_vertex:j3,skinnormal_vertex:q3,specularmap_fragment:$3,specularmap_pars_fragment:e_,tonemapping_fragment:t_,tonemapping_pars_fragment:n_,transmission_fragment:i_,transmission_pars_fragment:a_,uv_pars_fragment:s_,uv_pars_vertex:o_,uv_vertex:r_,worldpos_vertex:l_,background_vert:g_,background_frag:c_,backgroundCube_vert:u_,backgroundCube_frag:I_,cube_vert:d_,cube_frag:C_,depth_vert:h_,depth_frag:A_,distanceRGBA_vert:f_,distanceRGBA_frag:p_,equirect_vert:m_,equirect_frag:b_,linedashed_vert:v_,linedashed_frag:y_,meshbasic_vert:G_,meshbasic_frag:B_,meshlambert_vert:Z_,meshlambert_frag:S_,meshmatcap_vert:R_,meshmatcap_frag:w_,meshnormal_vert:W_,meshnormal_frag:x_,meshphong_vert:V_,meshphong_frag:N_,meshphysical_vert:X_,meshphysical_frag:Y_,meshtoon_vert:M_,meshtoon_frag:H_,points_vert:F_,points_frag:K_,shadow_vert:E_,shadow_frag:T_,sprite_vert:z_,sprite_frag:L_},Lt={common:{diffuse:{value:new an(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Pn},alphaMap:{value:null},alphaMapTransform:{value:new Pn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Pn}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Pn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Pn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Pn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Pn},normalScale:{value:new lt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Pn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Pn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Pn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Pn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new an(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new an(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Pn},alphaTest:{value:0},uvTransform:{value:new Pn}},sprite:{diffuse:{value:new an(16777215)},opacity:{value:1},center:{value:new lt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Pn},alphaMap:{value:null},alphaMapTransform:{value:new Pn},alphaTest:{value:0}}},Hg={basic:{uniforms:Lo([Lt.common,Lt.specularmap,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.fog]),vertexShader:kn.meshbasic_vert,fragmentShader:kn.meshbasic_frag},lambert:{uniforms:Lo([Lt.common,Lt.specularmap,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.fog,Lt.lights,{emissive:{value:new an(0)}}]),vertexShader:kn.meshlambert_vert,fragmentShader:kn.meshlambert_frag},phong:{uniforms:Lo([Lt.common,Lt.specularmap,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.fog,Lt.lights,{emissive:{value:new an(0)},specular:{value:new an(1118481)},shininess:{value:30}}]),vertexShader:kn.meshphong_vert,fragmentShader:kn.meshphong_frag},standard:{uniforms:Lo([Lt.common,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.roughnessmap,Lt.metalnessmap,Lt.fog,Lt.lights,{emissive:{value:new an(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:kn.meshphysical_vert,fragmentShader:kn.meshphysical_frag},toon:{uniforms:Lo([Lt.common,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.gradientmap,Lt.fog,Lt.lights,{emissive:{value:new an(0)}}]),vertexShader:kn.meshtoon_vert,fragmentShader:kn.meshtoon_frag},matcap:{uniforms:Lo([Lt.common,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.fog,{matcap:{value:null}}]),vertexShader:kn.meshmatcap_vert,fragmentShader:kn.meshmatcap_frag},points:{uniforms:Lo([Lt.points,Lt.fog]),vertexShader:kn.points_vert,fragmentShader:kn.points_frag},dashed:{uniforms:Lo([Lt.common,Lt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:kn.linedashed_vert,fragmentShader:kn.linedashed_frag},depth:{uniforms:Lo([Lt.common,Lt.displacementmap]),vertexShader:kn.depth_vert,fragmentShader:kn.depth_frag},normal:{uniforms:Lo([Lt.common,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,{opacity:{value:1}}]),vertexShader:kn.meshnormal_vert,fragmentShader:kn.meshnormal_frag},sprite:{uniforms:Lo([Lt.sprite,Lt.fog]),vertexShader:kn.sprite_vert,fragmentShader:kn.sprite_frag},background:{uniforms:{uvTransform:{value:new Pn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:kn.background_vert,fragmentShader:kn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:kn.backgroundCube_vert,fragmentShader:kn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:kn.cube_vert,fragmentShader:kn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:kn.equirect_vert,fragmentShader:kn.equirect_frag},distanceRGBA:{uniforms:Lo([Lt.common,Lt.displacementmap,{referencePosition:{value:new $},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:kn.distanceRGBA_vert,fragmentShader:kn.distanceRGBA_frag},shadow:{uniforms:Lo([Lt.lights,Lt.fog,{color:{value:new an(0)},opacity:{value:1}}]),vertexShader:kn.shadow_vert,fragmentShader:kn.shadow_frag}};Hg.physical={uniforms:Lo([Hg.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Pn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Pn},clearcoatNormalScale:{value:new lt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Pn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Pn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Pn},sheen:{value:0},sheenColor:{value:new an(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Pn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Pn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Pn},transmissionSamplerSize:{value:new lt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Pn},attenuationDistance:{value:0},attenuationColor:{value:new an(0)},specularColor:{value:new an(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Pn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Pn},anisotropyVector:{value:new lt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Pn}}]),vertexShader:kn.meshphysical_vert,fragmentShader:kn.meshphysical_frag};const AS={r:0,b:0,g:0};function __(r,e,t,n,a,o,c){const I=new an(0);let C=o===!0?0:1,d,f,b=null,v=0,y=null;function Z(R,S){let N=!1,w=S.isScene===!0?S.background:null;w&&w.isTexture&&(w=(S.backgroundBlurriness>0?t:e).get(w)),w===null?V(I,C):w&&w.isColor&&(V(w,1),N=!0);const X=r.xr.getEnvironmentBlendMode();X==="additive"?n.buffers.color.setClear(0,0,0,1,c):X==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,c),(r.autoClear||N)&&r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil),w&&(w.isCubeTexture||w.mapping===lb)?(f===void 0&&(f=new ts(new YA(1,1,1),new zc({name:"BackgroundCubeMaterial",uniforms:sb(Hg.backgroundCube.uniforms),vertexShader:Hg.backgroundCube.vertexShader,fragmentShader:Hg.backgroundCube.fragmentShader,side:Do,depthTest:!1,depthWrite:!1,fog:!1})),f.geometry.deleteAttribute("normal"),f.geometry.deleteAttribute("uv"),f.onBeforeRender=function(H,F,_){this.matrixWorld.copyPosition(_.matrixWorld)},Object.defineProperty(f.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),a.update(f)),f.material.uniforms.envMap.value=w,f.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,f.material.uniforms.backgroundBlurriness.value=S.backgroundBlurriness,f.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,f.material.toneMapped=Ni.getTransfer(w.colorSpace)!==ta,(b!==w||v!==w.version||y!==r.toneMapping)&&(f.material.needsUpdate=!0,b=w,v=w.version,y=r.toneMapping),f.layers.enableAll(),R.unshift(f,f.geometry,f.material,0,0,null)):w&&w.isTexture&&(d===void 0&&(d=new ts(new rG(2,2),new zc({name:"BackgroundMaterial",uniforms:sb(Hg.background.uniforms),vertexShader:Hg.background.vertexShader,fragmentShader:Hg.background.fragmentShader,side:fI,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),Object.defineProperty(d.material,"map",{get:function(){return this.uniforms.t2D.value}}),a.update(d)),d.material.uniforms.t2D.value=w,d.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,d.material.toneMapped=Ni.getTransfer(w.colorSpace)!==ta,w.matrixAutoUpdate===!0&&w.updateMatrix(),d.material.uniforms.uvTransform.value.copy(w.matrix),(b!==w||v!==w.version||y!==r.toneMapping)&&(d.material.needsUpdate=!0,b=w,v=w.version,y=r.toneMapping),d.layers.enableAll(),R.unshift(d,d.geometry,d.material,0,0,null))}function V(R,S){R.getRGB(AS,hK(r)),n.buffers.color.setClear(AS.r,AS.g,AS.b,S,c)}return{getClearColor:function(){return I},setClearColor:function(R,S=1){I.set(R),C=S,V(I,C)},getClearAlpha:function(){return C},setClearAlpha:function(R){C=R,V(I,C)},render:Z}}function k_(r,e,t,n){const a=r.getParameter(r.MAX_VERTEX_ATTRIBS),o=n.isWebGL2?null:e.get("OES_vertex_array_object"),c=n.isWebGL2||o!==null,I={},C=R(null);let d=C,f=!1;function b(se,Ce,he,Be,ve){let we=!1;if(c){const me=V(Be,he,Ce);d!==me&&(d=me,y(d.object)),we=S(se,Be,he,ve),we&&N(se,Be,he,ve)}else{const me=Ce.wireframe===!0;(d.geometry!==Be.id||d.program!==he.id||d.wireframe!==me)&&(d.geometry=Be.id,d.program=he.id,d.wireframe=me,we=!0)}ve!==null&&t.update(ve,r.ELEMENT_ARRAY_BUFFER),(we||f)&&(f=!1,P(se,Ce,he,Be),ve!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.get(ve).buffer))}function v(){return n.isWebGL2?r.createVertexArray():o.createVertexArrayOES()}function y(se){return n.isWebGL2?r.bindVertexArray(se):o.bindVertexArrayOES(se)}function Z(se){return n.isWebGL2?r.deleteVertexArray(se):o.deleteVertexArrayOES(se)}function V(se,Ce,he){const Be=he.wireframe===!0;let ve=I[se.id];ve===void 0&&(ve={},I[se.id]=ve);let we=ve[Ce.id];we===void 0&&(we={},ve[Ce.id]=we);let me=we[Be];return me===void 0&&(me=R(v()),we[Be]=me),me}function R(se){const Ce=[],he=[],Be=[];for(let ve=0;ve<a;ve++)Ce[ve]=0,he[ve]=0,Be[ve]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Ce,enabledAttributes:he,attributeDivisors:Be,object:se,attributes:{},index:null}}function S(se,Ce,he,Be){const ve=d.attributes,we=Ce.attributes;let me=0;const Xe=he.getAttributes();for(const Ue in Xe)if(Xe[Ue].location>=0){const Ee=ve[Ue];let At=we[Ue];if(At===void 0&&(Ue==="instanceMatrix"&&se.instanceMatrix&&(At=se.instanceMatrix),Ue==="instanceColor"&&se.instanceColor&&(At=se.instanceColor)),Ee===void 0||Ee.attribute!==At||At&&Ee.data!==At.data)return!0;me++}return d.attributesNum!==me||d.index!==Be}function N(se,Ce,he,Be){const ve={},we=Ce.attributes;let me=0;const Xe=he.getAttributes();for(const Ue in Xe)if(Xe[Ue].location>=0){let Ee=we[Ue];Ee===void 0&&(Ue==="instanceMatrix"&&se.instanceMatrix&&(Ee=se.instanceMatrix),Ue==="instanceColor"&&se.instanceColor&&(Ee=se.instanceColor));const At={};At.attribute=Ee,Ee&&Ee.data&&(At.data=Ee.data),ve[Ue]=At,me++}d.attributes=ve,d.attributesNum=me,d.index=Be}function w(){const se=d.newAttributes;for(let Ce=0,he=se.length;Ce<he;Ce++)se[Ce]=0}function X(se){H(se,0)}function H(se,Ce){const he=d.newAttributes,Be=d.enabledAttributes,ve=d.attributeDivisors;he[se]=1,Be[se]===0&&(r.enableVertexAttribArray(se),Be[se]=1),ve[se]!==Ce&&((n.isWebGL2?r:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](se,Ce),ve[se]=Ce)}function F(){const se=d.newAttributes,Ce=d.enabledAttributes;for(let he=0,Be=Ce.length;he<Be;he++)Ce[he]!==se[he]&&(r.disableVertexAttribArray(he),Ce[he]=0)}function _(se,Ce,he,Be,ve,we,me){me===!0?r.vertexAttribIPointer(se,Ce,he,ve,we):r.vertexAttribPointer(se,Ce,he,Be,ve,we)}function P(se,Ce,he,Be){if(n.isWebGL2===!1&&(se.isInstancedMesh||Be.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;w();const ve=Be.attributes,we=he.getAttributes(),me=Ce.defaultAttributeValues;for(const Xe in we){const Ue=we[Xe];if(Ue.location>=0){let de=ve[Xe];if(de===void 0&&(Xe==="instanceMatrix"&&se.instanceMatrix&&(de=se.instanceMatrix),Xe==="instanceColor"&&se.instanceColor&&(de=se.instanceColor)),de!==void 0){const Ee=de.normalized,At=de.itemSize,Zt=t.get(de);if(Zt===void 0)continue;const Bt=Zt.buffer,kt=Zt.type,$t=Zt.bytesPerElement,Xt=n.isWebGL2===!0&&(kt===r.INT||kt===r.UNSIGNED_INT||de.gpuType===ON);if(de.isInterleavedBufferAttribute){const Ot=de.data,oe=Ot.stride,ut=de.offset;if(Ot.isInstancedInterleavedBuffer){for(let _e=0;_e<Ue.locationSize;_e++)H(Ue.location+_e,Ot.meshPerAttribute);se.isInstancedMesh!==!0&&Be._maxInstanceCount===void 0&&(Be._maxInstanceCount=Ot.meshPerAttribute*Ot.count)}else for(let _e=0;_e<Ue.locationSize;_e++)X(Ue.location+_e);r.bindBuffer(r.ARRAY_BUFFER,Bt);for(let _e=0;_e<Ue.locationSize;_e++)_(Ue.location+_e,At/Ue.locationSize,kt,Ee,oe*$t,(ut+At/Ue.locationSize*_e)*$t,Xt)}else{if(de.isInstancedBufferAttribute){for(let Ot=0;Ot<Ue.locationSize;Ot++)H(Ue.location+Ot,de.meshPerAttribute);se.isInstancedMesh!==!0&&Be._maxInstanceCount===void 0&&(Be._maxInstanceCount=de.meshPerAttribute*de.count)}else for(let Ot=0;Ot<Ue.locationSize;Ot++)X(Ue.location+Ot);r.bindBuffer(r.ARRAY_BUFFER,Bt);for(let Ot=0;Ot<Ue.locationSize;Ot++)_(Ue.location+Ot,At/Ue.locationSize,kt,Ee,At*$t,At/Ue.locationSize*Ot*$t,Xt)}}else if(me!==void 0){const Ee=me[Xe];if(Ee!==void 0)switch(Ee.length){case 2:r.vertexAttrib2fv(Ue.location,Ee);break;case 3:r.vertexAttrib3fv(Ue.location,Ee);break;case 4:r.vertexAttrib4fv(Ue.location,Ee);break;default:r.vertexAttrib1fv(Ue.location,Ee)}}}}F()}function K(){Ie();for(const se in I){const Ce=I[se];for(const he in Ce){const Be=Ce[he];for(const ve in Be)Z(Be[ve].object),delete Be[ve];delete Ce[he]}delete I[se]}}function E(se){if(I[se.id]===void 0)return;const Ce=I[se.id];for(const he in Ce){const Be=Ce[he];for(const ve in Be)Z(Be[ve].object),delete Be[ve];delete Ce[he]}delete I[se.id]}function ee(se){for(const Ce in I){const he=I[Ce];if(he[se.id]===void 0)continue;const Be=he[se.id];for(const ve in Be)Z(Be[ve].object),delete Be[ve];delete he[se.id]}}function Ie(){be(),f=!0,d!==C&&(d=C,y(d.object))}function be(){C.geometry=null,C.program=null,C.wireframe=!1}return{setup:b,reset:Ie,resetDefaultState:be,dispose:K,releaseStatesOfGeometry:E,releaseStatesOfProgram:ee,initAttributes:w,enableAttribute:X,disableUnusedAttributes:F}}function U_(r,e,t,n){const a=n.isWebGL2;let o;function c(f){o=f}function I(f,b){r.drawArrays(o,f,b),t.update(b,o,1)}function C(f,b,v){if(v===0)return;let y,Z;if(a)y=r,Z="drawArraysInstanced";else if(y=e.get("ANGLE_instanced_arrays"),Z="drawArraysInstancedANGLE",y===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}y[Z](o,f,b,v),t.update(b,o,v)}function d(f,b,v){if(v===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let Z=0;Z<v;Z++)this.render(f[Z],b[Z]);else{y.multiDrawArraysWEBGL(o,f,0,b,0,v);let Z=0;for(let V=0;V<v;V++)Z+=b[V];t.update(Z,o,1)}}this.setMode=c,this.render=I,this.renderInstances=C,this.renderMultiDraw=d}function D_(r,e,t){let n;function a(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const _=e.get("EXT_texture_filter_anisotropic");n=r.getParameter(_.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function o(_){if(_==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";_="mediump"}return _==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const c=typeof WebGL2RenderingContext<"u"&&r.constructor.name==="WebGL2RenderingContext";let I=t.precision!==void 0?t.precision:"highp";const C=o(I);C!==I&&(console.warn("THREE.WebGLRenderer:",I,"not supported, using",C,"instead."),I=C);const d=c||e.has("WEBGL_draw_buffers"),f=t.logarithmicDepthBuffer===!0,b=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),v=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),y=r.getParameter(r.MAX_TEXTURE_SIZE),Z=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),V=r.getParameter(r.MAX_VERTEX_ATTRIBS),R=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),S=r.getParameter(r.MAX_VARYING_VECTORS),N=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),w=v>0,X=c||e.has("OES_texture_float"),H=w&&X,F=c?r.getParameter(r.MAX_SAMPLES):0;return{isWebGL2:c,drawBuffers:d,getMaxAnisotropy:a,getMaxPrecision:o,precision:I,logarithmicDepthBuffer:f,maxTextures:b,maxVertexTextures:v,maxTextureSize:y,maxCubemapSize:Z,maxAttributes:V,maxVertexUniforms:R,maxVaryings:S,maxFragmentUniforms:N,vertexTextures:w,floatFragmentTextures:X,floatVertexTextures:H,maxSamples:F}}function J_(r){const e=this;let t=null,n=0,a=!1,o=!1;const c=new cI,I=new Pn,C={value:null,needsUpdate:!1};this.uniform=C,this.numPlanes=0,this.numIntersection=0,this.init=function(b,v){const y=b.length!==0||v||n!==0||a;return a=v,n=b.length,y},this.beginShadows=function(){o=!0,f(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(b,v){t=f(b,v,0)},this.setState=function(b,v,y){const Z=b.clippingPlanes,V=b.clipIntersection,R=b.clipShadows,S=r.get(b);if(!a||Z===null||Z.length===0||o&&!R)o?f(null):d();else{const N=o?0:n,w=N*4;let X=S.clippingState||null;C.value=X,X=f(Z,v,w,y);for(let H=0;H!==w;++H)X[H]=t[H];S.clippingState=X,this.numIntersection=V?this.numPlanes:0,this.numPlanes+=N}};function d(){C.value!==t&&(C.value=t,C.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function f(b,v,y,Z){const V=b!==null?b.length:0;let R=null;if(V!==0){if(R=C.value,Z!==!0||R===null){const S=y+V*4,N=v.matrixWorldInverse;I.getNormalMatrix(N),(R===null||R.length<S)&&(R=new Float32Array(S));for(let w=0,X=y;w!==V;++w,X+=4)c.copy(b[w]).applyMatrix4(N,I),c.normal.toArray(R,X),R[X+3]=c.constant}C.value=R,C.needsUpdate=!0}return e.numPlanes=V,e.numIntersection=0,R}}function O_(r){let e=new WeakMap;function t(c,I){return I===H0?c.mapping=pI:I===F0&&(c.mapping=tC),c}function n(c){if(c&&c.isTexture){const I=c.mapping;if(I===H0||I===F0)if(e.has(c)){const C=e.get(c).texture;return t(C,c.mapping)}else{const C=c.image;if(C&&C.height>0){const d=new pK(C.height/2);return d.fromEquirectangularTexture(r,c),e.set(c,d),c.addEventListener("dispose",a),t(d.texture,c.mapping)}else return null}}return c}function a(c){const I=c.target;I.removeEventListener("dispose",a);const C=e.get(I);C!==void 0&&(e.delete(I),C.dispose())}function o(){e=new WeakMap}return{get:n,dispose:o}}class $d extends aG{constructor(e=-1,t=1,n=1,a=-1,o=.1,c=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=a,this.near=o,this.far=c,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,a,o,c){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=a,this.view.width=o,this.view.height=c,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,a=(this.top+this.bottom)/2;let o=n-e,c=n+e,I=a+t,C=a-t;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=d*this.view.offsetX,c=o+d*this.view.width,I-=f*this.view.offsetY,C=I-f*this.view.height}this.projectionMatrix.makeOrthographic(o,c,I,C,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Jm=4,iM=[.125,.215,.35,.446,.526,.582],pA=20,sV=new $d,aM=new an;let oV=null,rV=0,lV=0;const AA=(1+Math.sqrt(5))/2,Mm=1/AA,sM=[new $(1,1,1),new $(-1,1,1),new $(1,1,-1),new $(-1,1,-1),new $(0,AA,Mm),new $(0,AA,-Mm),new $(Mm,0,AA),new $(-Mm,0,AA),new $(AA,Mm,0),new $(-AA,Mm,0)];class BN{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,a=100){oV=this._renderer.getRenderTarget(),rV=this._renderer.getActiveCubeFace(),lV=this._renderer.getActiveMipmapLevel(),this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,a,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=lM(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=rM(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(oV,rV,lV),e.scissorTest=!1,fS(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===pI||e.mapping===tC?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),oV=this._renderer.getRenderTarget(),rV=this._renderer.getActiveCubeFace(),lV=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Ka,minFilter:Ka,generateMipmaps:!1,type:nb,format:Uo,colorSpace:Tc,depthBuffer:!1},a=oM(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=oM(e,t,n);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=P_(o)),this._blurMaterial=Q_(o,e,t)}return a}_compileMaterial(e){const t=new ts(this._lodPlanes[0],e);this._renderer.compile(t,sV)}_sceneToCubeUV(e,t,n,a){const I=new Ea(90,1,t,n),C=[1,-1,1,1,1,1],d=[1,1,1,-1,-1,-1],f=this._renderer,b=f.autoClear,v=f.toneMapping;f.getClearColor(aM),f.toneMapping=Fc,f.autoClear=!1;const y=new sC({name:"PMREM.Background",side:Do,depthWrite:!1,depthTest:!1}),Z=new ts(new YA,y);let V=!1;const R=e.background;R?R.isColor&&(y.color.copy(R),e.background=null,V=!0):(y.color.copy(aM),V=!0);for(let S=0;S<6;S++){const N=S%3;N===0?(I.up.set(0,C[S],0),I.lookAt(d[S],0,0)):N===1?(I.up.set(0,0,C[S]),I.lookAt(0,d[S],0)):(I.up.set(0,C[S],0),I.lookAt(0,0,d[S]));const w=this._cubeSize;fS(a,N*w,S>2?w:0,w,w),f.setRenderTarget(a),V&&f.render(Z,I),f.render(e,I)}Z.geometry.dispose(),Z.material.dispose(),f.toneMapping=v,f.autoClear=b,e.background=R}_textureToCubeUV(e,t){const n=this._renderer,a=e.mapping===pI||e.mapping===tC;a?(this._cubemapMaterial===null&&(this._cubemapMaterial=lM()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=rM());const o=a?this._cubemapMaterial:this._equirectMaterial,c=new ts(this._lodPlanes[0],o),I=o.uniforms;I.envMap.value=e;const C=this._cubeSize;fS(t,0,0,3*C,2*C),n.setRenderTarget(t),n.render(c,sV)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let a=1;a<this._lodPlanes.length;a++){const o=Math.sqrt(this._sigmas[a]*this._sigmas[a]-this._sigmas[a-1]*this._sigmas[a-1]),c=sM[(a-1)%sM.length];this._blur(e,a-1,a,o,c)}t.autoClear=n}_blur(e,t,n,a,o){const c=this._pingPongRenderTarget;this._halfBlur(e,c,t,n,a,"latitudinal",o),this._halfBlur(c,e,n,n,a,"longitudinal",o)}_halfBlur(e,t,n,a,o,c,I){const C=this._renderer,d=this._blurMaterial;c!=="latitudinal"&&c!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const f=3,b=new ts(this._lodPlanes[a],d),v=d.uniforms,y=this._sizeLods[n]-1,Z=isFinite(o)?Math.PI/(2*y):2*Math.PI/(2*pA-1),V=o/Z,R=isFinite(o)?1+Math.floor(f*V):pA;R>pA&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${R} samples when the maximum is set to ${pA}`);const S=[];let N=0;for(let _=0;_<pA;++_){const P=_/V,K=Math.exp(-P*P/2);S.push(K),_===0?N+=K:_<R&&(N+=2*K)}for(let _=0;_<S.length;_++)S[_]=S[_]/N;v.envMap.value=e.texture,v.samples.value=R,v.weights.value=S,v.latitudinal.value=c==="latitudinal",I&&(v.poleAxis.value=I);const{_lodMax:w}=this;v.dTheta.value=Z,v.mipInt.value=w-n;const X=this._sizeLods[a],H=3*X*(a>w-Jm?a-w+Jm:0),F=4*(this._cubeSize-X);fS(t,H,F,3*X,2*X),C.setRenderTarget(t),C.render(b,sV)}}function P_(r){const e=[],t=[],n=[];let a=r;const o=r-Jm+1+iM.length;for(let c=0;c<o;c++){const I=Math.pow(2,a);t.push(I);let C=1/I;c>r-Jm?C=iM[c-r+Jm-1]:c===0&&(C=0),n.push(C);const d=1/(I-2),f=-d,b=1+d,v=[f,f,b,f,b,b,f,f,b,b,f,b],y=6,Z=6,V=3,R=2,S=1,N=new Float32Array(V*Z*y),w=new Float32Array(R*Z*y),X=new Float32Array(S*Z*y);for(let F=0;F<y;F++){const _=F%3*2/3-1,P=F>2?0:-1,K=[_,P,0,_+2/3,P,0,_+2/3,P+1,0,_,P,0,_+2/3,P+1,0,_,P+1,0];N.set(K,V*Z*F),w.set(v,R*Z*F);const E=[F,F,F,F,F,F];X.set(E,S*Z*F)}const H=new Qn;H.setAttribute("position",new Yi(N,V)),H.setAttribute("uv",new Yi(w,R)),H.setAttribute("faceIndex",new Yi(X,S)),e.push(H),a>Jm&&a--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function oM(r,e,t){const n=new Eg(r,e,t);return n.texture.mapping=lb,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function fS(r,e,t,n,a){r.viewport.set(e,t,n,a),r.scissor.set(e,t,n,a)}function Q_(r,e,t){const n=new Float32Array(pA),a=new $(0,1,0);return new zc({name:"SphericalGaussianBlur",defines:{n:pA,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a}},vertexShader:g2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:AI,depthTest:!1,depthWrite:!1})}function rM(){return new zc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:g2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:AI,depthTest:!1,depthWrite:!1})}function lM(){return new zc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:g2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:AI,depthTest:!1,depthWrite:!1})}function g2(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function j_(r){let e=new WeakMap,t=null;function n(I){if(I&&I.isTexture){const C=I.mapping,d=C===H0||C===F0,f=C===pI||C===tC;if(d||f)if(I.isRenderTargetTexture&&I.needsPMREMUpdate===!0){I.needsPMREMUpdate=!1;let b=e.get(I);return t===null&&(t=new BN(r)),b=d?t.fromEquirectangular(I,b):t.fromCubemap(I,b),e.set(I,b),b.texture}else{if(e.has(I))return e.get(I).texture;{const b=I.image;if(d&&b&&b.height>0||f&&b&&a(b)){t===null&&(t=new BN(r));const v=d?t.fromEquirectangular(I):t.fromCubemap(I);return e.set(I,v),I.addEventListener("dispose",o),v.texture}else return null}}}return I}function a(I){let C=0;const d=6;for(let f=0;f<d;f++)I[f]!==void 0&&C++;return C===d}function o(I){const C=I.target;C.removeEventListener("dispose",o);const d=e.get(C);d!==void 0&&(e.delete(C),d.dispose())}function c(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:c}}function q_(r){const e={};function t(n){if(e[n]!==void 0)return e[n];let a;switch(n){case"WEBGL_depth_texture":a=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":a=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:a=r.getExtension(n)}return e[n]=a,a}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?(t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance")):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const a=t(n);return a===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),a}}}function $_(r,e,t,n){const a={},o=new WeakMap;function c(b){const v=b.target;v.index!==null&&e.remove(v.index);for(const Z in v.attributes)e.remove(v.attributes[Z]);for(const Z in v.morphAttributes){const V=v.morphAttributes[Z];for(let R=0,S=V.length;R<S;R++)e.remove(V[R])}v.removeEventListener("dispose",c),delete a[v.id];const y=o.get(v);y&&(e.remove(y),o.delete(v)),n.releaseStatesOfGeometry(v),v.isInstancedBufferGeometry===!0&&delete v._maxInstanceCount,t.memory.geometries--}function I(b,v){return a[v.id]===!0||(v.addEventListener("dispose",c),a[v.id]=!0,t.memory.geometries++),v}function C(b){const v=b.attributes;for(const Z in v)e.update(v[Z],r.ARRAY_BUFFER);const y=b.morphAttributes;for(const Z in y){const V=y[Z];for(let R=0,S=V.length;R<S;R++)e.update(V[R],r.ARRAY_BUFFER)}}function d(b){const v=[],y=b.index,Z=b.attributes.position;let V=0;if(y!==null){const N=y.array;V=y.version;for(let w=0,X=N.length;w<X;w+=3){const H=N[w+0],F=N[w+1],_=N[w+2];v.push(H,F,F,_,_,H)}}else if(Z!==void 0){const N=Z.array;V=Z.version;for(let w=0,X=N.length/3-1;w<X;w+=3){const H=w+0,F=w+1,_=w+2;v.push(H,F,F,_,_,H)}}else return;const R=new(uK(v)?l2:r2)(v,1);R.version=V;const S=o.get(b);S&&e.remove(S),o.set(b,R)}function f(b){const v=o.get(b);if(v){const y=b.index;y!==null&&v.version<y.version&&d(b)}else d(b);return o.get(b)}return{get:I,update:C,getWireframeAttribute:f}}function ek(r,e,t,n){const a=n.isWebGL2;let o;function c(y){o=y}let I,C;function d(y){I=y.type,C=y.bytesPerElement}function f(y,Z){r.drawElements(o,Z,I,y*C),t.update(Z,o,1)}function b(y,Z,V){if(V===0)return;let R,S;if(a)R=r,S="drawElementsInstanced";else if(R=e.get("ANGLE_instanced_arrays"),S="drawElementsInstancedANGLE",R===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}R[S](o,Z,I,y*C,V),t.update(Z,o,V)}function v(y,Z,V){if(V===0)return;const R=e.get("WEBGL_multi_draw");if(R===null)for(let S=0;S<V;S++)this.render(y[S]/C,Z[S]);else{R.multiDrawElementsWEBGL(o,Z,0,I,y,0,V);let S=0;for(let N=0;N<V;N++)S+=Z[N];t.update(S,o,1)}}this.setMode=c,this.setIndex=d,this.render=f,this.renderInstances=b,this.renderMultiDraw=v}function tk(r){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(o,c,I){switch(t.calls++,c){case r.TRIANGLES:t.triangles+=I*(o/3);break;case r.LINES:t.lines+=I*(o/2);break;case r.LINE_STRIP:t.lines+=I*(o-1);break;case r.LINE_LOOP:t.lines+=I*o;break;case r.POINTS:t.points+=I*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",c);break}}function a(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:a,update:n}}function nk(r,e){return r[0]-e[0]}function ik(r,e){return Math.abs(e[1])-Math.abs(r[1])}function ak(r,e,t){const n={},a=new Float32Array(8),o=new WeakMap,c=new Xi,I=[];for(let d=0;d<8;d++)I[d]=[d,0];function C(d,f,b){const v=d.morphTargetInfluences;if(e.isWebGL2===!0){const Z=f.morphAttributes.position||f.morphAttributes.normal||f.morphAttributes.color,V=Z!==void 0?Z.length:0;let R=o.get(f);if(R===void 0||R.count!==V){let Ce=function(){be.dispose(),o.delete(f),f.removeEventListener("dispose",Ce)};var y=Ce;R!==void 0&&R.texture.dispose();const w=f.morphAttributes.position!==void 0,X=f.morphAttributes.normal!==void 0,H=f.morphAttributes.color!==void 0,F=f.morphAttributes.position||[],_=f.morphAttributes.normal||[],P=f.morphAttributes.color||[];let K=0;w===!0&&(K=1),X===!0&&(K=2),H===!0&&(K=3);let E=f.attributes.position.count*K,ee=1;E>e.maxTextureSize&&(ee=Math.ceil(E/e.maxTextureSize),E=e.maxTextureSize);const Ie=new Float32Array(E*ee*4*V),be=new RR(Ie,E,ee,V);be.type=Fg,be.needsUpdate=!0;const se=K*4;for(let he=0;he<V;he++){const Be=F[he],ve=_[he],we=P[he],me=E*ee*4*he;for(let Xe=0;Xe<Be.count;Xe++){const Ue=Xe*se;w===!0&&(c.fromBufferAttribute(Be,Xe),Ie[me+Ue+0]=c.x,Ie[me+Ue+1]=c.y,Ie[me+Ue+2]=c.z,Ie[me+Ue+3]=0),X===!0&&(c.fromBufferAttribute(ve,Xe),Ie[me+Ue+4]=c.x,Ie[me+Ue+5]=c.y,Ie[me+Ue+6]=c.z,Ie[me+Ue+7]=0),H===!0&&(c.fromBufferAttribute(we,Xe),Ie[me+Ue+8]=c.x,Ie[me+Ue+9]=c.y,Ie[me+Ue+10]=c.z,Ie[me+Ue+11]=we.itemSize===4?c.w:1)}}R={count:V,texture:be,size:new lt(E,ee)},o.set(f,R),f.addEventListener("dispose",Ce)}let S=0;for(let w=0;w<v.length;w++)S+=v[w];const N=f.morphTargetsRelative?1:1-S;b.getUniforms().setValue(r,"morphTargetBaseInfluence",N),b.getUniforms().setValue(r,"morphTargetInfluences",v),b.getUniforms().setValue(r,"morphTargetsTexture",R.texture,t),b.getUniforms().setValue(r,"morphTargetsTextureSize",R.size)}else{const Z=v===void 0?0:v.length;let V=n[f.id];if(V===void 0||V.length!==Z){V=[];for(let X=0;X<Z;X++)V[X]=[X,0];n[f.id]=V}for(let X=0;X<Z;X++){const H=V[X];H[0]=X,H[1]=v[X]}V.sort(ik);for(let X=0;X<8;X++)X<Z&&V[X][1]?(I[X][0]=V[X][0],I[X][1]=V[X][1]):(I[X][0]=Number.MAX_SAFE_INTEGER,I[X][1]=0);I.sort(nk);const R=f.morphAttributes.position,S=f.morphAttributes.normal;let N=0;for(let X=0;X<8;X++){const H=I[X],F=H[0],_=H[1];F!==Number.MAX_SAFE_INTEGER&&_?(R&&f.getAttribute("morphTarget"+X)!==R[F]&&f.setAttribute("morphTarget"+X,R[F]),S&&f.getAttribute("morphNormal"+X)!==S[F]&&f.setAttribute("morphNormal"+X,S[F]),a[X]=_,N+=_):(R&&f.hasAttribute("morphTarget"+X)===!0&&f.deleteAttribute("morphTarget"+X),S&&f.hasAttribute("morphNormal"+X)===!0&&f.deleteAttribute("morphNormal"+X),a[X]=0)}const w=f.morphTargetsRelative?1:1-N;b.getUniforms().setValue(r,"morphTargetBaseInfluence",w),b.getUniforms().setValue(r,"morphTargetInfluences",a)}}return{update:C}}function sk(r,e,t,n){let a=new WeakMap;function o(C){const d=n.render.frame,f=C.geometry,b=e.get(C,f);if(a.get(b)!==d&&(e.update(b),a.set(b,d)),C.isInstancedMesh&&(C.hasEventListener("dispose",I)===!1&&C.addEventListener("dispose",I),a.get(C)!==d&&(t.update(C.instanceMatrix,r.ARRAY_BUFFER),C.instanceColor!==null&&t.update(C.instanceColor,r.ARRAY_BUFFER),a.set(C,d))),C.isSkinnedMesh){const v=C.skeleton;a.get(v)!==d&&(v.update(),a.set(v,d))}return b}function c(){a=new WeakMap}function I(C){const d=C.target;d.removeEventListener("dispose",I),t.remove(d.instanceMatrix),d.instanceColor!==null&&t.remove(d.instanceColor)}return{update:o,dispose:c}}class c2 extends Ta{constructor(e,t,n,a,o,c,I,C,d,f){if(f=f!==void 0?f:jd,f!==jd&&f!==xA)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&f===jd&&(n=II),n===void 0&&f===xA&&(n=Qd),super(null,a,o,c,I,C,f,n,d),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=I!==void 0?I:Fa,this.minFilter=C!==void 0?C:Fa,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const bK=new Ta,vK=new c2(1,1);vK.compareFunction=i2;const yK=new RR,GK=new o2,BK=new sG,gM=[],cM=[],uM=new Float32Array(16),IM=new Float32Array(9),dM=new Float32Array(4);function cb(r,e,t){const n=r[0];if(n<=0||n>0)return r;const a=e*t;let o=gM[a];if(o===void 0&&(o=new Float32Array(a),gM[a]=o),e!==0){n.toArray(o,0);for(let c=1,I=0;c!==e;++c)I+=t,r[c].toArray(o,I)}return o}function fs(r,e){if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;t++)if(r[t]!==e[t])return!1;return!0}function ps(r,e){for(let t=0,n=e.length;t<n;t++)r[t]=e[t]}function wR(r,e){let t=cM[e];t===void 0&&(t=new Int32Array(e),cM[e]=t);for(let n=0;n!==e;++n)t[n]=r.allocateTextureUnit();return t}function ok(r,e){const t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function rk(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(fs(t,e))return;r.uniform2fv(this.addr,e),ps(t,e)}}function lk(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(fs(t,e))return;r.uniform3fv(this.addr,e),ps(t,e)}}function gk(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(fs(t,e))return;r.uniform4fv(this.addr,e),ps(t,e)}}function ck(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(fs(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),ps(t,e)}else{if(fs(t,n))return;dM.set(n),r.uniformMatrix2fv(this.addr,!1,dM),ps(t,n)}}function uk(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(fs(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),ps(t,e)}else{if(fs(t,n))return;IM.set(n),r.uniformMatrix3fv(this.addr,!1,IM),ps(t,n)}}function Ik(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(fs(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),ps(t,e)}else{if(fs(t,n))return;uM.set(n),r.uniformMatrix4fv(this.addr,!1,uM),ps(t,n)}}function dk(r,e){const t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function Ck(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(fs(t,e))return;r.uniform2iv(this.addr,e),ps(t,e)}}function hk(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(fs(t,e))return;r.uniform3iv(this.addr,e),ps(t,e)}}function Ak(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(fs(t,e))return;r.uniform4iv(this.addr,e),ps(t,e)}}function fk(r,e){const t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function pk(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(fs(t,e))return;r.uniform2uiv(this.addr,e),ps(t,e)}}function mk(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(fs(t,e))return;r.uniform3uiv(this.addr,e),ps(t,e)}}function bk(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(fs(t,e))return;r.uniform4uiv(this.addr,e),ps(t,e)}}function vk(r,e,t){const n=this.cache,a=t.allocateTextureUnit();n[0]!==a&&(r.uniform1i(this.addr,a),n[0]=a);const o=this.type===r.SAMPLER_2D_SHADOW?vK:bK;t.setTexture2D(e||o,a)}function yk(r,e,t){const n=this.cache,a=t.allocateTextureUnit();n[0]!==a&&(r.uniform1i(this.addr,a),n[0]=a),t.setTexture3D(e||GK,a)}function Gk(r,e,t){const n=this.cache,a=t.allocateTextureUnit();n[0]!==a&&(r.uniform1i(this.addr,a),n[0]=a),t.setTextureCube(e||BK,a)}function Bk(r,e,t){const n=this.cache,a=t.allocateTextureUnit();n[0]!==a&&(r.uniform1i(this.addr,a),n[0]=a),t.setTexture2DArray(e||yK,a)}function Zk(r){switch(r){case 5126:return ok;case 35664:return rk;case 35665:return lk;case 35666:return gk;case 35674:return ck;case 35675:return uk;case 35676:return Ik;case 5124:case 35670:return dk;case 35667:case 35671:return Ck;case 35668:case 35672:return hk;case 35669:case 35673:return Ak;case 5125:return fk;case 36294:return pk;case 36295:return mk;case 36296:return bk;case 35678:case 36198:case 36298:case 36306:case 35682:return vk;case 35679:case 36299:case 36307:return yk;case 35680:case 36300:case 36308:case 36293:return Gk;case 36289:case 36303:case 36311:case 36292:return Bk}}function Sk(r,e){r.uniform1fv(this.addr,e)}function Rk(r,e){const t=cb(e,this.size,2);r.uniform2fv(this.addr,t)}function wk(r,e){const t=cb(e,this.size,3);r.uniform3fv(this.addr,t)}function Wk(r,e){const t=cb(e,this.size,4);r.uniform4fv(this.addr,t)}function xk(r,e){const t=cb(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function Vk(r,e){const t=cb(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function Nk(r,e){const t=cb(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function Xk(r,e){r.uniform1iv(this.addr,e)}function Yk(r,e){r.uniform2iv(this.addr,e)}function Mk(r,e){r.uniform3iv(this.addr,e)}function Hk(r,e){r.uniform4iv(this.addr,e)}function Fk(r,e){r.uniform1uiv(this.addr,e)}function Kk(r,e){r.uniform2uiv(this.addr,e)}function Ek(r,e){r.uniform3uiv(this.addr,e)}function Tk(r,e){r.uniform4uiv(this.addr,e)}function zk(r,e,t){const n=this.cache,a=e.length,o=wR(t,a);fs(n,o)||(r.uniform1iv(this.addr,o),ps(n,o));for(let c=0;c!==a;++c)t.setTexture2D(e[c]||bK,o[c])}function Lk(r,e,t){const n=this.cache,a=e.length,o=wR(t,a);fs(n,o)||(r.uniform1iv(this.addr,o),ps(n,o));for(let c=0;c!==a;++c)t.setTexture3D(e[c]||GK,o[c])}function _k(r,e,t){const n=this.cache,a=e.length,o=wR(t,a);fs(n,o)||(r.uniform1iv(this.addr,o),ps(n,o));for(let c=0;c!==a;++c)t.setTextureCube(e[c]||BK,o[c])}function kk(r,e,t){const n=this.cache,a=e.length,o=wR(t,a);fs(n,o)||(r.uniform1iv(this.addr,o),ps(n,o));for(let c=0;c!==a;++c)t.setTexture2DArray(e[c]||yK,o[c])}function Uk(r){switch(r){case 5126:return Sk;case 35664:return Rk;case 35665:return wk;case 35666:return Wk;case 35674:return xk;case 35675:return Vk;case 35676:return Nk;case 5124:case 35670:return Xk;case 35667:case 35671:return Yk;case 35668:case 35672:return Mk;case 35669:case 35673:return Hk;case 5125:return Fk;case 36294:return Kk;case 36295:return Ek;case 36296:return Tk;case 35678:case 36198:case 36298:case 36306:case 35682:return zk;case 35679:case 36299:case 36307:return Lk;case 35680:case 36300:case 36308:case 36293:return _k;case 36289:case 36303:case 36311:case 36292:return kk}}class Dk{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=Zk(t.type)}}class Jk{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=Uk(t.type)}}class Ok{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const a=this.seq;for(let o=0,c=a.length;o!==c;++o){const I=a[o];I.setValue(e,t[I.id],n)}}}const gV=/(\w+)(\])?(\[|\.)?/g;function CM(r,e){r.seq.push(e),r.map[e.id]=e}function Pk(r,e,t){const n=r.name,a=n.length;for(gV.lastIndex=0;;){const o=gV.exec(n),c=gV.lastIndex;let I=o[1];const C=o[2]==="]",d=o[3];if(C&&(I=I|0),d===void 0||d==="["&&c+2===a){CM(t,d===void 0?new Dk(I,r,e):new Jk(I,r,e));break}else{let b=t.map[I];b===void 0&&(b=new Ok(I),CM(t,b)),t=b}}}class aR{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let a=0;a<n;++a){const o=e.getActiveUniform(t,a),c=e.getUniformLocation(t,o.name);Pk(o,c,this)}}setValue(e,t,n,a){const o=this.map[t];o!==void 0&&o.setValue(e,n,a)}setOptional(e,t,n){const a=t[n];a!==void 0&&this.setValue(e,n,a)}static upload(e,t,n,a){for(let o=0,c=t.length;o!==c;++o){const I=t[o],C=n[I.id];C.needsUpdate!==!1&&I.setValue(e,C.value,a)}}static seqWithValue(e,t){const n=[];for(let a=0,o=e.length;a!==o;++a){const c=e[a];c.id in t&&n.push(c)}return n}}function hM(r,e,t){const n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),n}const Qk=37297;let jk=0;function qk(r,e){const t=r.split(`
`),n=[],a=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let c=a;c<o;c++){const I=c+1;n.push(`${I===e?">":" "} ${I}: ${t[c]}`)}return n.join(`
`)}function $k(r){const e=Ni.getPrimaries(Ni.workingColorSpace),t=Ni.getPrimaries(r);let n;switch(e===t?n="":e===U0&&t===k0?n="LinearDisplayP3ToLinearSRGB":e===k0&&t===U0&&(n="LinearSRGBToLinearDisplayP3"),r){case Tc:case iG:return[n,"LinearTransferOETF"];case As:case SR:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",r),[n,"LinearTransferOETF"]}}function AM(r,e,t){const n=r.getShaderParameter(e,r.COMPILE_STATUS),a=r.getShaderInfoLog(e).trim();if(n&&a==="")return"";const o=/ERROR: 0:(\d+)/.exec(a);if(o){const c=parseInt(o[1]);return t.toUpperCase()+`

`+a+`

`+qk(r.getShaderSource(e),c)}else return a}function eU(r,e){const t=$k(e);return`vec4 ${r}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function tU(r,e){let t;switch(e){case FF:t="Linear";break;case KF:t="Reinhard";break;case EF:t="OptimizedCineon";break;case DN:t="ACESFilmic";break;case zF:t="AgX";break;case TF:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+r+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function nU(r){return[r.extensionDerivatives||r.envMapCubeUVHeight||r.bumpMap||r.normalMapTangentSpace||r.clearcoatNormalMap||r.flatShading||r.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(r.extensionFragDepth||r.logarithmicDepthBuffer)&&r.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",r.extensionDrawBuffers&&r.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(r.extensionShaderTextureLOD||r.envMap||r.transmission)&&r.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Om).join(`
`)}function iU(r){return[r.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":""].filter(Om).join(`
`)}function aU(r){const e=[];for(const t in r){const n=r[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function sU(r,e){const t={},n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let a=0;a<n;a++){const o=r.getActiveAttrib(e,a),c=o.name;let I=1;o.type===r.FLOAT_MAT2&&(I=2),o.type===r.FLOAT_MAT3&&(I=3),o.type===r.FLOAT_MAT4&&(I=4),t[c]={type:o.type,location:r.getAttribLocation(e,c),locationSize:I}}return t}function Om(r){return r!==""}function fM(r,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function pM(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const oU=/^[ \t]*#include +<([\w\d./]+)>/gm;function ZN(r){return r.replace(oU,lU)}const rU=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function lU(r,e){let t=kn[e];if(t===void 0){const n=rU.get(e);if(n!==void 0)t=kn[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return ZN(t)}const gU=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function mM(r){return r.replace(gU,cU)}function cU(r,e,t,n){let a="";for(let o=parseInt(e);o<parseInt(t);o++)a+=n.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return a}function bM(r){let e="precision "+r.precision+` float;
precision `+r.precision+" int;";return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function uU(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===yR?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===W0?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===Yg&&(e="SHADOWMAP_TYPE_VSM"),e}function IU(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case pI:case tC:e="ENVMAP_TYPE_CUBE";break;case lb:e="ENVMAP_TYPE_CUBE_UV";break}return e}function dU(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case tC:e="ENVMAP_MODE_REFRACTION";break}return e}function CU(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case nG:e="ENVMAP_BLENDING_MULTIPLY";break;case MF:e="ENVMAP_BLENDING_MIX";break;case HF:e="ENVMAP_BLENDING_ADD";break}return e}function hU(r){const e=r.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function AU(r,e,t,n){const a=r.getContext(),o=t.defines;let c=t.vertexShader,I=t.fragmentShader;const C=uU(t),d=IU(t),f=dU(t),b=CU(t),v=hU(t),y=t.isWebGL2?"":nU(t),Z=iU(t),V=aU(o),R=a.createProgram();let S,N,w=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(S=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,V].filter(Om).join(`
`),S.length>0&&(S+=`
`),N=[y,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,V].filter(Om).join(`
`),N.length>0&&(N+=`
`)):(S=[bM(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,V,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+f:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+C:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Om).join(`
`),N=[y,bM(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,V,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.envMap?"#define "+f:"",t.envMap?"#define "+b:"",v?"#define CUBEUV_TEXEL_WIDTH "+v.texelWidth:"",v?"#define CUBEUV_TEXEL_HEIGHT "+v.texelHeight:"",v?"#define CUBEUV_MAX_MIP "+v.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+C:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Fc?"#define TONE_MAPPING":"",t.toneMapping!==Fc?kn.tonemapping_pars_fragment:"",t.toneMapping!==Fc?tU("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",kn.colorspace_pars_fragment,eU("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Om).join(`
`)),c=ZN(c),c=fM(c,t),c=pM(c,t),I=ZN(I),I=fM(I,t),I=pM(I,t),c=mM(c),I=mM(I),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(w=`#version 300 es
`,S=[Z,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+S,N=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===yN?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===yN?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+N);const X=w+S+c,H=w+N+I,F=hM(a,a.VERTEX_SHADER,X),_=hM(a,a.FRAGMENT_SHADER,H);a.attachShader(R,F),a.attachShader(R,_),t.index0AttributeName!==void 0?a.bindAttribLocation(R,0,t.index0AttributeName):t.morphTargets===!0&&a.bindAttribLocation(R,0,"position"),a.linkProgram(R);function P(Ie){if(r.debug.checkShaderErrors){const be=a.getProgramInfoLog(R).trim(),se=a.getShaderInfoLog(F).trim(),Ce=a.getShaderInfoLog(_).trim();let he=!0,Be=!0;if(a.getProgramParameter(R,a.LINK_STATUS)===!1)if(he=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(a,R,F,_);else{const ve=AM(a,F,"vertex"),we=AM(a,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(R,a.VALIDATE_STATUS)+`

Program Info Log: `+be+`
`+ve+`
`+we)}else be!==""?console.warn("THREE.WebGLProgram: Program Info Log:",be):(se===""||Ce==="")&&(Be=!1);Be&&(Ie.diagnostics={runnable:he,programLog:be,vertexShader:{log:se,prefix:S},fragmentShader:{log:Ce,prefix:N}})}a.deleteShader(F),a.deleteShader(_),K=new aR(a,R),E=sU(a,R)}let K;this.getUniforms=function(){return K===void 0&&P(this),K};let E;this.getAttributes=function(){return E===void 0&&P(this),E};let ee=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return ee===!1&&(ee=a.getProgramParameter(R,Qk)),ee},this.destroy=function(){n.releaseStatesOfProgram(this),a.deleteProgram(R),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=jk++,this.cacheKey=e,this.usedTimes=1,this.program=R,this.vertexShader=F,this.fragmentShader=_,this}let fU=0;class pU{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,a=this._getShaderStage(t),o=this._getShaderStage(n),c=this._getShaderCacheForMaterial(e);return c.has(a)===!1&&(c.add(a),a.usedTimes++),c.has(o)===!1&&(c.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new mU(e),t.set(e,n)),n}}class mU{constructor(e){this.id=fU++,this.code=e,this.usedTimes=0}}function bU(r,e,t,n,a,o,c){const I=new RA,C=new pU,d=[],f=a.isWebGL2,b=a.logarithmicDepthBuffer,v=a.vertexTextures;let y=a.precision;const Z={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function V(K){return K===0?"uv":`uv${K}`}function R(K,E,ee,Ie,be){const se=Ie.fog,Ce=be.geometry,he=K.isMeshStandardMaterial?Ie.environment:null,Be=(K.isMeshStandardMaterial?t:e).get(K.envMap||he),ve=Be&&Be.mapping===lb?Be.image.height:null,we=Z[K.type];K.precision!==null&&(y=a.getMaxPrecision(K.precision),y!==K.precision&&console.warn("THREE.WebGLProgram.getParameters:",K.precision,"not supported, using",y,"instead."));const me=Ce.morphAttributes.position||Ce.morphAttributes.normal||Ce.morphAttributes.color,Xe=me!==void 0?me.length:0;let Ue=0;Ce.morphAttributes.position!==void 0&&(Ue=1),Ce.morphAttributes.normal!==void 0&&(Ue=2),Ce.morphAttributes.color!==void 0&&(Ue=3);let de,Ee,At,Zt;if(we){const Dn=Hg[we];de=Dn.vertexShader,Ee=Dn.fragmentShader}else de=K.vertexShader,Ee=K.fragmentShader,C.update(K),At=C.getVertexShaderID(K),Zt=C.getFragmentShaderID(K);const Bt=r.getRenderTarget(),kt=be.isInstancedMesh===!0,$t=be.isBatchedMesh===!0,Xt=!!K.map,Ot=!!K.matcap,oe=!!Be,ut=!!K.aoMap,_e=!!K.lightMap,it=!!K.bumpMap,Te=!!K.normalMap,Et=!!K.displacementMap,Wt=!!K.emissiveMap,O=!!K.metalnessMap,k=!!K.roughnessMap,Ae=K.anisotropy>0,Oe=K.clearcoat>0,$e=K.iridescence>0,et=K.sheen>0,Yt=K.transmission>0,vt=Ae&&!!K.anisotropyMap,Vt=Oe&&!!K.clearcoatMap,tn=Oe&&!!K.clearcoatNormalMap,un=Oe&&!!K.clearcoatRoughnessMap,ae=$e&&!!K.iridescenceMap,Le=$e&&!!K.iridescenceThicknessMap,at=et&&!!K.sheenColorMap,Pe=et&&!!K.sheenRoughnessMap,pt=!!K.specularMap,Ct=!!K.specularColorMap,q=!!K.specularIntensityMap,ye=Yt&&!!K.transmissionMap,gt=Yt&&!!K.thicknessMap,De=!!K.gradientMap,Ne=!!K.alphaMap,ce=K.alphaTest>0,dt=!!K.alphaHash,wt=!!K.extensions,rn=!!Ce.attributes.uv1,mt=!!Ce.attributes.uv2,mn=!!Ce.attributes.uv3;let Wn=Fc;return K.toneMapped&&(Bt===null||Bt.isXRRenderTarget===!0)&&(Wn=r.toneMapping),{isWebGL2:f,shaderID:we,shaderType:K.type,shaderName:K.name,vertexShader:de,fragmentShader:Ee,defines:K.defines,customVertexShaderID:At,customFragmentShaderID:Zt,isRawShaderMaterial:K.isRawShaderMaterial===!0,glslVersion:K.glslVersion,precision:y,batching:$t,instancing:kt,instancingColor:kt&&be.instanceColor!==null,supportsVertexTextures:v,outputColorSpace:Bt===null?r.outputColorSpace:Bt.isXRRenderTarget===!0?Bt.texture.colorSpace:Tc,map:Xt,matcap:Ot,envMap:oe,envMapMode:oe&&Be.mapping,envMapCubeUVHeight:ve,aoMap:ut,lightMap:_e,bumpMap:it,normalMap:Te,displacementMap:v&&Et,emissiveMap:Wt,normalMapObjectSpace:Te&&K.normalMapType===nK,normalMapTangentSpace:Te&&K.normalMapType===aC,metalnessMap:O,roughnessMap:k,anisotropy:Ae,anisotropyMap:vt,clearcoat:Oe,clearcoatMap:Vt,clearcoatNormalMap:tn,clearcoatRoughnessMap:un,iridescence:$e,iridescenceMap:ae,iridescenceThicknessMap:Le,sheen:et,sheenColorMap:at,sheenRoughnessMap:Pe,specularMap:pt,specularColorMap:Ct,specularIntensityMap:q,transmission:Yt,transmissionMap:ye,thicknessMap:gt,gradientMap:De,opaque:K.transparent===!1&&K.blending===ZA,alphaMap:Ne,alphaTest:ce,alphaHash:dt,combine:K.combine,mapUv:Xt&&V(K.map.channel),aoMapUv:ut&&V(K.aoMap.channel),lightMapUv:_e&&V(K.lightMap.channel),bumpMapUv:it&&V(K.bumpMap.channel),normalMapUv:Te&&V(K.normalMap.channel),displacementMapUv:Et&&V(K.displacementMap.channel),emissiveMapUv:Wt&&V(K.emissiveMap.channel),metalnessMapUv:O&&V(K.metalnessMap.channel),roughnessMapUv:k&&V(K.roughnessMap.channel),anisotropyMapUv:vt&&V(K.anisotropyMap.channel),clearcoatMapUv:Vt&&V(K.clearcoatMap.channel),clearcoatNormalMapUv:tn&&V(K.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:un&&V(K.clearcoatRoughnessMap.channel),iridescenceMapUv:ae&&V(K.iridescenceMap.channel),iridescenceThicknessMapUv:Le&&V(K.iridescenceThicknessMap.channel),sheenColorMapUv:at&&V(K.sheenColorMap.channel),sheenRoughnessMapUv:Pe&&V(K.sheenRoughnessMap.channel),specularMapUv:pt&&V(K.specularMap.channel),specularColorMapUv:Ct&&V(K.specularColorMap.channel),specularIntensityMapUv:q&&V(K.specularIntensityMap.channel),transmissionMapUv:ye&&V(K.transmissionMap.channel),thicknessMapUv:gt&&V(K.thicknessMap.channel),alphaMapUv:Ne&&V(K.alphaMap.channel),vertexTangents:!!Ce.attributes.tangent&&(Te||Ae),vertexColors:K.vertexColors,vertexAlphas:K.vertexColors===!0&&!!Ce.attributes.color&&Ce.attributes.color.itemSize===4,vertexUv1s:rn,vertexUv2s:mt,vertexUv3s:mn,pointsUvs:be.isPoints===!0&&!!Ce.attributes.uv&&(Xt||Ne),fog:!!se,useFog:K.fog===!0,fogExp2:se&&se.isFogExp2,flatShading:K.flatShading===!0,sizeAttenuation:K.sizeAttenuation===!0,logarithmicDepthBuffer:b,skinning:be.isSkinnedMesh===!0,morphTargets:Ce.morphAttributes.position!==void 0,morphNormals:Ce.morphAttributes.normal!==void 0,morphColors:Ce.morphAttributes.color!==void 0,morphTargetsCount:Xe,morphTextureStride:Ue,numDirLights:E.directional.length,numPointLights:E.point.length,numSpotLights:E.spot.length,numSpotLightMaps:E.spotLightMap.length,numRectAreaLights:E.rectArea.length,numHemiLights:E.hemi.length,numDirLightShadows:E.directionalShadowMap.length,numPointLightShadows:E.pointShadowMap.length,numSpotLightShadows:E.spotShadowMap.length,numSpotLightShadowsWithMaps:E.numSpotLightShadowsWithMaps,numLightProbes:E.numLightProbes,numClippingPlanes:c.numPlanes,numClipIntersection:c.numIntersection,dithering:K.dithering,shadowMapEnabled:r.shadowMap.enabled&&ee.length>0,shadowMapType:r.shadowMap.type,toneMapping:Wn,useLegacyLights:r._useLegacyLights,decodeVideoTexture:Xt&&K.map.isVideoTexture===!0&&Ni.getTransfer(K.map.colorSpace)===ta,premultipliedAlpha:K.premultipliedAlpha,doubleSided:K.side===il,flipSided:K.side===Do,useDepthPacking:K.depthPacking>=0,depthPacking:K.depthPacking||0,index0AttributeName:K.index0AttributeName,extensionDerivatives:wt&&K.extensions.derivatives===!0,extensionFragDepth:wt&&K.extensions.fragDepth===!0,extensionDrawBuffers:wt&&K.extensions.drawBuffers===!0,extensionShaderTextureLOD:wt&&K.extensions.shaderTextureLOD===!0,extensionClipCullDistance:wt&&K.extensions.clipCullDistance&&n.has("WEBGL_clip_cull_distance"),rendererExtensionFragDepth:f||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:f||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:f||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:K.customProgramCacheKey()}}function S(K){const E=[];if(K.shaderID?E.push(K.shaderID):(E.push(K.customVertexShaderID),E.push(K.customFragmentShaderID)),K.defines!==void 0)for(const ee in K.defines)E.push(ee),E.push(K.defines[ee]);return K.isRawShaderMaterial===!1&&(N(E,K),w(E,K),E.push(r.outputColorSpace)),E.push(K.customProgramCacheKey),E.join()}function N(K,E){K.push(E.precision),K.push(E.outputColorSpace),K.push(E.envMapMode),K.push(E.envMapCubeUVHeight),K.push(E.mapUv),K.push(E.alphaMapUv),K.push(E.lightMapUv),K.push(E.aoMapUv),K.push(E.bumpMapUv),K.push(E.normalMapUv),K.push(E.displacementMapUv),K.push(E.emissiveMapUv),K.push(E.metalnessMapUv),K.push(E.roughnessMapUv),K.push(E.anisotropyMapUv),K.push(E.clearcoatMapUv),K.push(E.clearcoatNormalMapUv),K.push(E.clearcoatRoughnessMapUv),K.push(E.iridescenceMapUv),K.push(E.iridescenceThicknessMapUv),K.push(E.sheenColorMapUv),K.push(E.sheenRoughnessMapUv),K.push(E.specularMapUv),K.push(E.specularColorMapUv),K.push(E.specularIntensityMapUv),K.push(E.transmissionMapUv),K.push(E.thicknessMapUv),K.push(E.combine),K.push(E.fogExp2),K.push(E.sizeAttenuation),K.push(E.morphTargetsCount),K.push(E.morphAttributeCount),K.push(E.numDirLights),K.push(E.numPointLights),K.push(E.numSpotLights),K.push(E.numSpotLightMaps),K.push(E.numHemiLights),K.push(E.numRectAreaLights),K.push(E.numDirLightShadows),K.push(E.numPointLightShadows),K.push(E.numSpotLightShadows),K.push(E.numSpotLightShadowsWithMaps),K.push(E.numLightProbes),K.push(E.shadowMapType),K.push(E.toneMapping),K.push(E.numClippingPlanes),K.push(E.numClipIntersection),K.push(E.depthPacking)}function w(K,E){I.disableAll(),E.isWebGL2&&I.enable(0),E.supportsVertexTextures&&I.enable(1),E.instancing&&I.enable(2),E.instancingColor&&I.enable(3),E.matcap&&I.enable(4),E.envMap&&I.enable(5),E.normalMapObjectSpace&&I.enable(6),E.normalMapTangentSpace&&I.enable(7),E.clearcoat&&I.enable(8),E.iridescence&&I.enable(9),E.alphaTest&&I.enable(10),E.vertexColors&&I.enable(11),E.vertexAlphas&&I.enable(12),E.vertexUv1s&&I.enable(13),E.vertexUv2s&&I.enable(14),E.vertexUv3s&&I.enable(15),E.vertexTangents&&I.enable(16),E.anisotropy&&I.enable(17),E.alphaHash&&I.enable(18),E.batching&&I.enable(19),K.push(I.mask),I.disableAll(),E.fog&&I.enable(0),E.useFog&&I.enable(1),E.flatShading&&I.enable(2),E.logarithmicDepthBuffer&&I.enable(3),E.skinning&&I.enable(4),E.morphTargets&&I.enable(5),E.morphNormals&&I.enable(6),E.morphColors&&I.enable(7),E.premultipliedAlpha&&I.enable(8),E.shadowMapEnabled&&I.enable(9),E.useLegacyLights&&I.enable(10),E.doubleSided&&I.enable(11),E.flipSided&&I.enable(12),E.useDepthPacking&&I.enable(13),E.dithering&&I.enable(14),E.transmission&&I.enable(15),E.sheen&&I.enable(16),E.opaque&&I.enable(17),E.pointsUvs&&I.enable(18),E.decodeVideoTexture&&I.enable(19),K.push(I.mask)}function X(K){const E=Z[K.type];let ee;if(E){const Ie=Hg[E];ee=AK.clone(Ie.uniforms)}else ee=K.uniforms;return ee}function H(K,E){let ee;for(let Ie=0,be=d.length;Ie<be;Ie++){const se=d[Ie];if(se.cacheKey===E){ee=se,++ee.usedTimes;break}}return ee===void 0&&(ee=new AU(r,E,K,o),d.push(ee)),ee}function F(K){if(--K.usedTimes===0){const E=d.indexOf(K);d[E]=d[d.length-1],d.pop(),K.destroy()}}function _(K){C.remove(K)}function P(){C.dispose()}return{getParameters:R,getProgramCacheKey:S,getUniforms:X,acquireProgram:H,releaseProgram:F,releaseShaderCache:_,programs:d,dispose:P}}function vU(){let r=new WeakMap;function e(o){let c=r.get(o);return c===void 0&&(c={},r.set(o,c)),c}function t(o){r.delete(o)}function n(o,c,I){r.get(o)[c]=I}function a(){r=new WeakMap}return{get:e,remove:t,update:n,dispose:a}}function yU(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function vM(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function yM(){const r=[];let e=0;const t=[],n=[],a=[];function o(){e=0,t.length=0,n.length=0,a.length=0}function c(b,v,y,Z,V,R){let S=r[e];return S===void 0?(S={id:b.id,object:b,geometry:v,material:y,groupOrder:Z,renderOrder:b.renderOrder,z:V,group:R},r[e]=S):(S.id=b.id,S.object=b,S.geometry=v,S.material=y,S.groupOrder=Z,S.renderOrder=b.renderOrder,S.z=V,S.group=R),e++,S}function I(b,v,y,Z,V,R){const S=c(b,v,y,Z,V,R);y.transmission>0?n.push(S):y.transparent===!0?a.push(S):t.push(S)}function C(b,v,y,Z,V,R){const S=c(b,v,y,Z,V,R);y.transmission>0?n.unshift(S):y.transparent===!0?a.unshift(S):t.unshift(S)}function d(b,v){t.length>1&&t.sort(b||yU),n.length>1&&n.sort(v||vM),a.length>1&&a.sort(v||vM)}function f(){for(let b=e,v=r.length;b<v;b++){const y=r[b];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:t,transmissive:n,transparent:a,init:o,push:I,unshift:C,finish:f,sort:d}}function GU(){let r=new WeakMap;function e(n,a){const o=r.get(n);let c;return o===void 0?(c=new yM,r.set(n,[c])):a>=o.length?(c=new yM,o.push(c)):c=o[a],c}function t(){r=new WeakMap}return{get:e,dispose:t}}function BU(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new $,color:new an};break;case"SpotLight":t={position:new $,direction:new $,color:new an,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new $,color:new an,distance:0,decay:0};break;case"HemisphereLight":t={direction:new $,skyColor:new an,groundColor:new an};break;case"RectAreaLight":t={color:new an,position:new $,halfWidth:new $,halfHeight:new $};break}return r[e.id]=t,t}}}function ZU(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new lt};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new lt};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new lt,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=t,t}}}let SU=0;function RU(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function wU(r,e){const t=new BU,n=ZU(),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let f=0;f<9;f++)a.probe.push(new $);const o=new $,c=new Nn,I=new Nn;function C(f,b){let v=0,y=0,Z=0;for(let Ie=0;Ie<9;Ie++)a.probe[Ie].set(0,0,0);let V=0,R=0,S=0,N=0,w=0,X=0,H=0,F=0,_=0,P=0,K=0;f.sort(RU);const E=b===!0?Math.PI:1;for(let Ie=0,be=f.length;Ie<be;Ie++){const se=f[Ie],Ce=se.color,he=se.intensity,Be=se.distance,ve=se.shadow&&se.shadow.map?se.shadow.map.texture:null;if(se.isAmbientLight)v+=Ce.r*he*E,y+=Ce.g*he*E,Z+=Ce.b*he*E;else if(se.isLightProbe){for(let we=0;we<9;we++)a.probe[we].addScaledVector(se.sh.coefficients[we],he);K++}else if(se.isDirectionalLight){const we=t.get(se);if(we.color.copy(se.color).multiplyScalar(se.intensity*E),se.castShadow){const me=se.shadow,Xe=n.get(se);Xe.shadowBias=me.bias,Xe.shadowNormalBias=me.normalBias,Xe.shadowRadius=me.radius,Xe.shadowMapSize=me.mapSize,a.directionalShadow[V]=Xe,a.directionalShadowMap[V]=ve,a.directionalShadowMatrix[V]=se.shadow.matrix,X++}a.directional[V]=we,V++}else if(se.isSpotLight){const we=t.get(se);we.position.setFromMatrixPosition(se.matrixWorld),we.color.copy(Ce).multiplyScalar(he*E),we.distance=Be,we.coneCos=Math.cos(se.angle),we.penumbraCos=Math.cos(se.angle*(1-se.penumbra)),we.decay=se.decay,a.spot[S]=we;const me=se.shadow;if(se.map&&(a.spotLightMap[_]=se.map,_++,me.updateMatrices(se),se.castShadow&&P++),a.spotLightMatrix[S]=me.matrix,se.castShadow){const Xe=n.get(se);Xe.shadowBias=me.bias,Xe.shadowNormalBias=me.normalBias,Xe.shadowRadius=me.radius,Xe.shadowMapSize=me.mapSize,a.spotShadow[S]=Xe,a.spotShadowMap[S]=ve,F++}S++}else if(se.isRectAreaLight){const we=t.get(se);we.color.copy(Ce).multiplyScalar(he),we.halfWidth.set(se.width*.5,0,0),we.halfHeight.set(0,se.height*.5,0),a.rectArea[N]=we,N++}else if(se.isPointLight){const we=t.get(se);if(we.color.copy(se.color).multiplyScalar(se.intensity*E),we.distance=se.distance,we.decay=se.decay,se.castShadow){const me=se.shadow,Xe=n.get(se);Xe.shadowBias=me.bias,Xe.shadowNormalBias=me.normalBias,Xe.shadowRadius=me.radius,Xe.shadowMapSize=me.mapSize,Xe.shadowCameraNear=me.camera.near,Xe.shadowCameraFar=me.camera.far,a.pointShadow[R]=Xe,a.pointShadowMap[R]=ve,a.pointShadowMatrix[R]=se.shadow.matrix,H++}a.point[R]=we,R++}else if(se.isHemisphereLight){const we=t.get(se);we.skyColor.copy(se.color).multiplyScalar(he*E),we.groundColor.copy(se.groundColor).multiplyScalar(he*E),a.hemi[w]=we,w++}}N>0&&(e.isWebGL2?r.has("OES_texture_float_linear")===!0?(a.rectAreaLTC1=Lt.LTC_FLOAT_1,a.rectAreaLTC2=Lt.LTC_FLOAT_2):(a.rectAreaLTC1=Lt.LTC_HALF_1,a.rectAreaLTC2=Lt.LTC_HALF_2):r.has("OES_texture_float_linear")===!0?(a.rectAreaLTC1=Lt.LTC_FLOAT_1,a.rectAreaLTC2=Lt.LTC_FLOAT_2):r.has("OES_texture_half_float_linear")===!0?(a.rectAreaLTC1=Lt.LTC_HALF_1,a.rectAreaLTC2=Lt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=v,a.ambient[1]=y,a.ambient[2]=Z;const ee=a.hash;(ee.directionalLength!==V||ee.pointLength!==R||ee.spotLength!==S||ee.rectAreaLength!==N||ee.hemiLength!==w||ee.numDirectionalShadows!==X||ee.numPointShadows!==H||ee.numSpotShadows!==F||ee.numSpotMaps!==_||ee.numLightProbes!==K)&&(a.directional.length=V,a.spot.length=S,a.rectArea.length=N,a.point.length=R,a.hemi.length=w,a.directionalShadow.length=X,a.directionalShadowMap.length=X,a.pointShadow.length=H,a.pointShadowMap.length=H,a.spotShadow.length=F,a.spotShadowMap.length=F,a.directionalShadowMatrix.length=X,a.pointShadowMatrix.length=H,a.spotLightMatrix.length=F+_-P,a.spotLightMap.length=_,a.numSpotLightShadowsWithMaps=P,a.numLightProbes=K,ee.directionalLength=V,ee.pointLength=R,ee.spotLength=S,ee.rectAreaLength=N,ee.hemiLength=w,ee.numDirectionalShadows=X,ee.numPointShadows=H,ee.numSpotShadows=F,ee.numSpotMaps=_,ee.numLightProbes=K,a.version=SU++)}function d(f,b){let v=0,y=0,Z=0,V=0,R=0;const S=b.matrixWorldInverse;for(let N=0,w=f.length;N<w;N++){const X=f[N];if(X.isDirectionalLight){const H=a.directional[v];H.direction.setFromMatrixPosition(X.matrixWorld),o.setFromMatrixPosition(X.target.matrixWorld),H.direction.sub(o),H.direction.transformDirection(S),v++}else if(X.isSpotLight){const H=a.spot[Z];H.position.setFromMatrixPosition(X.matrixWorld),H.position.applyMatrix4(S),H.direction.setFromMatrixPosition(X.matrixWorld),o.setFromMatrixPosition(X.target.matrixWorld),H.direction.sub(o),H.direction.transformDirection(S),Z++}else if(X.isRectAreaLight){const H=a.rectArea[V];H.position.setFromMatrixPosition(X.matrixWorld),H.position.applyMatrix4(S),I.identity(),c.copy(X.matrixWorld),c.premultiply(S),I.extractRotation(c),H.halfWidth.set(X.width*.5,0,0),H.halfHeight.set(0,X.height*.5,0),H.halfWidth.applyMatrix4(I),H.halfHeight.applyMatrix4(I),V++}else if(X.isPointLight){const H=a.point[y];H.position.setFromMatrixPosition(X.matrixWorld),H.position.applyMatrix4(S),y++}else if(X.isHemisphereLight){const H=a.hemi[R];H.direction.setFromMatrixPosition(X.matrixWorld),H.direction.transformDirection(S),R++}}}return{setup:C,setupView:d,state:a}}function GM(r,e){const t=new wU(r,e),n=[],a=[];function o(){n.length=0,a.length=0}function c(b){n.push(b)}function I(b){a.push(b)}function C(b){t.setup(n,b)}function d(b){t.setupView(n,b)}return{init:o,state:{lightsArray:n,shadowsArray:a,lights:t},setupLights:C,setupLightsView:d,pushLight:c,pushShadow:I}}function WU(r,e){let t=new WeakMap;function n(o,c=0){const I=t.get(o);let C;return I===void 0?(C=new GM(r,e),t.set(o,[C])):c>=I.length?(C=new GM(r,e),I.push(C)):C=I[c],C}function a(){t=new WeakMap}return{get:n,dispose:a}}class u2 extends Zo{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=eK,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class I2 extends Zo{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const xU=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,VU=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function NU(r,e,t){let n=new oG;const a=new lt,o=new lt,c=new Xi,I=new u2({depthPacking:tK}),C=new I2,d={},f=t.maxTextureSize,b={[fI]:Do,[Do]:fI,[il]:il},v=new zc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new lt},radius:{value:4}},vertexShader:xU,fragmentShader:VU}),y=v.clone();y.defines.HORIZONTAL_PASS=1;const Z=new Qn;Z.setAttribute("position",new Yi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const V=new ts(Z,v),R=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=yR;let S=this.type;this.render=function(F,_,P){if(R.enabled===!1||R.autoUpdate===!1&&R.needsUpdate===!1||F.length===0)return;const K=r.getRenderTarget(),E=r.getActiveCubeFace(),ee=r.getActiveMipmapLevel(),Ie=r.state;Ie.setBlending(AI),Ie.buffers.color.setClear(1,1,1,1),Ie.buffers.depth.setTest(!0),Ie.setScissorTest(!1);const be=S!==Yg&&this.type===Yg,se=S===Yg&&this.type!==Yg;for(let Ce=0,he=F.length;Ce<he;Ce++){const Be=F[Ce],ve=Be.shadow;if(ve===void 0){console.warn("THREE.WebGLShadowMap:",Be,"has no shadow.");continue}if(ve.autoUpdate===!1&&ve.needsUpdate===!1)continue;a.copy(ve.mapSize);const we=ve.getFrameExtents();if(a.multiply(we),o.copy(ve.mapSize),(a.x>f||a.y>f)&&(a.x>f&&(o.x=Math.floor(f/we.x),a.x=o.x*we.x,ve.mapSize.x=o.x),a.y>f&&(o.y=Math.floor(f/we.y),a.y=o.y*we.y,ve.mapSize.y=o.y)),ve.map===null||be===!0||se===!0){const Xe=this.type!==Yg?{minFilter:Fa,magFilter:Fa}:{};ve.map!==null&&ve.map.dispose(),ve.map=new Eg(a.x,a.y,Xe),ve.map.texture.name=Be.name+".shadowMap",ve.camera.updateProjectionMatrix()}r.setRenderTarget(ve.map),r.clear();const me=ve.getViewportCount();for(let Xe=0;Xe<me;Xe++){const Ue=ve.getViewport(Xe);c.set(o.x*Ue.x,o.y*Ue.y,o.x*Ue.z,o.y*Ue.w),Ie.viewport(c),ve.updateMatrices(Be,Xe),n=ve.getFrustum(),X(_,P,ve.camera,Be,this.type)}ve.isPointLightShadow!==!0&&this.type===Yg&&N(ve,P),ve.needsUpdate=!1}S=this.type,R.needsUpdate=!1,r.setRenderTarget(K,E,ee)};function N(F,_){const P=e.update(V);v.defines.VSM_SAMPLES!==F.blurSamples&&(v.defines.VSM_SAMPLES=F.blurSamples,y.defines.VSM_SAMPLES=F.blurSamples,v.needsUpdate=!0,y.needsUpdate=!0),F.mapPass===null&&(F.mapPass=new Eg(a.x,a.y)),v.uniforms.shadow_pass.value=F.map.texture,v.uniforms.resolution.value=F.mapSize,v.uniforms.radius.value=F.radius,r.setRenderTarget(F.mapPass),r.clear(),r.renderBufferDirect(_,null,P,v,V,null),y.uniforms.shadow_pass.value=F.mapPass.texture,y.uniforms.resolution.value=F.mapSize,y.uniforms.radius.value=F.radius,r.setRenderTarget(F.map),r.clear(),r.renderBufferDirect(_,null,P,y,V,null)}function w(F,_,P,K){let E=null;const ee=P.isPointLight===!0?F.customDistanceMaterial:F.customDepthMaterial;if(ee!==void 0)E=ee;else if(E=P.isPointLight===!0?C:I,r.localClippingEnabled&&_.clipShadows===!0&&Array.isArray(_.clippingPlanes)&&_.clippingPlanes.length!==0||_.displacementMap&&_.displacementScale!==0||_.alphaMap&&_.alphaTest>0||_.map&&_.alphaTest>0){const Ie=E.uuid,be=_.uuid;let se=d[Ie];se===void 0&&(se={},d[Ie]=se);let Ce=se[be];Ce===void 0&&(Ce=E.clone(),se[be]=Ce,_.addEventListener("dispose",H)),E=Ce}if(E.visible=_.visible,E.wireframe=_.wireframe,K===Yg?E.side=_.shadowSide!==null?_.shadowSide:_.side:E.side=_.shadowSide!==null?_.shadowSide:b[_.side],E.alphaMap=_.alphaMap,E.alphaTest=_.alphaTest,E.map=_.map,E.clipShadows=_.clipShadows,E.clippingPlanes=_.clippingPlanes,E.clipIntersection=_.clipIntersection,E.displacementMap=_.displacementMap,E.displacementScale=_.displacementScale,E.displacementBias=_.displacementBias,E.wireframeLinewidth=_.wireframeLinewidth,E.linewidth=_.linewidth,P.isPointLight===!0&&E.isMeshDistanceMaterial===!0){const Ie=r.properties.get(E);Ie.light=P}return E}function X(F,_,P,K,E){if(F.visible===!1)return;if(F.layers.test(_.layers)&&(F.isMesh||F.isLine||F.isPoints)&&(F.castShadow||F.receiveShadow&&E===Yg)&&(!F.frustumCulled||n.intersectsObject(F))){F.modelViewMatrix.multiplyMatrices(P.matrixWorldInverse,F.matrixWorld);const be=e.update(F),se=F.material;if(Array.isArray(se)){const Ce=be.groups;for(let he=0,Be=Ce.length;he<Be;he++){const ve=Ce[he],we=se[ve.materialIndex];if(we&&we.visible){const me=w(F,we,K,E);F.onBeforeShadow(r,F,_,P,be,me,ve),r.renderBufferDirect(P,null,be,me,F,ve),F.onAfterShadow(r,F,_,P,be,me,ve)}}}else if(se.visible){const Ce=w(F,se,K,E);F.onBeforeShadow(r,F,_,P,be,Ce,null),r.renderBufferDirect(P,null,be,Ce,F,null),F.onAfterShadow(r,F,_,P,be,Ce,null)}}const Ie=F.children;for(let be=0,se=Ie.length;be<se;be++)X(Ie[be],_,P,K,E)}function H(F){F.target.removeEventListener("dispose",H);for(const P in d){const K=d[P],E=F.target.uuid;E in K&&(K[E].dispose(),delete K[E])}}}function XU(r,e,t){const n=t.isWebGL2;function a(){let ce=!1;const dt=new Xi;let wt=null;const rn=new Xi(0,0,0,0);return{setMask:function(mt){wt!==mt&&!ce&&(r.colorMask(mt,mt,mt,mt),wt=mt)},setLocked:function(mt){ce=mt},setClear:function(mt,mn,Wn,zn,Dn){Dn===!0&&(mt*=zn,mn*=zn,Wn*=zn),dt.set(mt,mn,Wn,zn),rn.equals(dt)===!1&&(r.clearColor(mt,mn,Wn,zn),rn.copy(dt))},reset:function(){ce=!1,wt=null,rn.set(-1,0,0,0)}}}function o(){let ce=!1,dt=null,wt=null,rn=null;return{setTest:function(mt){mt?$t(r.DEPTH_TEST):Xt(r.DEPTH_TEST)},setMask:function(mt){dt!==mt&&!ce&&(r.depthMask(mt),dt=mt)},setFunc:function(mt){if(wt!==mt){switch(mt){case wF:r.depthFunc(r.NEVER);break;case WF:r.depthFunc(r.ALWAYS);break;case xF:r.depthFunc(r.LESS);break;case M0:r.depthFunc(r.LEQUAL);break;case VF:r.depthFunc(r.EQUAL);break;case NF:r.depthFunc(r.GEQUAL);break;case XF:r.depthFunc(r.GREATER);break;case YF:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}wt=mt}},setLocked:function(mt){ce=mt},setClear:function(mt){rn!==mt&&(r.clearDepth(mt),rn=mt)},reset:function(){ce=!1,dt=null,wt=null,rn=null}}}function c(){let ce=!1,dt=null,wt=null,rn=null,mt=null,mn=null,Wn=null,zn=null,Dn=null;return{setTest:function(In){ce||(In?$t(r.STENCIL_TEST):Xt(r.STENCIL_TEST))},setMask:function(In){dt!==In&&!ce&&(r.stencilMask(In),dt=In)},setFunc:function(In,fi,ci){(wt!==In||rn!==fi||mt!==ci)&&(r.stencilFunc(In,fi,ci),wt=In,rn=fi,mt=ci)},setOp:function(In,fi,ci){(mn!==In||Wn!==fi||zn!==ci)&&(r.stencilOp(In,fi,ci),mn=In,Wn=fi,zn=ci)},setLocked:function(In){ce=In},setClear:function(In){Dn!==In&&(r.clearStencil(In),Dn=In)},reset:function(){ce=!1,dt=null,wt=null,rn=null,mt=null,mn=null,Wn=null,zn=null,Dn=null}}}const I=new a,C=new o,d=new c,f=new WeakMap,b=new WeakMap;let v={},y={},Z=new WeakMap,V=[],R=null,S=!1,N=null,w=null,X=null,H=null,F=null,_=null,P=null,K=new an(0,0,0),E=0,ee=!1,Ie=null,be=null,se=null,Ce=null,he=null;const Be=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ve=!1,we=0;const me=r.getParameter(r.VERSION);me.indexOf("WebGL")!==-1?(we=parseFloat(/^WebGL (\d)/.exec(me)[1]),ve=we>=1):me.indexOf("OpenGL ES")!==-1&&(we=parseFloat(/^OpenGL ES (\d)/.exec(me)[1]),ve=we>=2);let Xe=null,Ue={};const de=r.getParameter(r.SCISSOR_BOX),Ee=r.getParameter(r.VIEWPORT),At=new Xi().fromArray(de),Zt=new Xi().fromArray(Ee);function Bt(ce,dt,wt,rn){const mt=new Uint8Array(4),mn=r.createTexture();r.bindTexture(ce,mn),r.texParameteri(ce,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(ce,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let Wn=0;Wn<wt;Wn++)n&&(ce===r.TEXTURE_3D||ce===r.TEXTURE_2D_ARRAY)?r.texImage3D(dt,0,r.RGBA,1,1,rn,0,r.RGBA,r.UNSIGNED_BYTE,mt):r.texImage2D(dt+Wn,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,mt);return mn}const kt={};kt[r.TEXTURE_2D]=Bt(r.TEXTURE_2D,r.TEXTURE_2D,1),kt[r.TEXTURE_CUBE_MAP]=Bt(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(kt[r.TEXTURE_2D_ARRAY]=Bt(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),kt[r.TEXTURE_3D]=Bt(r.TEXTURE_3D,r.TEXTURE_3D,1,1)),I.setClear(0,0,0,1),C.setClear(1),d.setClear(0),$t(r.DEPTH_TEST),C.setFunc(M0),Wt(!1),O(_V),$t(r.CULL_FACE),Te(AI);function $t(ce){v[ce]!==!0&&(r.enable(ce),v[ce]=!0)}function Xt(ce){v[ce]!==!1&&(r.disable(ce),v[ce]=!1)}function Ot(ce,dt){return y[ce]!==dt?(r.bindFramebuffer(ce,dt),y[ce]=dt,n&&(ce===r.DRAW_FRAMEBUFFER&&(y[r.FRAMEBUFFER]=dt),ce===r.FRAMEBUFFER&&(y[r.DRAW_FRAMEBUFFER]=dt)),!0):!1}function oe(ce,dt){let wt=V,rn=!1;if(ce)if(wt=Z.get(dt),wt===void 0&&(wt=[],Z.set(dt,wt)),ce.isWebGLMultipleRenderTargets){const mt=ce.texture;if(wt.length!==mt.length||wt[0]!==r.COLOR_ATTACHMENT0){for(let mn=0,Wn=mt.length;mn<Wn;mn++)wt[mn]=r.COLOR_ATTACHMENT0+mn;wt.length=mt.length,rn=!0}}else wt[0]!==r.COLOR_ATTACHMENT0&&(wt[0]=r.COLOR_ATTACHMENT0,rn=!0);else wt[0]!==r.BACK&&(wt[0]=r.BACK,rn=!0);rn&&(t.isWebGL2?r.drawBuffers(wt):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(wt))}function ut(ce){return R!==ce?(r.useProgram(ce),R=ce,!0):!1}const _e={[Pd]:r.FUNC_ADD,[dF]:r.FUNC_SUBTRACT,[CF]:r.FUNC_REVERSE_SUBTRACT};if(n)_e[JV]=r.MIN,_e[OV]=r.MAX;else{const ce=e.get("EXT_blend_minmax");ce!==null&&(_e[JV]=ce.MIN_EXT,_e[OV]=ce.MAX_EXT)}const it={[hF]:r.ZERO,[AF]:r.ONE,[fF]:r.SRC_COLOR,[CR]:r.SRC_ALPHA,[GF]:r.SRC_ALPHA_SATURATE,[vF]:r.DST_COLOR,[mF]:r.DST_ALPHA,[pF]:r.ONE_MINUS_SRC_COLOR,[hR]:r.ONE_MINUS_SRC_ALPHA,[yF]:r.ONE_MINUS_DST_COLOR,[bF]:r.ONE_MINUS_DST_ALPHA,[BF]:r.CONSTANT_COLOR,[ZF]:r.ONE_MINUS_CONSTANT_COLOR,[SF]:r.CONSTANT_ALPHA,[RF]:r.ONE_MINUS_CONSTANT_ALPHA};function Te(ce,dt,wt,rn,mt,mn,Wn,zn,Dn,In){if(ce===AI){S===!0&&(Xt(r.BLEND),S=!1);return}if(S===!1&&($t(r.BLEND),S=!0),ce!==IF){if(ce!==N||In!==ee){if((w!==Pd||F!==Pd)&&(r.blendEquation(r.FUNC_ADD),w=Pd,F=Pd),In)switch(ce){case ZA:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case kV:r.blendFunc(r.ONE,r.ONE);break;case UV:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case DV:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ce);break}else switch(ce){case ZA:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case kV:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case UV:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case DV:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ce);break}X=null,H=null,_=null,P=null,K.set(0,0,0),E=0,N=ce,ee=In}return}mt=mt||dt,mn=mn||wt,Wn=Wn||rn,(dt!==w||mt!==F)&&(r.blendEquationSeparate(_e[dt],_e[mt]),w=dt,F=mt),(wt!==X||rn!==H||mn!==_||Wn!==P)&&(r.blendFuncSeparate(it[wt],it[rn],it[mn],it[Wn]),X=wt,H=rn,_=mn,P=Wn),(zn.equals(K)===!1||Dn!==E)&&(r.blendColor(zn.r,zn.g,zn.b,Dn),K.copy(zn),E=Dn),N=ce,ee=!1}function Et(ce,dt){ce.side===il?Xt(r.CULL_FACE):$t(r.CULL_FACE);let wt=ce.side===Do;dt&&(wt=!wt),Wt(wt),ce.blending===ZA&&ce.transparent===!1?Te(AI):Te(ce.blending,ce.blendEquation,ce.blendSrc,ce.blendDst,ce.blendEquationAlpha,ce.blendSrcAlpha,ce.blendDstAlpha,ce.blendColor,ce.blendAlpha,ce.premultipliedAlpha),C.setFunc(ce.depthFunc),C.setTest(ce.depthTest),C.setMask(ce.depthWrite),I.setMask(ce.colorWrite);const rn=ce.stencilWrite;d.setTest(rn),rn&&(d.setMask(ce.stencilWriteMask),d.setFunc(ce.stencilFunc,ce.stencilRef,ce.stencilFuncMask),d.setOp(ce.stencilFail,ce.stencilZFail,ce.stencilZPass)),Ae(ce.polygonOffset,ce.polygonOffsetFactor,ce.polygonOffsetUnits),ce.alphaToCoverage===!0?$t(r.SAMPLE_ALPHA_TO_COVERAGE):Xt(r.SAMPLE_ALPHA_TO_COVERAGE)}function Wt(ce){Ie!==ce&&(ce?r.frontFace(r.CW):r.frontFace(r.CCW),Ie=ce)}function O(ce){ce!==gF?($t(r.CULL_FACE),ce!==be&&(ce===_V?r.cullFace(r.BACK):ce===cF?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):Xt(r.CULL_FACE),be=ce}function k(ce){ce!==se&&(ve&&r.lineWidth(ce),se=ce)}function Ae(ce,dt,wt){ce?($t(r.POLYGON_OFFSET_FILL),(Ce!==dt||he!==wt)&&(r.polygonOffset(dt,wt),Ce=dt,he=wt)):Xt(r.POLYGON_OFFSET_FILL)}function Oe(ce){ce?$t(r.SCISSOR_TEST):Xt(r.SCISSOR_TEST)}function $e(ce){ce===void 0&&(ce=r.TEXTURE0+Be-1),Xe!==ce&&(r.activeTexture(ce),Xe=ce)}function et(ce,dt,wt){wt===void 0&&(Xe===null?wt=r.TEXTURE0+Be-1:wt=Xe);let rn=Ue[wt];rn===void 0&&(rn={type:void 0,texture:void 0},Ue[wt]=rn),(rn.type!==ce||rn.texture!==dt)&&(Xe!==wt&&(r.activeTexture(wt),Xe=wt),r.bindTexture(ce,dt||kt[ce]),rn.type=ce,rn.texture=dt)}function Yt(){const ce=Ue[Xe];ce!==void 0&&ce.type!==void 0&&(r.bindTexture(ce.type,null),ce.type=void 0,ce.texture=void 0)}function vt(){try{r.compressedTexImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Vt(){try{r.compressedTexImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function tn(){try{r.texSubImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function un(){try{r.texSubImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function ae(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Le(){try{r.compressedTexSubImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function at(){try{r.texStorage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Pe(){try{r.texStorage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function pt(){try{r.texImage2D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function Ct(){try{r.texImage3D.apply(r,arguments)}catch(ce){console.error("THREE.WebGLState:",ce)}}function q(ce){At.equals(ce)===!1&&(r.scissor(ce.x,ce.y,ce.z,ce.w),At.copy(ce))}function ye(ce){Zt.equals(ce)===!1&&(r.viewport(ce.x,ce.y,ce.z,ce.w),Zt.copy(ce))}function gt(ce,dt){let wt=b.get(dt);wt===void 0&&(wt=new WeakMap,b.set(dt,wt));let rn=wt.get(ce);rn===void 0&&(rn=r.getUniformBlockIndex(dt,ce.name),wt.set(ce,rn))}function De(ce,dt){const rn=b.get(dt).get(ce);f.get(dt)!==rn&&(r.uniformBlockBinding(dt,rn,ce.__bindingPointIndex),f.set(dt,rn))}function Ne(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),n===!0&&(r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null)),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),v={},Xe=null,Ue={},y={},Z=new WeakMap,V=[],R=null,S=!1,N=null,w=null,X=null,H=null,F=null,_=null,P=null,K=new an(0,0,0),E=0,ee=!1,Ie=null,be=null,se=null,Ce=null,he=null,At.set(0,0,r.canvas.width,r.canvas.height),Zt.set(0,0,r.canvas.width,r.canvas.height),I.reset(),C.reset(),d.reset()}return{buffers:{color:I,depth:C,stencil:d},enable:$t,disable:Xt,bindFramebuffer:Ot,drawBuffers:oe,useProgram:ut,setBlending:Te,setMaterial:Et,setFlipSided:Wt,setCullFace:O,setLineWidth:k,setPolygonOffset:Ae,setScissorTest:Oe,activeTexture:$e,bindTexture:et,unbindTexture:Yt,compressedTexImage2D:vt,compressedTexImage3D:Vt,texImage2D:pt,texImage3D:Ct,updateUBOMapping:gt,uniformBlockBinding:De,texStorage2D:at,texStorage3D:Pe,texSubImage2D:tn,texSubImage3D:un,compressedTexSubImage2D:ae,compressedTexSubImage3D:Le,scissor:q,viewport:ye,reset:Ne}}function YU(r,e,t,n,a,o,c){const I=a.isWebGL2,C=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,d=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let b;const v=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function Z(O,k){return y?new OffscreenCanvas(O,k):J0("canvas")}function V(O,k,Ae,Oe){let $e=1;if((O.width>Oe||O.height>Oe)&&($e=Oe/Math.max(O.width,O.height)),$e<1||k===!0)if(typeof HTMLImageElement<"u"&&O instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&O instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&O instanceof ImageBitmap){const et=k?pR:Math.floor,Yt=et($e*O.width),vt=et($e*O.height);b===void 0&&(b=Z(Yt,vt));const Vt=Ae?Z(Yt,vt):b;return Vt.width=Yt,Vt.height=vt,Vt.getContext("2d").drawImage(O,0,0,Yt,vt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+O.width+"x"+O.height+") to ("+Yt+"x"+vt+")."),Vt}else return"data"in O&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+O.width+"x"+O.height+")."),O;return O}function R(O){return GN(O.width)&&GN(O.height)}function S(O){return I?!1:O.wrapS!==Go||O.wrapT!==Go||O.minFilter!==Fa&&O.minFilter!==Ka}function N(O,k){return O.generateMipmaps&&k&&O.minFilter!==Fa&&O.minFilter!==Ka}function w(O){r.generateMipmap(O)}function X(O,k,Ae,Oe,$e=!1){if(I===!1)return k;if(O!==null){if(r[O]!==void 0)return r[O];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+O+"'")}let et=k;if(k===r.RED&&(Ae===r.FLOAT&&(et=r.R32F),Ae===r.HALF_FLOAT&&(et=r.R16F),Ae===r.UNSIGNED_BYTE&&(et=r.R8)),k===r.RED_INTEGER&&(Ae===r.UNSIGNED_BYTE&&(et=r.R8UI),Ae===r.UNSIGNED_SHORT&&(et=r.R16UI),Ae===r.UNSIGNED_INT&&(et=r.R32UI),Ae===r.BYTE&&(et=r.R8I),Ae===r.SHORT&&(et=r.R16I),Ae===r.INT&&(et=r.R32I)),k===r.RG&&(Ae===r.FLOAT&&(et=r.RG32F),Ae===r.HALF_FLOAT&&(et=r.RG16F),Ae===r.UNSIGNED_BYTE&&(et=r.RG8)),k===r.RGBA){const Yt=$e?_0:Ni.getTransfer(Oe);Ae===r.FLOAT&&(et=r.RGBA32F),Ae===r.HALF_FLOAT&&(et=r.RGBA16F),Ae===r.UNSIGNED_BYTE&&(et=Yt===ta?r.SRGB8_ALPHA8:r.RGBA8),Ae===r.UNSIGNED_SHORT_4_4_4_4&&(et=r.RGBA4),Ae===r.UNSIGNED_SHORT_5_5_5_1&&(et=r.RGB5_A1)}return(et===r.R16F||et===r.R32F||et===r.RG16F||et===r.RG32F||et===r.RGBA16F||et===r.RGBA32F)&&e.get("EXT_color_buffer_float"),et}function H(O,k,Ae){return N(O,Ae)===!0||O.isFramebufferTexture&&O.minFilter!==Fa&&O.minFilter!==Ka?Math.log2(Math.max(k.width,k.height))+1:O.mipmaps!==void 0&&O.mipmaps.length>0?O.mipmaps.length:O.isCompressedTexture&&Array.isArray(O.image)?k.mipmaps.length:1}function F(O){return O===Fa||O===AR||O===x0?r.NEAREST:r.LINEAR}function _(O){const k=O.target;k.removeEventListener("dispose",_),K(k),k.isVideoTexture&&f.delete(k)}function P(O){const k=O.target;k.removeEventListener("dispose",P),ee(k)}function K(O){const k=n.get(O);if(k.__webglInit===void 0)return;const Ae=O.source,Oe=v.get(Ae);if(Oe){const $e=Oe[k.__cacheKey];$e.usedTimes--,$e.usedTimes===0&&E(O),Object.keys(Oe).length===0&&v.delete(Ae)}n.remove(O)}function E(O){const k=n.get(O);r.deleteTexture(k.__webglTexture);const Ae=O.source,Oe=v.get(Ae);delete Oe[k.__cacheKey],c.memory.textures--}function ee(O){const k=O.texture,Ae=n.get(O),Oe=n.get(k);if(Oe.__webglTexture!==void 0&&(r.deleteTexture(Oe.__webglTexture),c.memory.textures--),O.depthTexture&&O.depthTexture.dispose(),O.isWebGLCubeRenderTarget)for(let $e=0;$e<6;$e++){if(Array.isArray(Ae.__webglFramebuffer[$e]))for(let et=0;et<Ae.__webglFramebuffer[$e].length;et++)r.deleteFramebuffer(Ae.__webglFramebuffer[$e][et]);else r.deleteFramebuffer(Ae.__webglFramebuffer[$e]);Ae.__webglDepthbuffer&&r.deleteRenderbuffer(Ae.__webglDepthbuffer[$e])}else{if(Array.isArray(Ae.__webglFramebuffer))for(let $e=0;$e<Ae.__webglFramebuffer.length;$e++)r.deleteFramebuffer(Ae.__webglFramebuffer[$e]);else r.deleteFramebuffer(Ae.__webglFramebuffer);if(Ae.__webglDepthbuffer&&r.deleteRenderbuffer(Ae.__webglDepthbuffer),Ae.__webglMultisampledFramebuffer&&r.deleteFramebuffer(Ae.__webglMultisampledFramebuffer),Ae.__webglColorRenderbuffer)for(let $e=0;$e<Ae.__webglColorRenderbuffer.length;$e++)Ae.__webglColorRenderbuffer[$e]&&r.deleteRenderbuffer(Ae.__webglColorRenderbuffer[$e]);Ae.__webglDepthRenderbuffer&&r.deleteRenderbuffer(Ae.__webglDepthRenderbuffer)}if(O.isWebGLMultipleRenderTargets)for(let $e=0,et=k.length;$e<et;$e++){const Yt=n.get(k[$e]);Yt.__webglTexture&&(r.deleteTexture(Yt.__webglTexture),c.memory.textures--),n.remove(k[$e])}n.remove(k),n.remove(O)}let Ie=0;function be(){Ie=0}function se(){const O=Ie;return O>=a.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+O+" texture units while this GPU supports only "+a.maxTextures),Ie+=1,O}function Ce(O){const k=[];return k.push(O.wrapS),k.push(O.wrapT),k.push(O.wrapR||0),k.push(O.magFilter),k.push(O.minFilter),k.push(O.anisotropy),k.push(O.internalFormat),k.push(O.format),k.push(O.type),k.push(O.generateMipmaps),k.push(O.premultiplyAlpha),k.push(O.flipY),k.push(O.unpackAlignment),k.push(O.colorSpace),k.join()}function he(O,k){const Ae=n.get(O);if(O.isVideoTexture&&Et(O),O.isRenderTargetTexture===!1&&O.version>0&&Ae.__version!==O.version){const Oe=O.image;if(Oe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Oe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{At(Ae,O,k);return}}t.bindTexture(r.TEXTURE_2D,Ae.__webglTexture,r.TEXTURE0+k)}function Be(O,k){const Ae=n.get(O);if(O.version>0&&Ae.__version!==O.version){At(Ae,O,k);return}t.bindTexture(r.TEXTURE_2D_ARRAY,Ae.__webglTexture,r.TEXTURE0+k)}function ve(O,k){const Ae=n.get(O);if(O.version>0&&Ae.__version!==O.version){At(Ae,O,k);return}t.bindTexture(r.TEXTURE_3D,Ae.__webglTexture,r.TEXTURE0+k)}function we(O,k){const Ae=n.get(O);if(O.version>0&&Ae.__version!==O.version){Zt(Ae,O,k);return}t.bindTexture(r.TEXTURE_CUBE_MAP,Ae.__webglTexture,r.TEXTURE0+k)}const me={[K0]:r.REPEAT,[Go]:r.CLAMP_TO_EDGE,[E0]:r.MIRRORED_REPEAT},Xe={[Fa]:r.NEAREST,[AR]:r.NEAREST_MIPMAP_NEAREST,[x0]:r.NEAREST_MIPMAP_LINEAR,[Ka]:r.LINEAR,[JN]:r.LINEAR_MIPMAP_NEAREST,[nC]:r.LINEAR_MIPMAP_LINEAR},Ue={[iK]:r.NEVER,[gK]:r.ALWAYS,[aK]:r.LESS,[i2]:r.LEQUAL,[sK]:r.EQUAL,[lK]:r.GEQUAL,[oK]:r.GREATER,[rK]:r.NOTEQUAL};function de(O,k,Ae){if(Ae?(r.texParameteri(O,r.TEXTURE_WRAP_S,me[k.wrapS]),r.texParameteri(O,r.TEXTURE_WRAP_T,me[k.wrapT]),(O===r.TEXTURE_3D||O===r.TEXTURE_2D_ARRAY)&&r.texParameteri(O,r.TEXTURE_WRAP_R,me[k.wrapR]),r.texParameteri(O,r.TEXTURE_MAG_FILTER,Xe[k.magFilter]),r.texParameteri(O,r.TEXTURE_MIN_FILTER,Xe[k.minFilter])):(r.texParameteri(O,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(O,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),(O===r.TEXTURE_3D||O===r.TEXTURE_2D_ARRAY)&&r.texParameteri(O,r.TEXTURE_WRAP_R,r.CLAMP_TO_EDGE),(k.wrapS!==Go||k.wrapT!==Go)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),r.texParameteri(O,r.TEXTURE_MAG_FILTER,F(k.magFilter)),r.texParameteri(O,r.TEXTURE_MIN_FILTER,F(k.minFilter)),k.minFilter!==Fa&&k.minFilter!==Ka&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),k.compareFunction&&(r.texParameteri(O,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(O,r.TEXTURE_COMPARE_FUNC,Ue[k.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const Oe=e.get("EXT_texture_filter_anisotropic");if(k.magFilter===Fa||k.minFilter!==x0&&k.minFilter!==nC||k.type===Fg&&e.has("OES_texture_float_linear")===!1||I===!1&&k.type===nb&&e.has("OES_texture_half_float_linear")===!1)return;(k.anisotropy>1||n.get(k).__currentAnisotropy)&&(r.texParameterf(O,Oe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(k.anisotropy,a.getMaxAnisotropy())),n.get(k).__currentAnisotropy=k.anisotropy)}}function Ee(O,k){let Ae=!1;O.__webglInit===void 0&&(O.__webglInit=!0,k.addEventListener("dispose",_));const Oe=k.source;let $e=v.get(Oe);$e===void 0&&($e={},v.set(Oe,$e));const et=Ce(k);if(et!==O.__cacheKey){$e[et]===void 0&&($e[et]={texture:r.createTexture(),usedTimes:0},c.memory.textures++,Ae=!0),$e[et].usedTimes++;const Yt=$e[O.__cacheKey];Yt!==void 0&&($e[O.__cacheKey].usedTimes--,Yt.usedTimes===0&&E(k)),O.__cacheKey=et,O.__webglTexture=$e[et].texture}return Ae}function At(O,k,Ae){let Oe=r.TEXTURE_2D;(k.isDataArrayTexture||k.isCompressedArrayTexture)&&(Oe=r.TEXTURE_2D_ARRAY),k.isData3DTexture&&(Oe=r.TEXTURE_3D);const $e=Ee(O,k),et=k.source;t.bindTexture(Oe,O.__webglTexture,r.TEXTURE0+Ae);const Yt=n.get(et);if(et.version!==Yt.__version||$e===!0){t.activeTexture(r.TEXTURE0+Ae);const vt=Ni.getPrimaries(Ni.workingColorSpace),Vt=k.colorSpace===al?null:Ni.getPrimaries(k.colorSpace),tn=k.colorSpace===al||vt===Vt?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,k.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,k.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,tn);const un=S(k)&&R(k.image)===!1;let ae=V(k.image,un,!1,a.maxTextureSize);ae=Wt(k,ae);const Le=R(ae)||I,at=o.convert(k.format,k.colorSpace);let Pe=o.convert(k.type),pt=X(k.internalFormat,at,Pe,k.colorSpace,k.isVideoTexture);de(Oe,k,Le);let Ct;const q=k.mipmaps,ye=I&&k.isVideoTexture!==!0&&pt!==e2,gt=Yt.__version===void 0||$e===!0,De=H(k,ae,Le);if(k.isDepthTexture)pt=r.DEPTH_COMPONENT,I?k.type===Fg?pt=r.DEPTH_COMPONENT32F:k.type===II?pt=r.DEPTH_COMPONENT24:k.type===Qd?pt=r.DEPTH24_STENCIL8:pt=r.DEPTH_COMPONENT16:k.type===Fg&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),k.format===jd&&pt===r.DEPTH_COMPONENT&&k.type!==BR&&k.type!==II&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),k.type=II,Pe=o.convert(k.type)),k.format===xA&&pt===r.DEPTH_COMPONENT&&(pt=r.DEPTH_STENCIL,k.type!==Qd&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),k.type=Qd,Pe=o.convert(k.type))),gt&&(ye?t.texStorage2D(r.TEXTURE_2D,1,pt,ae.width,ae.height):t.texImage2D(r.TEXTURE_2D,0,pt,ae.width,ae.height,0,at,Pe,null));else if(k.isDataTexture)if(q.length>0&&Le){ye&&gt&&t.texStorage2D(r.TEXTURE_2D,De,pt,q[0].width,q[0].height);for(let Ne=0,ce=q.length;Ne<ce;Ne++)Ct=q[Ne],ye?t.texSubImage2D(r.TEXTURE_2D,Ne,0,0,Ct.width,Ct.height,at,Pe,Ct.data):t.texImage2D(r.TEXTURE_2D,Ne,pt,Ct.width,Ct.height,0,at,Pe,Ct.data);k.generateMipmaps=!1}else ye?(gt&&t.texStorage2D(r.TEXTURE_2D,De,pt,ae.width,ae.height),t.texSubImage2D(r.TEXTURE_2D,0,0,0,ae.width,ae.height,at,Pe,ae.data)):t.texImage2D(r.TEXTURE_2D,0,pt,ae.width,ae.height,0,at,Pe,ae.data);else if(k.isCompressedTexture)if(k.isCompressedArrayTexture){ye&&gt&&t.texStorage3D(r.TEXTURE_2D_ARRAY,De,pt,q[0].width,q[0].height,ae.depth);for(let Ne=0,ce=q.length;Ne<ce;Ne++)Ct=q[Ne],k.format!==Uo?at!==null?ye?t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,Ne,0,0,0,Ct.width,Ct.height,ae.depth,at,Ct.data,0,0):t.compressedTexImage3D(r.TEXTURE_2D_ARRAY,Ne,pt,Ct.width,Ct.height,ae.depth,0,Ct.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ye?t.texSubImage3D(r.TEXTURE_2D_ARRAY,Ne,0,0,0,Ct.width,Ct.height,ae.depth,at,Pe,Ct.data):t.texImage3D(r.TEXTURE_2D_ARRAY,Ne,pt,Ct.width,Ct.height,ae.depth,0,at,Pe,Ct.data)}else{ye&&gt&&t.texStorage2D(r.TEXTURE_2D,De,pt,q[0].width,q[0].height);for(let Ne=0,ce=q.length;Ne<ce;Ne++)Ct=q[Ne],k.format!==Uo?at!==null?ye?t.compressedTexSubImage2D(r.TEXTURE_2D,Ne,0,0,Ct.width,Ct.height,at,Ct.data):t.compressedTexImage2D(r.TEXTURE_2D,Ne,pt,Ct.width,Ct.height,0,Ct.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ye?t.texSubImage2D(r.TEXTURE_2D,Ne,0,0,Ct.width,Ct.height,at,Pe,Ct.data):t.texImage2D(r.TEXTURE_2D,Ne,pt,Ct.width,Ct.height,0,at,Pe,Ct.data)}else if(k.isDataArrayTexture)ye?(gt&&t.texStorage3D(r.TEXTURE_2D_ARRAY,De,pt,ae.width,ae.height,ae.depth),t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,ae.width,ae.height,ae.depth,at,Pe,ae.data)):t.texImage3D(r.TEXTURE_2D_ARRAY,0,pt,ae.width,ae.height,ae.depth,0,at,Pe,ae.data);else if(k.isData3DTexture)ye?(gt&&t.texStorage3D(r.TEXTURE_3D,De,pt,ae.width,ae.height,ae.depth),t.texSubImage3D(r.TEXTURE_3D,0,0,0,0,ae.width,ae.height,ae.depth,at,Pe,ae.data)):t.texImage3D(r.TEXTURE_3D,0,pt,ae.width,ae.height,ae.depth,0,at,Pe,ae.data);else if(k.isFramebufferTexture){if(gt)if(ye)t.texStorage2D(r.TEXTURE_2D,De,pt,ae.width,ae.height);else{let Ne=ae.width,ce=ae.height;for(let dt=0;dt<De;dt++)t.texImage2D(r.TEXTURE_2D,dt,pt,Ne,ce,0,at,Pe,null),Ne>>=1,ce>>=1}}else if(q.length>0&&Le){ye&&gt&&t.texStorage2D(r.TEXTURE_2D,De,pt,q[0].width,q[0].height);for(let Ne=0,ce=q.length;Ne<ce;Ne++)Ct=q[Ne],ye?t.texSubImage2D(r.TEXTURE_2D,Ne,0,0,at,Pe,Ct):t.texImage2D(r.TEXTURE_2D,Ne,pt,at,Pe,Ct);k.generateMipmaps=!1}else ye?(gt&&t.texStorage2D(r.TEXTURE_2D,De,pt,ae.width,ae.height),t.texSubImage2D(r.TEXTURE_2D,0,0,0,at,Pe,ae)):t.texImage2D(r.TEXTURE_2D,0,pt,at,Pe,ae);N(k,Le)&&w(Oe),Yt.__version=et.version,k.onUpdate&&k.onUpdate(k)}O.__version=k.version}function Zt(O,k,Ae){if(k.image.length!==6)return;const Oe=Ee(O,k),$e=k.source;t.bindTexture(r.TEXTURE_CUBE_MAP,O.__webglTexture,r.TEXTURE0+Ae);const et=n.get($e);if($e.version!==et.__version||Oe===!0){t.activeTexture(r.TEXTURE0+Ae);const Yt=Ni.getPrimaries(Ni.workingColorSpace),vt=k.colorSpace===al?null:Ni.getPrimaries(k.colorSpace),Vt=k.colorSpace===al||Yt===vt?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,k.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,k.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,Vt);const tn=k.isCompressedTexture||k.image[0].isCompressedTexture,un=k.image[0]&&k.image[0].isDataTexture,ae=[];for(let Ne=0;Ne<6;Ne++)!tn&&!un?ae[Ne]=V(k.image[Ne],!1,!0,a.maxCubemapSize):ae[Ne]=un?k.image[Ne].image:k.image[Ne],ae[Ne]=Wt(k,ae[Ne]);const Le=ae[0],at=R(Le)||I,Pe=o.convert(k.format,k.colorSpace),pt=o.convert(k.type),Ct=X(k.internalFormat,Pe,pt,k.colorSpace),q=I&&k.isVideoTexture!==!0,ye=et.__version===void 0||Oe===!0;let gt=H(k,Le,at);de(r.TEXTURE_CUBE_MAP,k,at);let De;if(tn){q&&ye&&t.texStorage2D(r.TEXTURE_CUBE_MAP,gt,Ct,Le.width,Le.height);for(let Ne=0;Ne<6;Ne++){De=ae[Ne].mipmaps;for(let ce=0;ce<De.length;ce++){const dt=De[ce];k.format!==Uo?Pe!==null?q?t.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,ce,0,0,dt.width,dt.height,Pe,dt.data):t.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,ce,Ct,dt.width,dt.height,0,dt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):q?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,ce,0,0,dt.width,dt.height,Pe,pt,dt.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,ce,Ct,dt.width,dt.height,0,Pe,pt,dt.data)}}}else{De=k.mipmaps,q&&ye&&(De.length>0&&gt++,t.texStorage2D(r.TEXTURE_CUBE_MAP,gt,Ct,ae[0].width,ae[0].height));for(let Ne=0;Ne<6;Ne++)if(un){q?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,0,0,0,ae[Ne].width,ae[Ne].height,Pe,pt,ae[Ne].data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,0,Ct,ae[Ne].width,ae[Ne].height,0,Pe,pt,ae[Ne].data);for(let ce=0;ce<De.length;ce++){const wt=De[ce].image[Ne].image;q?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,ce+1,0,0,wt.width,wt.height,Pe,pt,wt.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,ce+1,Ct,wt.width,wt.height,0,Pe,pt,wt.data)}}else{q?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,0,0,0,Pe,pt,ae[Ne]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,0,Ct,Pe,pt,ae[Ne]);for(let ce=0;ce<De.length;ce++){const dt=De[ce];q?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,ce+1,0,0,Pe,pt,dt.image[Ne]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,ce+1,Ct,Pe,pt,dt.image[Ne])}}}N(k,at)&&w(r.TEXTURE_CUBE_MAP),et.__version=$e.version,k.onUpdate&&k.onUpdate(k)}O.__version=k.version}function Bt(O,k,Ae,Oe,$e,et){const Yt=o.convert(Ae.format,Ae.colorSpace),vt=o.convert(Ae.type),Vt=X(Ae.internalFormat,Yt,vt,Ae.colorSpace);if(!n.get(k).__hasExternalTextures){const un=Math.max(1,k.width>>et),ae=Math.max(1,k.height>>et);$e===r.TEXTURE_3D||$e===r.TEXTURE_2D_ARRAY?t.texImage3D($e,et,Vt,un,ae,k.depth,0,Yt,vt,null):t.texImage2D($e,et,Vt,un,ae,0,Yt,vt,null)}t.bindFramebuffer(r.FRAMEBUFFER,O),Te(k)?C.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,Oe,$e,n.get(Ae).__webglTexture,0,it(k)):($e===r.TEXTURE_2D||$e>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&$e<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,Oe,$e,n.get(Ae).__webglTexture,et),t.bindFramebuffer(r.FRAMEBUFFER,null)}function kt(O,k,Ae){if(r.bindRenderbuffer(r.RENDERBUFFER,O),k.depthBuffer&&!k.stencilBuffer){let Oe=I===!0?r.DEPTH_COMPONENT24:r.DEPTH_COMPONENT16;if(Ae||Te(k)){const $e=k.depthTexture;$e&&$e.isDepthTexture&&($e.type===Fg?Oe=r.DEPTH_COMPONENT32F:$e.type===II&&(Oe=r.DEPTH_COMPONENT24));const et=it(k);Te(k)?C.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,et,Oe,k.width,k.height):r.renderbufferStorageMultisample(r.RENDERBUFFER,et,Oe,k.width,k.height)}else r.renderbufferStorage(r.RENDERBUFFER,Oe,k.width,k.height);r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,O)}else if(k.depthBuffer&&k.stencilBuffer){const Oe=it(k);Ae&&Te(k)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,Oe,r.DEPTH24_STENCIL8,k.width,k.height):Te(k)?C.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,Oe,r.DEPTH24_STENCIL8,k.width,k.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,k.width,k.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,O)}else{const Oe=k.isWebGLMultipleRenderTargets===!0?k.texture:[k.texture];for(let $e=0;$e<Oe.length;$e++){const et=Oe[$e],Yt=o.convert(et.format,et.colorSpace),vt=o.convert(et.type),Vt=X(et.internalFormat,Yt,vt,et.colorSpace),tn=it(k);Ae&&Te(k)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,tn,Vt,k.width,k.height):Te(k)?C.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,tn,Vt,k.width,k.height):r.renderbufferStorage(r.RENDERBUFFER,Vt,k.width,k.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function $t(O,k){if(k&&k.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(r.FRAMEBUFFER,O),!(k.depthTexture&&k.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(k.depthTexture).__webglTexture||k.depthTexture.image.width!==k.width||k.depthTexture.image.height!==k.height)&&(k.depthTexture.image.width=k.width,k.depthTexture.image.height=k.height,k.depthTexture.needsUpdate=!0),he(k.depthTexture,0);const Oe=n.get(k.depthTexture).__webglTexture,$e=it(k);if(k.depthTexture.format===jd)Te(k)?C.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Oe,0,$e):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Oe,0);else if(k.depthTexture.format===xA)Te(k)?C.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Oe,0,$e):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Oe,0);else throw new Error("Unknown depthTexture format")}function Xt(O){const k=n.get(O),Ae=O.isWebGLCubeRenderTarget===!0;if(O.depthTexture&&!k.__autoAllocateDepthBuffer){if(Ae)throw new Error("target.depthTexture not supported in Cube render targets");$t(k.__webglFramebuffer,O)}else if(Ae){k.__webglDepthbuffer=[];for(let Oe=0;Oe<6;Oe++)t.bindFramebuffer(r.FRAMEBUFFER,k.__webglFramebuffer[Oe]),k.__webglDepthbuffer[Oe]=r.createRenderbuffer(),kt(k.__webglDepthbuffer[Oe],O,!1)}else t.bindFramebuffer(r.FRAMEBUFFER,k.__webglFramebuffer),k.__webglDepthbuffer=r.createRenderbuffer(),kt(k.__webglDepthbuffer,O,!1);t.bindFramebuffer(r.FRAMEBUFFER,null)}function Ot(O,k,Ae){const Oe=n.get(O);k!==void 0&&Bt(Oe.__webglFramebuffer,O,O.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),Ae!==void 0&&Xt(O)}function oe(O){const k=O.texture,Ae=n.get(O),Oe=n.get(k);O.addEventListener("dispose",P),O.isWebGLMultipleRenderTargets!==!0&&(Oe.__webglTexture===void 0&&(Oe.__webglTexture=r.createTexture()),Oe.__version=k.version,c.memory.textures++);const $e=O.isWebGLCubeRenderTarget===!0,et=O.isWebGLMultipleRenderTargets===!0,Yt=R(O)||I;if($e){Ae.__webglFramebuffer=[];for(let vt=0;vt<6;vt++)if(I&&k.mipmaps&&k.mipmaps.length>0){Ae.__webglFramebuffer[vt]=[];for(let Vt=0;Vt<k.mipmaps.length;Vt++)Ae.__webglFramebuffer[vt][Vt]=r.createFramebuffer()}else Ae.__webglFramebuffer[vt]=r.createFramebuffer()}else{if(I&&k.mipmaps&&k.mipmaps.length>0){Ae.__webglFramebuffer=[];for(let vt=0;vt<k.mipmaps.length;vt++)Ae.__webglFramebuffer[vt]=r.createFramebuffer()}else Ae.__webglFramebuffer=r.createFramebuffer();if(et)if(a.drawBuffers){const vt=O.texture;for(let Vt=0,tn=vt.length;Vt<tn;Vt++){const un=n.get(vt[Vt]);un.__webglTexture===void 0&&(un.__webglTexture=r.createTexture(),c.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(I&&O.samples>0&&Te(O)===!1){const vt=et?k:[k];Ae.__webglMultisampledFramebuffer=r.createFramebuffer(),Ae.__webglColorRenderbuffer=[],t.bindFramebuffer(r.FRAMEBUFFER,Ae.__webglMultisampledFramebuffer);for(let Vt=0;Vt<vt.length;Vt++){const tn=vt[Vt];Ae.__webglColorRenderbuffer[Vt]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,Ae.__webglColorRenderbuffer[Vt]);const un=o.convert(tn.format,tn.colorSpace),ae=o.convert(tn.type),Le=X(tn.internalFormat,un,ae,tn.colorSpace,O.isXRRenderTarget===!0),at=it(O);r.renderbufferStorageMultisample(r.RENDERBUFFER,at,Le,O.width,O.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+Vt,r.RENDERBUFFER,Ae.__webglColorRenderbuffer[Vt])}r.bindRenderbuffer(r.RENDERBUFFER,null),O.depthBuffer&&(Ae.__webglDepthRenderbuffer=r.createRenderbuffer(),kt(Ae.__webglDepthRenderbuffer,O,!0)),t.bindFramebuffer(r.FRAMEBUFFER,null)}}if($e){t.bindTexture(r.TEXTURE_CUBE_MAP,Oe.__webglTexture),de(r.TEXTURE_CUBE_MAP,k,Yt);for(let vt=0;vt<6;vt++)if(I&&k.mipmaps&&k.mipmaps.length>0)for(let Vt=0;Vt<k.mipmaps.length;Vt++)Bt(Ae.__webglFramebuffer[vt][Vt],O,k,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+vt,Vt);else Bt(Ae.__webglFramebuffer[vt],O,k,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+vt,0);N(k,Yt)&&w(r.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(et){const vt=O.texture;for(let Vt=0,tn=vt.length;Vt<tn;Vt++){const un=vt[Vt],ae=n.get(un);t.bindTexture(r.TEXTURE_2D,ae.__webglTexture),de(r.TEXTURE_2D,un,Yt),Bt(Ae.__webglFramebuffer,O,un,r.COLOR_ATTACHMENT0+Vt,r.TEXTURE_2D,0),N(un,Yt)&&w(r.TEXTURE_2D)}t.unbindTexture()}else{let vt=r.TEXTURE_2D;if((O.isWebGL3DRenderTarget||O.isWebGLArrayRenderTarget)&&(I?vt=O.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(vt,Oe.__webglTexture),de(vt,k,Yt),I&&k.mipmaps&&k.mipmaps.length>0)for(let Vt=0;Vt<k.mipmaps.length;Vt++)Bt(Ae.__webglFramebuffer[Vt],O,k,r.COLOR_ATTACHMENT0,vt,Vt);else Bt(Ae.__webglFramebuffer,O,k,r.COLOR_ATTACHMENT0,vt,0);N(k,Yt)&&w(vt),t.unbindTexture()}O.depthBuffer&&Xt(O)}function ut(O){const k=R(O)||I,Ae=O.isWebGLMultipleRenderTargets===!0?O.texture:[O.texture];for(let Oe=0,$e=Ae.length;Oe<$e;Oe++){const et=Ae[Oe];if(N(et,k)){const Yt=O.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D,vt=n.get(et).__webglTexture;t.bindTexture(Yt,vt),w(Yt),t.unbindTexture()}}}function _e(O){if(I&&O.samples>0&&Te(O)===!1){const k=O.isWebGLMultipleRenderTargets?O.texture:[O.texture],Ae=O.width,Oe=O.height;let $e=r.COLOR_BUFFER_BIT;const et=[],Yt=O.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,vt=n.get(O),Vt=O.isWebGLMultipleRenderTargets===!0;if(Vt)for(let tn=0;tn<k.length;tn++)t.bindFramebuffer(r.FRAMEBUFFER,vt.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+tn,r.RENDERBUFFER,null),t.bindFramebuffer(r.FRAMEBUFFER,vt.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+tn,r.TEXTURE_2D,null,0);t.bindFramebuffer(r.READ_FRAMEBUFFER,vt.__webglMultisampledFramebuffer),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,vt.__webglFramebuffer);for(let tn=0;tn<k.length;tn++){et.push(r.COLOR_ATTACHMENT0+tn),O.depthBuffer&&et.push(Yt);const un=vt.__ignoreDepthValues!==void 0?vt.__ignoreDepthValues:!1;if(un===!1&&(O.depthBuffer&&($e|=r.DEPTH_BUFFER_BIT),O.stencilBuffer&&($e|=r.STENCIL_BUFFER_BIT)),Vt&&r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,vt.__webglColorRenderbuffer[tn]),un===!0&&(r.invalidateFramebuffer(r.READ_FRAMEBUFFER,[Yt]),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[Yt])),Vt){const ae=n.get(k[tn]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,ae,0)}r.blitFramebuffer(0,0,Ae,Oe,0,0,Ae,Oe,$e,r.NEAREST),d&&r.invalidateFramebuffer(r.READ_FRAMEBUFFER,et)}if(t.bindFramebuffer(r.READ_FRAMEBUFFER,null),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),Vt)for(let tn=0;tn<k.length;tn++){t.bindFramebuffer(r.FRAMEBUFFER,vt.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+tn,r.RENDERBUFFER,vt.__webglColorRenderbuffer[tn]);const un=n.get(k[tn]).__webglTexture;t.bindFramebuffer(r.FRAMEBUFFER,vt.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+tn,r.TEXTURE_2D,un,0)}t.bindFramebuffer(r.DRAW_FRAMEBUFFER,vt.__webglMultisampledFramebuffer)}}function it(O){return Math.min(a.maxSamples,O.samples)}function Te(O){const k=n.get(O);return I&&O.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&k.__useRenderToTexture!==!1}function Et(O){const k=c.render.frame;f.get(O)!==k&&(f.set(O,k),O.update())}function Wt(O,k){const Ae=O.colorSpace,Oe=O.format,$e=O.type;return O.isCompressedTexture===!0||O.isVideoTexture===!0||O.format===fR||Ae!==Tc&&Ae!==al&&(Ni.getTransfer(Ae)===ta?I===!1?e.has("EXT_sRGB")===!0&&Oe===Uo?(O.format=fR,O.minFilter=Ka,O.generateMipmaps=!1):k=s2.sRGBToLinear(k):(Oe!==Uo||$e!==Kc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Ae)),k}this.allocateTextureUnit=se,this.resetTextureUnits=be,this.setTexture2D=he,this.setTexture2DArray=Be,this.setTexture3D=ve,this.setTextureCube=we,this.rebindTextures=Ot,this.setupRenderTarget=oe,this.updateRenderTargetMipmap=ut,this.updateMultisampleRenderTarget=_e,this.setupDepthRenderbuffer=Xt,this.setupFrameBufferTexture=Bt,this.useMultisampledRTT=Te}function ZK(r,e,t){const n=t.isWebGL2;function a(o,c=al){let I;const C=Ni.getTransfer(c);if(o===Kc)return r.UNSIGNED_BYTE;if(o===PN)return r.UNSIGNED_SHORT_4_4_4_4;if(o===QN)return r.UNSIGNED_SHORT_5_5_5_1;if(o===_F)return r.BYTE;if(o===kF)return r.SHORT;if(o===BR)return r.UNSIGNED_SHORT;if(o===ON)return r.INT;if(o===II)return r.UNSIGNED_INT;if(o===Fg)return r.FLOAT;if(o===nb)return n?r.HALF_FLOAT:(I=e.get("OES_texture_half_float"),I!==null?I.HALF_FLOAT_OES:null);if(o===UF)return r.ALPHA;if(o===Uo)return r.RGBA;if(o===DF)return r.LUMINANCE;if(o===JF)return r.LUMINANCE_ALPHA;if(o===jd)return r.DEPTH_COMPONENT;if(o===xA)return r.DEPTH_STENCIL;if(o===fR)return I=e.get("EXT_sRGB"),I!==null?I.SRGB_ALPHA_EXT:null;if(o===OF)return r.RED;if(o===jN)return r.RED_INTEGER;if(o===PF)return r.RG;if(o===qN)return r.RG_INTEGER;if(o===$N)return r.RGBA_INTEGER;if(o===qS||o===$S||o===eR||o===tR)if(C===ta)if(I=e.get("WEBGL_compressed_texture_s3tc_srgb"),I!==null){if(o===qS)return I.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(o===$S)return I.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(o===eR)return I.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(o===tR)return I.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(I=e.get("WEBGL_compressed_texture_s3tc"),I!==null){if(o===qS)return I.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===$S)return I.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===eR)return I.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===tR)return I.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===QV||o===jV||o===qV||o===$V)if(I=e.get("WEBGL_compressed_texture_pvrtc"),I!==null){if(o===QV)return I.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===jV)return I.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===qV)return I.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===$V)return I.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===e2)return I=e.get("WEBGL_compressed_texture_etc1"),I!==null?I.COMPRESSED_RGB_ETC1_WEBGL:null;if(o===eN||o===tN)if(I=e.get("WEBGL_compressed_texture_etc"),I!==null){if(o===eN)return C===ta?I.COMPRESSED_SRGB8_ETC2:I.COMPRESSED_RGB8_ETC2;if(o===tN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:I.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(o===nN||o===iN||o===aN||o===sN||o===oN||o===rN||o===lN||o===gN||o===cN||o===uN||o===IN||o===dN||o===CN||o===hN)if(I=e.get("WEBGL_compressed_texture_astc"),I!==null){if(o===nN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:I.COMPRESSED_RGBA_ASTC_4x4_KHR;if(o===iN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:I.COMPRESSED_RGBA_ASTC_5x4_KHR;if(o===aN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:I.COMPRESSED_RGBA_ASTC_5x5_KHR;if(o===sN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:I.COMPRESSED_RGBA_ASTC_6x5_KHR;if(o===oN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:I.COMPRESSED_RGBA_ASTC_6x6_KHR;if(o===rN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:I.COMPRESSED_RGBA_ASTC_8x5_KHR;if(o===lN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:I.COMPRESSED_RGBA_ASTC_8x6_KHR;if(o===gN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:I.COMPRESSED_RGBA_ASTC_8x8_KHR;if(o===cN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:I.COMPRESSED_RGBA_ASTC_10x5_KHR;if(o===uN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:I.COMPRESSED_RGBA_ASTC_10x6_KHR;if(o===IN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:I.COMPRESSED_RGBA_ASTC_10x8_KHR;if(o===dN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:I.COMPRESSED_RGBA_ASTC_10x10_KHR;if(o===CN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:I.COMPRESSED_RGBA_ASTC_12x10_KHR;if(o===hN)return C===ta?I.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:I.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(o===nR||o===AN||o===fN)if(I=e.get("EXT_texture_compression_bptc"),I!==null){if(o===nR)return C===ta?I.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:I.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(o===AN)return I.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(o===fN)return I.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(o===QF||o===pN||o===mN||o===bN)if(I=e.get("EXT_texture_compression_rgtc"),I!==null){if(o===nR)return I.COMPRESSED_RED_RGTC1_EXT;if(o===pN)return I.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(o===mN)return I.COMPRESSED_RED_GREEN_RGTC2_EXT;if(o===bN)return I.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return o===Qd?n?r.UNSIGNED_INT_24_8:(I=e.get("WEBGL_depth_texture"),I!==null?I.UNSIGNED_INT_24_8_WEBGL:null):r[o]!==void 0?r[o]:null}return{convert:a}}class SK extends Ea{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Pm extends Ai{constructor(){super(),this.isGroup=!0,this.type="Group"}}const MU={type:"move"};class cV{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Pm,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Pm,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new $,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new $),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Pm,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new $,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new $),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let a=null,o=null,c=null;const I=this._targetRay,C=this._grip,d=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(d&&e.hand){c=!0;for(const V of e.hand.values()){const R=t.getJointPose(V,n),S=this._getHandJoint(d,V);R!==null&&(S.matrix.fromArray(R.transform.matrix),S.matrix.decompose(S.position,S.rotation,S.scale),S.matrixWorldNeedsUpdate=!0,S.jointRadius=R.radius),S.visible=R!==null}const f=d.joints["index-finger-tip"],b=d.joints["thumb-tip"],v=f.position.distanceTo(b.position),y=.02,Z=.005;d.inputState.pinching&&v>y+Z?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!d.inputState.pinching&&v<=y-Z&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else C!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,n),o!==null&&(C.matrix.fromArray(o.transform.matrix),C.matrix.decompose(C.position,C.rotation,C.scale),C.matrixWorldNeedsUpdate=!0,o.linearVelocity?(C.hasLinearVelocity=!0,C.linearVelocity.copy(o.linearVelocity)):C.hasLinearVelocity=!1,o.angularVelocity?(C.hasAngularVelocity=!0,C.angularVelocity.copy(o.angularVelocity)):C.hasAngularVelocity=!1));I!==null&&(a=t.getPose(e.targetRaySpace,n),a===null&&o!==null&&(a=o),a!==null&&(I.matrix.fromArray(a.transform.matrix),I.matrix.decompose(I.position,I.rotation,I.scale),I.matrixWorldNeedsUpdate=!0,a.linearVelocity?(I.hasLinearVelocity=!0,I.linearVelocity.copy(a.linearVelocity)):I.hasLinearVelocity=!1,a.angularVelocity?(I.hasAngularVelocity=!0,I.angularVelocity.copy(a.angularVelocity)):I.hasAngularVelocity=!1,this.dispatchEvent(MU)))}return I!==null&&(I.visible=a!==null),C!==null&&(C.visible=o!==null),d!==null&&(d.visible=c!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Pm;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class HU extends bI{constructor(e,t){super();const n=this;let a=null,o=1,c=null,I="local-floor",C=1,d=null,f=null,b=null,v=null,y=null,Z=null;const V=t.getContextAttributes();let R=null,S=null;const N=[],w=[],X=new lt;let H=null;const F=new Ea;F.layers.enable(1),F.viewport=new Xi;const _=new Ea;_.layers.enable(2),_.viewport=new Xi;const P=[F,_],K=new SK;K.layers.enable(1),K.layers.enable(2);let E=null,ee=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(de){let Ee=N[de];return Ee===void 0&&(Ee=new cV,N[de]=Ee),Ee.getTargetRaySpace()},this.getControllerGrip=function(de){let Ee=N[de];return Ee===void 0&&(Ee=new cV,N[de]=Ee),Ee.getGripSpace()},this.getHand=function(de){let Ee=N[de];return Ee===void 0&&(Ee=new cV,N[de]=Ee),Ee.getHandSpace()};function Ie(de){const Ee=w.indexOf(de.inputSource);if(Ee===-1)return;const At=N[Ee];At!==void 0&&(At.update(de.inputSource,de.frame,d||c),At.dispatchEvent({type:de.type,data:de.inputSource}))}function be(){a.removeEventListener("select",Ie),a.removeEventListener("selectstart",Ie),a.removeEventListener("selectend",Ie),a.removeEventListener("squeeze",Ie),a.removeEventListener("squeezestart",Ie),a.removeEventListener("squeezeend",Ie),a.removeEventListener("end",be),a.removeEventListener("inputsourceschange",se);for(let de=0;de<N.length;de++){const Ee=w[de];Ee!==null&&(w[de]=null,N[de].disconnect(Ee))}E=null,ee=null,e.setRenderTarget(R),y=null,v=null,b=null,a=null,S=null,Ue.stop(),n.isPresenting=!1,e.setPixelRatio(H),e.setSize(X.width,X.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(de){o=de,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(de){I=de,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return d||c},this.setReferenceSpace=function(de){d=de},this.getBaseLayer=function(){return v!==null?v:y},this.getBinding=function(){return b},this.getFrame=function(){return Z},this.getSession=function(){return a},this.setSession=async function(de){if(a=de,a!==null){if(R=e.getRenderTarget(),a.addEventListener("select",Ie),a.addEventListener("selectstart",Ie),a.addEventListener("selectend",Ie),a.addEventListener("squeeze",Ie),a.addEventListener("squeezestart",Ie),a.addEventListener("squeezeend",Ie),a.addEventListener("end",be),a.addEventListener("inputsourceschange",se),V.xrCompatible!==!0&&await t.makeXRCompatible(),H=e.getPixelRatio(),e.getSize(X),a.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const Ee={antialias:a.renderState.layers===void 0?V.antialias:!0,alpha:!0,depth:V.depth,stencil:V.stencil,framebufferScaleFactor:o};y=new XRWebGLLayer(a,t,Ee),a.updateRenderState({baseLayer:y}),e.setPixelRatio(1),e.setSize(y.framebufferWidth,y.framebufferHeight,!1),S=new Eg(y.framebufferWidth,y.framebufferHeight,{format:Uo,type:Kc,colorSpace:e.outputColorSpace,stencilBuffer:V.stencil})}else{let Ee=null,At=null,Zt=null;V.depth&&(Zt=V.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Ee=V.stencil?xA:jd,At=V.stencil?Qd:II);const Bt={colorFormat:t.RGBA8,depthFormat:Zt,scaleFactor:o};b=new XRWebGLBinding(a,t),v=b.createProjectionLayer(Bt),a.updateRenderState({layers:[v]}),e.setPixelRatio(1),e.setSize(v.textureWidth,v.textureHeight,!1),S=new Eg(v.textureWidth,v.textureHeight,{format:Uo,type:Kc,depthTexture:new c2(v.textureWidth,v.textureHeight,At,void 0,void 0,void 0,void 0,void 0,void 0,Ee),stencilBuffer:V.stencil,colorSpace:e.outputColorSpace,samples:V.antialias?4:0});const kt=e.properties.get(S);kt.__ignoreDepthValues=v.ignoreDepthValues}S.isXRRenderTarget=!0,this.setFoveation(C),d=null,c=await a.requestReferenceSpace(I),Ue.setContext(a),Ue.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(a!==null)return a.environmentBlendMode};function se(de){for(let Ee=0;Ee<de.removed.length;Ee++){const At=de.removed[Ee],Zt=w.indexOf(At);Zt>=0&&(w[Zt]=null,N[Zt].disconnect(At))}for(let Ee=0;Ee<de.added.length;Ee++){const At=de.added[Ee];let Zt=w.indexOf(At);if(Zt===-1){for(let kt=0;kt<N.length;kt++)if(kt>=w.length){w.push(At),Zt=kt;break}else if(w[kt]===null){w[kt]=At,Zt=kt;break}if(Zt===-1)break}const Bt=N[Zt];Bt&&Bt.connect(At)}}const Ce=new $,he=new $;function Be(de,Ee,At){Ce.setFromMatrixPosition(Ee.matrixWorld),he.setFromMatrixPosition(At.matrixWorld);const Zt=Ce.distanceTo(he),Bt=Ee.projectionMatrix.elements,kt=At.projectionMatrix.elements,$t=Bt[14]/(Bt[10]-1),Xt=Bt[14]/(Bt[10]+1),Ot=(Bt[9]+1)/Bt[5],oe=(Bt[9]-1)/Bt[5],ut=(Bt[8]-1)/Bt[0],_e=(kt[8]+1)/kt[0],it=$t*ut,Te=$t*_e,Et=Zt/(-ut+_e),Wt=Et*-ut;Ee.matrixWorld.decompose(de.position,de.quaternion,de.scale),de.translateX(Wt),de.translateZ(Et),de.matrixWorld.compose(de.position,de.quaternion,de.scale),de.matrixWorldInverse.copy(de.matrixWorld).invert();const O=$t+Et,k=Xt+Et,Ae=it-Wt,Oe=Te+(Zt-Wt),$e=Ot*Xt/k*O,et=oe*Xt/k*O;de.projectionMatrix.makePerspective(Ae,Oe,$e,et,O,k),de.projectionMatrixInverse.copy(de.projectionMatrix).invert()}function ve(de,Ee){Ee===null?de.matrixWorld.copy(de.matrix):de.matrixWorld.multiplyMatrices(Ee.matrixWorld,de.matrix),de.matrixWorldInverse.copy(de.matrixWorld).invert()}this.updateCamera=function(de){if(a===null)return;K.near=_.near=F.near=de.near,K.far=_.far=F.far=de.far,(E!==K.near||ee!==K.far)&&(a.updateRenderState({depthNear:K.near,depthFar:K.far}),E=K.near,ee=K.far);const Ee=de.parent,At=K.cameras;ve(K,Ee);for(let Zt=0;Zt<At.length;Zt++)ve(At[Zt],Ee);At.length===2?Be(K,F,_):K.projectionMatrix.copy(F.projectionMatrix),we(de,K,Ee)};function we(de,Ee,At){At===null?de.matrix.copy(Ee.matrixWorld):(de.matrix.copy(At.matrixWorld),de.matrix.invert(),de.matrix.multiply(Ee.matrixWorld)),de.matrix.decompose(de.position,de.quaternion,de.scale),de.updateMatrixWorld(!0),de.projectionMatrix.copy(Ee.projectionMatrix),de.projectionMatrixInverse.copy(Ee.projectionMatrixInverse),de.isPerspectiveCamera&&(de.fov=ab*2*Math.atan(1/de.projectionMatrix.elements[5]),de.zoom=1)}this.getCamera=function(){return K},this.getFoveation=function(){if(!(v===null&&y===null))return C},this.setFoveation=function(de){C=de,v!==null&&(v.fixedFoveation=de),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=de)};let me=null;function Xe(de,Ee){if(f=Ee.getViewerPose(d||c),Z=Ee,f!==null){const At=f.views;y!==null&&(e.setRenderTargetFramebuffer(S,y.framebuffer),e.setRenderTarget(S));let Zt=!1;At.length!==K.cameras.length&&(K.cameras.length=0,Zt=!0);for(let Bt=0;Bt<At.length;Bt++){const kt=At[Bt];let $t=null;if(y!==null)$t=y.getViewport(kt);else{const Ot=b.getViewSubImage(v,kt);$t=Ot.viewport,Bt===0&&(e.setRenderTargetTextures(S,Ot.colorTexture,v.ignoreDepthValues?void 0:Ot.depthStencilTexture),e.setRenderTarget(S))}let Xt=P[Bt];Xt===void 0&&(Xt=new Ea,Xt.layers.enable(Bt),Xt.viewport=new Xi,P[Bt]=Xt),Xt.matrix.fromArray(kt.transform.matrix),Xt.matrix.decompose(Xt.position,Xt.quaternion,Xt.scale),Xt.projectionMatrix.fromArray(kt.projectionMatrix),Xt.projectionMatrixInverse.copy(Xt.projectionMatrix).invert(),Xt.viewport.set($t.x,$t.y,$t.width,$t.height),Bt===0&&(K.matrix.copy(Xt.matrix),K.matrix.decompose(K.position,K.quaternion,K.scale)),Zt===!0&&K.cameras.push(Xt)}}for(let At=0;At<N.length;At++){const Zt=w[At],Bt=N[At];Zt!==null&&Bt!==void 0&&Bt.update(Zt,Ee,d||c)}me&&me(de,Ee),Ee.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Ee}),Z=null}const Ue=new mK;Ue.setAnimationLoop(Xe),this.setAnimationLoop=function(de){me=de},this.dispose=function(){}}}function FU(r,e){function t(R,S){R.matrixAutoUpdate===!0&&R.updateMatrix(),S.value.copy(R.matrix)}function n(R,S){S.color.getRGB(R.fogColor.value,hK(r)),S.isFog?(R.fogNear.value=S.near,R.fogFar.value=S.far):S.isFogExp2&&(R.fogDensity.value=S.density)}function a(R,S,N,w,X){S.isMeshBasicMaterial||S.isMeshLambertMaterial?o(R,S):S.isMeshToonMaterial?(o(R,S),b(R,S)):S.isMeshPhongMaterial?(o(R,S),f(R,S)):S.isMeshStandardMaterial?(o(R,S),v(R,S),S.isMeshPhysicalMaterial&&y(R,S,X)):S.isMeshMatcapMaterial?(o(R,S),Z(R,S)):S.isMeshDepthMaterial?o(R,S):S.isMeshDistanceMaterial?(o(R,S),V(R,S)):S.isMeshNormalMaterial?o(R,S):S.isLineBasicMaterial?(c(R,S),S.isLineDashedMaterial&&I(R,S)):S.isPointsMaterial?C(R,S,N,w):S.isSpriteMaterial?d(R,S):S.isShadowMaterial?(R.color.value.copy(S.color),R.opacity.value=S.opacity):S.isShaderMaterial&&(S.uniformsNeedUpdate=!1)}function o(R,S){R.opacity.value=S.opacity,S.color&&R.diffuse.value.copy(S.color),S.emissive&&R.emissive.value.copy(S.emissive).multiplyScalar(S.emissiveIntensity),S.map&&(R.map.value=S.map,t(S.map,R.mapTransform)),S.alphaMap&&(R.alphaMap.value=S.alphaMap,t(S.alphaMap,R.alphaMapTransform)),S.bumpMap&&(R.bumpMap.value=S.bumpMap,t(S.bumpMap,R.bumpMapTransform),R.bumpScale.value=S.bumpScale,S.side===Do&&(R.bumpScale.value*=-1)),S.normalMap&&(R.normalMap.value=S.normalMap,t(S.normalMap,R.normalMapTransform),R.normalScale.value.copy(S.normalScale),S.side===Do&&R.normalScale.value.negate()),S.displacementMap&&(R.displacementMap.value=S.displacementMap,t(S.displacementMap,R.displacementMapTransform),R.displacementScale.value=S.displacementScale,R.displacementBias.value=S.displacementBias),S.emissiveMap&&(R.emissiveMap.value=S.emissiveMap,t(S.emissiveMap,R.emissiveMapTransform)),S.specularMap&&(R.specularMap.value=S.specularMap,t(S.specularMap,R.specularMapTransform)),S.alphaTest>0&&(R.alphaTest.value=S.alphaTest);const N=e.get(S).envMap;if(N&&(R.envMap.value=N,R.flipEnvMap.value=N.isCubeTexture&&N.isRenderTargetTexture===!1?-1:1,R.reflectivity.value=S.reflectivity,R.ior.value=S.ior,R.refractionRatio.value=S.refractionRatio),S.lightMap){R.lightMap.value=S.lightMap;const w=r._useLegacyLights===!0?Math.PI:1;R.lightMapIntensity.value=S.lightMapIntensity*w,t(S.lightMap,R.lightMapTransform)}S.aoMap&&(R.aoMap.value=S.aoMap,R.aoMapIntensity.value=S.aoMapIntensity,t(S.aoMap,R.aoMapTransform))}function c(R,S){R.diffuse.value.copy(S.color),R.opacity.value=S.opacity,S.map&&(R.map.value=S.map,t(S.map,R.mapTransform))}function I(R,S){R.dashSize.value=S.dashSize,R.totalSize.value=S.dashSize+S.gapSize,R.scale.value=S.scale}function C(R,S,N,w){R.diffuse.value.copy(S.color),R.opacity.value=S.opacity,R.size.value=S.size*N,R.scale.value=w*.5,S.map&&(R.map.value=S.map,t(S.map,R.uvTransform)),S.alphaMap&&(R.alphaMap.value=S.alphaMap,t(S.alphaMap,R.alphaMapTransform)),S.alphaTest>0&&(R.alphaTest.value=S.alphaTest)}function d(R,S){R.diffuse.value.copy(S.color),R.opacity.value=S.opacity,R.rotation.value=S.rotation,S.map&&(R.map.value=S.map,t(S.map,R.mapTransform)),S.alphaMap&&(R.alphaMap.value=S.alphaMap,t(S.alphaMap,R.alphaMapTransform)),S.alphaTest>0&&(R.alphaTest.value=S.alphaTest)}function f(R,S){R.specular.value.copy(S.specular),R.shininess.value=Math.max(S.shininess,1e-4)}function b(R,S){S.gradientMap&&(R.gradientMap.value=S.gradientMap)}function v(R,S){R.metalness.value=S.metalness,S.metalnessMap&&(R.metalnessMap.value=S.metalnessMap,t(S.metalnessMap,R.metalnessMapTransform)),R.roughness.value=S.roughness,S.roughnessMap&&(R.roughnessMap.value=S.roughnessMap,t(S.roughnessMap,R.roughnessMapTransform)),e.get(S).envMap&&(R.envMapIntensity.value=S.envMapIntensity)}function y(R,S,N){R.ior.value=S.ior,S.sheen>0&&(R.sheenColor.value.copy(S.sheenColor).multiplyScalar(S.sheen),R.sheenRoughness.value=S.sheenRoughness,S.sheenColorMap&&(R.sheenColorMap.value=S.sheenColorMap,t(S.sheenColorMap,R.sheenColorMapTransform)),S.sheenRoughnessMap&&(R.sheenRoughnessMap.value=S.sheenRoughnessMap,t(S.sheenRoughnessMap,R.sheenRoughnessMapTransform))),S.clearcoat>0&&(R.clearcoat.value=S.clearcoat,R.clearcoatRoughness.value=S.clearcoatRoughness,S.clearcoatMap&&(R.clearcoatMap.value=S.clearcoatMap,t(S.clearcoatMap,R.clearcoatMapTransform)),S.clearcoatRoughnessMap&&(R.clearcoatRoughnessMap.value=S.clearcoatRoughnessMap,t(S.clearcoatRoughnessMap,R.clearcoatRoughnessMapTransform)),S.clearcoatNormalMap&&(R.clearcoatNormalMap.value=S.clearcoatNormalMap,t(S.clearcoatNormalMap,R.clearcoatNormalMapTransform),R.clearcoatNormalScale.value.copy(S.clearcoatNormalScale),S.side===Do&&R.clearcoatNormalScale.value.negate())),S.iridescence>0&&(R.iridescence.value=S.iridescence,R.iridescenceIOR.value=S.iridescenceIOR,R.iridescenceThicknessMinimum.value=S.iridescenceThicknessRange[0],R.iridescenceThicknessMaximum.value=S.iridescenceThicknessRange[1],S.iridescenceMap&&(R.iridescenceMap.value=S.iridescenceMap,t(S.iridescenceMap,R.iridescenceMapTransform)),S.iridescenceThicknessMap&&(R.iridescenceThicknessMap.value=S.iridescenceThicknessMap,t(S.iridescenceThicknessMap,R.iridescenceThicknessMapTransform))),S.transmission>0&&(R.transmission.value=S.transmission,R.transmissionSamplerMap.value=N.texture,R.transmissionSamplerSize.value.set(N.width,N.height),S.transmissionMap&&(R.transmissionMap.value=S.transmissionMap,t(S.transmissionMap,R.transmissionMapTransform)),R.thickness.value=S.thickness,S.thicknessMap&&(R.thicknessMap.value=S.thicknessMap,t(S.thicknessMap,R.thicknessMapTransform)),R.attenuationDistance.value=S.attenuationDistance,R.attenuationColor.value.copy(S.attenuationColor)),S.anisotropy>0&&(R.anisotropyVector.value.set(S.anisotropy*Math.cos(S.anisotropyRotation),S.anisotropy*Math.sin(S.anisotropyRotation)),S.anisotropyMap&&(R.anisotropyMap.value=S.anisotropyMap,t(S.anisotropyMap,R.anisotropyMapTransform))),R.specularIntensity.value=S.specularIntensity,R.specularColor.value.copy(S.specularColor),S.specularColorMap&&(R.specularColorMap.value=S.specularColorMap,t(S.specularColorMap,R.specularColorMapTransform)),S.specularIntensityMap&&(R.specularIntensityMap.value=S.specularIntensityMap,t(S.specularIntensityMap,R.specularIntensityMapTransform))}function Z(R,S){S.matcap&&(R.matcap.value=S.matcap)}function V(R,S){const N=e.get(S).light;R.referencePosition.value.setFromMatrixPosition(N.matrixWorld),R.nearDistance.value=N.shadow.camera.near,R.farDistance.value=N.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:a}}function KU(r,e,t,n){let a={},o={},c=[];const I=t.isWebGL2?r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS):0;function C(N,w){const X=w.program;n.uniformBlockBinding(N,X)}function d(N,w){let X=a[N.id];X===void 0&&(Z(N),X=f(N),a[N.id]=X,N.addEventListener("dispose",R));const H=w.program;n.updateUBOMapping(N,H);const F=e.render.frame;o[N.id]!==F&&(v(N),o[N.id]=F)}function f(N){const w=b();N.__bindingPointIndex=w;const X=r.createBuffer(),H=N.__size,F=N.usage;return r.bindBuffer(r.UNIFORM_BUFFER,X),r.bufferData(r.UNIFORM_BUFFER,H,F),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,w,X),X}function b(){for(let N=0;N<I;N++)if(c.indexOf(N)===-1)return c.push(N),N;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function v(N){const w=a[N.id],X=N.uniforms,H=N.__cache;r.bindBuffer(r.UNIFORM_BUFFER,w);for(let F=0,_=X.length;F<_;F++){const P=Array.isArray(X[F])?X[F]:[X[F]];for(let K=0,E=P.length;K<E;K++){const ee=P[K];if(y(ee,F,K,H)===!0){const Ie=ee.__offset,be=Array.isArray(ee.value)?ee.value:[ee.value];let se=0;for(let Ce=0;Ce<be.length;Ce++){const he=be[Ce],Be=V(he);typeof he=="number"||typeof he=="boolean"?(ee.__data[0]=he,r.bufferSubData(r.UNIFORM_BUFFER,Ie+se,ee.__data)):he.isMatrix3?(ee.__data[0]=he.elements[0],ee.__data[1]=he.elements[1],ee.__data[2]=he.elements[2],ee.__data[3]=0,ee.__data[4]=he.elements[3],ee.__data[5]=he.elements[4],ee.__data[6]=he.elements[5],ee.__data[7]=0,ee.__data[8]=he.elements[6],ee.__data[9]=he.elements[7],ee.__data[10]=he.elements[8],ee.__data[11]=0):(he.toArray(ee.__data,se),se+=Be.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,Ie,ee.__data)}}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function y(N,w,X,H){const F=N.value,_=w+"_"+X;if(H[_]===void 0)return typeof F=="number"||typeof F=="boolean"?H[_]=F:H[_]=F.clone(),!0;{const P=H[_];if(typeof F=="number"||typeof F=="boolean"){if(P!==F)return H[_]=F,!0}else if(P.equals(F)===!1)return P.copy(F),!0}return!1}function Z(N){const w=N.uniforms;let X=0;const H=16;for(let _=0,P=w.length;_<P;_++){const K=Array.isArray(w[_])?w[_]:[w[_]];for(let E=0,ee=K.length;E<ee;E++){const Ie=K[E],be=Array.isArray(Ie.value)?Ie.value:[Ie.value];for(let se=0,Ce=be.length;se<Ce;se++){const he=be[se],Be=V(he),ve=X%H;ve!==0&&H-ve<Be.boundary&&(X+=H-ve),Ie.__data=new Float32Array(Be.storage/Float32Array.BYTES_PER_ELEMENT),Ie.__offset=X,X+=Be.storage}}}const F=X%H;return F>0&&(X+=H-F),N.__size=X,N.__cache={},this}function V(N){const w={boundary:0,storage:0};return typeof N=="number"||typeof N=="boolean"?(w.boundary=4,w.storage=4):N.isVector2?(w.boundary=8,w.storage=8):N.isVector3||N.isColor?(w.boundary=16,w.storage=12):N.isVector4?(w.boundary=16,w.storage=16):N.isMatrix3?(w.boundary=48,w.storage=48):N.isMatrix4?(w.boundary=64,w.storage=64):N.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",N),w}function R(N){const w=N.target;w.removeEventListener("dispose",R);const X=c.indexOf(w.__bindingPointIndex);c.splice(X,1),r.deleteBuffer(a[w.id]),delete a[w.id],delete o[w.id]}function S(){for(const N in a)r.deleteBuffer(a[N]);c=[],a={},o={}}return{bind:C,update:d,dispose:S}}class d2{constructor(e={}){const{canvas:t=IK(),context:n=null,depth:a=!0,stencil:o=!0,alpha:c=!1,antialias:I=!1,premultipliedAlpha:C=!0,preserveDrawingBuffer:d=!1,powerPreference:f="default",failIfMajorPerformanceCaveat:b=!1}=e;this.isWebGLRenderer=!0;let v;n!==null?v=n.getContextAttributes().alpha:v=c;const y=new Uint32Array(4),Z=new Int32Array(4);let V=null,R=null;const S=[],N=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=As,this._useLegacyLights=!1,this.toneMapping=Fc,this.toneMappingExposure=1;const w=this;let X=!1,H=0,F=0,_=null,P=-1,K=null;const E=new Xi,ee=new Xi;let Ie=null;const be=new an(0);let se=0,Ce=t.width,he=t.height,Be=1,ve=null,we=null;const me=new Xi(0,0,Ce,he),Xe=new Xi(0,0,Ce,he);let Ue=!1;const de=new oG;let Ee=!1,At=!1,Zt=null;const Bt=new Nn,kt=new lt,$t=new $,Xt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ot(){return _===null?Be:1}let oe=n;function ut(D,ge){for(let Ge=0;Ge<D.length;Ge++){const Se=D[Ge],Ze=t.getContext(Se,ge);if(Ze!==null)return Ze}return null}try{const D={alpha:!0,depth:a,stencil:o,antialias:I,premultipliedAlpha:C,preserveDrawingBuffer:d,powerPreference:f,failIfMajorPerformanceCaveat:b};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${vR}`),t.addEventListener("webglcontextlost",Ne,!1),t.addEventListener("webglcontextrestored",ce,!1),t.addEventListener("webglcontextcreationerror",dt,!1),oe===null){const ge=["webgl2","webgl","experimental-webgl"];if(w.isWebGL1Renderer===!0&&ge.shift(),oe=ut(ge,D),oe===null)throw ut(ge)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&oe instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),oe.getShaderPrecisionFormat===void 0&&(oe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(D){throw console.error("THREE.WebGLRenderer: "+D.message),D}let _e,it,Te,Et,Wt,O,k,Ae,Oe,$e,et,Yt,vt,Vt,tn,un,ae,Le,at,Pe,pt,Ct,q,ye;function gt(){_e=new q_(oe),it=new D_(oe,_e,e),_e.init(it),Ct=new ZK(oe,_e,it),Te=new XU(oe,_e,it),Et=new tk(oe),Wt=new vU,O=new YU(oe,_e,Te,Wt,it,Ct,Et),k=new O_(w),Ae=new j_(w),Oe=new g1(oe,it),q=new k_(oe,_e,Oe,it),$e=new $_(oe,Oe,Et,q),et=new sk(oe,$e,Oe,Et),at=new ak(oe,it,O),un=new J_(Wt),Yt=new bU(w,k,Ae,_e,it,q,un),vt=new FU(w,Wt),Vt=new GU,tn=new WU(_e,it),Le=new __(w,k,Ae,Te,et,v,C),ae=new NU(w,et,it),ye=new KU(oe,Et,it,Te),Pe=new U_(oe,_e,Et,it),pt=new ek(oe,_e,Et,it),Et.programs=Yt.programs,w.capabilities=it,w.extensions=_e,w.properties=Wt,w.renderLists=Vt,w.shadowMap=ae,w.state=Te,w.info=Et}gt();const De=new HU(w,oe);this.xr=De,this.getContext=function(){return oe},this.getContextAttributes=function(){return oe.getContextAttributes()},this.forceContextLoss=function(){const D=_e.get("WEBGL_lose_context");D&&D.loseContext()},this.forceContextRestore=function(){const D=_e.get("WEBGL_lose_context");D&&D.restoreContext()},this.getPixelRatio=function(){return Be},this.setPixelRatio=function(D){D!==void 0&&(Be=D,this.setSize(Ce,he,!1))},this.getSize=function(D){return D.set(Ce,he)},this.setSize=function(D,ge,Ge=!0){if(De.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Ce=D,he=ge,t.width=Math.floor(D*Be),t.height=Math.floor(ge*Be),Ge===!0&&(t.style.width=D+"px",t.style.height=ge+"px"),this.setViewport(0,0,D,ge)},this.getDrawingBufferSize=function(D){return D.set(Ce*Be,he*Be).floor()},this.setDrawingBufferSize=function(D,ge,Ge){Ce=D,he=ge,Be=Ge,t.width=Math.floor(D*Ge),t.height=Math.floor(ge*Ge),this.setViewport(0,0,D,ge)},this.getCurrentViewport=function(D){return D.copy(E)},this.getViewport=function(D){return D.copy(me)},this.setViewport=function(D,ge,Ge,Se){D.isVector4?me.set(D.x,D.y,D.z,D.w):me.set(D,ge,Ge,Se),Te.viewport(E.copy(me).multiplyScalar(Be).floor())},this.getScissor=function(D){return D.copy(Xe)},this.setScissor=function(D,ge,Ge,Se){D.isVector4?Xe.set(D.x,D.y,D.z,D.w):Xe.set(D,ge,Ge,Se),Te.scissor(ee.copy(Xe).multiplyScalar(Be).floor())},this.getScissorTest=function(){return Ue},this.setScissorTest=function(D){Te.setScissorTest(Ue=D)},this.setOpaqueSort=function(D){ve=D},this.setTransparentSort=function(D){we=D},this.getClearColor=function(D){return D.copy(Le.getClearColor())},this.setClearColor=function(){Le.setClearColor.apply(Le,arguments)},this.getClearAlpha=function(){return Le.getClearAlpha()},this.setClearAlpha=function(){Le.setClearAlpha.apply(Le,arguments)},this.clear=function(D=!0,ge=!0,Ge=!0){let Se=0;if(D){let Ze=!1;if(_!==null){const bt=_.texture.format;Ze=bt===$N||bt===qN||bt===jN}if(Ze){const bt=_.texture.type,Ft=bt===Kc||bt===II||bt===BR||bt===Qd||bt===PN||bt===QN,nn=Le.getClearColor(),jt=Le.getClearAlpha(),Mt=nn.r,vn=nn.g,Zn=nn.b;Ft?(y[0]=Mt,y[1]=vn,y[2]=Zn,y[3]=jt,oe.clearBufferuiv(oe.COLOR,0,y)):(Z[0]=Mt,Z[1]=vn,Z[2]=Zn,Z[3]=jt,oe.clearBufferiv(oe.COLOR,0,Z))}else Se|=oe.COLOR_BUFFER_BIT}ge&&(Se|=oe.DEPTH_BUFFER_BIT),Ge&&(Se|=oe.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),oe.clear(Se)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ne,!1),t.removeEventListener("webglcontextrestored",ce,!1),t.removeEventListener("webglcontextcreationerror",dt,!1),Vt.dispose(),tn.dispose(),Wt.dispose(),k.dispose(),Ae.dispose(),et.dispose(),q.dispose(),ye.dispose(),Yt.dispose(),De.dispose(),De.removeEventListener("sessionstart",Dn),De.removeEventListener("sessionend",In),Zt&&(Zt.dispose(),Zt=null),fi.stop()};function Ne(D){D.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),X=!0}function ce(){console.log("THREE.WebGLRenderer: Context Restored."),X=!1;const D=Et.autoReset,ge=ae.enabled,Ge=ae.autoUpdate,Se=ae.needsUpdate,Ze=ae.type;gt(),Et.autoReset=D,ae.enabled=ge,ae.autoUpdate=Ge,ae.needsUpdate=Se,ae.type=Ze}function dt(D){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",D.statusMessage)}function wt(D){const ge=D.target;ge.removeEventListener("dispose",wt),rn(ge)}function rn(D){mt(D),Wt.remove(D)}function mt(D){const ge=Wt.get(D).programs;ge!==void 0&&(ge.forEach(function(Ge){Yt.releaseProgram(Ge)}),D.isShaderMaterial&&Yt.releaseShaderCache(D))}this.renderBufferDirect=function(D,ge,Ge,Se,Ze,bt){ge===null&&(ge=Xt);const Ft=Ze.isMesh&&Ze.matrixWorld.determinant()<0,nn=ft(D,ge,Ge,Se,Ze);Te.setMaterial(Se,Ft);let jt=Ge.index,Mt=1;if(Se.wireframe===!0){if(jt=$e.getWireframeAttribute(Ge),jt===void 0)return;Mt=2}const vn=Ge.drawRange,Zn=Ge.attributes.position;let Si=vn.start*Mt,na=(vn.start+vn.count)*Mt;bt!==null&&(Si=Math.max(Si,bt.start*Mt),na=Math.min(na,(bt.start+bt.count)*Mt)),jt!==null?(Si=Math.max(Si,0),na=Math.min(na,jt.count)):Zn!=null&&(Si=Math.max(Si,0),na=Math.min(na,Zn.count));const Ji=na-Si;if(Ji<0||Ji===1/0)return;q.setup(Ze,Se,nn,Ge,jt);let ms,yi=Pe;if(jt!==null&&(ms=Oe.get(jt),yi=pt,yi.setIndex(ms)),Ze.isMesh)Se.wireframe===!0?(Te.setLineWidth(Se.wireframeLinewidth*Ot()),yi.setMode(oe.LINES)):yi.setMode(oe.TRIANGLES);else if(Ze.isLine){let dn=Se.linewidth;dn===void 0&&(dn=1),Te.setLineWidth(dn*Ot()),Ze.isLineSegments?yi.setMode(oe.LINES):Ze.isLineLoop?yi.setMode(oe.LINE_LOOP):yi.setMode(oe.LINE_STRIP)}else Ze.isPoints?yi.setMode(oe.POINTS):Ze.isSprite&&yi.setMode(oe.TRIANGLES);if(Ze.isBatchedMesh)yi.renderMultiDraw(Ze._multiDrawStarts,Ze._multiDrawCounts,Ze._multiDrawCount);else if(Ze.isInstancedMesh)yi.renderInstances(Si,Ji,Ze.count);else if(Ge.isInstancedBufferGeometry){const dn=Ge._maxInstanceCount!==void 0?Ge._maxInstanceCount:1/0,wr=Math.min(Ge.instanceCount,dn);yi.renderInstances(Si,Ji,wr)}else yi.render(Si,Ji)};function mn(D,ge,Ge){D.transparent===!0&&D.side===il&&D.forceSinglePass===!1?(D.side=Do,D.needsUpdate=!0,Q(D,ge,Ge),D.side=fI,D.needsUpdate=!0,Q(D,ge,Ge),D.side=il):Q(D,ge,Ge)}this.compile=function(D,ge,Ge=null){Ge===null&&(Ge=D),R=tn.get(Ge),R.init(),N.push(R),Ge.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(ge.layers)&&(R.pushLight(Ze),Ze.castShadow&&R.pushShadow(Ze))}),D!==Ge&&D.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(ge.layers)&&(R.pushLight(Ze),Ze.castShadow&&R.pushShadow(Ze))}),R.setupLights(w._useLegacyLights);const Se=new Set;return D.traverse(function(Ze){const bt=Ze.material;if(bt)if(Array.isArray(bt))for(let Ft=0;Ft<bt.length;Ft++){const nn=bt[Ft];mn(nn,Ge,Ze),Se.add(nn)}else mn(bt,Ge,Ze),Se.add(bt)}),N.pop(),R=null,Se},this.compileAsync=function(D,ge,Ge=null){const Se=this.compile(D,ge,Ge);return new Promise(Ze=>{function bt(){if(Se.forEach(function(Ft){Wt.get(Ft).currentProgram.isReady()&&Se.delete(Ft)}),Se.size===0){Ze(D);return}setTimeout(bt,10)}_e.get("KHR_parallel_shader_compile")!==null?bt():setTimeout(bt,10)})};let Wn=null;function zn(D){Wn&&Wn(D)}function Dn(){fi.stop()}function In(){fi.start()}const fi=new mK;fi.setAnimationLoop(zn),typeof self<"u"&&fi.setContext(self),this.setAnimationLoop=function(D){Wn=D,De.setAnimationLoop(D),D===null?fi.stop():fi.start()},De.addEventListener("sessionstart",Dn),De.addEventListener("sessionend",In),this.render=function(D,ge){if(ge!==void 0&&ge.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(X===!0)return;D.matrixWorldAutoUpdate===!0&&D.updateMatrixWorld(),ge.parent===null&&ge.matrixWorldAutoUpdate===!0&&ge.updateMatrixWorld(),De.enabled===!0&&De.isPresenting===!0&&(De.cameraAutoUpdate===!0&&De.updateCamera(ge),ge=De.getCamera()),D.isScene===!0&&D.onBeforeRender(w,D,ge,_),R=tn.get(D,N.length),R.init(),N.push(R),Bt.multiplyMatrices(ge.projectionMatrix,ge.matrixWorldInverse),de.setFromProjectionMatrix(Bt),At=this.localClippingEnabled,Ee=un.init(this.clippingPlanes,At),V=Vt.get(D,S.length),V.init(),S.push(V),ci(D,ge,0,w.sortObjects),V.finish(),w.sortObjects===!0&&V.sort(ve,we),this.info.render.frame++,Ee===!0&&un.beginShadows();const Ge=R.state.shadowsArray;if(ae.render(Ge,D,ge),Ee===!0&&un.endShadows(),this.info.autoReset===!0&&this.info.reset(),Le.render(V,D),R.setupLights(w._useLegacyLights),ge.isArrayCamera){const Se=ge.cameras;for(let Ze=0,bt=Se.length;Ze<bt;Ze++){const Ft=Se[Ze];is(V,D,Ft,Ft.viewport)}}else is(V,D,ge);_!==null&&(O.updateMultisampleRenderTarget(_),O.updateRenderTargetMipmap(_)),D.isScene===!0&&D.onAfterRender(w,D,ge),q.resetDefaultState(),P=-1,K=null,N.pop(),N.length>0?R=N[N.length-1]:R=null,S.pop(),S.length>0?V=S[S.length-1]:V=null};function ci(D,ge,Ge,Se){if(D.visible===!1)return;if(D.layers.test(ge.layers)){if(D.isGroup)Ge=D.renderOrder;else if(D.isLOD)D.autoUpdate===!0&&D.update(ge);else if(D.isLight)R.pushLight(D),D.castShadow&&R.pushShadow(D);else if(D.isSprite){if(!D.frustumCulled||de.intersectsSprite(D)){Se&&$t.setFromMatrixPosition(D.matrixWorld).applyMatrix4(Bt);const Ft=et.update(D),nn=D.material;nn.visible&&V.push(D,Ft,nn,Ge,$t.z,null)}}else if((D.isMesh||D.isLine||D.isPoints)&&(!D.frustumCulled||de.intersectsObject(D))){const Ft=et.update(D),nn=D.material;if(Se&&(D.boundingSphere!==void 0?(D.boundingSphere===null&&D.computeBoundingSphere(),$t.copy(D.boundingSphere.center)):(Ft.boundingSphere===null&&Ft.computeBoundingSphere(),$t.copy(Ft.boundingSphere.center)),$t.applyMatrix4(D.matrixWorld).applyMatrix4(Bt)),Array.isArray(nn)){const jt=Ft.groups;for(let Mt=0,vn=jt.length;Mt<vn;Mt++){const Zn=jt[Mt],Si=nn[Zn.materialIndex];Si&&Si.visible&&V.push(D,Ft,Si,Ge,$t.z,Zn)}}else nn.visible&&V.push(D,Ft,nn,Ge,$t.z,null)}}const bt=D.children;for(let Ft=0,nn=bt.length;Ft<nn;Ft++)ci(bt[Ft],ge,Ge,Se)}function is(D,ge,Ge,Se){const Ze=D.opaque,bt=D.transmissive,Ft=D.transparent;R.setupLightsView(Ge),Ee===!0&&un.setGlobalState(w.clippingPlanes,Ge),bt.length>0&&Rr(Ze,bt,ge,Ge),Se&&Te.viewport(E.copy(Se)),Ze.length>0&&re(Ze,ge,Ge),bt.length>0&&re(bt,ge,Ge),Ft.length>0&&re(Ft,ge,Ge),Te.buffers.depth.setTest(!0),Te.buffers.depth.setMask(!0),Te.buffers.color.setMask(!0),Te.setPolygonOffset(!1)}function Rr(D,ge,Ge,Se){if((Ge.isScene===!0?Ge.overrideMaterial:null)!==null)return;const bt=it.isWebGL2;Zt===null&&(Zt=new Eg(1,1,{generateMipmaps:!0,type:_e.has("EXT_color_buffer_half_float")?nb:Kc,minFilter:nC,samples:bt?4:0})),w.getDrawingBufferSize(kt),bt?Zt.setSize(kt.x,kt.y):Zt.setSize(pR(kt.x),pR(kt.y));const Ft=w.getRenderTarget();w.setRenderTarget(Zt),w.getClearColor(be),se=w.getClearAlpha(),se<1&&w.setClearColor(16777215,.5),w.clear();const nn=w.toneMapping;w.toneMapping=Fc,re(D,Ge,Se),O.updateMultisampleRenderTarget(Zt),O.updateRenderTargetMipmap(Zt);let jt=!1;for(let Mt=0,vn=ge.length;Mt<vn;Mt++){const Zn=ge[Mt],Si=Zn.object,na=Zn.geometry,Ji=Zn.material,ms=Zn.group;if(Ji.side===il&&Si.layers.test(Se.layers)){const yi=Ji.side;Ji.side=Do,Ji.needsUpdate=!0,ot(Si,Ge,Se,na,Ji,ms),Ji.side=yi,Ji.needsUpdate=!0,jt=!0}}jt===!0&&(O.updateMultisampleRenderTarget(Zt),O.updateRenderTargetMipmap(Zt)),w.setRenderTarget(Ft),w.setClearColor(be,se),w.toneMapping=nn}function re(D,ge,Ge){const Se=ge.isScene===!0?ge.overrideMaterial:null;for(let Ze=0,bt=D.length;Ze<bt;Ze++){const Ft=D[Ze],nn=Ft.object,jt=Ft.geometry,Mt=Se===null?Ft.material:Se,vn=Ft.group;nn.layers.test(Ge.layers)&&ot(nn,ge,Ge,jt,Mt,vn)}}function ot(D,ge,Ge,Se,Ze,bt){D.onBeforeRender(w,ge,Ge,Se,Ze,bt),D.modelViewMatrix.multiplyMatrices(Ge.matrixWorldInverse,D.matrixWorld),D.normalMatrix.getNormalMatrix(D.modelViewMatrix),Ze.onBeforeRender(w,ge,Ge,Se,D,bt),Ze.transparent===!0&&Ze.side===il&&Ze.forceSinglePass===!1?(Ze.side=Do,Ze.needsUpdate=!0,w.renderBufferDirect(Ge,ge,Se,Ze,D,bt),Ze.side=fI,Ze.needsUpdate=!0,w.renderBufferDirect(Ge,ge,Se,Ze,D,bt),Ze.side=il):w.renderBufferDirect(Ge,ge,Se,Ze,D,bt),D.onAfterRender(w,ge,Ge,Se,Ze,bt)}function Q(D,ge,Ge){ge.isScene!==!0&&(ge=Xt);const Se=Wt.get(D),Ze=R.state.lights,bt=R.state.shadowsArray,Ft=Ze.state.version,nn=Yt.getParameters(D,Ze.state,bt,ge,Ge),jt=Yt.getProgramCacheKey(nn);let Mt=Se.programs;Se.environment=D.isMeshStandardMaterial?ge.environment:null,Se.fog=ge.fog,Se.envMap=(D.isMeshStandardMaterial?Ae:k).get(D.envMap||Se.environment),Mt===void 0&&(D.addEventListener("dispose",wt),Mt=new Map,Se.programs=Mt);let vn=Mt.get(jt);if(vn!==void 0){if(Se.currentProgram===vn&&Se.lightsStateVersion===Ft)return ct(D,nn),vn}else nn.uniforms=Yt.getUniforms(D),D.onBuild(Ge,nn,w),D.onBeforeCompile(nn,w),vn=Yt.acquireProgram(nn,jt),Mt.set(jt,vn),Se.uniforms=nn.uniforms;const Zn=Se.uniforms;return(!D.isShaderMaterial&&!D.isRawShaderMaterial||D.clipping===!0)&&(Zn.clippingPlanes=un.uniform),ct(D,nn),Se.needsLights=xt(D),Se.lightsStateVersion=Ft,Se.needsLights&&(Zn.ambientLightColor.value=Ze.state.ambient,Zn.lightProbe.value=Ze.state.probe,Zn.directionalLights.value=Ze.state.directional,Zn.directionalLightShadows.value=Ze.state.directionalShadow,Zn.spotLights.value=Ze.state.spot,Zn.spotLightShadows.value=Ze.state.spotShadow,Zn.rectAreaLights.value=Ze.state.rectArea,Zn.ltc_1.value=Ze.state.rectAreaLTC1,Zn.ltc_2.value=Ze.state.rectAreaLTC2,Zn.pointLights.value=Ze.state.point,Zn.pointLightShadows.value=Ze.state.pointShadow,Zn.hemisphereLights.value=Ze.state.hemi,Zn.directionalShadowMap.value=Ze.state.directionalShadowMap,Zn.directionalShadowMatrix.value=Ze.state.directionalShadowMatrix,Zn.spotShadowMap.value=Ze.state.spotShadowMap,Zn.spotLightMatrix.value=Ze.state.spotLightMatrix,Zn.spotLightMap.value=Ze.state.spotLightMap,Zn.pointShadowMap.value=Ze.state.pointShadowMap,Zn.pointShadowMatrix.value=Ze.state.pointShadowMatrix),Se.currentProgram=vn,Se.uniformsList=null,vn}function Ye(D){if(D.uniformsList===null){const ge=D.currentProgram.getUniforms();D.uniformsList=aR.seqWithValue(ge.seq,D.uniforms)}return D.uniformsList}function ct(D,ge){const Ge=Wt.get(D);Ge.outputColorSpace=ge.outputColorSpace,Ge.batching=ge.batching,Ge.instancing=ge.instancing,Ge.instancingColor=ge.instancingColor,Ge.skinning=ge.skinning,Ge.morphTargets=ge.morphTargets,Ge.morphNormals=ge.morphNormals,Ge.morphColors=ge.morphColors,Ge.morphTargetsCount=ge.morphTargetsCount,Ge.numClippingPlanes=ge.numClippingPlanes,Ge.numIntersection=ge.numClipIntersection,Ge.vertexAlphas=ge.vertexAlphas,Ge.vertexTangents=ge.vertexTangents,Ge.toneMapping=ge.toneMapping}function ft(D,ge,Ge,Se,Ze){ge.isScene!==!0&&(ge=Xt),O.resetTextureUnits();const bt=ge.fog,Ft=Se.isMeshStandardMaterial?ge.environment:null,nn=_===null?w.outputColorSpace:_.isXRRenderTarget===!0?_.texture.colorSpace:Tc,jt=(Se.isMeshStandardMaterial?Ae:k).get(Se.envMap||Ft),Mt=Se.vertexColors===!0&&!!Ge.attributes.color&&Ge.attributes.color.itemSize===4,vn=!!Ge.attributes.tangent&&(!!Se.normalMap||Se.anisotropy>0),Zn=!!Ge.morphAttributes.position,Si=!!Ge.morphAttributes.normal,na=!!Ge.morphAttributes.color;let Ji=Fc;Se.toneMapped&&(_===null||_.isXRRenderTarget===!0)&&(Ji=w.toneMapping);const ms=Ge.morphAttributes.position||Ge.morphAttributes.normal||Ge.morphAttributes.color,yi=ms!==void 0?ms.length:0,dn=Wt.get(Se),wr=R.state.lights;if(Ee===!0&&(At===!0||D!==K)){const ga=D===K&&Se.id===P;un.setState(Se,D,ga)}let xi=!1;Se.version===dn.__version?(dn.needsLights&&dn.lightsStateVersion!==wr.state.version||dn.outputColorSpace!==nn||Ze.isBatchedMesh&&dn.batching===!1||!Ze.isBatchedMesh&&dn.batching===!0||Ze.isInstancedMesh&&dn.instancing===!1||!Ze.isInstancedMesh&&dn.instancing===!0||Ze.isSkinnedMesh&&dn.skinning===!1||!Ze.isSkinnedMesh&&dn.skinning===!0||Ze.isInstancedMesh&&dn.instancingColor===!0&&Ze.instanceColor===null||Ze.isInstancedMesh&&dn.instancingColor===!1&&Ze.instanceColor!==null||dn.envMap!==jt||Se.fog===!0&&dn.fog!==bt||dn.numClippingPlanes!==void 0&&(dn.numClippingPlanes!==un.numPlanes||dn.numIntersection!==un.numIntersection)||dn.vertexAlphas!==Mt||dn.vertexTangents!==vn||dn.morphTargets!==Zn||dn.morphNormals!==Si||dn.morphColors!==na||dn.toneMapping!==Ji||it.isWebGL2===!0&&dn.morphTargetsCount!==yi)&&(xi=!0):(xi=!0,dn.__version=Se.version);let Po=dn.currentProgram;xi===!0&&(Po=Q(Se,ge,Ze));let kl=!1,Wr=!1,to=!1;const Mi=Po.getUniforms(),as=dn.uniforms;if(Te.useProgram(Po.program)&&(kl=!0,Wr=!0,to=!0),Se.id!==P&&(P=Se.id,Wr=!0),kl||K!==D){Mi.setValue(oe,"projectionMatrix",D.projectionMatrix),Mi.setValue(oe,"viewMatrix",D.matrixWorldInverse);const ga=Mi.map.cameraPosition;ga!==void 0&&ga.setValue(oe,$t.setFromMatrixPosition(D.matrixWorld)),it.logarithmicDepthBuffer&&Mi.setValue(oe,"logDepthBufFC",2/(Math.log(D.far+1)/Math.LN2)),(Se.isMeshPhongMaterial||Se.isMeshToonMaterial||Se.isMeshLambertMaterial||Se.isMeshBasicMaterial||Se.isMeshStandardMaterial||Se.isShaderMaterial)&&Mi.setValue(oe,"isOrthographic",D.isOrthographicCamera===!0),K!==D&&(K=D,Wr=!0,to=!0)}if(Ze.isSkinnedMesh){Mi.setOptional(oe,Ze,"bindMatrix"),Mi.setOptional(oe,Ze,"bindMatrixInverse");const ga=Ze.skeleton;ga&&(it.floatVertexTextures?(ga.boneTexture===null&&ga.computeBoneTexture(),Mi.setValue(oe,"boneTexture",ga.boneTexture,O)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}Ze.isBatchedMesh&&(Mi.setOptional(oe,Ze,"batchingTexture"),Mi.setValue(oe,"batchingTexture",Ze._matricesTexture,O));const xr=Ge.morphAttributes;if((xr.position!==void 0||xr.normal!==void 0||xr.color!==void 0&&it.isWebGL2===!0)&&at.update(Ze,Ge,Po),(Wr||dn.receiveShadow!==Ze.receiveShadow)&&(dn.receiveShadow=Ze.receiveShadow,Mi.setValue(oe,"receiveShadow",Ze.receiveShadow)),Se.isMeshGouraudMaterial&&Se.envMap!==null&&(as.envMap.value=jt,as.flipEnvMap.value=jt.isCubeTexture&&jt.isRenderTargetTexture===!1?-1:1),Wr&&(Mi.setValue(oe,"toneMappingExposure",w.toneMappingExposure),dn.needsLights&&_t(as,to),bt&&Se.fog===!0&&vt.refreshFogUniforms(as,bt),vt.refreshMaterialUniforms(as,Se,Be,he,Zt),aR.upload(oe,Ye(dn),as,O)),Se.isShaderMaterial&&Se.uniformsNeedUpdate===!0&&(aR.upload(oe,Ye(dn),as,O),Se.uniformsNeedUpdate=!1),Se.isSpriteMaterial&&Mi.setValue(oe,"center",Ze.center),Mi.setValue(oe,"modelViewMatrix",Ze.modelViewMatrix),Mi.setValue(oe,"normalMatrix",Ze.normalMatrix),Mi.setValue(oe,"modelMatrix",Ze.matrixWorld),Se.isShaderMaterial||Se.isRawShaderMaterial){const ga=Se.uniformsGroups;for(let Vr=0,Lg=ga.length;Vr<Lg;Vr++)if(it.isWebGL2){const kc=ga[Vr];ye.update(kc,Po),ye.bind(kc,Po)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Po}function _t(D,ge){D.ambientLightColor.needsUpdate=ge,D.lightProbe.needsUpdate=ge,D.directionalLights.needsUpdate=ge,D.directionalLightShadows.needsUpdate=ge,D.pointLights.needsUpdate=ge,D.pointLightShadows.needsUpdate=ge,D.spotLights.needsUpdate=ge,D.spotLightShadows.needsUpdate=ge,D.rectAreaLights.needsUpdate=ge,D.hemisphereLights.needsUpdate=ge}function xt(D){return D.isMeshLambertMaterial||D.isMeshToonMaterial||D.isMeshPhongMaterial||D.isMeshStandardMaterial||D.isShadowMaterial||D.isShaderMaterial&&D.lights===!0}this.getActiveCubeFace=function(){return H},this.getActiveMipmapLevel=function(){return F},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(D,ge,Ge){Wt.get(D.texture).__webglTexture=ge,Wt.get(D.depthTexture).__webglTexture=Ge;const Se=Wt.get(D);Se.__hasExternalTextures=!0,Se.__hasExternalTextures&&(Se.__autoAllocateDepthBuffer=Ge===void 0,Se.__autoAllocateDepthBuffer||_e.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Se.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(D,ge){const Ge=Wt.get(D);Ge.__webglFramebuffer=ge,Ge.__useDefaultFramebuffer=ge===void 0},this.setRenderTarget=function(D,ge=0,Ge=0){_=D,H=ge,F=Ge;let Se=!0,Ze=null,bt=!1,Ft=!1;if(D){const jt=Wt.get(D);jt.__useDefaultFramebuffer!==void 0?(Te.bindFramebuffer(oe.FRAMEBUFFER,null),Se=!1):jt.__webglFramebuffer===void 0?O.setupRenderTarget(D):jt.__hasExternalTextures&&O.rebindTextures(D,Wt.get(D.texture).__webglTexture,Wt.get(D.depthTexture).__webglTexture);const Mt=D.texture;(Mt.isData3DTexture||Mt.isDataArrayTexture||Mt.isCompressedArrayTexture)&&(Ft=!0);const vn=Wt.get(D).__webglFramebuffer;D.isWebGLCubeRenderTarget?(Array.isArray(vn[ge])?Ze=vn[ge][Ge]:Ze=vn[ge],bt=!0):it.isWebGL2&&D.samples>0&&O.useMultisampledRTT(D)===!1?Ze=Wt.get(D).__webglMultisampledFramebuffer:Array.isArray(vn)?Ze=vn[Ge]:Ze=vn,E.copy(D.viewport),ee.copy(D.scissor),Ie=D.scissorTest}else E.copy(me).multiplyScalar(Be).floor(),ee.copy(Xe).multiplyScalar(Be).floor(),Ie=Ue;if(Te.bindFramebuffer(oe.FRAMEBUFFER,Ze)&&it.drawBuffers&&Se&&Te.drawBuffers(D,Ze),Te.viewport(E),Te.scissor(ee),Te.setScissorTest(Ie),bt){const jt=Wt.get(D.texture);oe.framebufferTexture2D(oe.FRAMEBUFFER,oe.COLOR_ATTACHMENT0,oe.TEXTURE_CUBE_MAP_POSITIVE_X+ge,jt.__webglTexture,Ge)}else if(Ft){const jt=Wt.get(D.texture),Mt=ge||0;oe.framebufferTextureLayer(oe.FRAMEBUFFER,oe.COLOR_ATTACHMENT0,jt.__webglTexture,Ge||0,Mt)}P=-1},this.readRenderTargetPixels=function(D,ge,Ge,Se,Ze,bt,Ft){if(!(D&&D.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let nn=Wt.get(D).__webglFramebuffer;if(D.isWebGLCubeRenderTarget&&Ft!==void 0&&(nn=nn[Ft]),nn){Te.bindFramebuffer(oe.FRAMEBUFFER,nn);try{const jt=D.texture,Mt=jt.format,vn=jt.type;if(Mt!==Uo&&Ct.convert(Mt)!==oe.getParameter(oe.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Zn=vn===nb&&(_e.has("EXT_color_buffer_half_float")||it.isWebGL2&&_e.has("EXT_color_buffer_float"));if(vn!==Kc&&Ct.convert(vn)!==oe.getParameter(oe.IMPLEMENTATION_COLOR_READ_TYPE)&&!(vn===Fg&&(it.isWebGL2||_e.has("OES_texture_float")||_e.has("WEBGL_color_buffer_float")))&&!Zn){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ge>=0&&ge<=D.width-Se&&Ge>=0&&Ge<=D.height-Ze&&oe.readPixels(ge,Ge,Se,Ze,Ct.convert(Mt),Ct.convert(vn),bt)}finally{const jt=_!==null?Wt.get(_).__webglFramebuffer:null;Te.bindFramebuffer(oe.FRAMEBUFFER,jt)}}},this.copyFramebufferToTexture=function(D,ge,Ge=0){const Se=Math.pow(2,-Ge),Ze=Math.floor(ge.image.width*Se),bt=Math.floor(ge.image.height*Se);O.setTexture2D(ge,0),oe.copyTexSubImage2D(oe.TEXTURE_2D,Ge,0,0,D.x,D.y,Ze,bt),Te.unbindTexture()},this.copyTextureToTexture=function(D,ge,Ge,Se=0){const Ze=ge.image.width,bt=ge.image.height,Ft=Ct.convert(Ge.format),nn=Ct.convert(Ge.type);O.setTexture2D(Ge,0),oe.pixelStorei(oe.UNPACK_FLIP_Y_WEBGL,Ge.flipY),oe.pixelStorei(oe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ge.premultiplyAlpha),oe.pixelStorei(oe.UNPACK_ALIGNMENT,Ge.unpackAlignment),ge.isDataTexture?oe.texSubImage2D(oe.TEXTURE_2D,Se,D.x,D.y,Ze,bt,Ft,nn,ge.image.data):ge.isCompressedTexture?oe.compressedTexSubImage2D(oe.TEXTURE_2D,Se,D.x,D.y,ge.mipmaps[0].width,ge.mipmaps[0].height,Ft,ge.mipmaps[0].data):oe.texSubImage2D(oe.TEXTURE_2D,Se,D.x,D.y,Ft,nn,ge.image),Se===0&&Ge.generateMipmaps&&oe.generateMipmap(oe.TEXTURE_2D),Te.unbindTexture()},this.copyTextureToTexture3D=function(D,ge,Ge,Se,Ze=0){if(w.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const bt=D.max.x-D.min.x+1,Ft=D.max.y-D.min.y+1,nn=D.max.z-D.min.z+1,jt=Ct.convert(Se.format),Mt=Ct.convert(Se.type);let vn;if(Se.isData3DTexture)O.setTexture3D(Se,0),vn=oe.TEXTURE_3D;else if(Se.isDataArrayTexture||Se.isCompressedArrayTexture)O.setTexture2DArray(Se,0),vn=oe.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}oe.pixelStorei(oe.UNPACK_FLIP_Y_WEBGL,Se.flipY),oe.pixelStorei(oe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Se.premultiplyAlpha),oe.pixelStorei(oe.UNPACK_ALIGNMENT,Se.unpackAlignment);const Zn=oe.getParameter(oe.UNPACK_ROW_LENGTH),Si=oe.getParameter(oe.UNPACK_IMAGE_HEIGHT),na=oe.getParameter(oe.UNPACK_SKIP_PIXELS),Ji=oe.getParameter(oe.UNPACK_SKIP_ROWS),ms=oe.getParameter(oe.UNPACK_SKIP_IMAGES),yi=Ge.isCompressedTexture?Ge.mipmaps[Ze]:Ge.image;oe.pixelStorei(oe.UNPACK_ROW_LENGTH,yi.width),oe.pixelStorei(oe.UNPACK_IMAGE_HEIGHT,yi.height),oe.pixelStorei(oe.UNPACK_SKIP_PIXELS,D.min.x),oe.pixelStorei(oe.UNPACK_SKIP_ROWS,D.min.y),oe.pixelStorei(oe.UNPACK_SKIP_IMAGES,D.min.z),Ge.isDataTexture||Ge.isData3DTexture?oe.texSubImage3D(vn,Ze,ge.x,ge.y,ge.z,bt,Ft,nn,jt,Mt,yi.data):Ge.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),oe.compressedTexSubImage3D(vn,Ze,ge.x,ge.y,ge.z,bt,Ft,nn,jt,yi.data)):oe.texSubImage3D(vn,Ze,ge.x,ge.y,ge.z,bt,Ft,nn,jt,Mt,yi),oe.pixelStorei(oe.UNPACK_ROW_LENGTH,Zn),oe.pixelStorei(oe.UNPACK_IMAGE_HEIGHT,Si),oe.pixelStorei(oe.UNPACK_SKIP_PIXELS,na),oe.pixelStorei(oe.UNPACK_SKIP_ROWS,Ji),oe.pixelStorei(oe.UNPACK_SKIP_IMAGES,ms),Ze===0&&Se.generateMipmaps&&oe.generateMipmap(vn),Te.unbindTexture()},this.initTexture=function(D){D.isCubeTexture?O.setTextureCube(D,0):D.isData3DTexture?O.setTexture3D(D,0):D.isDataArrayTexture||D.isCompressedArrayTexture?O.setTexture2DArray(D,0):O.setTexture2D(D,0),Te.unbindTexture()},this.resetState=function(){H=0,F=0,_=null,Te.reset(),q.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Kg}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===SR?"display-p3":"srgb",t.unpackColorSpace=Ni.workingColorSpace===iG?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===As?qd:n2}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===qd?As:Tc}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class RK extends d2{}RK.prototype.isWebGL1Renderer=!0;class WR{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new an(e),this.density=t}clone(){return new WR(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class xR{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new an(e),this.near=t,this.far=n}clone(){return new xR(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}let C2=class extends Ai{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}};class VR{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=D0,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=sl()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return console.warn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let a=0,o=this.stride;a<o;a++)this.array[e+a]=t.array[n+a];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=sl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=sl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const zo=new $;class VA{constructor(e,t,n,a=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=a}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)zo.fromBufferAttribute(this,t),zo.applyMatrix4(e),this.setXYZ(t,zo.x,zo.y,zo.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)zo.fromBufferAttribute(this,t),zo.applyNormalMatrix(e),this.setXYZ(t,zo.x,zo.y,zo.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)zo.fromBufferAttribute(this,t),zo.transformDirection(e),this.setXYZ(t,zo.x,zo.y,zo.z);return this}setX(e,t){return this.normalized&&(t=Un(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Un(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Un(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Un(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Zr(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Zr(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Zr(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Zr(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),a=Un(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=a,this}setXYZW(e,t,n,a,o){return e=e*this.data.stride+this.offset,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),a=Un(a,this.array),o=Un(o,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=a,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const a=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[a+o])}return new Yi(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new VA(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const a=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[a+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class h2 extends Zo{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new an(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Hm;const d0=new $,Fm=new $,Km=new $,Em=new lt,C0=new lt,wK=new Nn,pS=new $,h0=new $,mS=new $,BM=new lt,uV=new lt,ZM=new lt;class WK extends Ai{constructor(e=new h2){if(super(),this.isSprite=!0,this.type="Sprite",Hm===void 0){Hm=new Qn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new VR(t,5);Hm.setIndex([0,1,2,0,2,3]),Hm.setAttribute("position",new VA(n,3,0,!1)),Hm.setAttribute("uv",new VA(n,2,3,!1))}this.geometry=Hm,this.material=e,this.center=new lt(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Fm.setFromMatrixScale(this.matrixWorld),wK.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Km.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Fm.multiplyScalar(-Km.z);const n=this.material.rotation;let a,o;n!==0&&(o=Math.cos(n),a=Math.sin(n));const c=this.center;bS(pS.set(-.5,-.5,0),Km,c,Fm,a,o),bS(h0.set(.5,-.5,0),Km,c,Fm,a,o),bS(mS.set(.5,.5,0),Km,c,Fm,a,o),BM.set(0,0),uV.set(1,0),ZM.set(1,1);let I=e.ray.intersectTriangle(pS,h0,mS,!1,d0);if(I===null&&(bS(h0.set(-.5,.5,0),Km,c,Fm,a,o),uV.set(0,1),I=e.ray.intersectTriangle(pS,mS,h0,!1,d0),I===null))return;const C=e.ray.origin.distanceTo(d0);C<e.near||C>e.far||t.push({distance:C,point:d0.clone(),uv:Br.getInterpolation(d0,pS,h0,mS,BM,uV,ZM,new lt),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function bS(r,e,t,n,a,o){Em.subVectors(r,t).addScalar(.5).multiply(n),a!==void 0?(C0.x=o*Em.x-a*Em.y,C0.y=a*Em.x+o*Em.y):C0.copy(Em),r.copy(e),r.x+=C0.x,r.y+=C0.y,r.applyMatrix4(wK)}const vS=new $,SM=new $;class xK extends Ai{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,a=t.length;n<a;n++){const o=t[n];this.addLevel(o.object.clone(),o.distance,o.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const a=this.levels;let o;for(o=0;o<a.length&&!(t<a[o].distance);o++);return a.splice(o,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,a;for(n=1,a=t.length;n<a;n++){let o=t[n].distance;if(t[n].object.visible&&(o-=o*t[n].hysteresis),e<o)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){vS.setFromMatrixPosition(this.matrixWorld);const a=e.ray.origin.distanceTo(vS);this.getObjectForDistance(a).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){vS.setFromMatrixPosition(e.matrixWorld),SM.setFromMatrixPosition(this.matrixWorld);const n=vS.distanceTo(SM)/e.zoom;t[0].object.visible=!0;let a,o;for(a=1,o=t.length;a<o;a++){let c=t[a].distance;if(t[a].object.visible&&(c-=c*t[a].hysteresis),n>=c)t[a-1].object.visible=!1,t[a].object.visible=!0;else break}for(this._currentLevel=a-1;a<o;a++)t[a].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let a=0,o=n.length;a<o;a++){const c=n[a];t.object.levels.push({object:c.object.uuid,distance:c.distance,hysteresis:c.hysteresis})}return t}}const RM=new $,wM=new Xi,WM=new Xi,EU=new $,xM=new Nn,yS=new $,IV=new Bo,VM=new Nn,dV=new XA;class VK extends ts{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=PV,this.bindMatrix=new Nn,this.bindMatrixInverse=new Nn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Jo),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,yS),this.boundingBox.expandByPoint(yS)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Bo),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,yS),this.boundingSphere.expandByPoint(yS)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,a=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),IV.copy(this.boundingSphere),IV.applyMatrix4(a),e.ray.intersectsSphere(IV)!==!1&&(VM.copy(a).invert(),dV.copy(e.ray).applyMatrix4(VM),!(this.boundingBox!==null&&dV.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,dV)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Xi,t=this.geometry.attributes.skinWeight;for(let n=0,a=t.count;n<a;n++){e.fromBufferAttribute(t,n);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===PV?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===LF?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,a=this.geometry;wM.fromBufferAttribute(a.attributes.skinIndex,e),WM.fromBufferAttribute(a.attributes.skinWeight,e),RM.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const c=WM.getComponent(o);if(c!==0){const I=wM.getComponent(o);xM.multiplyMatrices(n.bones[I].matrixWorld,n.boneInverses[I]),t.addScaledVector(EU.copy(RM).applyMatrix4(xM),c)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class A2 extends Ai{constructor(){super(),this.isBone=!0,this.type="Bone"}}class wA extends Ta{constructor(e=null,t=1,n=1,a,o,c,I,C,d=Fa,f=Fa,b,v){super(null,c,I,C,d,f,a,o,b,v),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const NM=new Nn,TU=new Nn;class NR{constructor(e=[],t=[]){this.uuid=sl(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,a=this.bones.length;n<a;n++)this.boneInverses.push(new Nn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Nn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,a=this.boneTexture;for(let o=0,c=e.length;o<c;o++){const I=e[o]?e[o].matrixWorld:TU;NM.multiplyMatrices(I,t[o]),NM.toArray(n,o*16)}a!==null&&(a.needsUpdate=!0)}clone(){return new NR(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new wA(t,e,e,Uo,Fg);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const a=this.bones[t];if(a.name===e)return a}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,a=e.bones.length;n<a;n++){const o=e.bones[n];let c=t[o];c===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),c=new A2),this.bones.push(c),this.boneInverses.push(new Nn().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let a=0,o=t.length;a<o;a++){const c=t[a];e.bones.push(c.uuid);const I=n[a];e.boneInverses.push(I.toArray())}return e}}class ob extends Yi{constructor(e,t,n,a=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=a}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Tm=new Nn,XM=new Nn,GS=[],YM=new Jo,zU=new Nn,A0=new ts,f0=new Bo;class $m extends ts{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new ob(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let a=0;a<n;a++)this.setMatrixAt(a,zU)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Jo),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Tm),YM.copy(e.boundingBox).applyMatrix4(Tm),this.boundingBox.union(YM)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Bo),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Tm),f0.copy(e.boundingSphere).applyMatrix4(Tm),this.boundingSphere.union(f0)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,a=this.count;if(A0.geometry=this.geometry,A0.material=this.material,A0.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),f0.copy(this.boundingSphere),f0.applyMatrix4(n),e.ray.intersectsSphere(f0)!==!1))for(let o=0;o<a;o++){this.getMatrixAt(o,Tm),XM.multiplyMatrices(n,Tm),A0.matrixWorld=XM,A0.raycast(e,GS);for(let c=0,I=GS.length;c<I;c++){const C=GS[c];C.instanceId=o,C.object=this,t.push(C)}GS.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new ob(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function LU(r,e){return r.z-e.z}function _U(r,e){return e.z-r.z}class kU{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const n=this.pool,a=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1});const o=n[this.index];a.push(o),this.index++,o.start=e.start,o.count=e.count,o.z=t}reset(){this.list.length=0,this.index=0}}const zm="batchId",Jd=new Nn,MM=new Nn,UU=new Nn,HM=new Nn,CV=new oG,BS=new Jo,rA=new Bo,p0=new $,hV=new kU,bo=new ts,ZS=[];function DU(r,e,t=0){const n=e.itemSize;if(r.isInterleavedBufferAttribute||r.array.constructor!==e.array.constructor){const a=r.count;for(let o=0;o<a;o++)for(let c=0;c<n;c++)e.setComponent(o+t,c,r.getComponent(o,c))}else e.array.set(r.array,t*n);e.needsUpdate=!0}class NK extends ts{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,n=t*2,a){super(new Qn,a),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxGeometryCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new wA(t,e,e,Uo,Fg);this._matricesTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,a=this._maxGeometryCount,o=this._maxIndexCount;if(this._geometryInitialized===!1){for(const I in e.attributes){const C=e.getAttribute(I),{array:d,itemSize:f,normalized:b}=C,v=new d.constructor(n*f),y=new C.constructor(v,f,b);y.setUsage(C.usage),t.setAttribute(I,y)}if(e.getIndex()!==null){const I=n>65536?new Uint32Array(o):new Uint16Array(o);t.setIndex(new Yi(I,1))}const c=a>65536?new Uint32Array(n):new Uint16Array(n);t.setAttribute(zm,new Yi(c,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(zm))throw new Error(`BatchedMesh: Geometry cannot use attribute "${zm}"`);const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(n===zm)continue;if(!e.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const a=e.getAttribute(n),o=t.getAttribute(n);if(a.itemSize!==o.itemSize||a.normalized!==o.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Jo);const e=this._geometryCount,t=this.boundingBox,n=this._active;t.makeEmpty();for(let a=0;a<e;a++)n[a]!==!1&&(this.getMatrixAt(a,Jd),this.getBoundingBoxAt(a,BS).applyMatrix4(Jd),t.union(BS))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Bo);const e=this._geometryCount,t=this.boundingSphere,n=this._active;t.makeEmpty();for(let a=0;a<e;a++)n[a]!==!1&&(this.getMatrixAt(a,Jd),this.getBoundingSphereAt(a,rA).applyMatrix4(Jd),t.union(rA))}addGeometry(e,t=-1,n=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const a={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let o=null;const c=this._reservedRanges,I=this._drawRanges,C=this._bounds;this._geometryCount!==0&&(o=c[c.length-1]),t===-1?a.vertexCount=e.getAttribute("position").count:a.vertexCount=t,o===null?a.vertexStart=0:a.vertexStart=o.vertexStart+o.vertexCount;const d=e.getIndex(),f=d!==null;if(f&&(n===-1?a.indexCount=d.count:a.indexCount=n,o===null?a.indexStart=0:a.indexStart=o.indexStart+o.indexCount),a.indexStart!==-1&&a.indexStart+a.indexCount>this._maxIndexCount||a.vertexStart+a.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const b=this._visibility,v=this._active,y=this._matricesTexture,Z=this._matricesTexture.image.data;b.push(!0),v.push(!0);const V=this._geometryCount;this._geometryCount++,UU.toArray(Z,V*16),y.needsUpdate=!0,c.push(a),I.push({start:f?a.indexStart:a.vertexStart,count:-1}),C.push({boxInitialized:!1,box:new Jo,sphereInitialized:!1,sphere:new Bo});const R=this.geometry.getAttribute(zm);for(let S=0;S<a.vertexCount;S++)R.setX(a.vertexStart+S,V);return R.needsUpdate=!0,this.setGeometryAt(V,e),V}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,a=n.getIndex()!==null,o=n.getIndex(),c=t.getIndex(),I=this._reservedRanges[e];if(a&&c.count>I.indexCount||t.attributes.position.count>I.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const C=I.vertexStart,d=I.vertexCount;for(const y in n.attributes){if(y===zm)continue;const Z=t.getAttribute(y),V=n.getAttribute(y);DU(Z,V,C);const R=Z.itemSize;for(let S=Z.count,N=d;S<N;S++){const w=C+S;for(let X=0;X<R;X++)V.setComponent(w,X,0)}V.needsUpdate=!0}if(a){const y=I.indexStart;for(let Z=0;Z<c.count;Z++)o.setX(y+Z,C+c.getX(Z));for(let Z=c.count,V=I.indexCount;Z<V;Z++)o.setX(y+Z,C);o.needsUpdate=!0}const f=this._bounds[e];t.boundingBox!==null?(f.box.copy(t.boundingBox),f.boxInitialized=!0):f.boxInitialized=!1,t.boundingSphere!==null?(f.sphere.copy(t.boundingSphere),f.sphereInitialized=!0):f.sphereInitialized=!1;const b=this._drawRanges[e],v=t.getAttribute("position");return b.count=a?c.count:v.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||t[e]===!1?this:(t[e]=!1,this._visibilityChanged=!0,this)}getBoundingBoxAt(e,t){if(this._active[e]===!1)return this;const a=this._bounds[e],o=a.box,c=this.geometry;if(a.boxInitialized===!1){o.makeEmpty();const I=c.index,C=c.attributes.position,d=this._drawRanges[e];for(let f=d.start,b=d.start+d.count;f<b;f++){let v=f;I&&(v=I.getX(v)),o.expandByPoint(p0.fromBufferAttribute(C,v))}a.boxInitialized=!0}return t.copy(o),t}getBoundingSphereAt(e,t){if(this._active[e]===!1)return this;const a=this._bounds[e],o=a.sphere,c=this.geometry;if(a.sphereInitialized===!1){o.makeEmpty(),this.getBoundingBoxAt(e,BS),BS.getCenter(o.center);const I=c.index,C=c.attributes.position,d=this._drawRanges[e];let f=0;for(let b=d.start,v=d.start+d.count;b<v;b++){let y=b;I&&(y=I.getX(y)),p0.fromBufferAttribute(C,y),f=Math.max(f,o.center.distanceToSquared(p0))}o.radius=Math.sqrt(f),a.sphereInitialized=!0}return t.copy(o),t}setMatrixAt(e,t){const n=this._active,a=this._matricesTexture,o=this._matricesTexture.image.data,c=this._geometryCount;return e>=c||n[e]===!1?this:(t.toArray(o,e*16),a.needsUpdate=!0,this)}getMatrixAt(e,t){const n=this._active,a=this._matricesTexture.image.data,o=this._geometryCount;return e>=o||n[e]===!1?null:t.fromArray(a,e*16)}setVisibleAt(e,t){const n=this._visibility,a=this._active,o=this._geometryCount;return e>=o||a[e]===!1||n[e]===t?this:(n[e]=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._visibility,n=this._active,a=this._geometryCount;return e>=a||n[e]===!1?!1:t[e]}raycast(e,t){const n=this._visibility,a=this._active,o=this._drawRanges,c=this._geometryCount,I=this.matrixWorld,C=this.geometry;bo.material=this.material,bo.geometry.index=C.index,bo.geometry.attributes=C.attributes,bo.geometry.boundingBox===null&&(bo.geometry.boundingBox=new Jo),bo.geometry.boundingSphere===null&&(bo.geometry.boundingSphere=new Bo);for(let d=0;d<c;d++){if(!n[d]||!a[d])continue;const f=o[d];bo.geometry.setDrawRange(f.start,f.count),this.getMatrixAt(d,bo.matrixWorld).premultiply(I),this.getBoundingBoxAt(d,bo.geometry.boundingBox),this.getBoundingSphereAt(d,bo.geometry.boundingSphere),bo.raycast(e,ZS);for(let b=0,v=ZS.length;b<v;b++){const y=ZS[b];y.object=this,y.batchId=d,t.push(y)}ZS.length=0}bo.material=null,bo.geometry.index=null,bo.geometry.attributes={},bo.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>({...t})),this._reservedRanges=e._reservedRanges.map(t=>({...t})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,t,n,a,o){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const c=a.getIndex(),I=c===null?1:c.array.BYTES_PER_ELEMENT,C=this._visibility,d=this._multiDrawStarts,f=this._multiDrawCounts,b=this._drawRanges,v=this.perObjectFrustumCulled;v&&(HM.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),CV.setFromProjectionMatrix(HM,e.isWebGPURenderer?ib:Kg));let y=0;if(this.sortObjects){MM.copy(this.matrixWorld).invert(),p0.setFromMatrixPosition(n.matrixWorld).applyMatrix4(MM);for(let R=0,S=C.length;R<S;R++)if(C[R]){this.getMatrixAt(R,Jd),this.getBoundingSphereAt(R,rA).applyMatrix4(Jd);let N=!1;if(v&&(N=!CV.intersectsSphere(rA)),!N){const w=p0.distanceTo(rA.center);hV.push(b[R],w)}}const Z=hV.list,V=this.customSort;V===null?Z.sort(o.transparent?_U:LU):V.call(this,Z,n);for(let R=0,S=Z.length;R<S;R++){const N=Z[R];d[y]=N.start*I,f[y]=N.count,y++}hV.reset()}else for(let Z=0,V=C.length;Z<V;Z++)if(C[Z]){let R=!1;if(v&&(this.getMatrixAt(Z,Jd),this.getBoundingSphereAt(Z,rA).applyMatrix4(Jd),R=!CV.intersectsSphere(rA)),!R){const S=b[Z];d[y]=S.start*I,f[y]=S.count,y++}}this._multiDrawCount=y,this._visibilityChanged=!1}onBeforeShadow(e,t,n,a,o,c){this.onBeforeRender(e,null,a,o,c)}}class Oo extends Zo{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new an(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const FM=new $,KM=new $,EM=new Nn,AV=new XA,SS=new Bo;class iC extends Ai{constructor(e=new Qn,t=new Oo){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let a=1,o=t.count;a<o;a++)FM.fromBufferAttribute(t,a-1),KM.fromBufferAttribute(t,a),n[a]=n[a-1],n[a]+=FM.distanceTo(KM);e.setAttribute("lineDistance",new cn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,a=this.matrixWorld,o=e.params.Line.threshold,c=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),SS.copy(n.boundingSphere),SS.applyMatrix4(a),SS.radius+=o,e.ray.intersectsSphere(SS)===!1)return;EM.copy(a).invert(),AV.copy(e.ray).applyMatrix4(EM);const I=o/((this.scale.x+this.scale.y+this.scale.z)/3),C=I*I,d=new $,f=new $,b=new $,v=new $,y=this.isLineSegments?2:1,Z=n.index,R=n.attributes.position;if(Z!==null){const S=Math.max(0,c.start),N=Math.min(Z.count,c.start+c.count);for(let w=S,X=N-1;w<X;w+=y){const H=Z.getX(w),F=Z.getX(w+1);if(d.fromBufferAttribute(R,H),f.fromBufferAttribute(R,F),AV.distanceSqToSegment(d,f,v,b)>C)continue;v.applyMatrix4(this.matrixWorld);const P=e.ray.origin.distanceTo(v);P<e.near||P>e.far||t.push({distance:P,point:b.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}else{const S=Math.max(0,c.start),N=Math.min(R.count,c.start+c.count);for(let w=S,X=N-1;w<X;w+=y){if(d.fromBufferAttribute(R,w),f.fromBufferAttribute(R,w+1),AV.distanceSqToSegment(d,f,v,b)>C)continue;v.applyMatrix4(this.matrixWorld);const F=e.ray.origin.distanceTo(v);F<e.near||F>e.far||t.push({distance:F,point:b.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const a=t[n[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,c=a.length;o<c;o++){const I=a[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[I]=o}}}}}const TM=new $,zM=new $;class _c extends iC{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let a=0,o=t.count;a<o;a+=2)TM.fromBufferAttribute(t,a),zM.fromBufferAttribute(t,a+1),n[a]=a===0?0:n[a-1],n[a+1]=n[a]+TM.distanceTo(zM);e.setAttribute("lineDistance",new cn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class XK extends iC{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class f2 extends Zo{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new an(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const LM=new Nn,SN=new XA,RS=new Bo,wS=new $;class YK extends Ai{constructor(e=new Qn,t=new f2){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,a=this.matrixWorld,o=e.params.Points.threshold,c=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),RS.copy(n.boundingSphere),RS.applyMatrix4(a),RS.radius+=o,e.ray.intersectsSphere(RS)===!1)return;LM.copy(a).invert(),SN.copy(e.ray).applyMatrix4(LM);const I=o/((this.scale.x+this.scale.y+this.scale.z)/3),C=I*I,d=n.index,b=n.attributes.position;if(d!==null){const v=Math.max(0,c.start),y=Math.min(d.count,c.start+c.count);for(let Z=v,V=y;Z<V;Z++){const R=d.getX(Z);wS.fromBufferAttribute(b,R),_M(wS,R,C,a,e,t,this)}}else{const v=Math.max(0,c.start),y=Math.min(b.count,c.start+c.count);for(let Z=v,V=y;Z<V;Z++)wS.fromBufferAttribute(b,Z),_M(wS,Z,C,a,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const a=t[n[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,c=a.length;o<c;o++){const I=a[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[I]=o}}}}}function _M(r,e,t,n,a,o,c){const I=SN.distanceSqToPoint(r);if(I<t){const C=new $;SN.closestPointToPoint(r,C),C.applyMatrix4(n);const d=a.ray.origin.distanceTo(C);if(d<a.near||d>a.far)return;o.push({distance:d,distanceToRay:Math.sqrt(I),point:C,index:e,face:null,object:c})}}class JU extends Ta{constructor(e,t,n,a,o,c,I,C,d){super(e,t,n,a,o,c,I,C,d),this.isVideoTexture=!0,this.minFilter=c!==void 0?c:Ka,this.magFilter=o!==void 0?o:Ka,this.generateMipmaps=!1;const f=this;function b(){f.needsUpdate=!0,e.requestVideoFrameCallback(b)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(b)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class OU extends Ta{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Fa,this.minFilter=Fa,this.generateMipmaps=!1,this.needsUpdate=!0}}class XR extends Ta{constructor(e,t,n,a,o,c,I,C,d,f,b,v){super(null,c,I,C,d,f,a,o,b,v),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class PU extends XR{constructor(e,t,n,a,o,c){super(e,t,n,o,c),this.isCompressedArrayTexture=!0,this.image.depth=a,this.wrapR=Go}}class QU extends XR{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,pI),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class jU extends Ta{constructor(e,t,n,a,o,c,I,C,d){super(e,t,n,a,o,c,I,C,d),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Tg{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,a=this.getPoint(0),o=0;t.push(0);for(let c=1;c<=e;c++)n=this.getPoint(c/e),o+=n.distanceTo(a),t.push(o),a=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let a=0;const o=n.length;let c;t?c=t:c=e*n[o-1];let I=0,C=o-1,d;for(;I<=C;)if(a=Math.floor(I+(C-I)/2),d=n[a]-c,d<0)I=a+1;else if(d>0)C=a-1;else{C=a;break}if(a=C,n[a]===c)return a/(o-1);const f=n[a],v=n[a+1]-f,y=(c-f)/v;return(a+y)/(o-1)}getTangent(e,t){let a=e-1e-4,o=e+1e-4;a<0&&(a=0),o>1&&(o=1);const c=this.getPoint(a),I=this.getPoint(o),C=t||(c.isVector2?new lt:new $);return C.copy(I).sub(c).normalize(),C}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new $,a=[],o=[],c=[],I=new $,C=new Nn;for(let y=0;y<=e;y++){const Z=y/e;a[y]=this.getTangentAt(Z,new $)}o[0]=new $,c[0]=new $;let d=Number.MAX_VALUE;const f=Math.abs(a[0].x),b=Math.abs(a[0].y),v=Math.abs(a[0].z);f<=d&&(d=f,n.set(1,0,0)),b<=d&&(d=b,n.set(0,1,0)),v<=d&&n.set(0,0,1),I.crossVectors(a[0],n).normalize(),o[0].crossVectors(a[0],I),c[0].crossVectors(a[0],o[0]);for(let y=1;y<=e;y++){if(o[y]=o[y-1].clone(),c[y]=c[y-1].clone(),I.crossVectors(a[y-1],a[y]),I.length()>Number.EPSILON){I.normalize();const Z=Math.acos(Wa(a[y-1].dot(a[y]),-1,1));o[y].applyMatrix4(C.makeRotationAxis(I,Z))}c[y].crossVectors(a[y],o[y])}if(t===!0){let y=Math.acos(Wa(o[0].dot(o[e]),-1,1));y/=e,a[0].dot(I.crossVectors(o[0],o[e]))>0&&(y=-y);for(let Z=1;Z<=e;Z++)o[Z].applyMatrix4(C.makeRotationAxis(a[Z],y*Z)),c[Z].crossVectors(a[Z],o[Z])}return{tangents:a,normals:o,binormals:c}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class YR extends Tg{constructor(e=0,t=0,n=1,a=1,o=0,c=Math.PI*2,I=!1,C=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=a,this.aStartAngle=o,this.aEndAngle=c,this.aClockwise=I,this.aRotation=C}getPoint(e,t){const n=t||new lt,a=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const c=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=a;for(;o>a;)o-=a;o<Number.EPSILON&&(c?o=0:o=a),this.aClockwise===!0&&!c&&(o===a?o=-a:o=o-a);const I=this.aStartAngle+e*o;let C=this.aX+this.xRadius*Math.cos(I),d=this.aY+this.yRadius*Math.sin(I);if(this.aRotation!==0){const f=Math.cos(this.aRotation),b=Math.sin(this.aRotation),v=C-this.aX,y=d-this.aY;C=v*f-y*b+this.aX,d=v*b+y*f+this.aY}return n.set(C,d)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class MK extends YR{constructor(e,t,n,a,o,c){super(e,t,n,n,a,o,c),this.isArcCurve=!0,this.type="ArcCurve"}}function p2(){let r=0,e=0,t=0,n=0;function a(o,c,I,C){r=o,e=I,t=-3*o+3*c-2*I-C,n=2*o-2*c+I+C}return{initCatmullRom:function(o,c,I,C,d){a(c,I,d*(I-o),d*(C-c))},initNonuniformCatmullRom:function(o,c,I,C,d,f,b){let v=(c-o)/d-(I-o)/(d+f)+(I-c)/f,y=(I-c)/f-(C-c)/(f+b)+(C-I)/b;v*=f,y*=f,a(c,I,v,y)},calc:function(o){const c=o*o,I=c*o;return r+e*o+t*c+n*I}}}const WS=new $,fV=new p2,pV=new p2,mV=new p2;class HK extends Tg{constructor(e=[],t=!1,n="centripetal",a=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=a}getPoint(e,t=new $){const n=t,a=this.points,o=a.length,c=(o-(this.closed?0:1))*e;let I=Math.floor(c),C=c-I;this.closed?I+=I>0?0:(Math.floor(Math.abs(I)/o)+1)*o:C===0&&I===o-1&&(I=o-2,C=1);let d,f;this.closed||I>0?d=a[(I-1)%o]:(WS.subVectors(a[0],a[1]).add(a[0]),d=WS);const b=a[I%o],v=a[(I+1)%o];if(this.closed||I+2<o?f=a[(I+2)%o]:(WS.subVectors(a[o-1],a[o-2]).add(a[o-1]),f=WS),this.curveType==="centripetal"||this.curveType==="chordal"){const y=this.curveType==="chordal"?.5:.25;let Z=Math.pow(d.distanceToSquared(b),y),V=Math.pow(b.distanceToSquared(v),y),R=Math.pow(v.distanceToSquared(f),y);V<1e-4&&(V=1),Z<1e-4&&(Z=V),R<1e-4&&(R=V),fV.initNonuniformCatmullRom(d.x,b.x,v.x,f.x,Z,V,R),pV.initNonuniformCatmullRom(d.y,b.y,v.y,f.y,Z,V,R),mV.initNonuniformCatmullRom(d.z,b.z,v.z,f.z,Z,V,R)}else this.curveType==="catmullrom"&&(fV.initCatmullRom(d.x,b.x,v.x,f.x,this.tension),pV.initCatmullRom(d.y,b.y,v.y,f.y,this.tension),mV.initCatmullRom(d.z,b.z,v.z,f.z,this.tension));return n.set(fV.calc(C),pV.calc(C),mV.calc(C)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const a=e.points[t];this.points.push(a.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const a=this.points[t];e.points.push(a.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const a=e.points[t];this.points.push(new $().fromArray(a))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function kM(r,e,t,n,a){const o=(n-e)*.5,c=(a-t)*.5,I=r*r,C=r*I;return(2*t-2*n+o+c)*C+(-3*t+3*n-2*o-c)*I+o*r+t}function qU(r,e){const t=1-r;return t*t*e}function $U(r,e){return 2*(1-r)*r*e}function eD(r,e){return r*r*e}function X0(r,e,t,n){return qU(r,e)+$U(r,t)+eD(r,n)}function tD(r,e){const t=1-r;return t*t*t*e}function nD(r,e){const t=1-r;return 3*t*t*r*e}function iD(r,e){return 3*(1-r)*r*r*e}function aD(r,e){return r*r*r*e}function Y0(r,e,t,n,a){return tD(r,e)+nD(r,t)+iD(r,n)+aD(r,a)}class m2 extends Tg{constructor(e=new lt,t=new lt,n=new lt,a=new lt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=a}getPoint(e,t=new lt){const n=t,a=this.v0,o=this.v1,c=this.v2,I=this.v3;return n.set(Y0(e,a.x,o.x,c.x,I.x),Y0(e,a.y,o.y,c.y,I.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class FK extends Tg{constructor(e=new $,t=new $,n=new $,a=new $){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=a}getPoint(e,t=new $){const n=t,a=this.v0,o=this.v1,c=this.v2,I=this.v3;return n.set(Y0(e,a.x,o.x,c.x,I.x),Y0(e,a.y,o.y,c.y,I.y),Y0(e,a.z,o.z,c.z,I.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class b2 extends Tg{constructor(e=new lt,t=new lt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new lt){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new lt){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class KK extends Tg{constructor(e=new $,t=new $){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new $){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new $){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class v2 extends Tg{constructor(e=new lt,t=new lt,n=new lt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new lt){const n=t,a=this.v0,o=this.v1,c=this.v2;return n.set(X0(e,a.x,o.x,c.x),X0(e,a.y,o.y,c.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class y2 extends Tg{constructor(e=new $,t=new $,n=new $){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new $){const n=t,a=this.v0,o=this.v1,c=this.v2;return n.set(X0(e,a.x,o.x,c.x),X0(e,a.y,o.y,c.y),X0(e,a.z,o.z,c.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class G2 extends Tg{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new lt){const n=t,a=this.points,o=(a.length-1)*e,c=Math.floor(o),I=o-c,C=a[c===0?c:c-1],d=a[c],f=a[c>a.length-2?a.length-1:c+1],b=a[c>a.length-3?a.length-1:c+2];return n.set(kM(I,C.x,d.x,f.x,b.x),kM(I,C.y,d.y,f.y,b.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const a=e.points[t];this.points.push(a.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const a=this.points[t];e.points.push(a.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const a=e.points[t];this.points.push(new lt().fromArray(a))}return this}}var mR=Object.freeze({__proto__:null,ArcCurve:MK,CatmullRomCurve3:HK,CubicBezierCurve:m2,CubicBezierCurve3:FK,EllipseCurve:YR,LineCurve:b2,LineCurve3:KK,QuadraticBezierCurve:v2,QuadraticBezierCurve3:y2,SplineCurve:G2});class EK extends Tg{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new mR[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),a=this.getCurveLengths();let o=0;for(;o<a.length;){if(a[o]>=n){const c=a[o]-n,I=this.curves[o],C=I.getLength(),d=C===0?0:1-c/C;return I.getPointAt(d,t)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,a=this.curves.length;n<a;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let a=0,o=this.curves;a<o.length;a++){const c=o[a],I=c.isEllipseCurve?e*2:c.isLineCurve||c.isLineCurve3?1:c.isSplineCurve?e*c.points.length:e,C=c.getPoints(I);for(let d=0;d<C.length;d++){const f=C[d];n&&n.equals(f)||(t.push(f),n=f)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const a=e.curves[t];this.curves.push(a.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const a=this.curves[t];e.curves.push(a.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const a=e.curves[t];this.curves.push(new mR[a.type]().fromJSON(a))}return this}}class O0 extends EK{constructor(e){super(),this.type="Path",this.currentPoint=new lt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new b2(this.currentPoint.clone(),new lt(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,a){const o=new v2(this.currentPoint.clone(),new lt(e,t),new lt(n,a));return this.curves.push(o),this.currentPoint.set(n,a),this}bezierCurveTo(e,t,n,a,o,c){const I=new m2(this.currentPoint.clone(),new lt(e,t),new lt(n,a),new lt(o,c));return this.curves.push(I),this.currentPoint.set(o,c),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new G2(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,a,o,c){const I=this.currentPoint.x,C=this.currentPoint.y;return this.absarc(e+I,t+C,n,a,o,c),this}absarc(e,t,n,a,o,c){return this.absellipse(e,t,n,n,a,o,c),this}ellipse(e,t,n,a,o,c,I,C){const d=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(e+d,t+f,n,a,o,c,I,C),this}absellipse(e,t,n,a,o,c,I,C){const d=new YR(e,t,n,a,o,c,I,C);if(this.curves.length>0){const b=d.getPoint(0);b.equals(this.currentPoint)||this.lineTo(b.x,b.y)}this.curves.push(d);const f=d.getPoint(1);return this.currentPoint.copy(f),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class lG extends Qn{constructor(e=[new lt(0,-.5),new lt(.5,0),new lt(0,.5)],t=12,n=0,a=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:a},t=Math.floor(t),a=Wa(a,0,Math.PI*2);const o=[],c=[],I=[],C=[],d=[],f=1/t,b=new $,v=new lt,y=new $,Z=new $,V=new $;let R=0,S=0;for(let N=0;N<=e.length-1;N++)switch(N){case 0:R=e[N+1].x-e[N].x,S=e[N+1].y-e[N].y,y.x=S*1,y.y=-R,y.z=S*0,V.copy(y),y.normalize(),C.push(y.x,y.y,y.z);break;case e.length-1:C.push(V.x,V.y,V.z);break;default:R=e[N+1].x-e[N].x,S=e[N+1].y-e[N].y,y.x=S*1,y.y=-R,y.z=S*0,Z.copy(y),y.x+=V.x,y.y+=V.y,y.z+=V.z,y.normalize(),C.push(y.x,y.y,y.z),V.copy(Z)}for(let N=0;N<=t;N++){const w=n+N*f*a,X=Math.sin(w),H=Math.cos(w);for(let F=0;F<=e.length-1;F++){b.x=e[F].x*X,b.y=e[F].y,b.z=e[F].x*H,c.push(b.x,b.y,b.z),v.x=N/t,v.y=F/(e.length-1),I.push(v.x,v.y);const _=C[3*F+0]*X,P=C[3*F+1],K=C[3*F+0]*H;d.push(_,P,K)}}for(let N=0;N<t;N++)for(let w=0;w<e.length-1;w++){const X=w+N*e.length,H=X,F=X+e.length,_=X+e.length+1,P=X+1;o.push(H,F,P),o.push(_,P,F)}this.setIndex(o),this.setAttribute("position",new cn(c,3)),this.setAttribute("uv",new cn(I,2)),this.setAttribute("normal",new cn(d,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new lG(e.points,e.segments,e.phiStart,e.phiLength)}}class MR extends lG{constructor(e=1,t=1,n=4,a=8){const o=new O0;o.absarc(0,-t/2,e,Math.PI*1.5,0),o.absarc(0,t/2,e,0,Math.PI*.5),super(o.getPoints(n),a),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:a}}static fromJSON(e){return new MR(e.radius,e.length,e.capSegments,e.radialSegments)}}class HR extends Qn{constructor(e=1,t=32,n=0,a=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:a},t=Math.max(3,t);const o=[],c=[],I=[],C=[],d=new $,f=new lt;c.push(0,0,0),I.push(0,0,1),C.push(.5,.5);for(let b=0,v=3;b<=t;b++,v+=3){const y=n+b/t*a;d.x=e*Math.cos(y),d.y=e*Math.sin(y),c.push(d.x,d.y,d.z),I.push(0,0,1),f.x=(c[v]/e+1)/2,f.y=(c[v+1]/e+1)/2,C.push(f.x,f.y)}for(let b=1;b<=t;b++)o.push(b,b+1,0);this.setIndex(o),this.setAttribute("position",new cn(c,3)),this.setAttribute("normal",new cn(I,3)),this.setAttribute("uv",new cn(C,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new HR(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class ub extends Qn{constructor(e=1,t=1,n=1,a=32,o=1,c=!1,I=0,C=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:a,heightSegments:o,openEnded:c,thetaStart:I,thetaLength:C};const d=this;a=Math.floor(a),o=Math.floor(o);const f=[],b=[],v=[],y=[];let Z=0;const V=[],R=n/2;let S=0;N(),c===!1&&(e>0&&w(!0),t>0&&w(!1)),this.setIndex(f),this.setAttribute("position",new cn(b,3)),this.setAttribute("normal",new cn(v,3)),this.setAttribute("uv",new cn(y,2));function N(){const X=new $,H=new $;let F=0;const _=(t-e)/n;for(let P=0;P<=o;P++){const K=[],E=P/o,ee=E*(t-e)+e;for(let Ie=0;Ie<=a;Ie++){const be=Ie/a,se=be*C+I,Ce=Math.sin(se),he=Math.cos(se);H.x=ee*Ce,H.y=-E*n+R,H.z=ee*he,b.push(H.x,H.y,H.z),X.set(Ce,_,he).normalize(),v.push(X.x,X.y,X.z),y.push(be,1-E),K.push(Z++)}V.push(K)}for(let P=0;P<a;P++)for(let K=0;K<o;K++){const E=V[K][P],ee=V[K+1][P],Ie=V[K+1][P+1],be=V[K][P+1];f.push(E,ee,be),f.push(ee,Ie,be),F+=6}d.addGroup(S,F,0),S+=F}function w(X){const H=Z,F=new lt,_=new $;let P=0;const K=X===!0?e:t,E=X===!0?1:-1;for(let Ie=1;Ie<=a;Ie++)b.push(0,R*E,0),v.push(0,E,0),y.push(.5,.5),Z++;const ee=Z;for(let Ie=0;Ie<=a;Ie++){const se=Ie/a*C+I,Ce=Math.cos(se),he=Math.sin(se);_.x=K*he,_.y=R*E,_.z=K*Ce,b.push(_.x,_.y,_.z),v.push(0,E,0),F.x=Ce*.5+.5,F.y=he*.5*E+.5,y.push(F.x,F.y),Z++}for(let Ie=0;Ie<a;Ie++){const be=H+Ie,se=ee+Ie;X===!0?f.push(se,se+1,be):f.push(se+1,se,be),P+=3}d.addGroup(S,P,X===!0?1:2),S+=P}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ub(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class FR extends ub{constructor(e=1,t=1,n=32,a=1,o=!1,c=0,I=Math.PI*2){super(0,e,t,n,a,o,c,I),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:a,openEnded:o,thetaStart:c,thetaLength:I}}static fromJSON(e){return new FR(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class oC extends Qn{constructor(e=[],t=[],n=1,a=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:a};const o=[],c=[];I(a),d(n),f(),this.setAttribute("position",new cn(o,3)),this.setAttribute("normal",new cn(o.slice(),3)),this.setAttribute("uv",new cn(c,2)),a===0?this.computeVertexNormals():this.normalizeNormals();function I(N){const w=new $,X=new $,H=new $;for(let F=0;F<t.length;F+=3)y(t[F+0],w),y(t[F+1],X),y(t[F+2],H),C(w,X,H,N)}function C(N,w,X,H){const F=H+1,_=[];for(let P=0;P<=F;P++){_[P]=[];const K=N.clone().lerp(X,P/F),E=w.clone().lerp(X,P/F),ee=F-P;for(let Ie=0;Ie<=ee;Ie++)Ie===0&&P===F?_[P][Ie]=K:_[P][Ie]=K.clone().lerp(E,Ie/ee)}for(let P=0;P<F;P++)for(let K=0;K<2*(F-P)-1;K++){const E=Math.floor(K/2);K%2===0?(v(_[P][E+1]),v(_[P+1][E]),v(_[P][E])):(v(_[P][E+1]),v(_[P+1][E+1]),v(_[P+1][E]))}}function d(N){const w=new $;for(let X=0;X<o.length;X+=3)w.x=o[X+0],w.y=o[X+1],w.z=o[X+2],w.normalize().multiplyScalar(N),o[X+0]=w.x,o[X+1]=w.y,o[X+2]=w.z}function f(){const N=new $;for(let w=0;w<o.length;w+=3){N.x=o[w+0],N.y=o[w+1],N.z=o[w+2];const X=R(N)/2/Math.PI+.5,H=S(N)/Math.PI+.5;c.push(X,1-H)}Z(),b()}function b(){for(let N=0;N<c.length;N+=6){const w=c[N+0],X=c[N+2],H=c[N+4],F=Math.max(w,X,H),_=Math.min(w,X,H);F>.9&&_<.1&&(w<.2&&(c[N+0]+=1),X<.2&&(c[N+2]+=1),H<.2&&(c[N+4]+=1))}}function v(N){o.push(N.x,N.y,N.z)}function y(N,w){const X=N*3;w.x=e[X+0],w.y=e[X+1],w.z=e[X+2]}function Z(){const N=new $,w=new $,X=new $,H=new $,F=new lt,_=new lt,P=new lt;for(let K=0,E=0;K<o.length;K+=9,E+=6){N.set(o[K+0],o[K+1],o[K+2]),w.set(o[K+3],o[K+4],o[K+5]),X.set(o[K+6],o[K+7],o[K+8]),F.set(c[E+0],c[E+1]),_.set(c[E+2],c[E+3]),P.set(c[E+4],c[E+5]),H.copy(N).add(w).add(X).divideScalar(3);const ee=R(H);V(F,E+0,N,ee),V(_,E+2,w,ee),V(P,E+4,X,ee)}}function V(N,w,X,H){H<0&&N.x===1&&(c[w]=N.x-1),X.x===0&&X.z===0&&(c[w]=H/2/Math.PI+.5)}function R(N){return Math.atan2(N.z,-N.x)}function S(N){return Math.atan2(-N.y,Math.sqrt(N.x*N.x+N.z*N.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new oC(e.vertices,e.indices,e.radius,e.details)}}class KR extends oC{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,a=1/n,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-a,-n,0,-a,n,0,a,-n,0,a,n,-a,-n,0,-a,n,0,a,-n,0,a,n,0,-n,0,-a,n,0,-a,-n,0,a,n,0,a],c=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(o,c,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new KR(e.radius,e.detail)}}const xS=new $,VS=new $,bV=new $,NS=new Br;class TK extends Qn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const a=Math.pow(10,4),o=Math.cos(SA*t),c=e.getIndex(),I=e.getAttribute("position"),C=c?c.count:I.count,d=[0,0,0],f=["a","b","c"],b=new Array(3),v={},y=[];for(let Z=0;Z<C;Z+=3){c?(d[0]=c.getX(Z),d[1]=c.getX(Z+1),d[2]=c.getX(Z+2)):(d[0]=Z,d[1]=Z+1,d[2]=Z+2);const{a:V,b:R,c:S}=NS;if(V.fromBufferAttribute(I,d[0]),R.fromBufferAttribute(I,d[1]),S.fromBufferAttribute(I,d[2]),NS.getNormal(bV),b[0]=`${Math.round(V.x*a)},${Math.round(V.y*a)},${Math.round(V.z*a)}`,b[1]=`${Math.round(R.x*a)},${Math.round(R.y*a)},${Math.round(R.z*a)}`,b[2]=`${Math.round(S.x*a)},${Math.round(S.y*a)},${Math.round(S.z*a)}`,!(b[0]===b[1]||b[1]===b[2]||b[2]===b[0]))for(let N=0;N<3;N++){const w=(N+1)%3,X=b[N],H=b[w],F=NS[f[N]],_=NS[f[w]],P=`${X}_${H}`,K=`${H}_${X}`;K in v&&v[K]?(bV.dot(v[K].normal)<=o&&(y.push(F.x,F.y,F.z),y.push(_.x,_.y,_.z)),v[K]=null):P in v||(v[P]={index0:d[N],index1:d[w],normal:bV.clone()})}}for(const Z in v)if(v[Z]){const{index0:V,index1:R}=v[Z];xS.fromBufferAttribute(I,V),VS.fromBufferAttribute(I,R),y.push(xS.x,xS.y,xS.z),y.push(VS.x,VS.y,VS.z)}this.setAttribute("position",new cn(y,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}let WA=class extends O0{constructor(e){super(e),this.uuid=sl(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,a=this.holes.length;n<a;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const a=e.holes[t];this.holes.push(a.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const a=this.holes[t];e.holes.push(a.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const a=e.holes[t];this.holes.push(new O0().fromJSON(a))}return this}};const sD={triangulate:function(r,e,t=2){const n=e&&e.length,a=n?e[0]*t:r.length;let o=zK(r,0,a,t,!0);const c=[];if(!o||o.next===o.prev)return c;let I,C,d,f,b,v,y;if(n&&(o=cD(r,e,o,t)),r.length>80*t){I=d=r[0],C=f=r[1];for(let Z=t;Z<a;Z+=t)b=r[Z],v=r[Z+1],b<I&&(I=b),v<C&&(C=v),b>d&&(d=b),v>f&&(f=v);y=Math.max(d-I,f-C),y=y!==0?32767/y:0}return P0(o,c,t,I,C,y,0),c}};function zK(r,e,t,n,a){let o,c;if(a===vD(r,e,t,n)>0)for(o=e;o<t;o+=n)c=UM(o,r[o],r[o+1],c);else for(o=t-n;o>=e;o-=n)c=UM(o,r[o],r[o+1],c);return c&&ER(c,c.next)&&(j0(c),c=c.next),c}function NA(r,e){if(!r)return r;e||(e=r);let t=r,n;do if(n=!1,!t.steiner&&(ER(t,t.next)||pa(t.prev,t,t.next)===0)){if(j0(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function P0(r,e,t,n,a,o,c){if(!r)return;!c&&o&&hD(r,n,a,o);let I=r,C,d;for(;r.prev!==r.next;){if(C=r.prev,d=r.next,o?rD(r,n,a,o):oD(r)){e.push(C.i/t|0),e.push(r.i/t|0),e.push(d.i/t|0),j0(r),r=d.next,I=d.next;continue}if(r=d,r===I){c?c===1?(r=lD(NA(r),e,t),P0(r,e,t,n,a,o,2)):c===2&&gD(r,e,t,n,a,o):P0(NA(r),e,t,n,a,o,1);break}}}function oD(r){const e=r.prev,t=r,n=r.next;if(pa(e,t,n)>=0)return!1;const a=e.x,o=t.x,c=n.x,I=e.y,C=t.y,d=n.y,f=a<o?a<c?a:c:o<c?o:c,b=I<C?I<d?I:d:C<d?C:d,v=a>o?a>c?a:c:o>c?o:c,y=I>C?I>d?I:d:C>d?C:d;let Z=n.next;for(;Z!==e;){if(Z.x>=f&&Z.x<=v&&Z.y>=b&&Z.y<=y&&Qm(a,I,o,C,c,d,Z.x,Z.y)&&pa(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function rD(r,e,t,n){const a=r.prev,o=r,c=r.next;if(pa(a,o,c)>=0)return!1;const I=a.x,C=o.x,d=c.x,f=a.y,b=o.y,v=c.y,y=I<C?I<d?I:d:C<d?C:d,Z=f<b?f<v?f:v:b<v?b:v,V=I>C?I>d?I:d:C>d?C:d,R=f>b?f>v?f:v:b>v?b:v,S=RN(y,Z,e,t,n),N=RN(V,R,e,t,n);let w=r.prevZ,X=r.nextZ;for(;w&&w.z>=S&&X&&X.z<=N;){if(w.x>=y&&w.x<=V&&w.y>=Z&&w.y<=R&&w!==a&&w!==c&&Qm(I,f,C,b,d,v,w.x,w.y)&&pa(w.prev,w,w.next)>=0||(w=w.prevZ,X.x>=y&&X.x<=V&&X.y>=Z&&X.y<=R&&X!==a&&X!==c&&Qm(I,f,C,b,d,v,X.x,X.y)&&pa(X.prev,X,X.next)>=0))return!1;X=X.nextZ}for(;w&&w.z>=S;){if(w.x>=y&&w.x<=V&&w.y>=Z&&w.y<=R&&w!==a&&w!==c&&Qm(I,f,C,b,d,v,w.x,w.y)&&pa(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;X&&X.z<=N;){if(X.x>=y&&X.x<=V&&X.y>=Z&&X.y<=R&&X!==a&&X!==c&&Qm(I,f,C,b,d,v,X.x,X.y)&&pa(X.prev,X,X.next)>=0)return!1;X=X.nextZ}return!0}function lD(r,e,t){let n=r;do{const a=n.prev,o=n.next.next;!ER(a,o)&&LK(a,n,n.next,o)&&Q0(a,o)&&Q0(o,a)&&(e.push(a.i/t|0),e.push(n.i/t|0),e.push(o.i/t|0),j0(n),j0(n.next),n=r=o),n=n.next}while(n!==r);return NA(n)}function gD(r,e,t,n,a,o){let c=r;do{let I=c.next.next;for(;I!==c.prev;){if(c.i!==I.i&&pD(c,I)){let C=_K(c,I);c=NA(c,c.next),C=NA(C,C.next),P0(c,e,t,n,a,o,0),P0(C,e,t,n,a,o,0);return}I=I.next}c=c.next}while(c!==r)}function cD(r,e,t,n){const a=[];let o,c,I,C,d;for(o=0,c=e.length;o<c;o++)I=e[o]*n,C=o<c-1?e[o+1]*n:r.length,d=zK(r,I,C,n,!1),d===d.next&&(d.steiner=!0),a.push(fD(d));for(a.sort(uD),o=0;o<a.length;o++)t=ID(a[o],t);return t}function uD(r,e){return r.x-e.x}function ID(r,e){const t=dD(r,e);if(!t)return e;const n=_K(t,r);return NA(n,n.next),NA(t,t.next)}function dD(r,e){let t=e,n=-1/0,a;const o=r.x,c=r.y;do{if(c<=t.y&&c>=t.next.y&&t.next.y!==t.y){const v=t.x+(c-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(v<=o&&v>n&&(n=v,a=t.x<t.next.x?t:t.next,v===o))return a}t=t.next}while(t!==e);if(!a)return null;const I=a,C=a.x,d=a.y;let f=1/0,b;t=a;do o>=t.x&&t.x>=C&&o!==t.x&&Qm(c<d?o:n,c,C,d,c<d?n:o,c,t.x,t.y)&&(b=Math.abs(c-t.y)/(o-t.x),Q0(t,r)&&(b<f||b===f&&(t.x>a.x||t.x===a.x&&CD(a,t)))&&(a=t,f=b)),t=t.next;while(t!==I);return a}function CD(r,e){return pa(r.prev,r,e.prev)<0&&pa(e.next,r,r.next)<0}function hD(r,e,t,n){let a=r;do a.z===0&&(a.z=RN(a.x,a.y,e,t,n)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==r);a.prevZ.nextZ=null,a.prevZ=null,AD(a)}function AD(r){let e,t,n,a,o,c,I,C,d=1;do{for(t=r,r=null,o=null,c=0;t;){for(c++,n=t,I=0,e=0;e<d&&(I++,n=n.nextZ,!!n);e++);for(C=d;I>0||C>0&&n;)I!==0&&(C===0||!n||t.z<=n.z)?(a=t,t=t.nextZ,I--):(a=n,n=n.nextZ,C--),o?o.nextZ=a:r=a,a.prevZ=o,o=a;t=n}o.nextZ=null,d*=2}while(c>1);return r}function RN(r,e,t,n,a){return r=(r-t)*a|0,e=(e-n)*a|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function fD(r){let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function Qm(r,e,t,n,a,o,c,I){return(a-c)*(e-I)>=(r-c)*(o-I)&&(r-c)*(n-I)>=(t-c)*(e-I)&&(t-c)*(o-I)>=(a-c)*(n-I)}function pD(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!mD(r,e)&&(Q0(r,e)&&Q0(e,r)&&bD(r,e)&&(pa(r.prev,r,e.prev)||pa(r,e.prev,e))||ER(r,e)&&pa(r.prev,r,r.next)>0&&pa(e.prev,e,e.next)>0)}function pa(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function ER(r,e){return r.x===e.x&&r.y===e.y}function LK(r,e,t,n){const a=YS(pa(r,e,t)),o=YS(pa(r,e,n)),c=YS(pa(t,n,r)),I=YS(pa(t,n,e));return!!(a!==o&&c!==I||a===0&&XS(r,t,e)||o===0&&XS(r,n,e)||c===0&&XS(t,r,n)||I===0&&XS(t,e,n))}function XS(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function YS(r){return r>0?1:r<0?-1:0}function mD(r,e){let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&LK(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function Q0(r,e){return pa(r.prev,r,r.next)<0?pa(r,e,r.next)>=0&&pa(r,r.prev,e)>=0:pa(r,e,r.prev)<0||pa(r,r.next,e)<0}function bD(r,e){let t=r,n=!1;const a=(r.x+e.x)/2,o=(r.y+e.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&a<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n}function _K(r,e){const t=new wN(r.i,r.x,r.y),n=new wN(e.i,e.x,e.y),a=r.next,o=e.prev;return r.next=e,e.prev=r,t.next=a,a.prev=t,n.next=t,t.prev=n,o.next=n,n.prev=o,n}function UM(r,e,t,n){const a=new wN(r,e,t);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function j0(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function wN(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function vD(r,e,t,n){let a=0;for(let o=e,c=t-n;o<t;o+=n)a+=(r[c]-r[o])*(r[o+1]+r[c+1]),c=o;return a}class Ec{static area(e){const t=e.length;let n=0;for(let a=t-1,o=0;o<t;a=o++)n+=e[a].x*e[o].y-e[o].x*e[a].y;return n*.5}static isClockWise(e){return Ec.area(e)<0}static triangulateShape(e,t){const n=[],a=[],o=[];DM(e),JM(n,e);let c=e.length;t.forEach(DM);for(let C=0;C<t.length;C++)a.push(c),c+=t[C].length,JM(n,t[C]);const I=sD.triangulate(n,a);for(let C=0;C<I.length;C+=3)o.push(I.slice(C,C+3));return o}}function DM(r){const e=r.length;e>2&&r[e-1].equals(r[0])&&r.pop()}function JM(r,e){for(let t=0;t<e.length;t++)r.push(e[t].x),r.push(e[t].y)}class TR extends Qn{constructor(e=new WA([new lt(.5,.5),new lt(-.5,.5),new lt(-.5,-.5),new lt(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,a=[],o=[];for(let I=0,C=e.length;I<C;I++){const d=e[I];c(d)}this.setAttribute("position",new cn(a,3)),this.setAttribute("uv",new cn(o,2)),this.computeVertexNormals();function c(I){const C=[],d=t.curveSegments!==void 0?t.curveSegments:12,f=t.steps!==void 0?t.steps:1,b=t.depth!==void 0?t.depth:1;let v=t.bevelEnabled!==void 0?t.bevelEnabled:!0,y=t.bevelThickness!==void 0?t.bevelThickness:.2,Z=t.bevelSize!==void 0?t.bevelSize:y-.1,V=t.bevelOffset!==void 0?t.bevelOffset:0,R=t.bevelSegments!==void 0?t.bevelSegments:3;const S=t.extrudePath,N=t.UVGenerator!==void 0?t.UVGenerator:yD;let w,X=!1,H,F,_,P;S&&(w=S.getSpacedPoints(f),X=!0,v=!1,H=S.computeFrenetFrames(f,!1),F=new $,_=new $,P=new $),v||(R=0,y=0,Z=0,V=0);const K=I.extractPoints(d);let E=K.shape;const ee=K.holes;if(!Ec.isClockWise(E)){E=E.reverse();for(let oe=0,ut=ee.length;oe<ut;oe++){const _e=ee[oe];Ec.isClockWise(_e)&&(ee[oe]=_e.reverse())}}const be=Ec.triangulateShape(E,ee),se=E;for(let oe=0,ut=ee.length;oe<ut;oe++){const _e=ee[oe];E=E.concat(_e)}function Ce(oe,ut,_e){return ut||console.error("THREE.ExtrudeGeometry: vec does not exist"),oe.clone().addScaledVector(ut,_e)}const he=E.length,Be=be.length;function ve(oe,ut,_e){let it,Te,Et;const Wt=oe.x-ut.x,O=oe.y-ut.y,k=_e.x-oe.x,Ae=_e.y-oe.y,Oe=Wt*Wt+O*O,$e=Wt*Ae-O*k;if(Math.abs($e)>Number.EPSILON){const et=Math.sqrt(Oe),Yt=Math.sqrt(k*k+Ae*Ae),vt=ut.x-O/et,Vt=ut.y+Wt/et,tn=_e.x-Ae/Yt,un=_e.y+k/Yt,ae=((tn-vt)*Ae-(un-Vt)*k)/(Wt*Ae-O*k);it=vt+Wt*ae-oe.x,Te=Vt+O*ae-oe.y;const Le=it*it+Te*Te;if(Le<=2)return new lt(it,Te);Et=Math.sqrt(Le/2)}else{let et=!1;Wt>Number.EPSILON?k>Number.EPSILON&&(et=!0):Wt<-Number.EPSILON?k<-Number.EPSILON&&(et=!0):Math.sign(O)===Math.sign(Ae)&&(et=!0),et?(it=-O,Te=Wt,Et=Math.sqrt(Oe)):(it=Wt,Te=O,Et=Math.sqrt(Oe/2))}return new lt(it/Et,Te/Et)}const we=[];for(let oe=0,ut=se.length,_e=ut-1,it=oe+1;oe<ut;oe++,_e++,it++)_e===ut&&(_e=0),it===ut&&(it=0),we[oe]=ve(se[oe],se[_e],se[it]);const me=[];let Xe,Ue=we.concat();for(let oe=0,ut=ee.length;oe<ut;oe++){const _e=ee[oe];Xe=[];for(let it=0,Te=_e.length,Et=Te-1,Wt=it+1;it<Te;it++,Et++,Wt++)Et===Te&&(Et=0),Wt===Te&&(Wt=0),Xe[it]=ve(_e[it],_e[Et],_e[Wt]);me.push(Xe),Ue=Ue.concat(Xe)}for(let oe=0;oe<R;oe++){const ut=oe/R,_e=y*Math.cos(ut*Math.PI/2),it=Z*Math.sin(ut*Math.PI/2)+V;for(let Te=0,Et=se.length;Te<Et;Te++){const Wt=Ce(se[Te],we[Te],it);Bt(Wt.x,Wt.y,-_e)}for(let Te=0,Et=ee.length;Te<Et;Te++){const Wt=ee[Te];Xe=me[Te];for(let O=0,k=Wt.length;O<k;O++){const Ae=Ce(Wt[O],Xe[O],it);Bt(Ae.x,Ae.y,-_e)}}}const de=Z+V;for(let oe=0;oe<he;oe++){const ut=v?Ce(E[oe],Ue[oe],de):E[oe];X?(_.copy(H.normals[0]).multiplyScalar(ut.x),F.copy(H.binormals[0]).multiplyScalar(ut.y),P.copy(w[0]).add(_).add(F),Bt(P.x,P.y,P.z)):Bt(ut.x,ut.y,0)}for(let oe=1;oe<=f;oe++)for(let ut=0;ut<he;ut++){const _e=v?Ce(E[ut],Ue[ut],de):E[ut];X?(_.copy(H.normals[oe]).multiplyScalar(_e.x),F.copy(H.binormals[oe]).multiplyScalar(_e.y),P.copy(w[oe]).add(_).add(F),Bt(P.x,P.y,P.z)):Bt(_e.x,_e.y,b/f*oe)}for(let oe=R-1;oe>=0;oe--){const ut=oe/R,_e=y*Math.cos(ut*Math.PI/2),it=Z*Math.sin(ut*Math.PI/2)+V;for(let Te=0,Et=se.length;Te<Et;Te++){const Wt=Ce(se[Te],we[Te],it);Bt(Wt.x,Wt.y,b+_e)}for(let Te=0,Et=ee.length;Te<Et;Te++){const Wt=ee[Te];Xe=me[Te];for(let O=0,k=Wt.length;O<k;O++){const Ae=Ce(Wt[O],Xe[O],it);X?Bt(Ae.x,Ae.y+w[f-1].y,w[f-1].x+_e):Bt(Ae.x,Ae.y,b+_e)}}}Ee(),At();function Ee(){const oe=a.length/3;if(v){let ut=0,_e=he*ut;for(let it=0;it<Be;it++){const Te=be[it];kt(Te[2]+_e,Te[1]+_e,Te[0]+_e)}ut=f+R*2,_e=he*ut;for(let it=0;it<Be;it++){const Te=be[it];kt(Te[0]+_e,Te[1]+_e,Te[2]+_e)}}else{for(let ut=0;ut<Be;ut++){const _e=be[ut];kt(_e[2],_e[1],_e[0])}for(let ut=0;ut<Be;ut++){const _e=be[ut];kt(_e[0]+he*f,_e[1]+he*f,_e[2]+he*f)}}n.addGroup(oe,a.length/3-oe,0)}function At(){const oe=a.length/3;let ut=0;Zt(se,ut),ut+=se.length;for(let _e=0,it=ee.length;_e<it;_e++){const Te=ee[_e];Zt(Te,ut),ut+=Te.length}n.addGroup(oe,a.length/3-oe,1)}function Zt(oe,ut){let _e=oe.length;for(;--_e>=0;){const it=_e;let Te=_e-1;Te<0&&(Te=oe.length-1);for(let Et=0,Wt=f+R*2;Et<Wt;Et++){const O=he*Et,k=he*(Et+1),Ae=ut+it+O,Oe=ut+Te+O,$e=ut+Te+k,et=ut+it+k;$t(Ae,Oe,$e,et)}}}function Bt(oe,ut,_e){C.push(oe),C.push(ut),C.push(_e)}function kt(oe,ut,_e){Xt(oe),Xt(ut),Xt(_e);const it=a.length/3,Te=N.generateTopUV(n,a,it-3,it-2,it-1);Ot(Te[0]),Ot(Te[1]),Ot(Te[2])}function $t(oe,ut,_e,it){Xt(oe),Xt(ut),Xt(it),Xt(ut),Xt(_e),Xt(it);const Te=a.length/3,Et=N.generateSideWallUV(n,a,Te-6,Te-3,Te-2,Te-1);Ot(Et[0]),Ot(Et[1]),Ot(Et[3]),Ot(Et[1]),Ot(Et[2]),Ot(Et[3])}function Xt(oe){a.push(C[oe*3+0]),a.push(C[oe*3+1]),a.push(C[oe*3+2])}function Ot(oe){o.push(oe.x),o.push(oe.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return GD(t,n,e)}static fromJSON(e,t){const n=[];for(let o=0,c=e.shapes.length;o<c;o++){const I=t[e.shapes[o]];n.push(I)}const a=e.options.extrudePath;return a!==void 0&&(e.options.extrudePath=new mR[a.type]().fromJSON(a)),new TR(n,e.options)}}const yD={generateTopUV:function(r,e,t,n,a){const o=e[t*3],c=e[t*3+1],I=e[n*3],C=e[n*3+1],d=e[a*3],f=e[a*3+1];return[new lt(o,c),new lt(I,C),new lt(d,f)]},generateSideWallUV:function(r,e,t,n,a,o){const c=e[t*3],I=e[t*3+1],C=e[t*3+2],d=e[n*3],f=e[n*3+1],b=e[n*3+2],v=e[a*3],y=e[a*3+1],Z=e[a*3+2],V=e[o*3],R=e[o*3+1],S=e[o*3+2];return Math.abs(I-f)<Math.abs(c-d)?[new lt(c,1-C),new lt(d,1-b),new lt(v,1-Z),new lt(V,1-S)]:[new lt(I,1-C),new lt(f,1-b),new lt(y,1-Z),new lt(R,1-S)]}};function GD(r,e,t){if(t.shapes=[],Array.isArray(r))for(let n=0,a=r.length;n<a;n++){const o=r[n];t.shapes.push(o.uuid)}else t.shapes.push(r.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class zR extends oC{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,a=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(a,o,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new zR(e.radius,e.detail)}}class gG extends oC{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],a=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,a,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new gG(e.radius,e.detail)}}class LR extends Qn{constructor(e=.5,t=1,n=32,a=1,o=0,c=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:a,thetaStart:o,thetaLength:c},n=Math.max(3,n),a=Math.max(1,a);const I=[],C=[],d=[],f=[];let b=e;const v=(t-e)/a,y=new $,Z=new lt;for(let V=0;V<=a;V++){for(let R=0;R<=n;R++){const S=o+R/n*c;y.x=b*Math.cos(S),y.y=b*Math.sin(S),C.push(y.x,y.y,y.z),d.push(0,0,1),Z.x=(y.x/t+1)/2,Z.y=(y.y/t+1)/2,f.push(Z.x,Z.y)}b+=v}for(let V=0;V<a;V++){const R=V*(n+1);for(let S=0;S<n;S++){const N=S+R,w=N,X=N+n+1,H=N+n+2,F=N+1;I.push(w,X,F),I.push(X,H,F)}}this.setIndex(I),this.setAttribute("position",new cn(C,3)),this.setAttribute("normal",new cn(d,3)),this.setAttribute("uv",new cn(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new LR(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class _R extends Qn{constructor(e=new WA([new lt(0,.5),new lt(-.5,-.5),new lt(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],a=[],o=[],c=[];let I=0,C=0;if(Array.isArray(e)===!1)d(e);else for(let f=0;f<e.length;f++)d(e[f]),this.addGroup(I,C,f),I+=C,C=0;this.setIndex(n),this.setAttribute("position",new cn(a,3)),this.setAttribute("normal",new cn(o,3)),this.setAttribute("uv",new cn(c,2));function d(f){const b=a.length/3,v=f.extractPoints(t);let y=v.shape;const Z=v.holes;Ec.isClockWise(y)===!1&&(y=y.reverse());for(let R=0,S=Z.length;R<S;R++){const N=Z[R];Ec.isClockWise(N)===!0&&(Z[R]=N.reverse())}const V=Ec.triangulateShape(y,Z);for(let R=0,S=Z.length;R<S;R++){const N=Z[R];y=y.concat(N)}for(let R=0,S=y.length;R<S;R++){const N=y[R];a.push(N.x,N.y,0),o.push(0,0,1),c.push(N.x,N.y)}for(let R=0,S=V.length;R<S;R++){const N=V[R],w=N[0]+b,X=N[1]+b,H=N[2]+b;n.push(w,X,H),C+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return BD(t,e)}static fromJSON(e,t){const n=[];for(let a=0,o=e.shapes.length;a<o;a++){const c=t[e.shapes[a]];n.push(c)}return new _R(n,e.curveSegments)}}function BD(r,e){if(e.shapes=[],Array.isArray(r))for(let t=0,n=r.length;t<n;t++){const a=r[t];e.shapes.push(a.uuid)}else e.shapes.push(r.uuid);return e}class Ib extends Qn{constructor(e=1,t=32,n=16,a=0,o=Math.PI*2,c=0,I=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:a,phiLength:o,thetaStart:c,thetaLength:I},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const C=Math.min(c+I,Math.PI);let d=0;const f=[],b=new $,v=new $,y=[],Z=[],V=[],R=[];for(let S=0;S<=n;S++){const N=[],w=S/n;let X=0;S===0&&c===0?X=.5/t:S===n&&C===Math.PI&&(X=-.5/t);for(let H=0;H<=t;H++){const F=H/t;b.x=-e*Math.cos(a+F*o)*Math.sin(c+w*I),b.y=e*Math.cos(c+w*I),b.z=e*Math.sin(a+F*o)*Math.sin(c+w*I),Z.push(b.x,b.y,b.z),v.copy(b).normalize(),V.push(v.x,v.y,v.z),R.push(F+X,1-w),N.push(d++)}f.push(N)}for(let S=0;S<n;S++)for(let N=0;N<t;N++){const w=f[S][N+1],X=f[S][N],H=f[S+1][N],F=f[S+1][N+1];(S!==0||c>0)&&y.push(w,X,F),(S!==n-1||C<Math.PI)&&y.push(X,H,F)}this.setIndex(y),this.setAttribute("position",new cn(Z,3)),this.setAttribute("normal",new cn(V,3)),this.setAttribute("uv",new cn(R,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ib(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class kR extends oC{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],a=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,a,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new kR(e.radius,e.detail)}}class UR extends Qn{constructor(e=1,t=.4,n=12,a=48,o=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:a,arc:o},n=Math.floor(n),a=Math.floor(a);const c=[],I=[],C=[],d=[],f=new $,b=new $,v=new $;for(let y=0;y<=n;y++)for(let Z=0;Z<=a;Z++){const V=Z/a*o,R=y/n*Math.PI*2;b.x=(e+t*Math.cos(R))*Math.cos(V),b.y=(e+t*Math.cos(R))*Math.sin(V),b.z=t*Math.sin(R),I.push(b.x,b.y,b.z),f.x=e*Math.cos(V),f.y=e*Math.sin(V),v.subVectors(b,f).normalize(),C.push(v.x,v.y,v.z),d.push(Z/a),d.push(y/n)}for(let y=1;y<=n;y++)for(let Z=1;Z<=a;Z++){const V=(a+1)*y+Z-1,R=(a+1)*(y-1)+Z-1,S=(a+1)*(y-1)+Z,N=(a+1)*y+Z;c.push(V,R,N),c.push(R,S,N)}this.setIndex(c),this.setAttribute("position",new cn(I,3)),this.setAttribute("normal",new cn(C,3)),this.setAttribute("uv",new cn(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new UR(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class DR extends Qn{constructor(e=1,t=.4,n=64,a=8,o=2,c=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:a,p:o,q:c},n=Math.floor(n),a=Math.floor(a);const I=[],C=[],d=[],f=[],b=new $,v=new $,y=new $,Z=new $,V=new $,R=new $,S=new $;for(let w=0;w<=n;++w){const X=w/n*o*Math.PI*2;N(X,o,c,e,y),N(X+.01,o,c,e,Z),R.subVectors(Z,y),S.addVectors(Z,y),V.crossVectors(R,S),S.crossVectors(V,R),V.normalize(),S.normalize();for(let H=0;H<=a;++H){const F=H/a*Math.PI*2,_=-t*Math.cos(F),P=t*Math.sin(F);b.x=y.x+(_*S.x+P*V.x),b.y=y.y+(_*S.y+P*V.y),b.z=y.z+(_*S.z+P*V.z),C.push(b.x,b.y,b.z),v.subVectors(b,y).normalize(),d.push(v.x,v.y,v.z),f.push(w/n),f.push(H/a)}}for(let w=1;w<=n;w++)for(let X=1;X<=a;X++){const H=(a+1)*(w-1)+(X-1),F=(a+1)*w+(X-1),_=(a+1)*w+X,P=(a+1)*(w-1)+X;I.push(H,F,P),I.push(F,_,P)}this.setIndex(I),this.setAttribute("position",new cn(C,3)),this.setAttribute("normal",new cn(d,3)),this.setAttribute("uv",new cn(f,2));function N(w,X,H,F,_){const P=Math.cos(w),K=Math.sin(w),E=H/X*w,ee=Math.cos(E);_.x=F*(2+ee)*.5*P,_.y=F*(2+ee)*K*.5,_.z=F*Math.sin(E)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new DR(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class JR extends Qn{constructor(e=new y2(new $(-1,-1,0),new $(-1,1,0),new $(1,1,0)),t=64,n=1,a=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:a,closed:o};const c=e.computeFrenetFrames(t,o);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals;const I=new $,C=new $,d=new lt;let f=new $;const b=[],v=[],y=[],Z=[];V(),this.setIndex(Z),this.setAttribute("position",new cn(b,3)),this.setAttribute("normal",new cn(v,3)),this.setAttribute("uv",new cn(y,2));function V(){for(let w=0;w<t;w++)R(w);R(o===!1?t:0),N(),S()}function R(w){f=e.getPointAt(w/t,f);const X=c.normals[w],H=c.binormals[w];for(let F=0;F<=a;F++){const _=F/a*Math.PI*2,P=Math.sin(_),K=-Math.cos(_);C.x=K*X.x+P*H.x,C.y=K*X.y+P*H.y,C.z=K*X.z+P*H.z,C.normalize(),v.push(C.x,C.y,C.z),I.x=f.x+n*C.x,I.y=f.y+n*C.y,I.z=f.z+n*C.z,b.push(I.x,I.y,I.z)}}function S(){for(let w=1;w<=t;w++)for(let X=1;X<=a;X++){const H=(a+1)*(w-1)+(X-1),F=(a+1)*w+(X-1),_=(a+1)*w+X,P=(a+1)*(w-1)+X;Z.push(H,F,P),Z.push(F,_,P)}}function N(){for(let w=0;w<=t;w++)for(let X=0;X<=a;X++)d.x=w/t,d.y=X/a,y.push(d.x,d.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new JR(new mR[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class kK extends Qn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,a=new $,o=new $;if(e.index!==null){const c=e.attributes.position,I=e.index;let C=e.groups;C.length===0&&(C=[{start:0,count:I.count,materialIndex:0}]);for(let d=0,f=C.length;d<f;++d){const b=C[d],v=b.start,y=b.count;for(let Z=v,V=v+y;Z<V;Z+=3)for(let R=0;R<3;R++){const S=I.getX(Z+R),N=I.getX(Z+(R+1)%3);a.fromBufferAttribute(c,S),o.fromBufferAttribute(c,N),OM(a,o,n)===!0&&(t.push(a.x,a.y,a.z),t.push(o.x,o.y,o.z))}}}else{const c=e.attributes.position;for(let I=0,C=c.count/3;I<C;I++)for(let d=0;d<3;d++){const f=3*I+d,b=3*I+(d+1)%3;a.fromBufferAttribute(c,f),o.fromBufferAttribute(c,b),OM(a,o,n)===!0&&(t.push(a.x,a.y,a.z),t.push(o.x,o.y,o.z))}}this.setAttribute("position",new cn(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function OM(r,e,t){const n=`${r.x},${r.y},${r.z}-${e.x},${e.y},${e.z}`,a=`${e.x},${e.y},${e.z}-${r.x},${r.y},${r.z}`;return t.has(n)===!0||t.has(a)===!0?!1:(t.add(n),t.add(a),!0)}var PM=Object.freeze({__proto__:null,BoxGeometry:YA,CapsuleGeometry:MR,CircleGeometry:HR,ConeGeometry:FR,CylinderGeometry:ub,DodecahedronGeometry:KR,EdgesGeometry:TK,ExtrudeGeometry:TR,IcosahedronGeometry:zR,LatheGeometry:lG,OctahedronGeometry:gG,PlaneGeometry:rG,PolyhedronGeometry:oC,RingGeometry:LR,ShapeGeometry:_R,SphereGeometry:Ib,TetrahedronGeometry:kR,TorusGeometry:UR,TorusKnotGeometry:DR,TubeGeometry:JR,WireframeGeometry:kK});class UK extends Zo{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new an(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class DK extends zc{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class OR extends Zo{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new an(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new an(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=aC,this.normalScale=new lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class JK extends OR{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new lt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Wa(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new an(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new an(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new an(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class OK extends Zo{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new an(16777215),this.specular=new an(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new an(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=aC,this.normalScale=new lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=nG,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class PK extends Zo{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new an(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new an(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=aC,this.normalScale=new lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class QK extends Zo{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=aC,this.normalScale=new lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class jK extends Zo{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new an(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new an(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=aC,this.normalScale=new lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=nG,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class qK extends Zo{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new an(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=aC,this.normalScale=new lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class $K extends Oo{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function BA(r,e,t){return!r||!t&&r.constructor===e?r:typeof e.BYTES_PER_ELEMENT=="number"?new e(r):Array.prototype.slice.call(r)}function eE(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function tE(r){function e(a,o){return r[a]-r[o]}const t=r.length,n=new Array(t);for(let a=0;a!==t;++a)n[a]=a;return n.sort(e),n}function WN(r,e,t){const n=r.length,a=new r.constructor(n);for(let o=0,c=0;c!==n;++o){const I=t[o]*e;for(let C=0;C!==e;++C)a[c++]=r[I+C]}return a}function B2(r,e,t,n){let a=1,o=r[0];for(;o!==void 0&&o[n]===void 0;)o=r[a++];if(o===void 0)return;let c=o[n];if(c!==void 0)if(Array.isArray(c))do c=o[n],c!==void 0&&(e.push(o.time),t.push.apply(t,c)),o=r[a++];while(o!==void 0);else if(c.toArray!==void 0)do c=o[n],c!==void 0&&(e.push(o.time),c.toArray(t,t.length)),o=r[a++];while(o!==void 0);else do c=o[n],c!==void 0&&(e.push(o.time),t.push(c)),o=r[a++];while(o!==void 0)}function ZD(r,e,t,n,a=30){const o=r.clone();o.name=e;const c=[];for(let C=0;C<o.tracks.length;++C){const d=o.tracks[C],f=d.getValueSize(),b=[],v=[];for(let y=0;y<d.times.length;++y){const Z=d.times[y]*a;if(!(Z<t||Z>=n)){b.push(d.times[y]);for(let V=0;V<f;++V)v.push(d.values[y*f+V])}}b.length!==0&&(d.times=BA(b,d.times.constructor),d.values=BA(v,d.values.constructor),c.push(d))}o.tracks=c;let I=1/0;for(let C=0;C<o.tracks.length;++C)I>o.tracks[C].times[0]&&(I=o.tracks[C].times[0]);for(let C=0;C<o.tracks.length;++C)o.tracks[C].shift(-1*I);return o.resetDuration(),o}function SD(r,e=0,t=r,n=30){n<=0&&(n=30);const a=t.tracks.length,o=e/n;for(let c=0;c<a;++c){const I=t.tracks[c],C=I.ValueTypeName;if(C==="bool"||C==="string")continue;const d=r.tracks.find(function(S){return S.name===I.name&&S.ValueTypeName===C});if(d===void 0)continue;let f=0;const b=I.getValueSize();I.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=b/3);let v=0;const y=d.getValueSize();d.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(v=y/3);const Z=I.times.length-1;let V;if(o<=I.times[0]){const S=f,N=b-f;V=I.values.slice(S,N)}else if(o>=I.times[Z]){const S=Z*b+f,N=S+b-f;V=I.values.slice(S,N)}else{const S=I.createInterpolant(),N=f,w=b-f;S.evaluate(o),V=S.resultBuffer.slice(N,w)}C==="quaternion"&&new xs().fromArray(V).normalize().conjugate().toArray(V);const R=d.times.length;for(let S=0;S<R;++S){const N=S*y+v;if(C==="quaternion")xs.multiplyQuaternionsFlat(d.values,N,V,0,d.values,N);else{const w=y-v*2;for(let X=0;X<w;++X)d.values[N+X]-=V[X]}}}return r.blendMode=t2,r}const RD={convertArray:BA,isTypedArray:eE,getKeyframeOrder:tE,sortedArray:WN,flattenJSON:B2,subclip:ZD,makeClipAdditive:SD};class cG{constructor(e,t,n,a){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=a!==void 0?a:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,a=t[n],o=t[n-1];e:{t:{let c;n:{i:if(!(e<a)){for(let I=n+2;;){if(a===void 0){if(e<o)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===I)break;if(o=a,a=t[++n],e<a)break t}c=t.length;break n}if(!(e>=o)){const I=t[1];e<I&&(n=2,o=I);for(let C=n-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===C)break;if(a=o,o=t[--n-1],e>=o)break t}c=n,n=0;break n}break e}for(;n<c;){const I=n+c>>>1;e<t[I]?c=I:n=I+1}if(a=t[n],o=t[n-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(a===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,o,a)}return this.interpolate_(n,o,e,a)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=e*a;for(let c=0;c!==a;++c)t[c]=n[o+c];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class nE extends cG{constructor(e,t,n,a){super(e,t,n,a),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:vA,endingEnd:vA}}intervalChanged_(e,t,n){const a=this.parameterPositions;let o=e-2,c=e+1,I=a[o],C=a[c];if(I===void 0)switch(this.getSettings_().endingStart){case yA:o=e,I=2*t-n;break;case L0:o=a.length-2,I=t+a[o]-a[o+1];break;default:o=e,I=n}if(C===void 0)switch(this.getSettings_().endingEnd){case yA:c=e,C=2*n-t;break;case L0:c=1,C=n+a[1]-a[0];break;default:c=e-1,C=t}const d=(n-t)*.5,f=this.valueSize;this._weightPrev=d/(t-I),this._weightNext=d/(C-n),this._offsetPrev=o*f,this._offsetNext=c*f}interpolate_(e,t,n,a){const o=this.resultBuffer,c=this.sampleValues,I=this.valueSize,C=e*I,d=C-I,f=this._offsetPrev,b=this._offsetNext,v=this._weightPrev,y=this._weightNext,Z=(n-t)/(a-t),V=Z*Z,R=V*Z,S=-v*R+2*v*V-v*Z,N=(1+v)*R+(-1.5-2*v)*V+(-.5+v)*Z+1,w=(-1-y)*R+(1.5+y)*V+.5*Z,X=y*R-y*V;for(let H=0;H!==I;++H)o[H]=S*c[f+H]+N*c[d+H]+w*c[C+H]+X*c[b+H];return o}}class Z2 extends cG{constructor(e,t,n,a){super(e,t,n,a)}interpolate_(e,t,n,a){const o=this.resultBuffer,c=this.sampleValues,I=this.valueSize,C=e*I,d=C-I,f=(n-t)/(a-t),b=1-f;for(let v=0;v!==I;++v)o[v]=c[d+v]*b+c[C+v]*f;return o}}class iE extends cG{constructor(e,t,n,a){super(e,t,n,a)}interpolate_(e){return this.copySampleValue_(e-1)}}class zg{constructor(e,t,n,a){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=BA(t,this.TimeBufferType),this.values=BA(n,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:BA(e.times,Array),values:BA(e.values,Array)};const a=e.getInterpolation();a!==e.DefaultInterpolation&&(n.interpolation=a)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new iE(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Z2(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new nE(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case T0:t=this.InterpolantFactoryMethodDiscrete;break;case z0:t=this.InterpolantFactoryMethodLinear;break;case iR:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return T0;case this.InterpolantFactoryMethodLinear:return z0;case this.InterpolantFactoryMethodSmooth:return iR}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,a=t.length;n!==a;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,a=t.length;n!==a;++n)t[n]*=e}return this}trim(e,t){const n=this.times,a=n.length;let o=0,c=a-1;for(;o!==a&&n[o]<e;)++o;for(;c!==-1&&n[c]>t;)--c;if(++c,o!==0||c!==a){o>=c&&(c=Math.max(c,1),o=c-1);const I=this.getValueSize();this.times=n.slice(o,c),this.values=this.values.slice(o*I,c*I)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,a=this.values,o=n.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let c=null;for(let I=0;I!==o;I++){const C=n[I];if(typeof C=="number"&&isNaN(C)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,I,C),e=!1;break}if(c!==null&&c>C){console.error("THREE.KeyframeTrack: Out of order keys.",this,I,C,c),e=!1;break}c=C}if(a!==void 0&&eE(a))for(let I=0,C=a.length;I!==C;++I){const d=a[I];if(isNaN(d)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,I,d),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),a=this.getInterpolation()===iR,o=e.length-1;let c=1;for(let I=1;I<o;++I){let C=!1;const d=e[I],f=e[I+1];if(d!==f&&(I!==1||d!==e[0]))if(a)C=!0;else{const b=I*n,v=b-n,y=b+n;for(let Z=0;Z!==n;++Z){const V=t[b+Z];if(V!==t[v+Z]||V!==t[y+Z]){C=!0;break}}}if(C){if(I!==c){e[c]=e[I];const b=I*n,v=c*n;for(let y=0;y!==n;++y)t[v+y]=t[b+y]}++c}}if(o>0){e[c]=e[o];for(let I=o*n,C=c*n,d=0;d!==n;++d)t[C+d]=t[I+d];++c}return c!==e.length?(this.times=e.slice(0,c),this.values=t.slice(0,c*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,a=new n(this.name,e,t);return a.createInterpolant=this.createInterpolant,a}}zg.prototype.TimeBufferType=Float32Array;zg.prototype.ValueBufferType=Float32Array;zg.prototype.DefaultInterpolation=z0;class MA extends zg{}MA.prototype.ValueTypeName="bool";MA.prototype.ValueBufferType=Array;MA.prototype.DefaultInterpolation=T0;MA.prototype.InterpolantFactoryMethodLinear=void 0;MA.prototype.InterpolantFactoryMethodSmooth=void 0;class S2 extends zg{}S2.prototype.ValueTypeName="color";class q0 extends zg{}q0.prototype.ValueTypeName="number";class aE extends cG{constructor(e,t,n,a){super(e,t,n,a)}interpolate_(e,t,n,a){const o=this.resultBuffer,c=this.sampleValues,I=this.valueSize,C=(n-t)/(a-t);let d=e*I;for(let f=d+I;d!==f;d+=4)xs.slerpFlat(o,0,c,d-I,c,d,C);return o}}class db extends zg{InterpolantFactoryMethodLinear(e){return new aE(this.times,this.values,this.getValueSize(),e)}}db.prototype.ValueTypeName="quaternion";db.prototype.DefaultInterpolation=z0;db.prototype.InterpolantFactoryMethodSmooth=void 0;class HA extends zg{}HA.prototype.ValueTypeName="string";HA.prototype.ValueBufferType=Array;HA.prototype.DefaultInterpolation=T0;HA.prototype.InterpolantFactoryMethodLinear=void 0;HA.prototype.InterpolantFactoryMethodSmooth=void 0;class $0 extends zg{}$0.prototype.ValueTypeName="vector";class eG{constructor(e,t=-1,n,a=ZR){this.name=e,this.tracks=n,this.duration=t,this.blendMode=a,this.uuid=sl(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,a=1/(e.fps||1);for(let c=0,I=n.length;c!==I;++c)t.push(WD(n[c]).scale(a));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],n=e.tracks,a={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,c=n.length;o!==c;++o)t.push(zg.toJSON(n[o]));return a}static CreateFromMorphTargetSequence(e,t,n,a){const o=t.length,c=[];for(let I=0;I<o;I++){let C=[],d=[];C.push((I+o-1)%o,I,(I+1)%o),d.push(0,1,0);const f=tE(C);C=WN(C,1,f),d=WN(d,1,f),!a&&C[0]===0&&(C.push(o),d.push(d[0])),c.push(new q0(".morphTargetInfluences["+t[I].name+"]",C,d).scale(1/n))}return new this(e,-1,c)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const a=e;n=a.geometry&&a.geometry.animations||a.animations}for(let a=0;a<n.length;a++)if(n[a].name===t)return n[a];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const a={},o=/^([\w-]*?)([\d]+)$/;for(let I=0,C=e.length;I<C;I++){const d=e[I],f=d.name.match(o);if(f&&f.length>1){const b=f[1];let v=a[b];v||(a[b]=v=[]),v.push(d)}}const c=[];for(const I in a)c.push(this.CreateFromMorphTargetSequence(I,a[I],t,n));return c}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(b,v,y,Z,V){if(y.length!==0){const R=[],S=[];B2(y,R,S,Z),R.length!==0&&V.push(new b(v,R,S))}},a=[],o=e.name||"default",c=e.fps||30,I=e.blendMode;let C=e.length||-1;const d=e.hierarchy||[];for(let b=0;b<d.length;b++){const v=d[b].keys;if(!(!v||v.length===0))if(v[0].morphTargets){const y={};let Z;for(Z=0;Z<v.length;Z++)if(v[Z].morphTargets)for(let V=0;V<v[Z].morphTargets.length;V++)y[v[Z].morphTargets[V]]=-1;for(const V in y){const R=[],S=[];for(let N=0;N!==v[Z].morphTargets.length;++N){const w=v[Z];R.push(w.time),S.push(w.morphTarget===V?1:0)}a.push(new q0(".morphTargetInfluence["+V+"]",R,S))}C=y.length*c}else{const y=".bones["+t[b].name+"]";n($0,y+".position",v,"pos",a),n(db,y+".quaternion",v,"rot",a),n($0,y+".scale",v,"scl",a)}}return a.length===0?null:new this(o,C,a,I)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,a=e.length;n!==a;++n){const o=this.tracks[n];t=Math.max(t,o.times[o.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function wD(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return q0;case"vector":case"vector2":case"vector3":case"vector4":return $0;case"color":return S2;case"quaternion":return db;case"bool":case"boolean":return MA;case"string":return HA}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function WD(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=wD(r.type);if(r.times===void 0){const t=[],n=[];B2(r.keys,t,n,"value"),r.times=t,r.values=n}return e.parse!==void 0?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}const dI={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class R2{constructor(e,t,n){const a=this;let o=!1,c=0,I=0,C;const d=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(f){I++,o===!1&&a.onStart!==void 0&&a.onStart(f,c,I),o=!0},this.itemEnd=function(f){c++,a.onProgress!==void 0&&a.onProgress(f,c,I),c===I&&(o=!1,a.onLoad!==void 0&&a.onLoad())},this.itemError=function(f){a.onError!==void 0&&a.onError(f)},this.resolveURL=function(f){return C?C(f):f},this.setURLModifier=function(f){return C=f,this},this.addHandler=function(f,b){return d.push(f,b),this},this.removeHandler=function(f){const b=d.indexOf(f);return b!==-1&&d.splice(b,2),this},this.getHandler=function(f){for(let b=0,v=d.length;b<v;b+=2){const y=d[b],Z=d[b+1];if(y.global&&(y.lastIndex=0),y.test(f))return Z}return null}}}const sE=new R2;class Sr{constructor(e){this.manager=e!==void 0?e:sE,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(a,o){n.load(e,a,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Sr.DEFAULT_MATERIAL_NAME="__DEFAULT";const lI={};class xD extends Error{constructor(e,t){super(e),this.response=t}}class mI extends Sr{constructor(e){super(e)}load(e,t,n,a){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=dI.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(lI[e]!==void 0){lI[e].push({onLoad:t,onProgress:n,onError:a});return}lI[e]=[],lI[e].push({onLoad:t,onProgress:n,onError:a});const c=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),I=this.mimeType,C=this.responseType;fetch(c).then(d=>{if(d.status===200||d.status===0){if(d.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||d.body===void 0||d.body.getReader===void 0)return d;const f=lI[e],b=d.body.getReader(),v=d.headers.get("Content-Length")||d.headers.get("X-File-Size"),y=v?parseInt(v):0,Z=y!==0;let V=0;const R=new ReadableStream({start(S){N();function N(){b.read().then(({done:w,value:X})=>{if(w)S.close();else{V+=X.byteLength;const H=new ProgressEvent("progress",{lengthComputable:Z,loaded:V,total:y});for(let F=0,_=f.length;F<_;F++){const P=f[F];P.onProgress&&P.onProgress(H)}S.enqueue(X),N()}})}}});return new Response(R)}else throw new xD(`fetch for "${d.url}" responded with ${d.status}: ${d.statusText}`,d)}).then(d=>{switch(C){case"arraybuffer":return d.arrayBuffer();case"blob":return d.blob();case"document":return d.text().then(f=>new DOMParser().parseFromString(f,I));case"json":return d.json();default:if(I===void 0)return d.text();{const b=/charset="?([^;"\s]*)"?/i.exec(I),v=b&&b[1]?b[1].toLowerCase():void 0,y=new TextDecoder(v);return d.arrayBuffer().then(Z=>y.decode(Z))}}}).then(d=>{dI.add(e,d);const f=lI[e];delete lI[e];for(let b=0,v=f.length;b<v;b++){const y=f[b];y.onLoad&&y.onLoad(d)}}).catch(d=>{const f=lI[e];if(f===void 0)throw this.manager.itemError(e),d;delete lI[e];for(let b=0,v=f.length;b<v;b++){const y=f[b];y.onError&&y.onError(d)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class VD extends Sr{constructor(e){super(e)}load(e,t,n,a){const o=this,c=new mI(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(I){try{t(o.parse(JSON.parse(I)))}catch(C){a?a(C):console.error(C),o.manager.itemError(e)}},n,a)}parse(e){const t=[];for(let n=0;n<e.length;n++){const a=eG.parse(e[n]);t.push(a)}return t}}class ND extends Sr{constructor(e){super(e)}load(e,t,n,a){const o=this,c=[],I=new XR,C=new mI(this.manager);C.setPath(this.path),C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setWithCredentials(o.withCredentials);let d=0;function f(b){C.load(e[b],function(v){const y=o.parse(v,!0);c[b]={width:y.width,height:y.height,format:y.format,mipmaps:y.mipmaps},d+=1,d===6&&(y.mipmapCount===1&&(I.minFilter=Ka),I.image=c,I.format=y.format,I.needsUpdate=!0,t&&t(I))},n,a)}if(Array.isArray(e))for(let b=0,v=e.length;b<v;++b)f(b);else C.load(e,function(b){const v=o.parse(b,!0);if(v.isCubemap){const y=v.mipmaps.length/v.mipmapCount;for(let Z=0;Z<y;Z++){c[Z]={mipmaps:[]};for(let V=0;V<v.mipmapCount;V++)c[Z].mipmaps.push(v.mipmaps[Z*v.mipmapCount+V]),c[Z].format=v.format,c[Z].width=v.width,c[Z].height=v.height}I.image=c}else I.image.width=v.width,I.image.height=v.height,I.mipmaps=v.mipmaps;v.mipmapCount===1&&(I.minFilter=Ka),I.format=v.format,I.needsUpdate=!0,t&&t(I)},n,a);return I}}class tG extends Sr{constructor(e){super(e)}load(e,t,n,a){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,c=dI.get(e);if(c!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(c),o.manager.itemEnd(e)},0),c;const I=J0("img");function C(){f(),dI.add(e,this),t&&t(this),o.manager.itemEnd(e)}function d(b){f(),a&&a(b),o.manager.itemError(e),o.manager.itemEnd(e)}function f(){I.removeEventListener("load",C,!1),I.removeEventListener("error",d,!1)}return I.addEventListener("load",C,!1),I.addEventListener("error",d,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(I.crossOrigin=this.crossOrigin),o.manager.itemStart(e),I.src=e,I}}class XD extends Sr{constructor(e){super(e)}load(e,t,n,a){const o=new sG;o.colorSpace=As;const c=new tG(this.manager);c.setCrossOrigin(this.crossOrigin),c.setPath(this.path);let I=0;function C(d){c.load(e[d],function(f){o.images[d]=f,I++,I===6&&(o.needsUpdate=!0,t&&t(o))},void 0,a)}for(let d=0;d<e.length;++d)C(d);return o}}class YD extends Sr{constructor(e){super(e)}load(e,t,n,a){const o=this,c=new wA,I=new mI(this.manager);return I.setResponseType("arraybuffer"),I.setRequestHeader(this.requestHeader),I.setPath(this.path),I.setWithCredentials(o.withCredentials),I.load(e,function(C){let d;try{d=o.parse(C)}catch(f){if(a!==void 0)a(f);else{console.error(f);return}}d.image!==void 0?c.image=d.image:d.data!==void 0&&(c.image.width=d.width,c.image.height=d.height,c.image.data=d.data),c.wrapS=d.wrapS!==void 0?d.wrapS:Go,c.wrapT=d.wrapT!==void 0?d.wrapT:Go,c.magFilter=d.magFilter!==void 0?d.magFilter:Ka,c.minFilter=d.minFilter!==void 0?d.minFilter:Ka,c.anisotropy=d.anisotropy!==void 0?d.anisotropy:1,d.colorSpace!==void 0?c.colorSpace=d.colorSpace:d.encoding!==void 0&&(c.encoding=d.encoding),d.flipY!==void 0&&(c.flipY=d.flipY),d.format!==void 0&&(c.format=d.format),d.type!==void 0&&(c.type=d.type),d.mipmaps!==void 0&&(c.mipmaps=d.mipmaps,c.minFilter=nC),d.mipmapCount===1&&(c.minFilter=Ka),d.generateMipmaps!==void 0&&(c.generateMipmaps=d.generateMipmaps),c.needsUpdate=!0,t&&t(c,d)},n,a),c}}class MD extends Sr{constructor(e){super(e)}load(e,t,n,a){const o=new Ta,c=new tG(this.manager);return c.setCrossOrigin(this.crossOrigin),c.setPath(this.path),c.load(e,function(I){o.image=I,o.needsUpdate=!0,t!==void 0&&t(o)},n,a),o}}class rC extends Ai{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new an(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class oE extends rC{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ai.DEFAULT_UP),this.updateMatrix(),this.groundColor=new an(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const vV=new Nn,QM=new $,jM=new $;class w2{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new lt(512,512),this.map=null,this.mapPass=null,this.matrix=new Nn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new oG,this._frameExtents=new lt(1,1),this._viewportCount=1,this._viewports=[new Xi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;QM.setFromMatrixPosition(e.matrixWorld),t.position.copy(QM),jM.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(jM),t.updateMatrixWorld(),vV.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(vV),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(vV)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class HD extends w2{constructor(){super(new Ea(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=ab*2*e.angle*this.focus,a=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(n!==t.fov||a!==t.aspect||o!==t.far)&&(t.fov=n,t.aspect=a,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class rE extends rC{constructor(e,t,n=0,a=Math.PI/3,o=0,c=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ai.DEFAULT_UP),this.updateMatrix(),this.target=new Ai,this.distance=n,this.angle=a,this.penumbra=o,this.decay=c,this.map=null,this.shadow=new HD}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const qM=new Nn,m0=new $,yV=new $;class FD extends w2{constructor(){super(new Ea(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new lt(4,2),this._viewportCount=6,this._viewports=[new Xi(2,1,1,1),new Xi(0,1,1,1),new Xi(3,1,1,1),new Xi(1,1,1,1),new Xi(3,0,1,1),new Xi(1,0,1,1)],this._cubeDirections=[new $(1,0,0),new $(-1,0,0),new $(0,0,1),new $(0,0,-1),new $(0,1,0),new $(0,-1,0)],this._cubeUps=[new $(0,1,0),new $(0,1,0),new $(0,1,0),new $(0,1,0),new $(0,0,1),new $(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,a=this.matrix,o=e.distance||n.far;o!==n.far&&(n.far=o,n.updateProjectionMatrix()),m0.setFromMatrixPosition(e.matrixWorld),n.position.copy(m0),yV.copy(n.position),yV.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(yV),n.updateMatrixWorld(),a.makeTranslation(-m0.x,-m0.y,-m0.z),qM.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(qM)}}class lE extends rC{constructor(e,t,n=0,a=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=a,this.shadow=new FD}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class KD extends w2{constructor(){super(new $d(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class gE extends rC{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ai.DEFAULT_UP),this.updateMatrix(),this.target=new Ai,this.shadow=new KD}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class cE extends rC{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class uE extends rC{constructor(e,t,n=10,a=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=a}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class IE{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new $)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,a=e.y,o=e.z,c=this.coefficients;return t.copy(c[0]).multiplyScalar(.282095),t.addScaledVector(c[1],.488603*a),t.addScaledVector(c[2],.488603*o),t.addScaledVector(c[3],.488603*n),t.addScaledVector(c[4],1.092548*(n*a)),t.addScaledVector(c[5],1.092548*(a*o)),t.addScaledVector(c[6],.315392*(3*o*o-1)),t.addScaledVector(c[7],1.092548*(n*o)),t.addScaledVector(c[8],.546274*(n*n-a*a)),t}getIrradianceAt(e,t){const n=e.x,a=e.y,o=e.z,c=this.coefficients;return t.copy(c[0]).multiplyScalar(.886227),t.addScaledVector(c[1],2*.511664*a),t.addScaledVector(c[2],2*.511664*o),t.addScaledVector(c[3],2*.511664*n),t.addScaledVector(c[4],2*.429043*n*a),t.addScaledVector(c[5],2*.429043*a*o),t.addScaledVector(c[6],.743125*o*o-.247708),t.addScaledVector(c[7],2*.429043*n*o),t.addScaledVector(c[8],.429043*(n*n-a*a)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let a=0;a<9;a++)n[a].fromArray(e,t+a*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let a=0;a<9;a++)n[a].toArray(e,t+a*3);return e}static getBasisAt(e,t){const n=e.x,a=e.y,o=e.z;t[0]=.282095,t[1]=.488603*a,t[2]=.488603*o,t[3]=.488603*n,t[4]=1.092548*n*a,t[5]=1.092548*a*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*n*o,t[8]=.546274*(n*n-a*a)}}class dE extends rC{constructor(e=new IE,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class PR extends Sr{constructor(e){super(e),this.textures={}}load(e,t,n,a){const o=this,c=new mI(o.manager);c.setPath(o.path),c.setRequestHeader(o.requestHeader),c.setWithCredentials(o.withCredentials),c.load(e,function(I){try{t(o.parse(JSON.parse(I)))}catch(C){a?a(C):console.error(C),o.manager.itemError(e)}},n,a)}parse(e){const t=this.textures;function n(o){return t[o]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",o),t[o]}const a=PR.createMaterialFromType(e.type);if(e.uuid!==void 0&&(a.uuid=e.uuid),e.name!==void 0&&(a.name=e.name),e.color!==void 0&&a.color!==void 0&&a.color.setHex(e.color),e.roughness!==void 0&&(a.roughness=e.roughness),e.metalness!==void 0&&(a.metalness=e.metalness),e.sheen!==void 0&&(a.sheen=e.sheen),e.sheenColor!==void 0&&(a.sheenColor=new an().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(a.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&a.emissive!==void 0&&a.emissive.setHex(e.emissive),e.specular!==void 0&&a.specular!==void 0&&a.specular.setHex(e.specular),e.specularIntensity!==void 0&&(a.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&a.specularColor!==void 0&&a.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(a.shininess=e.shininess),e.clearcoat!==void 0&&(a.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(a.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(a.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(a.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(a.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(a.transmission=e.transmission),e.thickness!==void 0&&(a.thickness=e.thickness),e.attenuationDistance!==void 0&&(a.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&a.attenuationColor!==void 0&&a.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(a.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(a.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(a.fog=e.fog),e.flatShading!==void 0&&(a.flatShading=e.flatShading),e.blending!==void 0&&(a.blending=e.blending),e.combine!==void 0&&(a.combine=e.combine),e.side!==void 0&&(a.side=e.side),e.shadowSide!==void 0&&(a.shadowSide=e.shadowSide),e.opacity!==void 0&&(a.opacity=e.opacity),e.transparent!==void 0&&(a.transparent=e.transparent),e.alphaTest!==void 0&&(a.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(a.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(a.depthFunc=e.depthFunc),e.depthTest!==void 0&&(a.depthTest=e.depthTest),e.depthWrite!==void 0&&(a.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(a.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(a.blendSrc=e.blendSrc),e.blendDst!==void 0&&(a.blendDst=e.blendDst),e.blendEquation!==void 0&&(a.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(a.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(a.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(a.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&a.blendColor!==void 0&&a.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(a.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(a.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(a.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(a.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(a.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(a.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(a.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(a.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(a.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(a.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(a.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(a.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(a.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(a.rotation=e.rotation),e.linewidth!==void 0&&(a.linewidth=e.linewidth),e.dashSize!==void 0&&(a.dashSize=e.dashSize),e.gapSize!==void 0&&(a.gapSize=e.gapSize),e.scale!==void 0&&(a.scale=e.scale),e.polygonOffset!==void 0&&(a.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(a.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(a.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(a.dithering=e.dithering),e.alphaToCoverage!==void 0&&(a.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(a.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(a.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(a.visible=e.visible),e.toneMapped!==void 0&&(a.toneMapped=e.toneMapped),e.userData!==void 0&&(a.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?a.vertexColors=e.vertexColors>0:a.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const o in e.uniforms){const c=e.uniforms[o];switch(a.uniforms[o]={},c.type){case"t":a.uniforms[o].value=n(c.value);break;case"c":a.uniforms[o].value=new an().setHex(c.value);break;case"v2":a.uniforms[o].value=new lt().fromArray(c.value);break;case"v3":a.uniforms[o].value=new $().fromArray(c.value);break;case"v4":a.uniforms[o].value=new Xi().fromArray(c.value);break;case"m3":a.uniforms[o].value=new Pn().fromArray(c.value);break;case"m4":a.uniforms[o].value=new Nn().fromArray(c.value);break;default:a.uniforms[o].value=c.value}}if(e.defines!==void 0&&(a.defines=e.defines),e.vertexShader!==void 0&&(a.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(a.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(a.glslVersion=e.glslVersion),e.extensions!==void 0)for(const o in e.extensions)a.extensions[o]=e.extensions[o];if(e.lights!==void 0&&(a.lights=e.lights),e.clipping!==void 0&&(a.clipping=e.clipping),e.size!==void 0&&(a.size=e.size),e.sizeAttenuation!==void 0&&(a.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(a.map=n(e.map)),e.matcap!==void 0&&(a.matcap=n(e.matcap)),e.alphaMap!==void 0&&(a.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(a.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(a.bumpScale=e.bumpScale),e.normalMap!==void 0&&(a.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(a.normalMapType=e.normalMapType),e.normalScale!==void 0){let o=e.normalScale;Array.isArray(o)===!1&&(o=[o,o]),a.normalScale=new lt().fromArray(o)}return e.displacementMap!==void 0&&(a.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(a.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(a.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(a.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(a.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(a.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(a.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(a.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(a.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(a.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(a.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(a.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(a.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(a.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(a.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(a.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(a.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(a.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(a.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(a.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(a.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(a.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(a.clearcoatNormalScale=new lt().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(a.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(a.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(a.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(a.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(a.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(a.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(a.sheenRoughnessMap=n(e.sheenRoughnessMap)),a}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:UK,SpriteMaterial:h2,RawShaderMaterial:DK,ShaderMaterial:zc,PointsMaterial:f2,MeshPhysicalMaterial:JK,MeshStandardMaterial:OR,MeshPhongMaterial:OK,MeshToonMaterial:PK,MeshNormalMaterial:QK,MeshLambertMaterial:jK,MeshDepthMaterial:u2,MeshDistanceMaterial:I2,MeshBasicMaterial:sC,MeshMatcapMaterial:qK,LineDashedMaterial:$K,LineBasicMaterial:Oo,Material:Zo};return new t[e]}}class xN{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class CE extends Qn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class hE extends Sr{constructor(e){super(e)}load(e,t,n,a){const o=this,c=new mI(o.manager);c.setPath(o.path),c.setRequestHeader(o.requestHeader),c.setWithCredentials(o.withCredentials),c.load(e,function(I){try{t(o.parse(JSON.parse(I)))}catch(C){a?a(C):console.error(C),o.manager.itemError(e)}},n,a)}parse(e){const t={},n={};function a(y,Z){if(t[Z]!==void 0)return t[Z];const R=y.interleavedBuffers[Z],S=o(y,R.buffer),N=Dm(R.type,S),w=new VR(N,R.stride);return w.uuid=R.uuid,t[Z]=w,w}function o(y,Z){if(n[Z]!==void 0)return n[Z];const R=y.arrayBuffers[Z],S=new Uint32Array(R).buffer;return n[Z]=S,S}const c=e.isInstancedBufferGeometry?new CE:new Qn,I=e.data.index;if(I!==void 0){const y=Dm(I.type,I.array);c.setIndex(new Yi(y,1))}const C=e.data.attributes;for(const y in C){const Z=C[y];let V;if(Z.isInterleavedBufferAttribute){const R=a(e.data,Z.data);V=new VA(R,Z.itemSize,Z.offset,Z.normalized)}else{const R=Dm(Z.type,Z.array),S=Z.isInstancedBufferAttribute?ob:Yi;V=new S(R,Z.itemSize,Z.normalized)}Z.name!==void 0&&(V.name=Z.name),Z.usage!==void 0&&V.setUsage(Z.usage),c.setAttribute(y,V)}const d=e.data.morphAttributes;if(d)for(const y in d){const Z=d[y],V=[];for(let R=0,S=Z.length;R<S;R++){const N=Z[R];let w;if(N.isInterleavedBufferAttribute){const X=a(e.data,N.data);w=new VA(X,N.itemSize,N.offset,N.normalized)}else{const X=Dm(N.type,N.array);w=new Yi(X,N.itemSize,N.normalized)}N.name!==void 0&&(w.name=N.name),V.push(w)}c.morphAttributes[y]=V}e.data.morphTargetsRelative&&(c.morphTargetsRelative=!0);const b=e.data.groups||e.data.drawcalls||e.data.offsets;if(b!==void 0)for(let y=0,Z=b.length;y!==Z;++y){const V=b[y];c.addGroup(V.start,V.count,V.materialIndex)}const v=e.data.boundingSphere;if(v!==void 0){const y=new $;v.center!==void 0&&y.fromArray(v.center),c.boundingSphere=new Bo(y,v.radius)}return e.name&&(c.name=e.name),e.userData&&(c.userData=e.userData),c}}class ED extends Sr{constructor(e){super(e)}load(e,t,n,a){const o=this,c=this.path===""?xN.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||c;const I=new mI(this.manager);I.setPath(this.path),I.setRequestHeader(this.requestHeader),I.setWithCredentials(this.withCredentials),I.load(e,function(C){let d=null;try{d=JSON.parse(C)}catch(b){a!==void 0&&a(b),console.error("THREE:ObjectLoader: Can't parse "+e+".",b.message);return}const f=d.metadata;if(f===void 0||f.type===void 0||f.type.toLowerCase()==="geometry"){a!==void 0&&a(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}o.parse(d,t)},n,a)}async loadAsync(e,t){const n=this,a=this.path===""?xN.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new mI(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials);const c=await o.loadAsync(e,t),I=JSON.parse(c),C=I.metadata;if(C===void 0||C.type===void 0||C.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(I)}parse(e,t){const n=this.parseAnimations(e.animations),a=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,a),c=this.parseImages(e.images,function(){t!==void 0&&t(d)}),I=this.parseTextures(e.textures,c),C=this.parseMaterials(e.materials,I),d=this.parseObject(e.object,o,C,I,n),f=this.parseSkeletons(e.skeletons,d);if(this.bindSkeletons(d,f),t!==void 0){let b=!1;for(const v in c)if(c[v].data instanceof HTMLImageElement){b=!0;break}b===!1&&t(d)}return d}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),a=this.parseGeometries(e.geometries,n),o=await this.parseImagesAsync(e.images),c=this.parseTextures(e.textures,o),I=this.parseMaterials(e.materials,c),C=this.parseObject(e.object,a,I,c,t),d=this.parseSkeletons(e.skeletons,C);return this.bindSkeletons(C,d),C}parseShapes(e){const t={};if(e!==void 0)for(let n=0,a=e.length;n<a;n++){const o=new WA().fromJSON(e[n]);t[o.uuid]=o}return t}parseSkeletons(e,t){const n={},a={};if(t.traverse(function(o){o.isBone&&(a[o.uuid]=o)}),e!==void 0)for(let o=0,c=e.length;o<c;o++){const I=new NR().fromJSON(e[o],a);n[I.uuid]=I}return n}parseGeometries(e,t){const n={};if(e!==void 0){const a=new hE;for(let o=0,c=e.length;o<c;o++){let I;const C=e[o];switch(C.type){case"BufferGeometry":case"InstancedBufferGeometry":I=a.parse(C);break;default:C.type in PM?I=PM[C.type].fromJSON(C,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${C.type}"`)}I.uuid=C.uuid,C.name!==void 0&&(I.name=C.name),C.userData!==void 0&&(I.userData=C.userData),n[C.uuid]=I}}return n}parseMaterials(e,t){const n={},a={};if(e!==void 0){const o=new PR;o.setTextures(t);for(let c=0,I=e.length;c<I;c++){const C=e[c];n[C.uuid]===void 0&&(n[C.uuid]=o.parse(C)),a[C.uuid]=n[C.uuid]}}return a}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const a=e[n],o=eG.parse(a);t[o.uuid]=o}return t}parseImages(e,t){const n=this,a={};let o;function c(C){return n.manager.itemStart(C),o.load(C,function(){n.manager.itemEnd(C)},void 0,function(){n.manager.itemError(C),n.manager.itemEnd(C)})}function I(C){if(typeof C=="string"){const d=C,f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:n.resourcePath+d;return c(f)}else return C.data?{data:Dm(C.type,C.data),width:C.width,height:C.height}:null}if(e!==void 0&&e.length>0){const C=new R2(t);o=new tG(C),o.setCrossOrigin(this.crossOrigin);for(let d=0,f=e.length;d<f;d++){const b=e[d],v=b.url;if(Array.isArray(v)){const y=[];for(let Z=0,V=v.length;Z<V;Z++){const R=v[Z],S=I(R);S!==null&&(S instanceof HTMLImageElement?y.push(S):y.push(new wA(S.data,S.width,S.height)))}a[b.uuid]=new GA(y)}else{const y=I(b.url);a[b.uuid]=new GA(y)}}}return a}async parseImagesAsync(e){const t=this,n={};let a;async function o(c){if(typeof c=="string"){const I=c,C=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(I)?I:t.resourcePath+I;return await a.loadAsync(C)}else return c.data?{data:Dm(c.type,c.data),width:c.width,height:c.height}:null}if(e!==void 0&&e.length>0){a=new tG(this.manager),a.setCrossOrigin(this.crossOrigin);for(let c=0,I=e.length;c<I;c++){const C=e[c],d=C.url;if(Array.isArray(d)){const f=[];for(let b=0,v=d.length;b<v;b++){const y=d[b],Z=await o(y);Z!==null&&(Z instanceof HTMLImageElement?f.push(Z):f.push(new wA(Z.data,Z.width,Z.height)))}n[C.uuid]=new GA(f)}else{const f=await o(C.url);n[C.uuid]=new GA(f)}}}return n}parseTextures(e,t){function n(o,c){return typeof o=="number"?o:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",o),c[o])}const a={};if(e!==void 0)for(let o=0,c=e.length;o<c;o++){const I=e[o];I.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',I.uuid),t[I.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",I.image);const C=t[I.image],d=C.data;let f;Array.isArray(d)?(f=new sG,d.length===6&&(f.needsUpdate=!0)):(d&&d.data?f=new wA:f=new Ta,d&&(f.needsUpdate=!0)),f.source=C,f.uuid=I.uuid,I.name!==void 0&&(f.name=I.name),I.mapping!==void 0&&(f.mapping=n(I.mapping,TD)),I.channel!==void 0&&(f.channel=I.channel),I.offset!==void 0&&f.offset.fromArray(I.offset),I.repeat!==void 0&&f.repeat.fromArray(I.repeat),I.center!==void 0&&f.center.fromArray(I.center),I.rotation!==void 0&&(f.rotation=I.rotation),I.wrap!==void 0&&(f.wrapS=n(I.wrap[0],$M),f.wrapT=n(I.wrap[1],$M)),I.format!==void 0&&(f.format=I.format),I.internalFormat!==void 0&&(f.internalFormat=I.internalFormat),I.type!==void 0&&(f.type=I.type),I.colorSpace!==void 0&&(f.colorSpace=I.colorSpace),I.encoding!==void 0&&(f.encoding=I.encoding),I.minFilter!==void 0&&(f.minFilter=n(I.minFilter,eH)),I.magFilter!==void 0&&(f.magFilter=n(I.magFilter,eH)),I.anisotropy!==void 0&&(f.anisotropy=I.anisotropy),I.flipY!==void 0&&(f.flipY=I.flipY),I.generateMipmaps!==void 0&&(f.generateMipmaps=I.generateMipmaps),I.premultiplyAlpha!==void 0&&(f.premultiplyAlpha=I.premultiplyAlpha),I.unpackAlignment!==void 0&&(f.unpackAlignment=I.unpackAlignment),I.compareFunction!==void 0&&(f.compareFunction=I.compareFunction),I.userData!==void 0&&(f.userData=I.userData),a[I.uuid]=f}return a}parseObject(e,t,n,a,o){let c;function I(v){return t[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",v),t[v]}function C(v){if(v!==void 0){if(Array.isArray(v)){const y=[];for(let Z=0,V=v.length;Z<V;Z++){const R=v[Z];n[R]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",R),y.push(n[R])}return y}return n[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",v),n[v]}}function d(v){return a[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",v),a[v]}let f,b;switch(e.type){case"Scene":c=new C2,e.background!==void 0&&(Number.isInteger(e.background)?c.background=new an(e.background):c.background=d(e.background)),e.environment!==void 0&&(c.environment=d(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?c.fog=new xR(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(c.fog=new WR(e.fog.color,e.fog.density)),e.fog.name!==""&&(c.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(c.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(c.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":c=new Ea(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(c.focus=e.focus),e.zoom!==void 0&&(c.zoom=e.zoom),e.filmGauge!==void 0&&(c.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(c.filmOffset=e.filmOffset),e.view!==void 0&&(c.view=Object.assign({},e.view));break;case"OrthographicCamera":c=new $d(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(c.zoom=e.zoom),e.view!==void 0&&(c.view=Object.assign({},e.view));break;case"AmbientLight":c=new cE(e.color,e.intensity);break;case"DirectionalLight":c=new gE(e.color,e.intensity);break;case"PointLight":c=new lE(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":c=new uE(e.color,e.intensity,e.width,e.height);break;case"SpotLight":c=new rE(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":c=new oE(e.color,e.groundColor,e.intensity);break;case"LightProbe":c=new dE().fromJSON(e);break;case"SkinnedMesh":f=I(e.geometry),b=C(e.material),c=new VK(f,b),e.bindMode!==void 0&&(c.bindMode=e.bindMode),e.bindMatrix!==void 0&&c.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(c.skeleton=e.skeleton);break;case"Mesh":f=I(e.geometry),b=C(e.material),c=new ts(f,b);break;case"InstancedMesh":f=I(e.geometry),b=C(e.material);const v=e.count,y=e.instanceMatrix,Z=e.instanceColor;c=new $m(f,b,v),c.instanceMatrix=new ob(new Float32Array(y.array),16),Z!==void 0&&(c.instanceColor=new ob(new Float32Array(Z.array),Z.itemSize));break;case"BatchedMesh":f=I(e.geometry),b=C(e.material),c=new NK(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,b),c.geometry=f,c.perObjectFrustumCulled=e.perObjectFrustumCulled,c.sortObjects=e.sortObjects,c._drawRanges=e.drawRanges,c._reservedRanges=e.reservedRanges,c._visibility=e.visibility,c._active=e.active,c._bounds=e.bounds.map(V=>{const R=new Jo;R.min.fromArray(V.boxMin),R.max.fromArray(V.boxMax);const S=new Bo;return S.radius=V.sphereRadius,S.center.fromArray(V.sphereCenter),{boxInitialized:V.boxInitialized,box:R,sphereInitialized:V.sphereInitialized,sphere:S}}),c._maxGeometryCount=e.maxGeometryCount,c._maxVertexCount=e.maxVertexCount,c._maxIndexCount=e.maxIndexCount,c._geometryInitialized=e.geometryInitialized,c._geometryCount=e.geometryCount,c._matricesTexture=d(e.matricesTexture.uuid);break;case"LOD":c=new xK;break;case"Line":c=new iC(I(e.geometry),C(e.material));break;case"LineLoop":c=new XK(I(e.geometry),C(e.material));break;case"LineSegments":c=new _c(I(e.geometry),C(e.material));break;case"PointCloud":case"Points":c=new YK(I(e.geometry),C(e.material));break;case"Sprite":c=new WK(C(e.material));break;case"Group":c=new Pm;break;case"Bone":c=new A2;break;default:c=new Ai}if(c.uuid=e.uuid,e.name!==void 0&&(c.name=e.name),e.matrix!==void 0?(c.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(c.matrixAutoUpdate=e.matrixAutoUpdate),c.matrixAutoUpdate&&c.matrix.decompose(c.position,c.quaternion,c.scale)):(e.position!==void 0&&c.position.fromArray(e.position),e.rotation!==void 0&&c.rotation.fromArray(e.rotation),e.quaternion!==void 0&&c.quaternion.fromArray(e.quaternion),e.scale!==void 0&&c.scale.fromArray(e.scale)),e.up!==void 0&&c.up.fromArray(e.up),e.castShadow!==void 0&&(c.castShadow=e.castShadow),e.receiveShadow!==void 0&&(c.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(c.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(c.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(c.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&c.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(c.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(c.visible=e.visible),e.frustumCulled!==void 0&&(c.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(c.renderOrder=e.renderOrder),e.userData!==void 0&&(c.userData=e.userData),e.layers!==void 0&&(c.layers.mask=e.layers),e.children!==void 0){const v=e.children;for(let y=0;y<v.length;y++)c.add(this.parseObject(v[y],t,n,a,o))}if(e.animations!==void 0){const v=e.animations;for(let y=0;y<v.length;y++){const Z=v[y];c.animations.push(o[Z])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(c.autoUpdate=e.autoUpdate);const v=e.levels;for(let y=0;y<v.length;y++){const Z=v[y],V=c.getObjectByProperty("uuid",Z.object);V!==void 0&&c.addLevel(V,Z.distance,Z.hysteresis)}}return c}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const a=t[n.skeleton];a===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(a,n.bindMatrix)}})}}const TD={UVMapping:GR,CubeReflectionMapping:pI,CubeRefractionMapping:tC,EquirectangularReflectionMapping:H0,EquirectangularRefractionMapping:F0,CubeUVReflectionMapping:lb},$M={RepeatWrapping:K0,ClampToEdgeWrapping:Go,MirroredRepeatWrapping:E0},eH={NearestFilter:Fa,NearestMipmapNearestFilter:AR,NearestMipmapLinearFilter:x0,LinearFilter:Ka,LinearMipmapNearestFilter:JN,LinearMipmapLinearFilter:nC};class zD extends Sr{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,a){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,c=dI.get(e);if(c!==void 0){if(o.manager.itemStart(e),c.then){c.then(d=>{t&&t(d),o.manager.itemEnd(e)}).catch(d=>{a&&a(d)});return}return setTimeout(function(){t&&t(c),o.manager.itemEnd(e)},0),c}const I={};I.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",I.headers=this.requestHeader;const C=fetch(e,I).then(function(d){return d.blob()}).then(function(d){return createImageBitmap(d,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(d){return dI.add(e,d),t&&t(d),o.manager.itemEnd(e),d}).catch(function(d){a&&a(d),dI.remove(e),o.manager.itemError(e),o.manager.itemEnd(e)});dI.add(e,C),o.manager.itemStart(e)}}let MS;class W2{static getContext(){return MS===void 0&&(MS=new(window.AudioContext||window.webkitAudioContext)),MS}static setContext(e){MS=e}}class LD extends Sr{constructor(e){super(e)}load(e,t,n,a){const o=this,c=new mI(this.manager);c.setResponseType("arraybuffer"),c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(C){try{const d=C.slice(0);W2.getContext().decodeAudioData(d,function(b){t(b)}).catch(I)}catch(d){I(d)}},n,a);function I(C){a?a(C):console.error(C),o.manager.itemError(e)}}}const tH=new Nn,nH=new Nn,lA=new Nn;class _D{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ea,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ea,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,lA.copy(e.projectionMatrix);const a=t.eyeSep/2,o=a*t.near/t.focus,c=t.near*Math.tan(SA*t.fov*.5)/t.zoom;let I,C;nH.elements[12]=-a,tH.elements[12]=a,I=-c*t.aspect+o,C=c*t.aspect+o,lA.elements[0]=2*t.near/(C-I),lA.elements[8]=(C+I)/(C-I),this.cameraL.projectionMatrix.copy(lA),I=-c*t.aspect-o,C=c*t.aspect-o,lA.elements[0]=2*t.near/(C-I),lA.elements[8]=(C+I)/(C-I),this.cameraR.projectionMatrix.copy(lA)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(nH),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(tH)}}class x2{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=iH(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=iH();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function iH(){return(typeof performance>"u"?Date:performance).now()}const gA=new $,aH=new xs,kD=new $,cA=new $;class UD extends Ai{constructor(){super(),this.type="AudioListener",this.context=W2.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new x2}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(gA,aH,kD),cA.set(0,0,-1).applyQuaternion(aH),t.positionX){const a=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(gA.x,a),t.positionY.linearRampToValueAtTime(gA.y,a),t.positionZ.linearRampToValueAtTime(gA.z,a),t.forwardX.linearRampToValueAtTime(cA.x,a),t.forwardY.linearRampToValueAtTime(cA.y,a),t.forwardZ.linearRampToValueAtTime(cA.z,a),t.upX.linearRampToValueAtTime(n.x,a),t.upY.linearRampToValueAtTime(n.y,a),t.upZ.linearRampToValueAtTime(n.z,a)}else t.setPosition(gA.x,gA.y,gA.z),t.setOrientation(cA.x,cA.y,cA.z,n.x,n.y,n.z)}}class AE extends Ai{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const uA=new $,sH=new xs,DD=new $,IA=new $;class JD extends AE{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(uA,sH,DD),IA.set(0,0,1).applyQuaternion(sH);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(uA.x,n),t.positionY.linearRampToValueAtTime(uA.y,n),t.positionZ.linearRampToValueAtTime(uA.z,n),t.orientationX.linearRampToValueAtTime(IA.x,n),t.orientationY.linearRampToValueAtTime(IA.y,n),t.orientationZ.linearRampToValueAtTime(IA.z,n)}else t.setPosition(uA.x,uA.y,uA.z),t.setOrientation(IA.x,IA.y,IA.z)}}class OD{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class fE{constructor(e,t,n){this.binding=e,this.valueSize=n;let a,o,c;switch(t){case"quaternion":a=this._slerp,o=this._slerpAdditive,c=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":a=this._select,o=this._select,c=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:a=this._lerp,o=this._lerpAdditive,c=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=a,this._mixBufferRegionAdditive=o,this._setIdentity=c,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,a=this.valueSize,o=e*a+a;let c=this.cumulativeWeight;if(c===0){for(let I=0;I!==a;++I)n[o+I]=n[I];c=t}else{c+=t;const I=t/c;this._mixBufferRegion(n,o,0,I,a)}this.cumulativeWeight=c}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,a=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,a,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,a=e*t+t,o=this.cumulativeWeight,c=this.cumulativeWeightAdditive,I=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const C=t*this._origIndex;this._mixBufferRegion(n,a,C,1-o,t)}c>0&&this._mixBufferRegionAdditive(n,a,this._addIndex*t,1,t);for(let C=t,d=t+t;C!==d;++C)if(n[C]!==n[C+t]){I.setValue(n,a);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,a=n*this._origIndex;e.getValue(t,a);for(let o=n,c=a;o!==c;++o)t[o]=t[a+o%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,a,o){if(a>=.5)for(let c=0;c!==o;++c)e[t+c]=e[n+c]}_slerp(e,t,n,a){xs.slerpFlat(e,t,e,t,e,n,a)}_slerpAdditive(e,t,n,a,o){const c=this._workIndex*o;xs.multiplyQuaternionsFlat(e,c,e,t,e,n),xs.slerpFlat(e,t,e,t,e,c,a)}_lerp(e,t,n,a,o){const c=1-a;for(let I=0;I!==o;++I){const C=t+I;e[C]=e[C]*c+e[n+I]*a}}_lerpAdditive(e,t,n,a,o){for(let c=0;c!==o;++c){const I=t+c;e[I]=e[I]+e[n+c]*a}}}const V2="\\[\\]\\.:\\/",PD=new RegExp("["+V2+"]","g"),N2="[^"+V2+"]",QD="[^"+V2.replace("\\.","")+"]",jD=/((?:WC+[\/:])*)/.source.replace("WC",N2),qD=/(WCOD+)?/.source.replace("WCOD",QD),$D=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",N2),eJ=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",N2),tJ=new RegExp("^"+jD+qD+$D+eJ+"$"),nJ=["material","materials","bones","map"];class iJ{constructor(e,t,n){const a=n||mi.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,a)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,a=this._bindings[n];a!==void 0&&a.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let a=this._targetGroup.nCachedObjects_,o=n.length;a!==o;++a)n[a].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class mi{constructor(e,t,n){this.path=t,this.parsedPath=n||mi.parseTrackName(t),this.node=mi.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new mi.Composite(e,t,n):new mi(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(PD,"")}static parseTrackName(e){const t=tJ.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},a=n.nodeName&&n.nodeName.lastIndexOf(".");if(a!==void 0&&a!==-1){const o=n.nodeName.substring(a+1);nJ.indexOf(o)!==-1&&(n.nodeName=n.nodeName.substring(0,a),n.objectName=o)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(o){for(let c=0;c<o.length;c++){const I=o[c];if(I.name===t||I.uuid===t)return I;const C=n(I.children);if(C)return C}return null},a=n(e.children);if(a)return a}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let a=0,o=n.length;a!==o;++a)e[t++]=n[a]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let a=0,o=n.length;a!==o;++a)n[a]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let a=0,o=n.length;a!==o;++a)n[a]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let a=0,o=n.length;a!==o;++a)n[a]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,a=t.propertyName;let o=t.propertyIndex;if(e||(e=mi.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let d=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let f=0;f<e.length;f++)if(e[f].name===d){d=f;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(d!==void 0){if(e[d]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[d]}}const c=e[a];if(c===void 0){const d=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+d+"."+a+" but it wasn't found.",e);return}let I=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?I=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(I=this.Versioning.MatrixWorldNeedsUpdate);let C=this.BindingType.Direct;if(o!==void 0){if(a==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}C=this.BindingType.ArrayElement,this.resolvedProperty=c,this.propertyIndex=o}else c.fromArray!==void 0&&c.toArray!==void 0?(C=this.BindingType.HasFromToArray,this.resolvedProperty=c):Array.isArray(c)?(C=this.BindingType.EntireArray,this.resolvedProperty=c):this.propertyName=a;this.getValue=this.GetterByBindingType[C],this.setValue=this.SetterByBindingTypeAndVersioning[C][I]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}mi.Composite=iJ;mi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};mi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};mi.prototype.GetterByBindingType=[mi.prototype._getValue_direct,mi.prototype._getValue_array,mi.prototype._getValue_arrayElement,mi.prototype._getValue_toArray];mi.prototype.SetterByBindingTypeAndVersioning=[[mi.prototype._setValue_direct,mi.prototype._setValue_direct_setNeedsUpdate,mi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[mi.prototype._setValue_array,mi.prototype._setValue_array_setNeedsUpdate,mi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[mi.prototype._setValue_arrayElement,mi.prototype._setValue_arrayElement_setNeedsUpdate,mi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[mi.prototype._setValue_fromArray,mi.prototype._setValue_fromArray_setNeedsUpdate,mi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class aJ{constructor(){this.isAnimationObjectGroup=!0,this.uuid=sl(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,a=arguments.length;n!==a;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,a=this._parsedPaths,o=this._bindings,c=o.length;let I,C=e.length,d=this.nCachedObjects_;for(let f=0,b=arguments.length;f!==b;++f){const v=arguments[f],y=v.uuid;let Z=t[y];if(Z===void 0){Z=C++,t[y]=Z,e.push(v);for(let V=0,R=c;V!==R;++V)o[V].push(new mi(v,n[V],a[V]))}else if(Z<d){I=e[Z];const V=--d,R=e[V];t[R.uuid]=Z,e[Z]=R,t[y]=V,e[V]=v;for(let S=0,N=c;S!==N;++S){const w=o[S],X=w[V];let H=w[Z];w[Z]=X,H===void 0&&(H=new mi(v,n[S],a[S])),w[V]=H}}else e[Z]!==I&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=d}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,a=n.length;let o=this.nCachedObjects_;for(let c=0,I=arguments.length;c!==I;++c){const C=arguments[c],d=C.uuid,f=t[d];if(f!==void 0&&f>=o){const b=o++,v=e[b];t[v.uuid]=f,e[f]=v,t[d]=b,e[b]=C;for(let y=0,Z=a;y!==Z;++y){const V=n[y],R=V[b],S=V[f];V[f]=R,V[b]=S}}}this.nCachedObjects_=o}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,a=n.length;let o=this.nCachedObjects_,c=e.length;for(let I=0,C=arguments.length;I!==C;++I){const d=arguments[I],f=d.uuid,b=t[f];if(b!==void 0)if(delete t[f],b<o){const v=--o,y=e[v],Z=--c,V=e[Z];t[y.uuid]=b,e[b]=y,t[V.uuid]=v,e[v]=V,e.pop();for(let R=0,S=a;R!==S;++R){const N=n[R],w=N[v],X=N[Z];N[b]=w,N[v]=X,N.pop()}}else{const v=--c,y=e[v];v>0&&(t[y.uuid]=b),e[b]=y,e.pop();for(let Z=0,V=a;Z!==V;++Z){const R=n[Z];R[b]=R[v],R.pop()}}}this.nCachedObjects_=o}subscribe_(e,t){const n=this._bindingsIndicesByPath;let a=n[e];const o=this._bindings;if(a!==void 0)return o[a];const c=this._paths,I=this._parsedPaths,C=this._objects,d=C.length,f=this.nCachedObjects_,b=new Array(d);a=o.length,n[e]=a,c.push(e),I.push(t),o.push(b);for(let v=f,y=C.length;v!==y;++v){const Z=C[v];b[v]=new mi(Z,e,t)}return b}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const a=this._paths,o=this._parsedPaths,c=this._bindings,I=c.length-1,C=c[I],d=e[I];t[d]=n,c[n]=C,c.pop(),o[n]=o[I],o.pop(),a[n]=a[I],a.pop()}}}class pE{constructor(e,t,n=null,a=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=a;const o=t.tracks,c=o.length,I=new Array(c),C={endingStart:vA,endingEnd:vA};for(let d=0;d!==c;++d){const f=o[d].createInterpolant(null);I[d]=f,f.settings=C}this._interpolantSettings=C,this._interpolants=I,this._propertyBindings=new Array(c),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=qF,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const a=this._clip.duration,o=e._clip.duration,c=o/a,I=a/o;e.warp(1,c,t),this.warp(I,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const a=this._mixer,o=a.time,c=this.timeScale;let I=this._timeScaleInterpolant;I===null&&(I=a._lendControlInterpolant(),this._timeScaleInterpolant=I);const C=I.parameterPositions,d=I.sampleValues;return C[0]=o,C[1]=o+n,d[0]=e/c,d[1]=t/c,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,a){if(!this.enabled){this._updateWeight(e);return}const o=this._startTime;if(o!==null){const C=(e-o)*n;C<0||n===0?t=0:(this._startTime=null,t=n*C)}t*=this._updateTimeScale(e);const c=this._updateTime(t),I=this._updateWeight(e);if(I>0){const C=this._interpolants,d=this._propertyBindings;switch(this.blendMode){case t2:for(let f=0,b=C.length;f!==b;++f)C[f].evaluate(c),d[f].accumulateAdditive(I);break;case ZR:default:for(let f=0,b=C.length;f!==b;++f)C[f].evaluate(c),d[f].accumulate(a,I)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const a=n.evaluate(e)[0];t*=a,e>n.parameterPositions[1]&&(this.stopFading(),a===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const a=n.evaluate(e)[0];t*=a,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let a=this.time+e,o=this._loopCount;const c=n===$F;if(e===0)return o===-1?a:c&&(o&1)===1?t-a:a;if(n===jF){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(a>=t)a=t;else if(a<0)a=0;else{this.time=a;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,c)):this._setEndings(this.repetitions===0,!0,c)),a>=t||a<0){const I=Math.floor(a/t);a-=t*I,o+=Math.abs(I);const C=this.repetitions-o;if(C<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a=e>0?t:0,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(C===1){const d=e<0;this._setEndings(d,!d,c)}else this._setEndings(!1,!1,c);this._loopCount=o,this.time=a,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:I})}}else this.time=a;if(c&&(o&1)===1)return t-a}return a}_setEndings(e,t,n){const a=this._interpolantSettings;n?(a.endingStart=yA,a.endingEnd=yA):(e?a.endingStart=this.zeroSlopeAtStart?yA:vA:a.endingStart=L0,t?a.endingEnd=this.zeroSlopeAtEnd?yA:vA:a.endingEnd=L0)}_scheduleFading(e,t,n){const a=this._mixer,o=a.time;let c=this._weightInterpolant;c===null&&(c=a._lendControlInterpolant(),this._weightInterpolant=c);const I=c.parameterPositions,C=c.sampleValues;return I[0]=o,C[0]=t,I[1]=o+e,C[1]=n,this}}const sJ=new Float32Array(1);class oJ extends bI{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,a=e._clip.tracks,o=a.length,c=e._propertyBindings,I=e._interpolants,C=n.uuid,d=this._bindingsByRootAndName;let f=d[C];f===void 0&&(f={},d[C]=f);for(let b=0;b!==o;++b){const v=a[b],y=v.name;let Z=f[y];if(Z!==void 0)++Z.referenceCount,c[b]=Z;else{if(Z=c[b],Z!==void 0){Z._cacheIndex===null&&(++Z.referenceCount,this._addInactiveBinding(Z,C,y));continue}const V=t&&t._propertyBindings[b].binding.parsedPath;Z=new fE(mi.create(n,y,V),v.ValueTypeName,v.getValueSize()),++Z.referenceCount,this._addInactiveBinding(Z,C,y),c[b]=Z}I[b].resultBuffer=Z.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,a=e._clip.uuid,o=this._actionsByClip[a];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,a,n)}const t=e._propertyBindings;for(let n=0,a=t.length;n!==a;++n){const o=t[n];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,a=t.length;n!==a;++n){const o=t[n];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const a=this._actions,o=this._actionsByClip;let c=o[t];if(c===void 0)c={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=c;else{const I=c.knownActions;e._byClipCacheIndex=I.length,I.push(e)}e._cacheIndex=a.length,a.push(e),c.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],a=e._cacheIndex;n._cacheIndex=a,t[a]=n,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,c=this._actionsByClip,I=c[o],C=I.knownActions,d=C[C.length-1],f=e._byClipCacheIndex;d._byClipCacheIndex=f,C[f]=d,C.pop(),e._byClipCacheIndex=null;const b=I.actionByRoot,v=(e._localRoot||this._root).uuid;delete b[v],C.length===0&&delete c[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,a=t.length;n!==a;++n){const o=t[n];--o.referenceCount===0&&this._removeInactiveBinding(o)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,a=this._nActiveActions++,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=n,t[n]=o}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,a=--this._nActiveActions,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=n,t[n]=o}_addInactiveBinding(e,t,n){const a=this._bindingsByRootAndName,o=this._bindings;let c=a[t];c===void 0&&(c={},a[t]=c),c[n]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,a=n.rootNode.uuid,o=n.path,c=this._bindingsByRootAndName,I=c[a],C=t[t.length-1],d=e._cacheIndex;C._cacheIndex=d,t[d]=C,t.pop(),delete I[o],Object.keys(I).length===0&&delete c[a]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,a=this._nActiveBindings++,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=n,t[n]=o}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,a=--this._nActiveBindings,o=t[a];e._cacheIndex=a,t[a]=e,o._cacheIndex=n,t[n]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new Z2(new Float32Array(2),new Float32Array(2),1,sJ),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,a=--this._nActiveControlInterpolants,o=t[a];e.__cacheIndex=a,t[a]=e,o.__cacheIndex=n,t[n]=o}clipAction(e,t,n){const a=t||this._root,o=a.uuid;let c=typeof e=="string"?eG.findByName(a,e):e;const I=c!==null?c.uuid:e,C=this._actionsByClip[I];let d=null;if(n===void 0&&(c!==null?n=c.blendMode:n=ZR),C!==void 0){const b=C.actionByRoot[o];if(b!==void 0&&b.blendMode===n)return b;d=C.knownActions[0],c===null&&(c=d._clip)}if(c===null)return null;const f=new pE(this,c,t,n);return this._bindAction(f,d),this._addInactiveAction(f,I,o),f}existingAction(e,t){const n=t||this._root,a=n.uuid,o=typeof e=="string"?eG.findByName(n,e):e,c=o?o.uuid:e,I=this._actionsByClip[c];return I!==void 0&&I.actionByRoot[a]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,a=this.time+=e,o=Math.sign(e),c=this._accuIndex^=1;for(let d=0;d!==n;++d)t[d]._update(a,e,o,c);const I=this._bindings,C=this._nActiveBindings;for(let d=0;d!==C;++d)I[d].apply(c);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,a=this._actionsByClip,o=a[n];if(o!==void 0){const c=o.knownActions;for(let I=0,C=c.length;I!==C;++I){const d=c[I];this._deactivateAction(d);const f=d._cacheIndex,b=t[t.length-1];d._cacheIndex=null,d._byClipCacheIndex=null,b._cacheIndex=f,t[f]=b,t.pop(),this._removeInactiveBindingsForAction(d)}delete a[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const c in n){const I=n[c].actionByRoot,C=I[t];C!==void 0&&(this._deactivateAction(C),this._removeInactiveAction(C))}const a=this._bindingsByRootAndName,o=a[t];if(o!==void 0)for(const c in o){const I=o[c];I.restoreOriginalState(),this._removeInactiveBinding(I)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class X2{constructor(e){this.value=e}clone(){return new X2(this.value.clone===void 0?this.value:this.value.clone())}}let rJ=0;class lJ extends bI{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:rJ++}),this.name="",this.usage=D0,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,a=t.length;n<a;n++){const o=Array.isArray(t[n])?t[n]:[t[n]];for(let c=0;c<o.length;c++)this.uniforms.push(o[c].clone())}return this}clone(){return new this.constructor().copy(this)}}class gJ extends VR{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class cJ{constructor(e,t,n,a,o){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=a,this.count=o,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class mE{constructor(e,t,n=0,a=1/0){this.ray=new XA(e,t),this.near=n,this.far=a,this.camera=null,this.layers=new RA,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return VN(e,this,n,t),n.sort(oH),n}intersectObjects(e,t=!0,n=[]){for(let a=0,o=e.length;a<o;a++)VN(e[a],this,n,t);return n.sort(oH),n}}function oH(r,e){return r.distance-e.distance}function VN(r,e,t,n){if(r.layers.test(e.layers)&&r.raycast(e,t),n===!0){const a=r.children;for(let o=0,c=a.length;o<c;o++)VN(a[o],e,t,!0)}}class NN{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Wa(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class uJ{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}const rH=new lt;class IJ{constructor(e=new lt(1/0,1/0),t=new lt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=rH.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,rH).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const lH=new $,HS=new $;class dJ{constructor(e=new $,t=new $){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){lH.subVectors(e,this.start),HS.subVectors(this.end,this.start);const n=HS.dot(HS);let o=HS.dot(lH)/n;return t&&(o=Wa(o,0,1)),o}closestPointToPoint(e,t,n){const a=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(a).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const gH=new $;class CJ extends Ai{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Qn,a=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let c=0,I=1,C=32;c<C;c++,I++){const d=c/C*Math.PI*2,f=I/C*Math.PI*2;a.push(Math.cos(d),Math.sin(d),1,Math.cos(f),Math.sin(f),1)}n.setAttribute("position",new cn(a,3));const o=new Oo({fog:!1,toneMapped:!1});this.cone=new _c(n,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),gH.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(gH),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Od=new $,FS=new Nn,GV=new Nn;class hJ extends _c{constructor(e){const t=bE(e),n=new Qn,a=[],o=[],c=new an(0,0,1),I=new an(0,1,0);for(let d=0;d<t.length;d++){const f=t[d];f.parent&&f.parent.isBone&&(a.push(0,0,0),a.push(0,0,0),o.push(c.r,c.g,c.b),o.push(I.r,I.g,I.b))}n.setAttribute("position",new cn(a,3)),n.setAttribute("color",new cn(o,3));const C=new Oo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,C),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,a=n.getAttribute("position");GV.copy(this.root.matrixWorld).invert();for(let o=0,c=0;o<t.length;o++){const I=t[o];I.parent&&I.parent.isBone&&(FS.multiplyMatrices(GV,I.matrixWorld),Od.setFromMatrixPosition(FS),a.setXYZ(c,Od.x,Od.y,Od.z),FS.multiplyMatrices(GV,I.parent.matrixWorld),Od.setFromMatrixPosition(FS),a.setXYZ(c+1,Od.x,Od.y,Od.z),c+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function bE(r){const e=[];r.isBone===!0&&e.push(r);for(let t=0;t<r.children.length;t++)e.push.apply(e,bE(r.children[t]));return e}class AJ extends ts{constructor(e,t,n){const a=new Ib(t,4,2),o=new sC({wireframe:!0,fog:!1,toneMapped:!1});super(a,o),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const fJ=new $,cH=new an,uH=new an;class pJ extends Ai{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const a=new gG(t);a.rotateY(Math.PI*.5),this.material=new sC({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const o=a.getAttribute("position"),c=new Float32Array(o.count*3);a.setAttribute("color",new Yi(c,3)),this.add(new ts(a,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");cH.copy(this.light.color),uH.copy(this.light.groundColor);for(let n=0,a=t.count;n<a;n++){const o=n<a/2?cH:uH;t.setXYZ(n,o.r,o.g,o.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(fJ.setFromMatrixPosition(this.light.matrixWorld).negate())}}class mJ extends _c{constructor(e=10,t=10,n=4473924,a=8947848){n=new an(n),a=new an(a);const o=t/2,c=e/t,I=e/2,C=[],d=[];for(let v=0,y=0,Z=-I;v<=t;v++,Z+=c){C.push(-I,0,Z,I,0,Z),C.push(Z,0,-I,Z,0,I);const V=v===o?n:a;V.toArray(d,y),y+=3,V.toArray(d,y),y+=3,V.toArray(d,y),y+=3,V.toArray(d,y),y+=3}const f=new Qn;f.setAttribute("position",new cn(C,3)),f.setAttribute("color",new cn(d,3));const b=new Oo({vertexColors:!0,toneMapped:!1});super(f,b),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class bJ extends _c{constructor(e=10,t=16,n=8,a=64,o=4473924,c=8947848){o=new an(o),c=new an(c);const I=[],C=[];if(t>1)for(let b=0;b<t;b++){const v=b/t*(Math.PI*2),y=Math.sin(v)*e,Z=Math.cos(v)*e;I.push(0,0,0),I.push(y,0,Z);const V=b&1?o:c;C.push(V.r,V.g,V.b),C.push(V.r,V.g,V.b)}for(let b=0;b<n;b++){const v=b&1?o:c,y=e-e/n*b;for(let Z=0;Z<a;Z++){let V=Z/a*(Math.PI*2),R=Math.sin(V)*y,S=Math.cos(V)*y;I.push(R,0,S),C.push(v.r,v.g,v.b),V=(Z+1)/a*(Math.PI*2),R=Math.sin(V)*y,S=Math.cos(V)*y,I.push(R,0,S),C.push(v.r,v.g,v.b)}}const d=new Qn;d.setAttribute("position",new cn(I,3)),d.setAttribute("color",new cn(C,3));const f=new Oo({vertexColors:!0,toneMapped:!1});super(d,f),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const IH=new $,KS=new $,dH=new $;class vJ extends Ai{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let a=new Qn;a.setAttribute("position",new cn([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const o=new Oo({fog:!1,toneMapped:!1});this.lightPlane=new iC(a,o),this.add(this.lightPlane),a=new Qn,a.setAttribute("position",new cn([0,0,0,0,0,1],3)),this.targetLine=new iC(a,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),IH.setFromMatrixPosition(this.light.matrixWorld),KS.setFromMatrixPosition(this.light.target.matrixWorld),dH.subVectors(KS,IH),this.lightPlane.lookAt(KS),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(KS),this.targetLine.scale.z=dH.length()}}const ES=new $,wa=new aG;class yJ extends _c{constructor(e){const t=new Qn,n=new Oo({color:16777215,vertexColors:!0,toneMapped:!1}),a=[],o=[],c={};I("n1","n2"),I("n2","n4"),I("n4","n3"),I("n3","n1"),I("f1","f2"),I("f2","f4"),I("f4","f3"),I("f3","f1"),I("n1","f1"),I("n2","f2"),I("n3","f3"),I("n4","f4"),I("p","n1"),I("p","n2"),I("p","n3"),I("p","n4"),I("u1","u2"),I("u2","u3"),I("u3","u1"),I("c","t"),I("p","c"),I("cn1","cn2"),I("cn3","cn4"),I("cf1","cf2"),I("cf3","cf4");function I(Z,V){C(Z),C(V)}function C(Z){a.push(0,0,0),o.push(0,0,0),c[Z]===void 0&&(c[Z]=[]),c[Z].push(a.length/3-1)}t.setAttribute("position",new cn(a,3)),t.setAttribute("color",new cn(o,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=c,this.update();const d=new an(16755200),f=new an(16711680),b=new an(43775),v=new an(16777215),y=new an(3355443);this.setColors(d,f,b,v,y)}setColors(e,t,n,a,o){const I=this.geometry.getAttribute("color");I.setXYZ(0,e.r,e.g,e.b),I.setXYZ(1,e.r,e.g,e.b),I.setXYZ(2,e.r,e.g,e.b),I.setXYZ(3,e.r,e.g,e.b),I.setXYZ(4,e.r,e.g,e.b),I.setXYZ(5,e.r,e.g,e.b),I.setXYZ(6,e.r,e.g,e.b),I.setXYZ(7,e.r,e.g,e.b),I.setXYZ(8,e.r,e.g,e.b),I.setXYZ(9,e.r,e.g,e.b),I.setXYZ(10,e.r,e.g,e.b),I.setXYZ(11,e.r,e.g,e.b),I.setXYZ(12,e.r,e.g,e.b),I.setXYZ(13,e.r,e.g,e.b),I.setXYZ(14,e.r,e.g,e.b),I.setXYZ(15,e.r,e.g,e.b),I.setXYZ(16,e.r,e.g,e.b),I.setXYZ(17,e.r,e.g,e.b),I.setXYZ(18,e.r,e.g,e.b),I.setXYZ(19,e.r,e.g,e.b),I.setXYZ(20,e.r,e.g,e.b),I.setXYZ(21,e.r,e.g,e.b),I.setXYZ(22,e.r,e.g,e.b),I.setXYZ(23,e.r,e.g,e.b),I.setXYZ(24,t.r,t.g,t.b),I.setXYZ(25,t.r,t.g,t.b),I.setXYZ(26,t.r,t.g,t.b),I.setXYZ(27,t.r,t.g,t.b),I.setXYZ(28,t.r,t.g,t.b),I.setXYZ(29,t.r,t.g,t.b),I.setXYZ(30,t.r,t.g,t.b),I.setXYZ(31,t.r,t.g,t.b),I.setXYZ(32,n.r,n.g,n.b),I.setXYZ(33,n.r,n.g,n.b),I.setXYZ(34,n.r,n.g,n.b),I.setXYZ(35,n.r,n.g,n.b),I.setXYZ(36,n.r,n.g,n.b),I.setXYZ(37,n.r,n.g,n.b),I.setXYZ(38,a.r,a.g,a.b),I.setXYZ(39,a.r,a.g,a.b),I.setXYZ(40,o.r,o.g,o.b),I.setXYZ(41,o.r,o.g,o.b),I.setXYZ(42,o.r,o.g,o.b),I.setXYZ(43,o.r,o.g,o.b),I.setXYZ(44,o.r,o.g,o.b),I.setXYZ(45,o.r,o.g,o.b),I.setXYZ(46,o.r,o.g,o.b),I.setXYZ(47,o.r,o.g,o.b),I.setXYZ(48,o.r,o.g,o.b),I.setXYZ(49,o.r,o.g,o.b),I.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,a=1;wa.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ha("c",t,e,wa,0,0,-1),Ha("t",t,e,wa,0,0,1),Ha("n1",t,e,wa,-n,-a,-1),Ha("n2",t,e,wa,n,-a,-1),Ha("n3",t,e,wa,-n,a,-1),Ha("n4",t,e,wa,n,a,-1),Ha("f1",t,e,wa,-n,-a,1),Ha("f2",t,e,wa,n,-a,1),Ha("f3",t,e,wa,-n,a,1),Ha("f4",t,e,wa,n,a,1),Ha("u1",t,e,wa,n*.7,a*1.1,-1),Ha("u2",t,e,wa,-n*.7,a*1.1,-1),Ha("u3",t,e,wa,0,a*2,-1),Ha("cf1",t,e,wa,-n,0,1),Ha("cf2",t,e,wa,n,0,1),Ha("cf3",t,e,wa,0,-a,1),Ha("cf4",t,e,wa,0,a,1),Ha("cn1",t,e,wa,-n,0,-1),Ha("cn2",t,e,wa,n,0,-1),Ha("cn3",t,e,wa,0,-a,-1),Ha("cn4",t,e,wa,0,a,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ha(r,e,t,n,a,o,c){ES.set(a,o,c).unproject(n);const I=e[r];if(I!==void 0){const C=t.getAttribute("position");for(let d=0,f=I.length;d<f;d++)C.setXYZ(I[d],ES.x,ES.y,ES.z)}}const TS=new Jo;class GJ extends _c{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=new Float32Array(8*3),o=new Qn;o.setIndex(new Yi(n,1)),o.setAttribute("position",new Yi(a,3)),super(o,new Oo({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&TS.setFromObject(this.object),TS.isEmpty())return;const t=TS.min,n=TS.max,a=this.geometry.attributes.position,o=a.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=t.x,o[4]=n.y,o[5]=n.z,o[6]=t.x,o[7]=t.y,o[8]=n.z,o[9]=n.x,o[10]=t.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=t.z,o[15]=t.x,o[16]=n.y,o[17]=t.z,o[18]=t.x,o[19]=t.y,o[20]=t.z,o[21]=n.x,o[22]=t.y,o[23]=t.z,a.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class BJ extends _c{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new Qn;o.setIndex(new Yi(n,1)),o.setAttribute("position",new cn(a,3)),super(o,new Oo({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class ZJ extends iC{constructor(e,t=1,n=16776960){const a=n,o=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],c=new Qn;c.setAttribute("position",new cn(o,3)),c.computeBoundingSphere(),super(c,new Oo({color:a,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const I=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],C=new Qn;C.setAttribute("position",new cn(I,3)),C.computeBoundingSphere(),this.add(new ts(C,new sC({color:a,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const CH=new $;let zS,BV;class SJ extends Ai{constructor(e=new $(0,0,1),t=new $(0,0,0),n=1,a=16776960,o=n*.2,c=o*.2){super(),this.type="ArrowHelper",zS===void 0&&(zS=new Qn,zS.setAttribute("position",new cn([0,0,0,0,1,0],3)),BV=new ub(0,.5,1,5,1),BV.translate(0,-.5,0)),this.position.copy(t),this.line=new iC(zS,new Oo({color:a,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ts(BV,new sC({color:a,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,o,c)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{CH.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(CH,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class RJ extends _c{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],a=new Qn;a.setAttribute("position",new cn(t,3)),a.setAttribute("color",new cn(n,3));const o=new Oo({vertexColors:!0,toneMapped:!1});super(a,o),this.type="AxesHelper"}setColors(e,t,n){const a=new an,o=this.geometry.attributes.color.array;return a.set(e),a.toArray(o,0),a.toArray(o,3),a.set(t),a.toArray(o,6),a.toArray(o,9),a.set(n),a.toArray(o,12),a.toArray(o,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class wJ{constructor(){this.type="ShapePath",this.color=new an,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new O0,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,a){return this.currentPath.quadraticCurveTo(e,t,n,a),this}bezierCurveTo(e,t,n,a,o,c){return this.currentPath.bezierCurveTo(e,t,n,a,o,c),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(S){const N=[];for(let w=0,X=S.length;w<X;w++){const H=S[w],F=new WA;F.curves=H.curves,N.push(F)}return N}function n(S,N){const w=N.length;let X=!1;for(let H=w-1,F=0;F<w;H=F++){let _=N[H],P=N[F],K=P.x-_.x,E=P.y-_.y;if(Math.abs(E)>Number.EPSILON){if(E<0&&(_=N[F],K=-K,P=N[H],E=-E),S.y<_.y||S.y>P.y)continue;if(S.y===_.y){if(S.x===_.x)return!0}else{const ee=E*(S.x-_.x)-K*(S.y-_.y);if(ee===0)return!0;if(ee<0)continue;X=!X}}else{if(S.y!==_.y)continue;if(P.x<=S.x&&S.x<=_.x||_.x<=S.x&&S.x<=P.x)return!0}}return X}const a=Ec.isClockWise,o=this.subPaths;if(o.length===0)return[];let c,I,C;const d=[];if(o.length===1)return I=o[0],C=new WA,C.curves=I.curves,d.push(C),d;let f=!a(o[0].getPoints());f=e?!f:f;const b=[],v=[];let y=[],Z=0,V;v[Z]=void 0,y[Z]=[];for(let S=0,N=o.length;S<N;S++)I=o[S],V=I.getPoints(),c=a(V),c=e?!c:c,c?(!f&&v[Z]&&Z++,v[Z]={s:new WA,p:V},v[Z].s.curves=I.curves,f&&Z++,y[Z]=[]):y[Z].push({h:I,p:V[0]});if(!v[0])return t(o);if(v.length>1){let S=!1,N=0;for(let w=0,X=v.length;w<X;w++)b[w]=[];for(let w=0,X=v.length;w<X;w++){const H=y[w];for(let F=0;F<H.length;F++){const _=H[F];let P=!0;for(let K=0;K<v.length;K++)n(_.p,v[K].p)&&(w!==K&&N++,P?(P=!1,b[K].push(_)):S=!0);P&&b[w].push(_)}}N>0&&S===!1&&(y=b)}let R;for(let S=0,N=v.length;S<N;S++){C=v[S].s,d.push(C),R=y[S];for(let w=0,X=R.length;w<X;w++)C.holes.push(R[w].h)}return d}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:vR}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=vR);const WJ=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:DN,AddEquation:Pd,AddOperation:HF,AdditiveAnimationBlendMode:t2,AdditiveBlending:kV,AgXToneMapping:zF,AlphaFormat:UF,AlwaysCompare:gK,AlwaysDepth:WF,AlwaysStencilFunc:vN,AmbientLight:cE,AnimationAction:pE,AnimationClip:eG,AnimationLoader:VD,AnimationMixer:oJ,AnimationObjectGroup:aJ,AnimationUtils:RD,ArcCurve:MK,ArrayCamera:SK,ArrowHelper:SJ,AttachedBindMode:PV,Audio:AE,AudioAnalyser:OD,AudioContext:W2,AudioListener:UD,AudioLoader:LD,AxesHelper:RJ,BackSide:Do,BasicDepthPacking:eK,BasicShadowMap:uF,BatchedMesh:NK,Bone:A2,BooleanKeyframeTrack:MA,Box2:IJ,Box3:Jo,Box3Helper:BJ,BoxGeometry:YA,BoxHelper:GJ,BufferAttribute:Yi,BufferGeometry:Qn,BufferGeometryLoader:hE,ByteType:_F,Cache:dI,Camera:aG,CameraHelper:yJ,CanvasTexture:jU,CapsuleGeometry:MR,CatmullRomCurve3:HK,CineonToneMapping:EF,CircleGeometry:HR,ClampToEdgeWrapping:Go,Clock:x2,Color:an,ColorKeyframeTrack:S2,ColorManagement:Ni,CompressedArrayTexture:PU,CompressedCubeTexture:QU,CompressedTexture:XR,CompressedTextureLoader:ND,ConeGeometry:FR,ConstantAlphaFactor:SF,ConstantColorFactor:BF,CubeCamera:fK,CubeReflectionMapping:pI,CubeRefractionMapping:tC,CubeTexture:sG,CubeTextureLoader:XD,CubeUVReflectionMapping:lb,CubicBezierCurve:m2,CubicBezierCurve3:FK,CubicInterpolant:nE,CullFaceBack:_V,CullFaceFront:cF,CullFaceFrontBack:E9,CullFaceNone:gF,Curve:Tg,CurvePath:EK,CustomBlending:IF,CustomToneMapping:TF,CylinderGeometry:ub,Cylindrical:uJ,Data3DTexture:o2,DataArrayTexture:RR,DataTexture:wA,DataTextureLoader:YD,DataUtils:O5,DecrementStencilOp:j9,DecrementWrapStencilOp:$9,DefaultLoadingManager:sE,DepthFormat:jd,DepthStencilFormat:xA,DepthTexture:c2,DetachedBindMode:LF,DirectionalLight:gE,DirectionalLightHelper:vJ,DiscreteInterpolant:iE,DisplayP3ColorSpace:SR,DodecahedronGeometry:KR,DoubleSide:il,DstAlphaFactor:mF,DstColorFactor:vF,DynamicCopyUsage:d5,DynamicDrawUsage:cK,DynamicReadUsage:c5,EdgesGeometry:TK,EllipseCurve:YR,EqualCompare:sK,EqualDepth:VF,EqualStencilFunc:i5,EquirectangularReflectionMapping:H0,EquirectangularRefractionMapping:F0,Euler:gb,EventDispatcher:bI,ExtrudeGeometry:TR,FileLoader:mI,Float16BufferAttribute:e1,Float32BufferAttribute:cn,Float64BufferAttribute:t1,FloatType:Fg,Fog:xR,FogExp2:WR,FramebufferTexture:OU,FrontSide:fI,Frustum:oG,GLBufferAttribute:cJ,GLSL1:h5,GLSL3:yN,GreaterCompare:oK,GreaterDepth:XF,GreaterEqualCompare:lK,GreaterEqualDepth:NF,GreaterEqualStencilFunc:r5,GreaterStencilFunc:s5,GridHelper:mJ,Group:Pm,HalfFloatType:nb,HemisphereLight:oE,HemisphereLightHelper:pJ,IcosahedronGeometry:zR,ImageBitmapLoader:zD,ImageLoader:tG,ImageUtils:s2,IncrementStencilOp:Q9,IncrementWrapStencilOp:q9,InstancedBufferAttribute:ob,InstancedBufferGeometry:CE,InstancedInterleavedBuffer:gJ,InstancedMesh:$m,Int16BufferAttribute:q5,Int32BufferAttribute:$5,Int8BufferAttribute:P5,IntType:ON,InterleavedBuffer:VR,InterleavedBufferAttribute:VA,Interpolant:cG,InterpolateDiscrete:T0,InterpolateLinear:z0,InterpolateSmooth:iR,InvertStencilOp:e5,KeepStencilOp:hA,KeyframeTrack:zg,LOD:xK,LatheGeometry:lG,Layers:RA,LessCompare:aK,LessDepth:xF,LessEqualCompare:i2,LessEqualDepth:M0,LessEqualStencilFunc:a5,LessStencilFunc:n5,Light:rC,LightProbe:dE,Line:iC,Line3:dJ,LineBasicMaterial:Oo,LineCurve:b2,LineCurve3:KK,LineDashedMaterial:$K,LineLoop:XK,LineSegments:_c,LinearDisplayP3ColorSpace:iG,LinearEncoding:n2,LinearFilter:Ka,LinearInterpolant:Z2,LinearMipMapLinearFilter:k9,LinearMipMapNearestFilter:_9,LinearMipmapLinearFilter:nC,LinearMipmapNearestFilter:JN,LinearSRGBColorSpace:Tc,LinearToneMapping:FF,LinearTransfer:_0,Loader:Sr,LoaderUtils:xN,LoadingManager:R2,LoopOnce:jF,LoopPingPong:$F,LoopRepeat:qF,LuminanceAlphaFormat:JF,LuminanceFormat:DF,MOUSE:dA,Material:Zo,MaterialLoader:PR,MathUtils:x5,Matrix3:Pn,Matrix4:Nn,MaxEquation:OV,Mesh:ts,MeshBasicMaterial:sC,MeshDepthMaterial:u2,MeshDistanceMaterial:I2,MeshLambertMaterial:jK,MeshMatcapMaterial:qK,MeshNormalMaterial:QK,MeshPhongMaterial:OK,MeshPhysicalMaterial:JK,MeshStandardMaterial:OR,MeshToonMaterial:PK,MinEquation:JV,MirroredRepeatWrapping:E0,MixOperation:MF,MultiplyBlending:DV,MultiplyOperation:nG,NearestFilter:Fa,NearestMipMapLinearFilter:L9,NearestMipMapNearestFilter:z9,NearestMipmapLinearFilter:x0,NearestMipmapNearestFilter:AR,NeverCompare:iK,NeverDepth:wF,NeverStencilFunc:t5,NoBlending:AI,NoColorSpace:al,NoToneMapping:Fc,NormalAnimationBlendMode:ZR,NormalBlending:ZA,NotEqualCompare:rK,NotEqualDepth:YF,NotEqualStencilFunc:o5,NumberKeyframeTrack:q0,Object3D:Ai,ObjectLoader:ED,ObjectSpaceNormalMap:nK,OctahedronGeometry:gG,OneFactor:AF,OneMinusConstantAlphaFactor:RF,OneMinusConstantColorFactor:ZF,OneMinusDstAlphaFactor:bF,OneMinusDstColorFactor:yF,OneMinusSrcAlphaFactor:hR,OneMinusSrcColorFactor:pF,OrthographicCamera:$d,P3Primaries:U0,PCFShadowMap:yR,PCFSoftShadowMap:W0,PMREMGenerator:BN,Path:O0,PerspectiveCamera:Ea,Plane:cI,PlaneGeometry:rG,PlaneHelper:ZJ,PointLight:lE,PointLightHelper:AJ,Points:YK,PointsMaterial:f2,PolarGridHelper:bJ,PolyhedronGeometry:oC,PositionalAudio:JD,PropertyBinding:mi,PropertyMixer:fE,QuadraticBezierCurve:v2,QuadraticBezierCurve3:y2,Quaternion:xs,QuaternionKeyframeTrack:db,QuaternionLinearInterpolant:aE,RED_GREEN_RGTC2_Format:mN,RED_RGTC1_Format:QF,REVISION:vR,RGBADepthPacking:tK,RGBAFormat:Uo,RGBAIntegerFormat:$N,RGBA_ASTC_10x10_Format:dN,RGBA_ASTC_10x5_Format:cN,RGBA_ASTC_10x6_Format:uN,RGBA_ASTC_10x8_Format:IN,RGBA_ASTC_12x10_Format:CN,RGBA_ASTC_12x12_Format:hN,RGBA_ASTC_4x4_Format:nN,RGBA_ASTC_5x4_Format:iN,RGBA_ASTC_5x5_Format:aN,RGBA_ASTC_6x5_Format:sN,RGBA_ASTC_6x6_Format:oN,RGBA_ASTC_8x5_Format:rN,RGBA_ASTC_8x6_Format:lN,RGBA_ASTC_8x8_Format:gN,RGBA_BPTC_Format:nR,RGBA_ETC2_EAC_Format:tN,RGBA_PVRTC_2BPPV1_Format:$V,RGBA_PVRTC_4BPPV1_Format:qV,RGBA_S3TC_DXT1_Format:$S,RGBA_S3TC_DXT3_Format:eR,RGBA_S3TC_DXT5_Format:tR,RGB_BPTC_SIGNED_Format:AN,RGB_BPTC_UNSIGNED_Format:fN,RGB_ETC1_Format:e2,RGB_ETC2_Format:eN,RGB_PVRTC_2BPPV1_Format:jV,RGB_PVRTC_4BPPV1_Format:QV,RGB_S3TC_DXT1_Format:qS,RGFormat:PF,RGIntegerFormat:qN,RawShaderMaterial:DK,Ray:XA,Raycaster:mE,Rec709Primaries:k0,RectAreaLight:uE,RedFormat:OF,RedIntegerFormat:jN,ReinhardToneMapping:KF,RenderTarget:dK,RepeatWrapping:K0,ReplaceStencilOp:P9,ReverseSubtractEquation:CF,RingGeometry:LR,SIGNED_RED_GREEN_RGTC2_Format:bN,SIGNED_RED_RGTC1_Format:pN,SRGBColorSpace:As,SRGBTransfer:ta,Scene:C2,ShaderChunk:kn,ShaderLib:Hg,ShaderMaterial:zc,ShadowMaterial:UK,Shape:WA,ShapeGeometry:_R,ShapePath:wJ,ShapeUtils:Ec,ShortType:kF,Skeleton:NR,SkeletonHelper:hJ,SkinnedMesh:VK,Source:GA,Sphere:Bo,SphereGeometry:Ib,Spherical:NN,SphericalHarmonics3:IE,SplineCurve:G2,SpotLight:rE,SpotLightHelper:CJ,Sprite:WK,SpriteMaterial:h2,SrcAlphaFactor:CR,SrcAlphaSaturateFactor:GF,SrcColorFactor:fF,StaticCopyUsage:I5,StaticDrawUsage:D0,StaticReadUsage:g5,StereoCamera:_D,StreamCopyUsage:C5,StreamDrawUsage:l5,StreamReadUsage:u5,StringKeyframeTrack:HA,SubtractEquation:dF,SubtractiveBlending:UV,TOUCH:CA,TangentSpaceNormalMap:aC,TetrahedronGeometry:kR,Texture:Ta,TextureLoader:MD,TorusGeometry:UR,TorusKnotGeometry:DR,Triangle:Br,TriangleFanDrawMode:J9,TriangleStripDrawMode:D9,TrianglesDrawMode:U9,TubeGeometry:JR,TwoPassDoubleSide:T9,UVMapping:GR,Uint16BufferAttribute:r2,Uint32BufferAttribute:l2,Uint8BufferAttribute:Q5,Uint8ClampedBufferAttribute:j5,Uniform:X2,UniformsGroup:lJ,UniformsLib:Lt,UniformsUtils:AK,UnsignedByteType:Kc,UnsignedInt248Type:Qd,UnsignedIntType:II,UnsignedShort4444Type:PN,UnsignedShort5551Type:QN,UnsignedShortType:BR,VSMShadowMap:Yg,Vector2:lt,Vector3:$,Vector4:Xi,VectorKeyframeTrack:$0,VideoTexture:JU,WebGL1Renderer:RK,WebGL3DRenderTarget:H5,WebGLArrayRenderTarget:M5,WebGLCoordinateSystem:Kg,WebGLCubeRenderTarget:pK,WebGLMultipleRenderTargets:F5,WebGLRenderTarget:Eg,WebGLRenderer:d2,WebGLUtils:ZK,WebGPUCoordinateSystem:ib,WireframeGeometry:kK,WrapAroundEnding:L0,ZeroCurvatureEnding:vA,ZeroFactor:hF,ZeroSlopeEnding:yA,ZeroStencilOp:O9,_SRGBAFormat:fR,createCanvasElement:IK,sRGBEncoding:qd},Symbol.toStringTag,{value:"Module"}));var vE={exports:{}},fA={};/**
 * @license React
 * react-reconciler-constants.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){var r=1,e=4,t=16,n=536870912,a=r,o=e,c=t,I=n,C=0,d=1;fA.ConcurrentRoot=d,fA.ContinuousEventPriority=o,fA.DefaultEventPriority=c,fA.DiscreteEventPriority=a,fA.IdleEventPriority=I,fA.LegacyRoot=C})();vE.exports=fA;var jm=vE.exports;function xJ(r){let e;const t=new Set,n=(d,f)=>{const b=typeof d=="function"?d(e):d;if(b!==e){const v=e;e=f?b:Object.assign({},e,b),t.forEach(y=>y(e,v))}},a=()=>e,o=(d,f=a,b=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let v=f(e);function y(){const Z=f(e);if(!b(v,Z)){const V=v;d(v=Z,V)}}return t.add(y),()=>t.delete(y)},C={setState:n,getState:a,subscribe:(d,f,b)=>f||b?o(d,f,b):(t.add(d),()=>t.delete(d)),destroy:()=>t.clear()};return e=r(n,a,C),C}const VJ=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),hH=VJ?rt.useEffect:rt.useLayoutEffect;function NJ(r){const e=typeof r=="function"?xJ(r):r,t=(n=e.getState,a=Object.is)=>{const[,o]=rt.useReducer(R=>R+1,0),c=e.getState(),I=rt.useRef(c),C=rt.useRef(n),d=rt.useRef(a),f=rt.useRef(!1),b=rt.useRef();b.current===void 0&&(b.current=n(c));let v,y=!1;(I.current!==c||C.current!==n||d.current!==a||f.current)&&(v=n(c),y=!a(b.current,v)),hH(()=>{y&&(b.current=v),I.current=c,C.current=n,d.current=a,f.current=!1});const Z=rt.useRef(c);hH(()=>{const R=()=>{try{const N=e.getState(),w=C.current(N);d.current(b.current,w)||(I.current=N,b.current=w,o())}catch{f.current=!0,o()}},S=e.subscribe(R);return e.getState()!==Z.current&&R(),S},[]);const V=y?v:b.current;return rt.useDebugValue(V),V};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const n=[t,e];return{next(){const a=n.length<=0;return{value:n.shift(),done:a}}}},t}var yE={exports:{}},sR={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){var r=rt,e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),I=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),b=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),y=Symbol.for("react.offscreen"),Z=Symbol.iterator,V="@@iterator";function R(Q){if(Q===null||typeof Q!="object")return null;var Ye=Z&&Q[Z]||Q[V];return typeof Ye=="function"?Ye:null}var S=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function N(Q){{for(var Ye=arguments.length,ct=new Array(Ye>1?Ye-1:0),ft=1;ft<Ye;ft++)ct[ft-1]=arguments[ft];w("error",Q,ct)}}function w(Q,Ye,ct){{var ft=S.ReactDebugCurrentFrame,_t=ft.getStackAddendum();_t!==""&&(Ye+="%s",ct=ct.concat([_t]));var xt=ct.map(function(D){return String(D)});xt.unshift("Warning: "+Ye),Function.prototype.apply.call(console[Q],console,xt)}}var X=!1,H=!1,F=!1,_=!1,P=!1,K;K=Symbol.for("react.module.reference");function E(Q){return!!(typeof Q=="string"||typeof Q=="function"||Q===n||Q===o||P||Q===a||Q===d||Q===f||_||Q===y||X||H||F||typeof Q=="object"&&Q!==null&&(Q.$$typeof===v||Q.$$typeof===b||Q.$$typeof===c||Q.$$typeof===I||Q.$$typeof===C||Q.$$typeof===K||Q.getModuleId!==void 0))}function ee(Q,Ye,ct){var ft=Q.displayName;if(ft)return ft;var _t=Ye.displayName||Ye.name||"";return _t!==""?ct+"("+_t+")":ct}function Ie(Q){return Q.displayName||"Context"}function be(Q){if(Q==null)return null;if(typeof Q.tag=="number"&&N("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof Q=="function")return Q.displayName||Q.name||null;if(typeof Q=="string")return Q;switch(Q){case n:return"Fragment";case t:return"Portal";case o:return"Profiler";case a:return"StrictMode";case d:return"Suspense";case f:return"SuspenseList"}if(typeof Q=="object")switch(Q.$$typeof){case I:var Ye=Q;return Ie(Ye)+".Consumer";case c:var ct=Q;return Ie(ct._context)+".Provider";case C:return ee(Q,Q.render,"ForwardRef");case b:var ft=Q.displayName||null;return ft!==null?ft:be(Q.type)||"Memo";case v:{var _t=Q,xt=_t._payload,D=_t._init;try{return be(D(xt))}catch{return null}}}return null}var se=Object.assign,Ce=0,he,Be,ve,we,me,Xe,Ue;function de(){}de.__reactDisabledLog=!0;function Ee(){{if(Ce===0){he=console.log,Be=console.info,ve=console.warn,we=console.error,me=console.group,Xe=console.groupCollapsed,Ue=console.groupEnd;var Q={configurable:!0,enumerable:!0,value:de,writable:!0};Object.defineProperties(console,{info:Q,log:Q,warn:Q,error:Q,group:Q,groupCollapsed:Q,groupEnd:Q})}Ce++}}function At(){{if(Ce--,Ce===0){var Q={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:se({},Q,{value:he}),info:se({},Q,{value:Be}),warn:se({},Q,{value:ve}),error:se({},Q,{value:we}),group:se({},Q,{value:me}),groupCollapsed:se({},Q,{value:Xe}),groupEnd:se({},Q,{value:Ue})})}Ce<0&&N("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Zt=S.ReactCurrentDispatcher,Bt;function kt(Q,Ye,ct){{if(Bt===void 0)try{throw Error()}catch(_t){var ft=_t.stack.trim().match(/\n( *(at )?)/);Bt=ft&&ft[1]||""}return`
`+Bt+Q}}var $t=!1,Xt;{var Ot=typeof WeakMap=="function"?WeakMap:Map;Xt=new Ot}function oe(Q,Ye){if(!Q||$t)return"";{var ct=Xt.get(Q);if(ct!==void 0)return ct}var ft;$t=!0;var _t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var xt;xt=Zt.current,Zt.current=null,Ee();try{if(Ye){var D=function(){throw Error()};if(Object.defineProperty(D.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(D,[])}catch(jt){ft=jt}Reflect.construct(Q,[],D)}else{try{D.call()}catch(jt){ft=jt}Q.call(D.prototype)}}else{try{throw Error()}catch(jt){ft=jt}Q()}}catch(jt){if(jt&&ft&&typeof jt.stack=="string"){for(var ge=jt.stack.split(`
`),Ge=ft.stack.split(`
`),Se=ge.length-1,Ze=Ge.length-1;Se>=1&&Ze>=0&&ge[Se]!==Ge[Ze];)Ze--;for(;Se>=1&&Ze>=0;Se--,Ze--)if(ge[Se]!==Ge[Ze]){if(Se!==1||Ze!==1)do if(Se--,Ze--,Ze<0||ge[Se]!==Ge[Ze]){var bt=`
`+ge[Se].replace(" at new "," at ");return Q.displayName&&bt.includes("<anonymous>")&&(bt=bt.replace("<anonymous>",Q.displayName)),typeof Q=="function"&&Xt.set(Q,bt),bt}while(Se>=1&&Ze>=0);break}}}finally{$t=!1,Zt.current=xt,At(),Error.prepareStackTrace=_t}var Ft=Q?Q.displayName||Q.name:"",nn=Ft?kt(Ft):"";return typeof Q=="function"&&Xt.set(Q,nn),nn}function ut(Q,Ye,ct){return oe(Q,!1)}function _e(Q){var Ye=Q.prototype;return!!(Ye&&Ye.isReactComponent)}function it(Q,Ye,ct){if(Q==null)return"";if(typeof Q=="function")return oe(Q,_e(Q));if(typeof Q=="string")return kt(Q);switch(Q){case d:return kt("Suspense");case f:return kt("SuspenseList")}if(typeof Q=="object")switch(Q.$$typeof){case C:return ut(Q.render);case b:return it(Q.type,Ye,ct);case v:{var ft=Q,_t=ft._payload,xt=ft._init;try{return it(xt(_t),Ye,ct)}catch{}}}return""}var Te=Object.prototype.hasOwnProperty,Et={},Wt=S.ReactDebugCurrentFrame;function O(Q){if(Q){var Ye=Q._owner,ct=it(Q.type,Q._source,Ye?Ye.type:null);Wt.setExtraStackFrame(ct)}else Wt.setExtraStackFrame(null)}function k(Q,Ye,ct,ft,_t){{var xt=Function.call.bind(Te);for(var D in Q)if(xt(Q,D)){var ge=void 0;try{if(typeof Q[D]!="function"){var Ge=Error((ft||"React class")+": "+ct+" type `"+D+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof Q[D]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Ge.name="Invariant Violation",Ge}ge=Q[D](Ye,D,ft,ct,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Se){ge=Se}ge&&!(ge instanceof Error)&&(O(_t),N("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",ft||"React class",ct,D,typeof ge),O(null)),ge instanceof Error&&!(ge.message in Et)&&(Et[ge.message]=!0,O(_t),N("Failed %s type: %s",ct,ge.message),O(null))}}}var Ae=Array.isArray;function Oe(Q){return Ae(Q)}function $e(Q){{var Ye=typeof Symbol=="function"&&Symbol.toStringTag,ct=Ye&&Q[Symbol.toStringTag]||Q.constructor.name||"Object";return ct}}function et(Q){try{return Yt(Q),!1}catch{return!0}}function Yt(Q){return""+Q}function vt(Q){if(et(Q))return N("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",$e(Q)),Yt(Q)}var Vt=S.ReactCurrentOwner,tn={key:!0,ref:!0,__self:!0,__source:!0},un,ae;function Le(Q){if(Te.call(Q,"ref")){var Ye=Object.getOwnPropertyDescriptor(Q,"ref").get;if(Ye&&Ye.isReactWarning)return!1}return Q.ref!==void 0}function at(Q){if(Te.call(Q,"key")){var Ye=Object.getOwnPropertyDescriptor(Q,"key").get;if(Ye&&Ye.isReactWarning)return!1}return Q.key!==void 0}function Pe(Q,Ye){typeof Q.ref=="string"&&Vt.current}function pt(Q,Ye){{var ct=function(){un||(un=!0,N("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",Ye))};ct.isReactWarning=!0,Object.defineProperty(Q,"key",{get:ct,configurable:!0})}}function Ct(Q,Ye){{var ct=function(){ae||(ae=!0,N("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",Ye))};ct.isReactWarning=!0,Object.defineProperty(Q,"ref",{get:ct,configurable:!0})}}var q=function(Q,Ye,ct,ft,_t,xt,D){var ge={$$typeof:e,type:Q,key:Ye,ref:ct,props:D,_owner:xt};return ge._store={},Object.defineProperty(ge._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(ge,"_self",{configurable:!1,enumerable:!1,writable:!1,value:ft}),Object.defineProperty(ge,"_source",{configurable:!1,enumerable:!1,writable:!1,value:_t}),Object.freeze&&(Object.freeze(ge.props),Object.freeze(ge)),ge};function ye(Q,Ye,ct,ft,_t){{var xt,D={},ge=null,Ge=null;ct!==void 0&&(vt(ct),ge=""+ct),at(Ye)&&(vt(Ye.key),ge=""+Ye.key),Le(Ye)&&(Ge=Ye.ref,Pe(Ye,_t));for(xt in Ye)Te.call(Ye,xt)&&!tn.hasOwnProperty(xt)&&(D[xt]=Ye[xt]);if(Q&&Q.defaultProps){var Se=Q.defaultProps;for(xt in Se)D[xt]===void 0&&(D[xt]=Se[xt])}if(ge||Ge){var Ze=typeof Q=="function"?Q.displayName||Q.name||"Unknown":Q;ge&&pt(D,Ze),Ge&&Ct(D,Ze)}return q(Q,ge,Ge,_t,ft,Vt.current,D)}}var gt=S.ReactCurrentOwner,De=S.ReactDebugCurrentFrame;function Ne(Q){if(Q){var Ye=Q._owner,ct=it(Q.type,Q._source,Ye?Ye.type:null);De.setExtraStackFrame(ct)}else De.setExtraStackFrame(null)}var ce;ce=!1;function dt(Q){return typeof Q=="object"&&Q!==null&&Q.$$typeof===e}function wt(){{if(gt.current){var Q=be(gt.current.type);if(Q)return`

Check the render method of \``+Q+"`."}return""}}function rn(Q){return""}var mt={};function mn(Q){{var Ye=wt();if(!Ye){var ct=typeof Q=="string"?Q:Q.displayName||Q.name;ct&&(Ye=`

Check the top-level render call using <`+ct+">.")}return Ye}}function Wn(Q,Ye){{if(!Q._store||Q._store.validated||Q.key!=null)return;Q._store.validated=!0;var ct=mn(Ye);if(mt[ct])return;mt[ct]=!0;var ft="";Q&&Q._owner&&Q._owner!==gt.current&&(ft=" It was passed a child from "+be(Q._owner.type)+"."),Ne(Q),N('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',ct,ft),Ne(null)}}function zn(Q,Ye){{if(typeof Q!="object")return;if(Oe(Q))for(var ct=0;ct<Q.length;ct++){var ft=Q[ct];dt(ft)&&Wn(ft,Ye)}else if(dt(Q))Q._store&&(Q._store.validated=!0);else if(Q){var _t=R(Q);if(typeof _t=="function"&&_t!==Q.entries)for(var xt=_t.call(Q),D;!(D=xt.next()).done;)dt(D.value)&&Wn(D.value,Ye)}}}function Dn(Q){{var Ye=Q.type;if(Ye==null||typeof Ye=="string")return;var ct;if(typeof Ye=="function")ct=Ye.propTypes;else if(typeof Ye=="object"&&(Ye.$$typeof===C||Ye.$$typeof===b))ct=Ye.propTypes;else return;if(ct){var ft=be(Ye);k(ct,Q.props,"prop",ft,Q)}else if(Ye.PropTypes!==void 0&&!ce){ce=!0;var _t=be(Ye);N("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",_t||"Unknown")}typeof Ye.getDefaultProps=="function"&&!Ye.getDefaultProps.isReactClassApproved&&N("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function In(Q){{for(var Ye=Object.keys(Q.props),ct=0;ct<Ye.length;ct++){var ft=Ye[ct];if(ft!=="children"&&ft!=="key"){Ne(Q),N("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",ft),Ne(null);break}}Q.ref!==null&&(Ne(Q),N("Invalid attribute `ref` supplied to `React.Fragment`."),Ne(null))}}var fi={};function ci(Q,Ye,ct,ft,_t,xt){{var D=E(Q);if(!D){var ge="";(Q===void 0||typeof Q=="object"&&Q!==null&&Object.keys(Q).length===0)&&(ge+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Ge=rn();Ge?ge+=Ge:ge+=wt();var Se;Q===null?Se="null":Oe(Q)?Se="array":Q!==void 0&&Q.$$typeof===e?(Se="<"+(be(Q.type)||"Unknown")+" />",ge=" Did you accidentally export a JSX literal instead of a component?"):Se=typeof Q,N("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",Se,ge)}var Ze=ye(Q,Ye,ct,_t,xt);if(Ze==null)return Ze;if(D){var bt=Ye.children;if(bt!==void 0)if(ft)if(Oe(bt)){for(var Ft=0;Ft<bt.length;Ft++)zn(bt[Ft],Q);Object.freeze&&Object.freeze(bt)}else N("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else zn(bt,Q)}if(Te.call(Ye,"key")){var nn=be(Q),jt=Object.keys(Ye).filter(function(Zn){return Zn!=="key"}),Mt=jt.length>0?"{key: someKey, "+jt.join(": ..., ")+": ...}":"{key: someKey}";if(!fi[nn+Mt]){var vn=jt.length>0?"{"+jt.join(": ..., ")+": ...}":"{}";N(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Mt,nn,vn,nn),fi[nn+Mt]=!0}}return Q===n?In(Ze):Dn(Ze),Ze}}function is(Q,Ye,ct){return ci(Q,Ye,ct,!0)}function Rr(Q,Ye,ct){return ci(Q,Ye,ct,!1)}var re=Rr,ot=is;sR.Fragment=n,sR.jsx=re,sR.jsxs=ot})();yE.exports=sR;var Tl=yE.exports,GE={exports:{}},BE={exports:{}},ZE={exports:{}},SE={};(function(r){/**
 * @license React
 * scheduler.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var e=!1,t=5;function n(ae,Le){var at=ae.length;ae.push(Le),c(ae,Le,at)}function a(ae){return ae.length===0?null:ae[0]}function o(ae){if(ae.length===0)return null;var Le=ae[0],at=ae.pop();return at!==Le&&(ae[0]=at,I(ae,at,0)),Le}function c(ae,Le,at){for(var Pe=at;Pe>0;){var pt=Pe-1>>>1,Ct=ae[pt];if(C(Ct,Le)>0)ae[pt]=Le,ae[Pe]=Ct,Pe=pt;else return}}function I(ae,Le,at){for(var Pe=at,pt=ae.length,Ct=pt>>>1;Pe<Ct;){var q=(Pe+1)*2-1,ye=ae[q],gt=q+1,De=ae[gt];if(C(ye,Le)<0)gt<pt&&C(De,ye)<0?(ae[Pe]=De,ae[gt]=Le,Pe=gt):(ae[Pe]=ye,ae[q]=Le,Pe=q);else if(gt<pt&&C(De,Le)<0)ae[Pe]=De,ae[gt]=Le,Pe=gt;else return}}function C(ae,Le){var at=ae.sortIndex-Le.sortIndex;return at!==0?at:ae.id-Le.id}var d=1,f=2,b=3,v=4,y=5;function Z(ae,Le){}var V=typeof performance=="object"&&typeof performance.now=="function";if(V){var R=performance;r.unstable_now=function(){return R.now()}}else{var S=Date,N=S.now();r.unstable_now=function(){return S.now()-N}}var w=1073741823,X=-1,H=250,F=5e3,_=1e4,P=w,K=[],E=[],ee=1,Ie=null,be=b,se=!1,Ce=!1,he=!1,Be=typeof setTimeout=="function"?setTimeout:null,ve=typeof clearTimeout=="function"?clearTimeout:null,we=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function me(ae){for(var Le=a(E);Le!==null;){if(Le.callback===null)o(E);else if(Le.startTime<=ae)o(E),Le.sortIndex=Le.expirationTime,n(K,Le);else return;Le=a(E)}}function Xe(ae){if(he=!1,me(ae),!Ce)if(a(K)!==null)Ce=!0,Yt(Ue);else{var Le=a(E);Le!==null&&vt(Xe,Le.startTime-ae)}}function Ue(ae,Le){Ce=!1,he&&(he=!1,Vt()),se=!0;var at=be;try{var Pe;if(!e)return de(ae,Le)}finally{Ie=null,be=at,se=!1}}function de(ae,Le){var at=Le;for(me(at),Ie=a(K);Ie!==null&&!(Ie.expirationTime>at&&(!ae||Wt()));){var Pe=Ie.callback;if(typeof Pe=="function"){Ie.callback=null,be=Ie.priorityLevel;var pt=Ie.expirationTime<=at,Ct=Pe(pt);at=r.unstable_now(),typeof Ct=="function"?Ie.callback=Ct:Ie===a(K)&&o(K),me(at)}else o(K);Ie=a(K)}if(Ie!==null)return!0;var q=a(E);return q!==null&&vt(Xe,q.startTime-at),!1}function Ee(ae,Le){switch(ae){case d:case f:case b:case v:case y:break;default:ae=b}var at=be;be=ae;try{return Le()}finally{be=at}}function At(ae){var Le;switch(be){case d:case f:case b:Le=b;break;default:Le=be;break}var at=be;be=Le;try{return ae()}finally{be=at}}function Zt(ae){var Le=be;return function(){var at=be;be=Le;try{return ae.apply(this,arguments)}finally{be=at}}}function Bt(ae,Le,at){var Pe=r.unstable_now(),pt;if(typeof at=="object"&&at!==null){var Ct=at.delay;typeof Ct=="number"&&Ct>0?pt=Pe+Ct:pt=Pe}else pt=Pe;var q;switch(ae){case d:q=X;break;case f:q=H;break;case y:q=P;break;case v:q=_;break;case b:default:q=F;break}var ye=pt+q,gt={id:ee++,callback:Le,priorityLevel:ae,startTime:pt,expirationTime:ye,sortIndex:-1};return pt>Pe?(gt.sortIndex=pt,n(E,gt),a(K)===null&&gt===a(E)&&(he?Vt():he=!0,vt(Xe,pt-Pe))):(gt.sortIndex=ye,n(K,gt),!Ce&&!se&&(Ce=!0,Yt(Ue))),gt}function kt(){}function $t(){!Ce&&!se&&(Ce=!0,Yt(Ue))}function Xt(){return a(K)}function Ot(ae){ae.callback=null}function oe(){return be}var ut=!1,_e=null,it=-1,Te=t,Et=-1;function Wt(){var ae=r.unstable_now()-Et;return!(ae<Te)}function O(){}function k(ae){if(ae<0||ae>125){console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported");return}ae>0?Te=Math.floor(1e3/ae):Te=t}var Ae=function(){if(_e!==null){var ae=r.unstable_now();Et=ae;var Le=!0,at=!0;try{at=_e(Le,ae)}finally{at?Oe():(ut=!1,_e=null)}}else ut=!1},Oe;if(typeof we=="function")Oe=function(){we(Ae)};else if(typeof MessageChannel<"u"){var $e=new MessageChannel,et=$e.port2;$e.port1.onmessage=Ae,Oe=function(){et.postMessage(null)}}else Oe=function(){Be(Ae,0)};function Yt(ae){_e=ae,ut||(ut=!0,Oe())}function vt(ae,Le){it=Be(function(){ae(r.unstable_now())},Le)}function Vt(){ve(it),it=-1}var tn=O,un=null;r.unstable_IdlePriority=y,r.unstable_ImmediatePriority=d,r.unstable_LowPriority=v,r.unstable_NormalPriority=b,r.unstable_Profiling=un,r.unstable_UserBlockingPriority=f,r.unstable_cancelCallback=Ot,r.unstable_continueExecution=$t,r.unstable_forceFrameRate=k,r.unstable_getCurrentPriorityLevel=oe,r.unstable_getFirstCallbackNode=Xt,r.unstable_next=At,r.unstable_pauseExecution=kt,r.unstable_requestPaint=tn,r.unstable_runWithPriority=Ee,r.unstable_scheduleCallback=Bt,r.unstable_shouldYield=Wt,r.unstable_wrapCallback=Zt,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})()})(SE);ZE.exports=SE;var XN=ZE.exports;/**
 * @license React
 * react-reconciler.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */BE.exports=function(e){var t={},n=rt,a=XN,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,c=!1;function I(l){c=l}function C(l){if(!c){for(var g=arguments.length,A=new Array(g>1?g-1:0),m=1;m<g;m++)A[m-1]=arguments[m];f("warn",l,A)}}function d(l){if(!c){for(var g=arguments.length,A=new Array(g>1?g-1:0),m=1;m<g;m++)A[m-1]=arguments[m];f("error",l,A)}}function f(l,g,A){{var m=o.ReactDebugCurrentFrame,G=m.getStackAddendum();G!==""&&(g+="%s",A=A.concat([G]));var W=A.map(function(M){return String(M)});W.unshift("Warning: "+g),Function.prototype.apply.call(console[l],console,W)}}var b=Object.assign;function v(l){return l._reactInternals}function y(l,g){l._reactInternals=g}var Z=!1,V=!1,R=!1,S=!1,N=!0,w=!0,X=!0,H=0,F=1,_=2,P=3,K=4,E=5,ee=6,Ie=7,be=8,se=9,Ce=10,he=11,Be=12,ve=13,we=14,me=15,Xe=16,Ue=17,de=18,Ee=19,At=21,Zt=22,Bt=23,kt=24,$t=25,Xt=Symbol.for("react.element"),Ot=Symbol.for("react.portal"),oe=Symbol.for("react.fragment"),ut=Symbol.for("react.strict_mode"),_e=Symbol.for("react.profiler"),it=Symbol.for("react.provider"),Te=Symbol.for("react.context"),Et=Symbol.for("react.forward_ref"),Wt=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),Ae=Symbol.for("react.lazy"),Oe=Symbol.for("react.scope"),$e=Symbol.for("react.debug_trace_mode"),et=Symbol.for("react.offscreen"),Yt=Symbol.for("react.legacy_hidden"),vt=Symbol.for("react.cache"),Vt=Symbol.for("react.tracing_marker"),tn=Symbol.iterator,un="@@iterator";function ae(l){if(l===null||typeof l!="object")return null;var g=tn&&l[tn]||l[un];return typeof g=="function"?g:null}function Le(l,g,A){var m=l.displayName;if(m)return m;var G=g.displayName||g.name||"";return G!==""?A+"("+G+")":A}function at(l){return l.displayName||"Context"}function Pe(l){if(l==null)return null;if(typeof l.tag=="number"&&d("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case oe:return"Fragment";case Ot:return"Portal";case _e:return"Profiler";case ut:return"StrictMode";case Wt:return"Suspense";case O:return"SuspenseList"}if(typeof l=="object")switch(l.$$typeof){case Te:var g=l;return at(g)+".Consumer";case it:var A=l;return at(A._context)+".Provider";case Et:return Le(l,l.render,"ForwardRef");case k:var m=l.displayName||null;return m!==null?m:Pe(l.type)||"Memo";case Ae:{var G=l,W=G._payload,M=G._init;try{return Pe(M(W))}catch{return null}}}return null}function pt(l,g,A){var m=g.displayName||g.name||"";return l.displayName||(m!==""?A+"("+m+")":A)}function Ct(l){return l.displayName||"Context"}function q(l){var g=l.tag,A=l.type;switch(g){case kt:return"Cache";case se:var m=A;return Ct(m)+".Consumer";case Ce:var G=A;return Ct(G._context)+".Provider";case de:return"DehydratedFragment";case he:return pt(A,A.render,"ForwardRef");case Ie:return"Fragment";case E:return A;case K:return"Portal";case P:return"Root";case ee:return"Text";case Xe:return Pe(A);case be:return A===ut?"StrictMode":"Mode";case Zt:return"Offscreen";case Be:return"Profiler";case At:return"Scope";case ve:return"Suspense";case Ee:return"SuspenseList";case $t:return"TracingMarker";case F:case H:case Ue:case _:case we:case me:if(typeof A=="function")return A.displayName||A.name||null;if(typeof A=="string")return A;break}return null}var ye=0,gt=1,De=2,Ne=4,ce=De|Ne,dt=16,wt=32,rn=64,mt=128,mn=256,Wn=512,zn=1024,Dn=2048,In=4096,fi=In|Ne,ci=8192,is=16384,Rr=32767,re=32768,ot=65536,Q=131072,Ye=1048576,ct=2097152,ft=4194304,_t=8388608,xt=16777216,D=33554432,ge=Ne|zn|0,Ge=De|Ne|dt|wt|Wn|In|ci,Se=Ne|rn|Wn|ci,Ze=Dn|dt,bt=ft|_t|ct,Ft=o.ReactCurrentOwner;function nn(l){var g=l,A=l;if(l.alternate)for(;g.return;)g=g.return;else{var m=g;do g=m,(g.flags&(De|In))!==ye&&(A=g.return),m=g.return;while(m)}return g.tag===P?A:null}function jt(l){return nn(l)===l}function Mt(l){{var g=Ft.current;if(g!==null&&g.tag===F){var A=g,m=A.stateNode;m._warnedAboutRefsInRender||d("%s is accessing isMounted inside its render() function. render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",q(A)||"A component"),m._warnedAboutRefsInRender=!0}}var G=v(l);return G?nn(G)===G:!1}function vn(l){if(nn(l)!==l)throw new Error("Unable to find node on an unmounted component.")}function Zn(l){var g=l.alternate;if(!g){var A=nn(l);if(A===null)throw new Error("Unable to find node on an unmounted component.");return A!==l?null:l}for(var m=l,G=g;;){var W=m.return;if(W===null)break;var M=W.alternate;if(M===null){var T=W.return;if(T!==null){m=G=T;continue}break}if(W.child===M.child){for(var U=W.child;U;){if(U===m)return vn(W),l;if(U===G)return vn(W),g;U=U.sibling}throw new Error("Unable to find node on an unmounted component.")}if(m.return!==G.return)m=W,G=M;else{for(var ie=!1,ue=W.child;ue;){if(ue===m){ie=!0,m=W,G=M;break}if(ue===G){ie=!0,G=W,m=M;break}ue=ue.sibling}if(!ie){for(ue=M.child;ue;){if(ue===m){ie=!0,m=M,G=W;break}if(ue===G){ie=!0,G=M,m=W;break}ue=ue.sibling}if(!ie)throw new Error("Child was not found in either parent set. This indicates a bug in React related to the return pointer. Please file an issue.")}}if(m.alternate!==G)throw new Error("Return fibers should always be each others' alternates. This error is likely caused by a bug in React. Please file an issue.")}if(m.tag!==P)throw new Error("Unable to find node on an unmounted component.");return m.stateNode.current===m?l:g}function Si(l){var g=Zn(l);return g!==null?na(g):null}function na(l){if(l.tag===E||l.tag===ee)return l;for(var g=l.child;g!==null;){var A=na(g);if(A!==null)return A;g=g.sibling}return null}function Ji(l){var g=Zn(l);return g!==null?ms(g):null}function ms(l){if(l.tag===E||l.tag===ee)return l;for(var g=l.child;g!==null;){if(g.tag!==K){var A=ms(g);if(A!==null)return A}g=g.sibling}return null}var yi=Array.isArray;function dn(l){return yi(l)}var wr=e.getPublicInstance,xi=e.getRootHostContext,Po=e.getChildHostContext,kl=e.prepareForCommit,Wr=e.resetAfterCommit,to=e.createInstance,Mi=e.appendInitialChild,as=e.finalizeInitialChildren,xr=e.prepareUpdate,ga=e.shouldSetTextContent,Vr=e.createTextInstance,Lg=e.scheduleTimeout,kc=e.cancelTimeout,Uc=e.noTimeout;e.now;var vI=e.isPrimaryRenderer,Dc=e.warnsIfNotActing,no=e.supportsMutation,_g=e.supportsPersistence,Mn=e.supportsHydration,Ab=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var Ul=e.preparePortalMount;e.preparePortalMount,e.getInstanceFromScope;var Xn=e.getCurrentEventPriority,lC=e.detachDeletedInstance,Vs=e.supportsMicrotasks,Jc=e.scheduleMicrotask,So=e.supportsTestSelectors,fb=e.findFiberRoot,za=e.getBoundingRect,Oi=e.getTextContent,kg=e.isHiddenSubtree,Qo=e.matchAccessibilityRole,Ns=e.setFocusIfFocusable,Nr=e.setupIntersectionObserver,pb=e.appendChild,gC=e.appendChildToContainer,FA=e.commitTextUpdate,cC=e.commitMount,yI=e.commitUpdate,mb=e.insertBefore,Ug=e.insertInContainerBefore,Oc=e.removeChild,uC=e.removeChildFromContainer,ol=e.resetTextContent,GI=e.hideInstance,BI=e.hideTextInstance,ZI=e.unhideInstance,KA=e.unhideTextInstance,EA=e.clearContainer,IC=e.cloneInstance,dC=e.createContainerChildSet,L=e.appendChildToContainerChildSet,le=e.finalizeContainerChildren,Ke=e.replaceContainerChildren;e.getOffscreenContainerType,e.getOffscreenContainerProps;var Je=e.cloneHiddenInstance,Nt=e.cloneHiddenTextInstance,yn=e.canHydrateInstance,sn=e.canHydrateTextInstance,xn=e.canHydrateSuspenseInstance,Jn=e.isSuspenseInstancePending,ui=e.isSuspenseInstanceFallback,Hi=e.registerSuspenseInstanceRetry,Gi=e.getNextHydratableSibling,Ln=e.getFirstHydratableChild,Pi=e.getFirstHydratableChildWithinContainer,ma=e.getFirstHydratableChildWithinSuspenseInstance,Pc=e.hydrateInstance,CC=e.hydrateTextInstance,Dl=e.hydrateSuspenseInstance,hC=e.getNextHydratableInstanceAfterSuspenseInstance,SI=e.commitHydratedContainer,bb=e.commitHydratedSuspenseInstance,TA=e.clearSuspenseBoundary,vb=e.clearSuspenseBoundaryFromContainer,IG=e.shouldDeleteUnhydratedTailInstances,yb=e.didNotMatchHydratedContainerTextInstance,dG=e.didNotMatchHydratedTextInstance,CG=e.didNotHydrateInstanceWithinContainer,hG=e.didNotHydrateInstanceWithinSuspenseInstance,$R=e.didNotHydrateInstance,Jl=e.didNotFindHydratableInstanceWithinContainer,ew=e.didNotFindHydratableTextInstanceWithinContainer,Gb=e.didNotFindHydratableSuspenseInstanceWithinContainer,Bb=e.didNotFindHydratableInstanceWithinSuspenseInstance,Zb=e.didNotFindHydratableTextInstanceWithinSuspenseInstance,tw=e.didNotFindHydratableSuspenseInstanceWithinSuspenseInstance,zA=e.didNotFindHydratableInstance,AG=e.didNotFindHydratableTextInstance,io=e.didNotFindHydratableSuspenseInstance,Ol=e.errorHydratingContainer,Qi=0,rl,LA,AC,fG,RI,pG,mG;function _A(){}_A.__reactDisabledLog=!0;function nw(){{if(Qi===0){rl=console.log,LA=console.info,AC=console.warn,fG=console.error,RI=console.group,pG=console.groupCollapsed,mG=console.groupEnd;var l={configurable:!0,enumerable:!0,value:_A,writable:!0};Object.defineProperties(console,{info:l,log:l,warn:l,error:l,group:l,groupCollapsed:l,groupEnd:l})}Qi++}}function iw(){{if(Qi--,Qi===0){var l={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:b({},l,{value:rl}),info:b({},l,{value:LA}),warn:b({},l,{value:AC}),error:b({},l,{value:fG}),group:b({},l,{value:RI}),groupCollapsed:b({},l,{value:pG}),groupEnd:b({},l,{value:mG})})}Qi<0&&d("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Sb=o.ReactCurrentDispatcher,kA;function Dg(l,g,A){{if(kA===void 0)try{throw Error()}catch(G){var m=G.stack.trim().match(/\n( *(at )?)/);kA=m&&m[1]||""}return`
`+kA+l}}var Rb=!1,UA;{var bG=typeof WeakMap=="function"?WeakMap:Map;UA=new bG}function Jg(l,g){if(!l||Rb)return"";{var A=UA.get(l);if(A!==void 0)return A}var m;Rb=!0;var G=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var W;W=Sb.current,Sb.current=null,nw();try{if(g){var M=function(){throw Error()};if(Object.defineProperty(M.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(M,[])}catch(ht){m=ht}Reflect.construct(l,[],M)}else{try{M.call()}catch(ht){m=ht}l.call(M.prototype)}}else{try{throw Error()}catch(ht){m=ht}l()}}catch(ht){if(ht&&m&&typeof ht.stack=="string"){for(var T=ht.stack.split(`
`),U=m.stack.split(`
`),ie=T.length-1,ue=U.length-1;ie>=1&&ue>=0&&T[ie]!==U[ue];)ue--;for(;ie>=1&&ue>=0;ie--,ue--)if(T[ie]!==U[ue]){if(ie!==1||ue!==1)do if(ie--,ue--,ue<0||T[ie]!==U[ue]){var Re=`
`+T[ie].replace(" at new "," at ");return l.displayName&&Re.includes("<anonymous>")&&(Re=Re.replace("<anonymous>",l.displayName)),typeof l=="function"&&UA.set(l,Re),Re}while(ie>=1&&ue>=0);break}}}finally{Rb=!1,Sb.current=W,iw(),Error.prepareStackTrace=G}var ke=l?l.displayName||l.name:"",Qe=ke?Dg(ke):"";return typeof l=="function"&&UA.set(l,Qe),Qe}function wb(l,g,A){return Jg(l,!0)}function DA(l,g,A){return Jg(l,!1)}function vG(l){var g=l.prototype;return!!(g&&g.isReactComponent)}function Wb(l,g,A){if(l==null)return"";if(typeof l=="function")return Jg(l,vG(l));if(typeof l=="string")return Dg(l);switch(l){case Wt:return Dg("Suspense");case O:return Dg("SuspenseList")}if(typeof l=="object")switch(l.$$typeof){case Et:return DA(l.render);case k:return Wb(l.type,g,A);case Ae:{var m=l,G=m._payload,W=m._init;try{return Wb(W(G),g,A)}catch{}}}return""}var yG=Object.prototype.hasOwnProperty,GG={},BG=o.ReactDebugCurrentFrame;function JA(l){if(l){var g=l._owner,A=Wb(l.type,l._source,g?g.type:null);BG.setExtraStackFrame(A)}else BG.setExtraStackFrame(null)}function Xr(l,g,A,m,G){{var W=Function.call.bind(yG);for(var M in l)if(W(l,M)){var T=void 0;try{if(typeof l[M]!="function"){var U=Error((m||"React class")+": "+A+" type `"+M+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof l[M]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw U.name="Invariant Violation",U}T=l[M](g,M,m,A,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(ie){T=ie}T&&!(T instanceof Error)&&(JA(G),d("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",m||"React class",A,M,typeof T),JA(null)),T instanceof Error&&!(T.message in GG)&&(GG[T.message]=!0,JA(G),d("Failed %s type: %s",A,T.message),JA(null))}}}var xb=[],OA;OA=[];var ll=-1;function Og(l){return{current:l}}function ss(l,g){if(ll<0){d("Unexpected pop.");return}g!==OA[ll]&&d("Unexpected Fiber popped."),l.current=xb[ll],xb[ll]=null,OA[ll]=null,ll--}function os(l,g,A){ll++,xb[ll]=l.current,OA[ll]=A,l.current=g}var Vb;Vb={};var Ro={};Object.freeze(Ro);var Pl=Og(Ro),jo=Og(!1),Ql=Ro;function jl(l,g,A){return A&&gl(g)?Ql:Pl.current}function Nb(l,g,A){{var m=l.stateNode;m.__reactInternalMemoizedUnmaskedChildContext=g,m.__reactInternalMemoizedMaskedChildContext=A}}function Yr(l,g){{var A=l.type,m=A.contextTypes;if(!m)return Ro;var G=l.stateNode;if(G&&G.__reactInternalMemoizedUnmaskedChildContext===g)return G.__reactInternalMemoizedMaskedChildContext;var W={};for(var M in m)W[M]=g[M];{var T=q(l)||"Unknown";Xr(m,W,"context",T)}return G&&Nb(l,g,W),W}}function PA(){return jo.current}function gl(l){{var g=l.childContextTypes;return g!=null}}function QA(l){ss(jo,l),ss(Pl,l)}function Xb(l){ss(jo,l),ss(Pl,l)}function ZG(l,g,A){{if(Pl.current!==Ro)throw new Error("Unexpected context found on stack. This error is likely caused by a bug in React. Please file an issue.");os(Pl,g,l),os(jo,A,l)}}function Yb(l,g,A){{var m=l.stateNode,G=g.childContextTypes;if(typeof m.getChildContext!="function"){{var W=q(l)||"Unknown";Vb[W]||(Vb[W]=!0,d("%s.childContextTypes is specified but there is no getChildContext() method on the instance. You can either define getChildContext() on %s or remove childContextTypes from it.",W,W))}return A}var M=m.getChildContext();for(var T in M)if(!(T in G))throw new Error((q(l)||"Unknown")+'.getChildContext(): key "'+T+'" is not defined in childContextTypes.');{var U=q(l)||"Unknown";Xr(G,M,"child context",U)}return b({},A,M)}}function jA(l){{var g=l.stateNode,A=g&&g.__reactInternalMemoizedMergedChildContext||Ro;return Ql=Pl.current,os(Pl,A,l),os(jo,jo.current,l),!0}}function Mb(l,g,A){{var m=l.stateNode;if(!m)throw new Error("Expected to have an instance by this point. This error is likely caused by a bug in React. Please file an issue.");if(A){var G=Yb(l,g,Ql);m.__reactInternalMemoizedMergedChildContext=G,ss(jo,l),ss(Pl,l),os(Pl,G,l),os(jo,A,l)}else ss(jo,l),os(jo,A,l)}}function Xs(l){{if(!jt(l)||l.tag!==F)throw new Error("Expected subtree parent to be a mounted class component. This error is likely caused by a bug in React. Please file an issue.");var g=l;do{switch(g.tag){case P:return g.stateNode.context;case F:{var A=g.type;if(gl(A))return g.stateNode.__reactInternalMemoizedMergedChildContext;break}}g=g.return}while(g!==null);throw new Error("Found unexpected detached subtree parent. This error is likely caused by a bug in React. Please file an issue.")}}var Qc=0,SG=1,Yn=0,Ri=1,Ii=2,ba=8,Mr=16,qA=Math.clz32?Math.clz32:pC,fC=Math.log,aw=Math.LN2;function pC(l){var g=l>>>0;return g===0?32:31-(fC(g)/aw|0)|0}var Hb=31,yt=0,La=0,On=1,Pg=2,wo=4,qo=8,cl=16,mC=32,jc=4194240,bC=64,$A=128,ef=256,tf=512,vC=1024,Fb=2048,nf=4096,Kb=8192,Eb=16384,Tb=32768,qc=65536,yC=131072,$c=262144,af=524288,sf=1048576,GC=2097152,of=130023424,Hr=4194304,wI=8388608,WI=16777216,BC=33554432,zb=67108864,rf=Hr,ZC=134217728,RG=268435455,SC=268435456,ql=536870912,_a=1073741824;function sw(l){{if(l&On)return"Sync";if(l&Pg)return"InputContinuousHydration";if(l&wo)return"InputContinuous";if(l&qo)return"DefaultHydration";if(l&cl)return"Default";if(l&mC)return"TransitionHydration";if(l&jc)return"Transition";if(l&of)return"Retry";if(l&ZC)return"SelectiveHydration";if(l&SC)return"IdleHydration";if(l&ql)return"Idle";if(l&_a)return"Offscreen"}}var Fi=-1,fn=bC,$l=Hr;function ji(l){switch(ng(l)){case On:return On;case Pg:return Pg;case wo:return wo;case qo:return qo;case cl:return cl;case mC:return mC;case bC:case $A:case ef:case tf:case vC:case Fb:case nf:case Kb:case Eb:case Tb:case qc:case yC:case $c:case af:case sf:case GC:return l&jc;case Hr:case wI:case WI:case BC:case zb:return l&of;case ZC:return ZC;case SC:return SC;case ql:return ql;case _a:return _a;default:return d("Should have found matching lanes. This is a bug in React."),l}}function ei(l,g){var A=l.pendingLanes;if(A===yt)return yt;var m=yt,G=l.suspendedLanes,W=l.pingedLanes,M=A&RG;if(M!==yt){var T=M&~G;if(T!==yt)m=ji(T);else{var U=M&W;U!==yt&&(m=ji(U))}}else{var ie=A&~G;ie!==yt?m=ji(ie):W!==yt&&(m=ji(W))}if(m===yt)return yt;if(g!==yt&&g!==m&&(g&G)===yt){var ue=ng(m),Re=ng(g);if(ue>=Re||ue===cl&&(Re&jc)!==yt)return g}(m&wo)!==yt&&(m|=A&cl);var ke=l.entangledLanes;if(ke!==yt)for(var Qe=l.entanglements,ht=m&ke;ht>0;){var Rt=ig(ht),Cn=1<<Rt;m|=Qe[Rt],ht&=~Cn}return m}function eu(l,g){for(var A=l.eventTimes,m=Fi;g>0;){var G=ig(g),W=1<<G,M=A[G];M>m&&(m=M),g&=~W}return m}function RC(l,g){switch(l){case On:case Pg:case wo:return g+250;case qo:case cl:case mC:case bC:case $A:case ef:case tf:case vC:case Fb:case nf:case Kb:case Eb:case Tb:case qc:case yC:case $c:case af:case sf:case GC:return g+5e3;case Hr:case wI:case WI:case BC:case zb:return Fi;case ZC:case SC:case ql:case _a:return Fi;default:return d("Should have found matching lanes. This is a bug in React."),Fi}}function wG(l,g){for(var A=l.pendingLanes,m=l.suspendedLanes,G=l.pingedLanes,W=l.expirationTimes,M=A;M>0;){var T=ig(M),U=1<<T,ie=W[T];ie===Fi?((U&m)===yt||(U&G)!==yt)&&(W[T]=RC(U,g)):ie<=g&&(l.expiredLanes|=U),M&=~U}}function ai(l){return ji(l.pendingLanes)}function Fr(l){var g=l.pendingLanes&~_a;return g!==yt?g:g&_a?_a:yt}function tu(l){return(l&On)!==yt}function Qg(l){return(l&RG)!==yt}function eg(l){return(l&of)===l}function tg(l){return(l&jc)===l}function ul(l,g){var A=Pg|wo|qo|cl;return(g&A)!==yt}function Lb(l,g){return(g&l.expiredLanes)!==yt}function WG(l){return(l&jc)!==0}function lf(){var l=fn;return fn<<=1,fn&jc||(fn=bC),l}function Ys(){var l=$l;return $l<<=1,$l&of||($l=Hr),l}function ng(l){return l&-l}function xI(l){return ng(l)}function ig(l){return 31-qA(l)}function ag(l){return ig(l)}function Ms(l,g){return(l&g)!==yt}function Wo(l,g){return(l&g)===g}function Kn(l,g){return l|g}function VI(l,g){return l&~g}function gf(l,g){return l&g}function cf(l){return l}function NI(l,g){return l!==La&&l<g?l:g}function Kr(l){for(var g=[],A=0;A<Hb;A++)g.push(l);return g}function wC(l,g,A){l.pendingLanes|=g,g!==ql&&(l.suspendedLanes=yt,l.pingedLanes=yt);var m=l.eventTimes,G=ag(g);m[G]=A}function nu(l,g){l.suspendedLanes|=g,l.pingedLanes&=~g;for(var A=l.expirationTimes,m=g;m>0;){var G=ig(m),W=1<<G;A[G]=Fi,m&=~W}}function _b(l,g,A){l.pingedLanes|=l.suspendedLanes&g}function xG(l,g){var A=l.pendingLanes&~g;l.pendingLanes=g,l.suspendedLanes=0,l.pingedLanes=0,l.expiredLanes&=g,l.mutableReadLanes&=g,l.entangledLanes&=g;for(var m=l.entanglements,G=l.eventTimes,W=l.expirationTimes,M=A;M>0;){var T=ig(M),U=1<<T;m[T]=yt,G[T]=Fi,W[T]=Fi,M&=~U}}function kb(l,g){for(var A=l.entangledLanes|=g,m=l.entanglements,G=A;G;){var W=ig(G),M=1<<W;M&g|m[W]&g&&(m[W]|=g),G&=~M}}function ow(l,g){var A=ng(g),m;switch(A){case wo:m=Pg;break;case cl:m=qo;break;case bC:case $A:case ef:case tf:case vC:case Fb:case nf:case Kb:case Eb:case Tb:case qc:case yC:case $c:case af:case sf:case GC:case Hr:case wI:case WI:case BC:case zb:m=mC;break;case ql:m=SC;break;default:m=La;break}return(m&(l.suspendedLanes|g))!==La?La:m}function Ub(l,g,A){if(wi)for(var m=l.pendingUpdatersLaneMap;A>0;){var G=ag(A),W=1<<G,M=m[G];M.add(g),A&=~W}}function Db(l,g){if(wi)for(var A=l.pendingUpdatersLaneMap,m=l.memoizedUpdaters;g>0;){var G=ag(g),W=1<<G,M=A[G];M.size>0&&(M.forEach(function(T){var U=T.alternate;(U===null||!m.has(U))&&m.add(T)}),M.clear()),g&=~W}}var Er=On,XI=wo,WC=cl,uf=ql,YI=La;function Tr(){return YI}function ka(l){YI=l}function rw(l,g){var A=YI;try{return YI=l,g()}finally{YI=A}}function Ua(l,g){return l!==0&&l<g?l:g}function lw(l,g){return l>g?l:g}function xC(l,g){return l!==0&&l<g}function If(l){var g=ng(l);return xC(Er,g)?xC(XI,g)?Qg(g)?WC:uf:XI:Er}var jg=a.unstable_scheduleCallback,gw=a.unstable_cancelCallback,Jb=a.unstable_shouldYield,cw=a.unstable_requestPaint,Da=a.unstable_now,sg=a.unstable_ImmediatePriority,rs=a.unstable_UserBlockingPriority,zt=a.unstable_NormalPriority,zr=a.unstable_IdlePriority,Lr=a.unstable_yieldValue,uw=a.unstable_setDisableYieldValue,MI=null,bs=null,Pt=null,Il=!1,wi=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u";function Iw(l){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")return!1;var g=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(g.isDisabled)return!0;if(!g.supportsFiber)return d("The installed version of React DevTools is too old and will not work with the current version of React. Please update React DevTools. https://reactjs.org/link/react-devtools"),!0;try{N&&(l=b({},l,{getLaneLabelMap:Aw,injectProfilingHooks:hw})),MI=g.inject(l),bs=g}catch(A){d("React instrumentation encountered an error: %s.",A)}return!!g.checkDCE}function dw(l,g){if(bs&&typeof bs.onScheduleFiberRoot=="function")try{bs.onScheduleFiberRoot(MI,l,g)}catch(A){Il||(Il=!0,d("React instrumentation encountered an error: %s",A))}}function Cw(l,g){if(bs&&typeof bs.onCommitFiberRoot=="function")try{var A=(l.current.flags&mt)===mt;if(w){var m;switch(g){case Er:m=sg;break;case XI:m=rs;break;case WC:m=zt;break;case uf:m=zr;break;default:m=zt;break}bs.onCommitFiberRoot(MI,l,m,A)}}catch(G){Il||(Il=!0,d("React instrumentation encountered an error: %s",G))}}function VG(l){if(bs&&typeof bs.onPostCommitFiberRoot=="function")try{bs.onPostCommitFiberRoot(MI,l)}catch(g){Il||(Il=!0,d("React instrumentation encountered an error: %s",g))}}function VC(l){if(bs&&typeof bs.onCommitFiberUnmount=="function")try{bs.onCommitFiberUnmount(MI,l)}catch(g){Il||(Il=!0,d("React instrumentation encountered an error: %s",g))}}function ia(l){if(typeof Lr=="function"&&(uw(l),I(l)),bs&&typeof bs.setStrictMode=="function")try{bs.setStrictMode(MI,l)}catch(g){Il||(Il=!0,d("React instrumentation encountered an error: %s",g))}}function hw(l){Pt=l}function Aw(){{for(var l=new Map,g=1,A=0;A<Hb;A++){var m=sw(g);l.set(g,m),g*=2}return l}}function fw(l){Pt!==null&&typeof Pt.markCommitStarted=="function"&&Pt.markCommitStarted(l)}function NG(){Pt!==null&&typeof Pt.markCommitStopped=="function"&&Pt.markCommitStopped()}function NC(l){Pt!==null&&typeof Pt.markComponentRenderStarted=="function"&&Pt.markComponentRenderStarted(l)}function HI(){Pt!==null&&typeof Pt.markComponentRenderStopped=="function"&&Pt.markComponentRenderStopped()}function XG(l){Pt!==null&&typeof Pt.markComponentPassiveEffectMountStarted=="function"&&Pt.markComponentPassiveEffectMountStarted(l)}function YG(){Pt!==null&&typeof Pt.markComponentPassiveEffectMountStopped=="function"&&Pt.markComponentPassiveEffectMountStopped()}function pw(l){Pt!==null&&typeof Pt.markComponentPassiveEffectUnmountStarted=="function"&&Pt.markComponentPassiveEffectUnmountStarted(l)}function mw(){Pt!==null&&typeof Pt.markComponentPassiveEffectUnmountStopped=="function"&&Pt.markComponentPassiveEffectUnmountStopped()}function bw(l){Pt!==null&&typeof Pt.markComponentLayoutEffectMountStarted=="function"&&Pt.markComponentLayoutEffectMountStarted(l)}function vw(){Pt!==null&&typeof Pt.markComponentLayoutEffectMountStopped=="function"&&Pt.markComponentLayoutEffectMountStopped()}function MG(l){Pt!==null&&typeof Pt.markComponentLayoutEffectUnmountStarted=="function"&&Pt.markComponentLayoutEffectUnmountStarted(l)}function HG(){Pt!==null&&typeof Pt.markComponentLayoutEffectUnmountStopped=="function"&&Pt.markComponentLayoutEffectUnmountStopped()}function FG(l,g,A){Pt!==null&&typeof Pt.markComponentErrored=="function"&&Pt.markComponentErrored(l,g,A)}function yw(l,g,A){Pt!==null&&typeof Pt.markComponentSuspended=="function"&&Pt.markComponentSuspended(l,g,A)}function KG(l){Pt!==null&&typeof Pt.markLayoutEffectsStarted=="function"&&Pt.markLayoutEffectsStarted(l)}function Gw(){Pt!==null&&typeof Pt.markLayoutEffectsStopped=="function"&&Pt.markLayoutEffectsStopped()}function Bw(l){Pt!==null&&typeof Pt.markPassiveEffectsStarted=="function"&&Pt.markPassiveEffectsStarted(l)}function Ob(){Pt!==null&&typeof Pt.markPassiveEffectsStopped=="function"&&Pt.markPassiveEffectsStopped()}function pn(l){Pt!==null&&typeof Pt.markRenderStarted=="function"&&Pt.markRenderStarted(l)}function jn(){Pt!==null&&typeof Pt.markRenderYielded=="function"&&Pt.markRenderYielded()}function pi(){Pt!==null&&typeof Pt.markRenderStopped=="function"&&Pt.markRenderStopped()}function ca(l){Pt!==null&&typeof Pt.markRenderScheduled=="function"&&Pt.markRenderScheduled(l)}function dl(l,g){Pt!==null&&typeof Pt.markForceUpdateScheduled=="function"&&Pt.markForceUpdateScheduled(l,g)}function df(l,g){Pt!==null&&typeof Pt.markStateUpdateScheduled=="function"&&Pt.markStateUpdateScheduled(l,g)}function Zw(l,g){return l===g&&(l!==0||1/l===1/g)||l!==l&&g!==g}var $o=typeof Object.is=="function"?Object.is:Zw,og=null,XC=!1,It=!1;function xa(l){og===null?og=[l]:og.push(l)}function wn(l){XC=!0,xa(l)}function iu(){XC&&Ja()}function Ja(){if(!It&&og!==null){It=!0;var l=0,g=Tr();try{var A=!0,m=og;for(ka(Er);l<m.length;l++){var G=m[l];do G=G(A);while(G!==null)}og=null,XC=!1}catch(W){throw og!==null&&(og=og.slice(l+1)),jg(sg,Ja),W}finally{ka(g),It=!1}}return null}function qg(l){var g=l.current.memoizedState;return g.isDehydrated}var Cl=o.ReactCurrentBatchConfig,YC=null;function FI(){return Cl.transition}function $g(l,g){if($o(l,g))return!0;if(typeof l!="object"||l===null||typeof g!="object"||g===null)return!1;var A=Object.keys(l),m=Object.keys(g);if(A.length!==m.length)return!1;for(var G=0;G<A.length;G++){var W=A[G];if(!yG.call(g,W)||!$o(l[W],g[W]))return!1}return!0}function Pb(l){switch(l._debugOwner&&l._debugOwner.type,l._debugSource,l.tag){case E:return Dg(l.type);case Xe:return Dg("Lazy");case ve:return Dg("Suspense");case Ee:return Dg("SuspenseList");case H:case _:case me:return DA(l.type);case he:return DA(l.type.render);case F:return wb(l.type);default:return""}}function Cf(l){try{var g="",A=l;do g+=Pb(A),A=A.return;while(A);return g}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var hf=o.ReactDebugCurrentFrame,ao=null,au=!1;function Qb(){{if(ao===null)return null;var l=ao._debugOwner;if(l!==null&&typeof l<"u")return q(l)}return null}function jb(){return ao===null?"":Cf(ao)}function Oa(){hf.getCurrentStack=null,ao=null,au=!1}function va(l){hf.getCurrentStack=jb,ao=l,au=!1}function er(l){au=l}var xo={recordUnsafeLifecycleWarnings:function(l,g){},flushPendingUnsafeLifecycleWarnings:function(){},recordLegacyContextWarning:function(l,g){},flushLegacyContextWarning:function(){},discardPendingWarnings:function(){}};{var qb=function(l){for(var g=null,A=l;A!==null;)A.mode&ba&&(g=A),A=A.return;return g},rg=function(l){var g=[];return l.forEach(function(A){g.push(A)}),g.sort().join(", ")},su=[],ou=[],ec=[],hl=[],ru=[],lu=[],lg=new Set;xo.recordUnsafeLifecycleWarnings=function(l,g){lg.has(l.type)||(typeof g.componentWillMount=="function"&&g.componentWillMount.__suppressDeprecationWarning!==!0&&su.push(l),l.mode&ba&&typeof g.UNSAFE_componentWillMount=="function"&&ou.push(l),typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps.__suppressDeprecationWarning!==!0&&ec.push(l),l.mode&ba&&typeof g.UNSAFE_componentWillReceiveProps=="function"&&hl.push(l),typeof g.componentWillUpdate=="function"&&g.componentWillUpdate.__suppressDeprecationWarning!==!0&&ru.push(l),l.mode&ba&&typeof g.UNSAFE_componentWillUpdate=="function"&&lu.push(l))},xo.flushPendingUnsafeLifecycleWarnings=function(){var l=new Set;su.length>0&&(su.forEach(function(ke){l.add(q(ke)||"Component"),lg.add(ke.type)}),su=[]);var g=new Set;ou.length>0&&(ou.forEach(function(ke){g.add(q(ke)||"Component"),lg.add(ke.type)}),ou=[]);var A=new Set;ec.length>0&&(ec.forEach(function(ke){A.add(q(ke)||"Component"),lg.add(ke.type)}),ec=[]);var m=new Set;hl.length>0&&(hl.forEach(function(ke){m.add(q(ke)||"Component"),lg.add(ke.type)}),hl=[]);var G=new Set;ru.length>0&&(ru.forEach(function(ke){G.add(q(ke)||"Component"),lg.add(ke.type)}),ru=[]);var W=new Set;if(lu.length>0&&(lu.forEach(function(ke){W.add(q(ke)||"Component"),lg.add(ke.type)}),lu=[]),g.size>0){var M=rg(g);d(`Using UNSAFE_componentWillMount in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.

Please update the following components: %s`,M)}if(m.size>0){var T=rg(m);d(`Using UNSAFE_componentWillReceiveProps in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state

Please update the following components: %s`,T)}if(W.size>0){var U=rg(W);d(`Using UNSAFE_componentWillUpdate in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.

Please update the following components: %s`,U)}if(l.size>0){var ie=rg(l);C(`componentWillMount has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.
* Rename componentWillMount to UNSAFE_componentWillMount to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,ie)}if(A.size>0){var ue=rg(A);C(`componentWillReceiveProps has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state
* Rename componentWillReceiveProps to UNSAFE_componentWillReceiveProps to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,ue)}if(G.size>0){var Re=rg(G);C(`componentWillUpdate has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* Rename componentWillUpdate to UNSAFE_componentWillUpdate to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,Re)}};var KI=new Map,$b=new Set;xo.recordLegacyContextWarning=function(l,g){var A=qb(l);if(A===null){d("Expected to find a StrictMode component in a strict mode tree. This error is likely caused by a bug in React. Please file an issue.");return}if(!$b.has(l.type)){var m=KI.get(A);(l.type.contextTypes!=null||l.type.childContextTypes!=null||g!==null&&typeof g.getChildContext=="function")&&(m===void 0&&(m=[],KI.set(A,m)),m.push(l))}},xo.flushLegacyContextWarning=function(){KI.forEach(function(l,g){if(l.length!==0){var A=l[0],m=new Set;l.forEach(function(W){m.add(q(W)||"Component"),$b.add(W.type)});var G=rg(m);try{va(A),d(`Legacy context API has been detected within a strict-mode tree.

The old API will be supported in all 16.x releases, but applications using it should migrate to the new version.

Please update the following components: %s

Learn more about this warning here: https://reactjs.org/link/legacy-context`,G)}finally{Oa()}}})},xo.discardPendingWarnings=function(){su=[],ou=[],ec=[],hl=[],ru=[],lu=[],KI=new Map}}function EI(l){{var g=typeof Symbol=="function"&&Symbol.toStringTag,A=g&&l[Symbol.toStringTag]||l.constructor.name||"Object";return A}}function ev(l){try{return gu(l),!1}catch{return!0}}function gu(l){return""+l}function cu(l){if(ev(l))return d("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",EI(l)),gu(l)}function Vo(l,g){if(ev(l))return d("The provided `%s` prop is an unsupported type %s. This value must be coerced to a string before before using it here.",g,EI(l)),gu(l)}function _r(l,g){if(l&&l.defaultProps){var A=b({},g),m=l.defaultProps;for(var G in m)A[G]===void 0&&(A[G]=m[G]);return A}return g}var Bi=Og(null),tc;tc={};var uu=null,Al=null,TI=null,Af=!1;function ff(){uu=null,Al=null,TI=null,Af=!1}function EG(){Af=!0}function TG(){Af=!1}function pf(l,g,A){vI?(os(Bi,g._currentValue,l),g._currentValue=A,g._currentRenderer!==void 0&&g._currentRenderer!==null&&g._currentRenderer!==tc&&d("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),g._currentRenderer=tc):(os(Bi,g._currentValue2,l),g._currentValue2=A,g._currentRenderer2!==void 0&&g._currentRenderer2!==null&&g._currentRenderer2!==tc&&d("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),g._currentRenderer2=tc)}function tv(l,g){var A=Bi.current;ss(Bi,g),vI?l._currentValue=A:l._currentValue2=A}function MC(l,g,A){for(var m=l;m!==null;){var G=m.alternate;if(Wo(m.childLanes,g)?G!==null&&!Wo(G.childLanes,g)&&(G.childLanes=Kn(G.childLanes,g)):(m.childLanes=Kn(m.childLanes,g),G!==null&&(G.childLanes=Kn(G.childLanes,g))),m===A)break;m=m.return}m!==A&&d("Expected to find the propagation root when scheduling context work. This error is likely caused by a bug in React. Please file an issue.")}function zG(l,g,A){Sw(l,g,A)}function Sw(l,g,A){var m=l.child;for(m!==null&&(m.return=l);m!==null;){var G=void 0,W=m.dependencies;if(W!==null){G=m.child;for(var M=W.firstContext;M!==null;){if(M.context===g){if(m.tag===F){var T=xI(A),U=fl(Fi,T);U.tag=ic;var ie=m.updateQueue;if(ie!==null){var ue=ie.shared,Re=ue.pending;Re===null?U.next=U:(U.next=Re.next,Re.next=U),ue.pending=U}}m.lanes=Kn(m.lanes,A);var ke=m.alternate;ke!==null&&(ke.lanes=Kn(ke.lanes,A)),MC(m.return,A,l),W.lanes=Kn(W.lanes,A);break}M=M.next}}else if(m.tag===Ce)G=m.type===l.type?null:m.child;else if(m.tag===de){var Qe=m.return;if(Qe===null)throw new Error("We just came from a parent so we must have had a parent. This is a bug in React.");Qe.lanes=Kn(Qe.lanes,A);var ht=Qe.alternate;ht!==null&&(ht.lanes=Kn(ht.lanes,A)),MC(Qe,A,l),G=m.sibling}else G=m.child;if(G!==null)G.return=m;else for(G=m;G!==null;){if(G===l){G=null;break}var Rt=G.sibling;if(Rt!==null){Rt.return=G.return,G=Rt;break}G=G.return}m=G}}function zI(l,g){uu=l,Al=null,TI=null;var A=l.dependencies;if(A!==null){var m=A.firstContext;m!==null&&(Ms(A.lanes,g)&&pc(),A.firstContext=null)}}function aa(l){Af&&d("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");var g=vI?l._currentValue:l._currentValue2;if(TI!==l){var A={context:l,memoizedValue:g,next:null};if(Al===null){if(uu===null)throw new Error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");Al=A,uu.dependencies={lanes:yt,firstContext:A}}else Al=Al.next=A}return g}var Iu=null;function nv(l){Iu===null?Iu=[l]:Iu.push(l)}function LG(){if(Iu!==null){for(var l=0;l<Iu.length;l++){var g=Iu[l],A=g.interleaved;if(A!==null){g.interleaved=null;var m=A.next,G=g.pending;if(G!==null){var W=G.next;G.next=m,A.next=W}g.pending=A}}Iu=null}}var _G=0,nc=1,ic=2,gg=3,LI=!1,Hs,cg;Hs=!1,cg=null;function Fn(l){var g={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:yt},effects:null};l.updateQueue=g}function HC(l,g){var A=g.updateQueue,m=l.updateQueue;if(A===m){var G={baseState:m.baseState,firstBaseUpdate:m.firstBaseUpdate,lastBaseUpdate:m.lastBaseUpdate,shared:m.shared,effects:m.effects};g.updateQueue=G}}function fl(l,g){var A={eventTime:l,lane:g,tag:_G,payload:null,callback:null,next:null};return A}function du(l,g,A){var m=l.updateQueue;if(m!==null){var G=m.shared;if(_u(l)){var W=G.interleaved;W===null?(g.next=g,nv(G)):(g.next=W.next,W.next=g),G.interleaved=g}else{var M=G.pending;M===null?g.next=g:(g.next=M.next,M.next=g),G.pending=g}cg===G&&!Hs&&(d("An update (setState, replaceState, or forceUpdate) was scheduled from inside an update function. Update functions should be pure, with zero side-effects. Consider using componentDidUpdate or a callback."),Hs=!0)}}function mf(l,g,A){var m=g.updateQueue;if(m!==null){var G=m.shared;if(WG(A)){var W=G.lanes;W=gf(W,l.pendingLanes);var M=Kn(W,A);G.lanes=M,kb(l,M)}}}function FC(l,g){var A=l.updateQueue,m=l.alternate;if(m!==null){var G=m.updateQueue;if(A===G){var W=null,M=null,T=A.firstBaseUpdate;if(T!==null){var U=T;do{var ie={eventTime:U.eventTime,lane:U.lane,tag:U.tag,payload:U.payload,callback:U.callback,next:null};M===null?W=M=ie:(M.next=ie,M=ie),U=U.next}while(U!==null);M===null?W=M=g:(M.next=g,M=g)}else W=M=g;A={baseState:G.baseState,firstBaseUpdate:W,lastBaseUpdate:M,shared:G.shared,effects:G.effects},l.updateQueue=A;return}}var ue=A.lastBaseUpdate;ue===null?A.firstBaseUpdate=g:ue.next=g,A.lastBaseUpdate=g}function KC(l,g,A,m,G,W){switch(A.tag){case nc:{var M=A.payload;if(typeof M=="function"){EG();var T=M.call(W,m,G);{if(l.mode&ba){ia(!0);try{M.call(W,m,G)}finally{ia(!1)}}TG()}return T}return M}case gg:l.flags=l.flags&~ot|mt;case _G:{var U=A.payload,ie;if(typeof U=="function"){EG(),ie=U.call(W,m,G);{if(l.mode&ba){ia(!0);try{U.call(W,m,G)}finally{ia(!1)}}TG()}}else ie=U;return ie==null?m:b({},m,ie)}case ic:return LI=!0,m}return m}function bf(l,g,A,m){var G=l.updateQueue;LI=!1,cg=G.shared;var W=G.firstBaseUpdate,M=G.lastBaseUpdate,T=G.shared.pending;if(T!==null){G.shared.pending=null;var U=T,ie=U.next;U.next=null,M===null?W=ie:M.next=ie,M=U;var ue=l.alternate;if(ue!==null){var Re=ue.updateQueue,ke=Re.lastBaseUpdate;ke!==M&&(ke===null?Re.firstBaseUpdate=ie:ke.next=ie,Re.lastBaseUpdate=U)}}if(W!==null){var Qe=G.baseState,ht=yt,Rt=null,Cn=null,En=null,Gn=W;do{var Ei=Gn.lane,Ti=Gn.eventTime;if(Wo(m,Ei)){if(En!==null){var tt={eventTime:Ti,lane:La,tag:Gn.tag,payload:Gn.payload,callback:Gn.callback,next:null};En=En.next=tt}Qe=KC(l,G,Gn,Qe,g,A);var Ve=Gn.callback;if(Ve!==null&&Gn.lane!==La){l.flags|=rn;var Gt=G.effects;Gt===null?G.effects=[Gn]:Gt.push(Gn)}}else{var Me={eventTime:Ti,lane:Ei,tag:Gn.tag,payload:Gn.payload,callback:Gn.callback,next:null};En===null?(Cn=En=Me,Rt=Qe):En=En.next=Me,ht=Kn(ht,Ei)}if(Gn=Gn.next,Gn===null){if(T=G.shared.pending,T===null)break;var ln=T,Tt=ln.next;ln.next=null,Gn=Tt,G.lastBaseUpdate=ln,G.shared.pending=null}}while(!0);En===null&&(Rt=Qe),G.baseState=Rt,G.firstBaseUpdate=Cn,G.lastBaseUpdate=En;var _n=G.shared.interleaved;if(_n!==null){var ri=_n;do ht=Kn(ht,ri.lane),ri=ri.next;while(ri!==_n)}else W===null&&(G.shared.lanes=yt);Sd(ht),l.lanes=ht,l.memoizedState=Qe}cg=null}function kG(l,g){if(typeof l!="function")throw new Error("Invalid argument passed as callback. Expected a function. Instead "+("received: "+l));l.call(g)}function UG(){LI=!1}function _I(){return LI}function DG(l,g,A){var m=g.effects;if(g.effects=null,m!==null)for(var G=0;G<m.length;G++){var W=m[G],M=W.callback;M!==null&&(W.callback=null,kG(M,A))}}var vf={},iv=new n.Component().refs,yf,Fs,kr,Ur,kI,UI,so,ya,av,sv;{yf=new Set,Fs=new Set,kr=new Set,Ur=new Set,ya=new Set,kI=new Set,av=new Set,sv=new Set;var JG=new Set;so=function(l,g){if(!(l===null||typeof l=="function")){var A=g+"_"+l;JG.has(A)||(JG.add(A),d("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",g,l))}},UI=function(l,g){if(g===void 0){var A=Pe(l)||"Component";kI.has(A)||(kI.add(A),d("%s.getDerivedStateFromProps(): A valid state object (or null) must be returned. You have returned undefined.",A))}},Object.defineProperty(vf,"_processChildContext",{enumerable:!1,value:function(){throw new Error("_processChildContext is not available in React 16+. This likely means you have multiple copies of React and are attempting to nest a React 15 tree inside a React 16 tree using unstable_renderSubtreeIntoContainer, which isn't supported. Try to make sure you have only one copy of React (and ideally, switch to ReactDOM.createPortal).")}}),Object.freeze(vf)}function EC(l,g,A,m){var G=l.memoizedState,W=A(m,G);{if(l.mode&ba){ia(!0);try{W=A(m,G)}finally{ia(!1)}}UI(g,W)}var M=W==null?G:b({},G,W);if(l.memoizedState=M,l.lanes===yt){var T=l.updateQueue;T.baseState=M}}var Gf={isMounted:Mt,enqueueSetState:function(l,g,A){var m=v(l),G=ws(),W=bg(m),M=fl(G,W);M.payload=g,A!=null&&(so(A,"setState"),M.callback=A),du(m,M);var T=ha(m,W,G);T!==null&&mf(T,m,W),df(m,W)},enqueueReplaceState:function(l,g,A){var m=v(l),G=ws(),W=bg(m),M=fl(G,W);M.tag=nc,M.payload=g,A!=null&&(so(A,"replaceState"),M.callback=A),du(m,M);var T=ha(m,W,G);T!==null&&mf(T,m,W),df(m,W)},enqueueForceUpdate:function(l,g){var A=v(l),m=ws(),G=bg(A),W=fl(m,G);W.tag=ic,g!=null&&(so(g,"forceUpdate"),W.callback=g),du(A,W);var M=ha(A,G,m);M!==null&&mf(M,A,G),dl(A,G)}};function TC(l,g,A,m,G,W,M){var T=l.stateNode;if(typeof T.shouldComponentUpdate=="function"){var U=T.shouldComponentUpdate(m,W,M);{if(l.mode&ba){ia(!0);try{U=T.shouldComponentUpdate(m,W,M)}finally{ia(!1)}}U===void 0&&d("%s.shouldComponentUpdate(): Returned undefined instead of a boolean value. Make sure to return true or false.",Pe(g)||"Component")}return U}return g.prototype&&g.prototype.isPureReactComponent?!$g(A,m)||!$g(G,W):!0}function OG(l,g,A){var m=l.stateNode;{var G=Pe(g)||"Component",W=m.render;W||(g.prototype&&typeof g.prototype.render=="function"?d("%s(...): No `render` method found on the returned component instance: did you accidentally return an object from the constructor?",G):d("%s(...): No `render` method found on the returned component instance: you may have forgotten to define `render`.",G)),m.getInitialState&&!m.getInitialState.isReactClassApproved&&!m.state&&d("getInitialState was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?",G),m.getDefaultProps&&!m.getDefaultProps.isReactClassApproved&&d("getDefaultProps was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.",G),m.propTypes&&d("propTypes was defined as an instance property on %s. Use a static property to define propTypes instead.",G),m.contextType&&d("contextType was defined as an instance property on %s. Use a static property to define contextType instead.",G),m.contextTypes&&d("contextTypes was defined as an instance property on %s. Use a static property to define contextTypes instead.",G),g.contextType&&g.contextTypes&&!av.has(g)&&(av.add(g),d("%s declares both contextTypes and contextType static properties. The legacy contextTypes property will be ignored.",G)),typeof m.componentShouldUpdate=="function"&&d("%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",G),g.prototype&&g.prototype.isPureReactComponent&&typeof m.shouldComponentUpdate<"u"&&d("%s has a method called shouldComponentUpdate(). shouldComponentUpdate should not be used when extending React.PureComponent. Please extend React.Component if shouldComponentUpdate is used.",Pe(g)||"A pure component"),typeof m.componentDidUnmount=="function"&&d("%s has a method called componentDidUnmount(). But there is no such lifecycle method. Did you mean componentWillUnmount()?",G),typeof m.componentDidReceiveProps=="function"&&d("%s has a method called componentDidReceiveProps(). But there is no such lifecycle method. If you meant to update the state in response to changing props, use componentWillReceiveProps(). If you meant to fetch data or run side-effects or mutations after React has updated the UI, use componentDidUpdate().",G),typeof m.componentWillRecieveProps=="function"&&d("%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",G),typeof m.UNSAFE_componentWillRecieveProps=="function"&&d("%s has a method called UNSAFE_componentWillRecieveProps(). Did you mean UNSAFE_componentWillReceiveProps()?",G);var M=m.props!==A;m.props!==void 0&&M&&d("%s(...): When calling super() in `%s`, make sure to pass up the same props that your component's constructor was passed.",G,G),m.defaultProps&&d("Setting defaultProps as an instance property on %s is not supported and will be ignored. Instead, define defaultProps as a static property on %s.",G,G),typeof m.getSnapshotBeforeUpdate=="function"&&typeof m.componentDidUpdate!="function"&&!kr.has(g)&&(kr.add(g),d("%s: getSnapshotBeforeUpdate() should be used with componentDidUpdate(). This component defines getSnapshotBeforeUpdate() only.",Pe(g))),typeof m.getDerivedStateFromProps=="function"&&d("%s: getDerivedStateFromProps() is defined as an instance method and will be ignored. Instead, declare it as a static method.",G),typeof m.getDerivedStateFromError=="function"&&d("%s: getDerivedStateFromError() is defined as an instance method and will be ignored. Instead, declare it as a static method.",G),typeof g.getSnapshotBeforeUpdate=="function"&&d("%s: getSnapshotBeforeUpdate() is defined as a static method and will be ignored. Instead, declare it as an instance method.",G);var T=m.state;T&&(typeof T!="object"||dn(T))&&d("%s.state: must be set to an object or null",G),typeof m.getChildContext=="function"&&typeof g.childContextTypes!="object"&&d("%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",G)}}function PG(l,g){g.updater=Gf,l.stateNode=g,y(g,l),g._reactInternalInstance=vf}function QG(l,g,A){var m=!1,G=Ro,W=Ro,M=g.contextType;if("contextType"in g){var T=M===null||M!==void 0&&M.$$typeof===Te&&M._context===void 0;if(!T&&!sv.has(g)){sv.add(g);var U="";M===void 0?U=" However, it is set to undefined. This can be caused by a typo or by mixing up named and default imports. This can also happen due to a circular dependency, so try moving the createContext() call to a separate file.":typeof M!="object"?U=" However, it is set to a "+typeof M+".":M.$$typeof===it?U=" Did you accidentally pass the Context.Provider instead?":M._context!==void 0?U=" Did you accidentally pass the Context.Consumer instead?":U=" However, it is set to an object with keys {"+Object.keys(M).join(", ")+"}.",d("%s defines an invalid contextType. contextType should point to the Context object returned by React.createContext().%s",Pe(g)||"Component",U)}}if(typeof M=="object"&&M!==null)W=aa(M);else{G=jl(l,g,!0);var ie=g.contextTypes;m=ie!=null,W=m?Yr(l,G):Ro}var ue=new g(A,W);if(l.mode&ba){ia(!0);try{ue=new g(A,W)}finally{ia(!1)}}var Re=l.memoizedState=ue.state!==null&&ue.state!==void 0?ue.state:null;PG(l,ue);{if(typeof g.getDerivedStateFromProps=="function"&&Re===null){var ke=Pe(g)||"Component";Fs.has(ke)||(Fs.add(ke),d("`%s` uses `getDerivedStateFromProps` but its initial state is %s. This is not recommended. Instead, define the initial state by assigning an object to `this.state` in the constructor of `%s`. This ensures that `getDerivedStateFromProps` arguments have a consistent shape.",ke,ue.state===null?"null":"undefined",ke))}if(typeof g.getDerivedStateFromProps=="function"||typeof ue.getSnapshotBeforeUpdate=="function"){var Qe=null,ht=null,Rt=null;if(typeof ue.componentWillMount=="function"&&ue.componentWillMount.__suppressDeprecationWarning!==!0?Qe="componentWillMount":typeof ue.UNSAFE_componentWillMount=="function"&&(Qe="UNSAFE_componentWillMount"),typeof ue.componentWillReceiveProps=="function"&&ue.componentWillReceiveProps.__suppressDeprecationWarning!==!0?ht="componentWillReceiveProps":typeof ue.UNSAFE_componentWillReceiveProps=="function"&&(ht="UNSAFE_componentWillReceiveProps"),typeof ue.componentWillUpdate=="function"&&ue.componentWillUpdate.__suppressDeprecationWarning!==!0?Rt="componentWillUpdate":typeof ue.UNSAFE_componentWillUpdate=="function"&&(Rt="UNSAFE_componentWillUpdate"),Qe!==null||ht!==null||Rt!==null){var Cn=Pe(g)||"Component",En=typeof g.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";Ur.has(Cn)||(Ur.add(Cn),d(`Unsafe legacy lifecycles will not be called for components using new component APIs.

%s uses %s but also contains the following legacy lifecycles:%s%s%s

The above lifecycles should be removed. Learn more about this warning here:
https://reactjs.org/link/unsafe-component-lifecycles`,Cn,En,Qe!==null?`
  `+Qe:"",ht!==null?`
  `+ht:"",Rt!==null?`
  `+Rt:""))}}}return m&&Nb(l,G,W),ue}function ov(l,g){var A=g.state;typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),A!==g.state&&(d("%s.componentWillMount(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",q(l)||"Component"),Gf.enqueueReplaceState(g,g.state,null))}function jG(l,g,A,m){var G=g.state;if(typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(A,m),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(A,m),g.state!==G){{var W=q(l)||"Component";yf.has(W)||(yf.add(W),d("%s.componentWillReceiveProps(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",W))}Gf.enqueueReplaceState(g,g.state,null)}}function Bf(l,g,A,m){OG(l,g,A);var G=l.stateNode;G.props=A,G.state=l.memoizedState,G.refs=iv,Fn(l);var W=g.contextType;if(typeof W=="object"&&W!==null)G.context=aa(W);else{var M=jl(l,g,!0);G.context=Yr(l,M)}{if(G.state===A){var T=Pe(g)||"Component";ya.has(T)||(ya.add(T),d("%s: It is not recommended to assign props directly to state because updates to props won't be reflected in state. In most cases, it is better to use props directly.",T))}l.mode&ba&&xo.recordLegacyContextWarning(l,G),xo.recordUnsafeLifecycleWarnings(l,G)}G.state=l.memoizedState;var U=g.getDerivedStateFromProps;if(typeof U=="function"&&(EC(l,g,U,A),G.state=l.memoizedState),typeof g.getDerivedStateFromProps!="function"&&typeof G.getSnapshotBeforeUpdate!="function"&&(typeof G.UNSAFE_componentWillMount=="function"||typeof G.componentWillMount=="function")&&(ov(l,G),bf(l,A,G,m),G.state=l.memoizedState),typeof G.componentDidMount=="function"){var ie=Ne;ie|=ft,(l.mode&Mr)!==Yn&&(ie|=xt),l.flags|=ie}}function Rw(l,g,A,m){var G=l.stateNode,W=l.memoizedProps;G.props=W;var M=G.context,T=g.contextType,U=Ro;if(typeof T=="object"&&T!==null)U=aa(T);else{var ie=jl(l,g,!0);U=Yr(l,ie)}var ue=g.getDerivedStateFromProps,Re=typeof ue=="function"||typeof G.getSnapshotBeforeUpdate=="function";!Re&&(typeof G.UNSAFE_componentWillReceiveProps=="function"||typeof G.componentWillReceiveProps=="function")&&(W!==A||M!==U)&&jG(l,G,A,U),UG();var ke=l.memoizedState,Qe=G.state=ke;if(bf(l,A,G,m),Qe=l.memoizedState,W===A&&ke===Qe&&!PA()&&!_I()){if(typeof G.componentDidMount=="function"){var ht=Ne;ht|=ft,(l.mode&Mr)!==Yn&&(ht|=xt),l.flags|=ht}return!1}typeof ue=="function"&&(EC(l,g,ue,A),Qe=l.memoizedState);var Rt=_I()||TC(l,g,W,A,ke,Qe,U);if(Rt){if(!Re&&(typeof G.UNSAFE_componentWillMount=="function"||typeof G.componentWillMount=="function")&&(typeof G.componentWillMount=="function"&&G.componentWillMount(),typeof G.UNSAFE_componentWillMount=="function"&&G.UNSAFE_componentWillMount()),typeof G.componentDidMount=="function"){var Cn=Ne;Cn|=ft,(l.mode&Mr)!==Yn&&(Cn|=xt),l.flags|=Cn}}else{if(typeof G.componentDidMount=="function"){var En=Ne;En|=ft,(l.mode&Mr)!==Yn&&(En|=xt),l.flags|=En}l.memoizedProps=A,l.memoizedState=Qe}return G.props=A,G.state=Qe,G.context=U,Rt}function qG(l,g,A,m,G){var W=g.stateNode;HC(l,g);var M=g.memoizedProps,T=g.type===g.elementType?M:_r(g.type,M);W.props=T;var U=g.pendingProps,ie=W.context,ue=A.contextType,Re=Ro;if(typeof ue=="object"&&ue!==null)Re=aa(ue);else{var ke=jl(g,A,!0);Re=Yr(g,ke)}var Qe=A.getDerivedStateFromProps,ht=typeof Qe=="function"||typeof W.getSnapshotBeforeUpdate=="function";!ht&&(typeof W.UNSAFE_componentWillReceiveProps=="function"||typeof W.componentWillReceiveProps=="function")&&(M!==U||ie!==Re)&&jG(g,W,m,Re),UG();var Rt=g.memoizedState,Cn=W.state=Rt;if(bf(g,m,W,G),Cn=g.memoizedState,M===U&&Rt===Cn&&!PA()&&!_I()&&!V)return typeof W.componentDidUpdate=="function"&&(M!==l.memoizedProps||Rt!==l.memoizedState)&&(g.flags|=Ne),typeof W.getSnapshotBeforeUpdate=="function"&&(M!==l.memoizedProps||Rt!==l.memoizedState)&&(g.flags|=zn),!1;typeof Qe=="function"&&(EC(g,A,Qe,m),Cn=g.memoizedState);var En=_I()||TC(g,A,T,m,Rt,Cn,Re)||V;return En?(!ht&&(typeof W.UNSAFE_componentWillUpdate=="function"||typeof W.componentWillUpdate=="function")&&(typeof W.componentWillUpdate=="function"&&W.componentWillUpdate(m,Cn,Re),typeof W.UNSAFE_componentWillUpdate=="function"&&W.UNSAFE_componentWillUpdate(m,Cn,Re)),typeof W.componentDidUpdate=="function"&&(g.flags|=Ne),typeof W.getSnapshotBeforeUpdate=="function"&&(g.flags|=zn)):(typeof W.componentDidUpdate=="function"&&(M!==l.memoizedProps||Rt!==l.memoizedState)&&(g.flags|=Ne),typeof W.getSnapshotBeforeUpdate=="function"&&(M!==l.memoizedProps||Rt!==l.memoizedState)&&(g.flags|=zn),g.memoizedProps=m,g.memoizedState=Cn),W.props=m,W.state=Cn,W.context=Re,En}var DI=[],Cu=0,Zf=null,JI=0,Ks=[],Va=0,oo=null,vs=1,No="";function zC(l){return oc(),(l.flags&Ye)!==ye}function ac(l){return oc(),JI}function ww(){var l=No,g=vs,A=g&~Ww(g);return A.toString(32)+l}function hu(l,g){oc(),DI[Cu++]=JI,DI[Cu++]=Zf,Zf=l,JI=g}function $G(l,g,A){oc(),Ks[Va++]=vs,Ks[Va++]=No,Ks[Va++]=oo,oo=l;var m=vs,G=No,W=sc(m)-1,M=m&~(1<<W),T=A+1,U=sc(g)+W;if(U>30){var ie=W-W%5,ue=(1<<ie)-1,Re=(M&ue).toString(32),ke=M>>ie,Qe=W-ie,ht=sc(g)+Qe,Rt=T<<Qe,Cn=Rt|ke,En=Re+G;vs=1<<ht|Cn,No=En}else{var Gn=T<<W,Ei=Gn|M,Ti=G;vs=1<<U|Ei,No=Ti}}function Sf(l){oc();var g=l.return;if(g!==null){var A=1,m=0;hu(l,A),$G(l,A,m)}}function sc(l){return 32-qA(l)}function Ww(l){return 1<<sc(l)-1}function Rf(l){for(;l===Zf;)Zf=DI[--Cu],DI[Cu]=null,JI=DI[--Cu],DI[Cu]=null;for(;l===oo;)oo=Ks[--Va],Ks[Va]=null,No=Ks[--Va],Ks[Va]=null,vs=Ks[--Va],Ks[Va]=null}function xw(){return oc(),oo!==null?{id:vs,overflow:No}:null}function wf(l,g){oc(),Ks[Va++]=vs,Ks[Va++]=No,Ks[Va++]=oo,vs=g.id,No=g.overflow,oo=l}function oc(){Na()||d("Expected to be hydrating. This is a bug in React. Please file an issue.")}var ls=null,ys=null,Es=!1,tr=!1,pl=null;function eB(){Es&&d("We should not be hydrating here. This is a bug in React. Please file a bug.")}function Vw(){tr=!0}function Nw(l){if(!Mn)return!1;var g=l.stateNode.containerInfo;return ys=Pi(g),ls=l,Es=!0,pl=null,tr=!1,!0}function Xw(l,g,A){return Mn?(ys=ma(g),ls=l,Es=!0,pl=null,tr=!1,A!==null&&wf(l,A),!0):!1}function tB(l,g){switch(l.tag){case P:CG(l.stateNode.containerInfo,g);break;case E:$R(l.type,l.memoizedProps,l.stateNode,g);break;case ve:var A=l.memoizedState;A.dehydrated!==null&&hG(A.dehydrated,g);break}}function Wf(l,g){tB(l,g);var A=AZ();A.stateNode=g,A.return=l;var m=l.deletions;m===null?(l.deletions=[A],l.flags|=dt):m.push(A)}function rv(l,g){{if(tr)return;switch(l.tag){case P:{var A=l.stateNode.containerInfo;switch(g.tag){case E:var m=g.type,G=g.pendingProps;Jl(A,m,G);break;case ee:var W=g.pendingProps;ew(A,W);break;case ve:Gb(A);break}break}case E:{var M=l.type,T=l.memoizedProps,U=l.stateNode;switch(g.tag){case E:var ie=g.type,ue=g.pendingProps;zA(M,T,U,ie,ue);break;case ee:var Re=g.pendingProps;AG(M,T,U,Re);break;case ve:io(M,T,U);break}break}case ve:{var ke=l.memoizedState,Qe=ke.dehydrated;if(Qe!==null)switch(g.tag){case E:var ht=g.type,Rt=g.pendingProps;Bb(Qe,ht,Rt);break;case ee:var Cn=g.pendingProps;Zb(Qe,Cn);break;case ve:tw(Qe);break}break}default:return}}}function LC(l,g){g.flags=g.flags&~In|De,rv(l,g)}function xf(l,g){switch(l.tag){case E:{var A=l.type,m=l.pendingProps,G=yn(g,A,m);return G!==null?(l.stateNode=G,ls=l,ys=Ln(G),!0):!1}case ee:{var W=l.pendingProps,M=sn(g,W);return M!==null?(l.stateNode=M,ls=l,ys=null,!0):!1}case ve:{{var T=xn(g);if(T!==null){var U={dehydrated:T,treeContext:xw(),retryLane:_a};l.memoizedState=U;var ie=fZ(T);return ie.return=l,l.child=ie,ls=l,ys=null,!0}}return!1}default:return!1}}function Vf(l){return(l.mode&Ri)!==Yn&&(l.flags&mt)===ye}function lv(l){throw new Error("Hydration failed because the initial UI does not match what was rendered on the server.")}function gv(l){if(Es){var g=ys;if(!g){Vf(l)&&(rv(ls,l),lv()),LC(ls,l),Es=!1,ls=l;return}var A=g;if(!xf(l,g)){Vf(l)&&(rv(ls,l),lv()),g=Gi(A);var m=ls;if(!g||!xf(l,g)){LC(ls,l),Es=!1,ls=l;return}Wf(m,A)}}}function Yw(l,g,A){if(!Mn)throw new Error("Expected prepareToHydrateHostInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var m=l.stateNode,G=!tr,W=Pc(m,l.type,l.memoizedProps,g,A,l,G);return l.updateQueue=W,W!==null}function Mw(l){if(!Mn)throw new Error("Expected prepareToHydrateHostTextInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var g=l.stateNode,A=l.memoizedProps,m=!tr,G=CC(g,A,l,m);if(G){var W=ls;if(W!==null){var M=(W.mode&Ri)!==Yn;switch(W.tag){case P:{var T=W.stateNode.containerInfo;yb(T,g,A,M);break}case E:{var U=W.type,ie=W.memoizedProps,ue=W.stateNode;dG(U,ie,ue,g,A,M);break}}}}return G}function _C(l){if(!Mn)throw new Error("Expected prepareToHydrateHostSuspenseInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var g=l.memoizedState,A=g!==null?g.dehydrated:null;if(!A)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");Dl(A,l)}function cv(l){if(!Mn)throw new Error("Expected skipPastDehydratedSuspenseInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var g=l.memoizedState,A=g!==null?g.dehydrated:null;if(!A)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");return hC(A)}function OI(l){for(var g=l.return;g!==null&&g.tag!==E&&g.tag!==P&&g.tag!==ve;)g=g.return;ls=g}function kC(l){if(!Mn||l!==ls)return!1;if(!Es)return OI(l),Es=!0,!1;if(l.tag!==P&&(l.tag!==E||IG(l.type)&&!ga(l.type,l.memoizedProps))){var g=ys;if(g)if(Vf(l))uv(l),lv();else for(;g;)Wf(l,g),g=Gi(g)}return OI(l),l.tag===ve?ys=cv(l):ys=ls?Gi(l.stateNode):null,!0}function Hw(){return Es&&ys!==null}function uv(l){for(var g=ys;g;)tB(l,g),g=Gi(g)}function Au(){Mn&&(ls=null,ys=null,Es=!1,tr=!1)}function UC(){pl!==null&&(aZ(pl),pl=null)}function Na(){return Es}function Nf(l){pl===null?pl=[l]:pl.push(l)}var Ts,rc,DC,fu,Iv,Xf=function(l,g){};Ts=!1,rc=!1,DC={},fu={},Iv={},Xf=function(l,g){if(!(l===null||typeof l!="object")&&!(!l._store||l._store.validated||l.key!=null)){if(typeof l._store!="object")throw new Error("React Component in warnForMissingKey should have a _store. This error is likely caused by a bug in React. Please file an issue.");l._store.validated=!0;var A=q(g)||"Component";fu[A]||(fu[A]=!0,d('Each child in a list should have a unique "key" prop. See https://reactjs.org/link/warning-keys for more information.'))}};function pu(l,g,A){var m=A.ref;if(m!==null&&typeof m!="function"&&typeof m!="object"){if((l.mode&ba||S)&&!(A._owner&&A._self&&A._owner.stateNode!==A._self)){var G=q(l)||"Component";DC[G]||(d('A string ref, "%s", has been found within a strict mode tree. String refs are a source of potential bugs and should be avoided. We recommend using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',m),DC[G]=!0)}if(A._owner){var W=A._owner,M;if(W){var T=W;if(T.tag!==F)throw new Error("Function components cannot have string refs. We recommend using useRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref");M=T.stateNode}if(!M)throw new Error("Missing owner for string ref "+m+". This error is likely caused by a bug in React. Please file an issue.");var U=M;Vo(m,"ref");var ie=""+m;if(g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===ie)return g.ref;var ue=function(Re){var ke=U.refs;ke===iv&&(ke=U.refs={}),Re===null?delete ke[ie]:ke[ie]=Re};return ue._stringRef=ie,ue}else{if(typeof m!="string")throw new Error("Expected ref to be a function, a string, an object returned by React.createRef(), or null.");if(!A._owner)throw new Error("Element ref was specified as a string ("+m+`) but no owner was set. This could happen for one of the following reasons:
1. You may be adding a ref to a function component
2. You may be adding a ref to a component that was not created inside a component's render method
3. You have multiple copies of React loaded
See https://reactjs.org/link/refs-must-have-owner for more information.`)}}return m}function lc(l,g){var A=Object.prototype.toString.call(g);throw new Error("Objects are not valid as a React child (found: "+(A==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":A)+"). If you meant to render a collection of children, use an array instead.")}function Yf(l){{var g=q(l)||"Component";if(Iv[g])return;Iv[g]=!0,d("Functions are not valid as a React child. This may happen if you return a Component instead of <Component /> from render. Or maybe you meant to call this function rather than return it.")}}function JC(l){var g=l._payload,A=l._init;return A(g)}function dv(l){function g(Me,tt){if(l){var Ve=Me.deletions;Ve===null?(Me.deletions=[tt],Me.flags|=dt):Ve.push(tt)}}function A(Me,tt){if(!l)return null;for(var Ve=tt;Ve!==null;)g(Me,Ve),Ve=Ve.sibling;return null}function m(Me,tt){for(var Ve=new Map,Gt=tt;Gt!==null;)Gt.key!==null?Ve.set(Gt.key,Gt):Ve.set(Gt.index,Gt),Gt=Gt.sibling;return Ve}function G(Me,tt){var Ve=$a(Me,tt);return Ve.index=0,Ve.sibling=null,Ve}function W(Me,tt,Ve){if(Me.index=Ve,!l)return Me.flags|=Ye,tt;var Gt=Me.alternate;if(Gt!==null){var ln=Gt.index;return ln<tt?(Me.flags|=De,tt):ln}else return Me.flags|=De,tt}function M(Me){return l&&Me.alternate===null&&(Me.flags|=De),Me}function T(Me,tt,Ve,Gt){if(tt===null||tt.tag!==ee){var ln=Pp(Ve,Me.mode,Gt);return ln.return=Me,ln}else{var Tt=G(tt,Ve);return Tt.return=Me,Tt}}function U(Me,tt,Ve,Gt){var ln=Ve.type;if(ln===oe)return ue(Me,tt,Ve.props.children,Gt,Ve.key);if(tt!==null&&(tt.elementType===ln||dZ(tt,Ve)||typeof ln=="object"&&ln!==null&&ln.$$typeof===Ae&&JC(ln)===tt.type)){var Tt=G(tt,Ve.props);return Tt.ref=pu(Me,tt,Ve),Tt.return=Me,Tt._debugSource=Ve._source,Tt._debugOwner=Ve._owner,Tt}var _n=Th(Ve,Me.mode,Gt);return _n.ref=pu(Me,tt,Ve),_n.return=Me,_n}function ie(Me,tt,Ve,Gt){if(tt===null||tt.tag!==K||tt.stateNode.containerInfo!==Ve.containerInfo||tt.stateNode.implementation!==Ve.implementation){var ln=Qp(Ve,Me.mode,Gt);return ln.return=Me,ln}else{var Tt=G(tt,Ve.children||[]);return Tt.return=Me,Tt}}function ue(Me,tt,Ve,Gt,ln){if(tt===null||tt.tag!==Ie){var Tt=Ml(Ve,Me.mode,Gt,ln);return Tt.return=Me,Tt}else{var _n=G(tt,Ve);return _n.return=Me,_n}}function Re(Me,tt,Ve){if(typeof tt=="string"&&tt!==""||typeof tt=="number"){var Gt=Pp(""+tt,Me.mode,Ve);return Gt.return=Me,Gt}if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case Xt:{var ln=Th(tt,Me.mode,Ve);return ln.ref=pu(Me,null,tt),ln.return=Me,ln}case Ot:{var Tt=Qp(tt,Me.mode,Ve);return Tt.return=Me,Tt}case Ae:{var _n=tt._payload,ri=tt._init;return Re(Me,ri(_n),Ve)}}if(dn(tt)||ae(tt)){var qn=Ml(tt,Me.mode,Ve,null);return qn.return=Me,qn}lc(Me,tt)}return typeof tt=="function"&&Yf(Me),null}function ke(Me,tt,Ve,Gt){var ln=tt!==null?tt.key:null;if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return ln!==null?null:T(Me,tt,""+Ve,Gt);if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case Xt:return Ve.key===ln?U(Me,tt,Ve,Gt):null;case Ot:return Ve.key===ln?ie(Me,tt,Ve,Gt):null;case Ae:{var Tt=Ve._payload,_n=Ve._init;return ke(Me,tt,_n(Tt),Gt)}}if(dn(Ve)||ae(Ve))return ln!==null?null:ue(Me,tt,Ve,Gt,null);lc(Me,Ve)}return typeof Ve=="function"&&Yf(Me),null}function Qe(Me,tt,Ve,Gt,ln){if(typeof Gt=="string"&&Gt!==""||typeof Gt=="number"){var Tt=Me.get(Ve)||null;return T(tt,Tt,""+Gt,ln)}if(typeof Gt=="object"&&Gt!==null){switch(Gt.$$typeof){case Xt:{var _n=Me.get(Gt.key===null?Ve:Gt.key)||null;return U(tt,_n,Gt,ln)}case Ot:{var ri=Me.get(Gt.key===null?Ve:Gt.key)||null;return ie(tt,ri,Gt,ln)}case Ae:{var qn=Gt._payload,li=Gt._init;return Qe(Me,tt,Ve,li(qn),ln)}}if(dn(Gt)||ae(Gt)){var ki=Me.get(Ve)||null;return ue(tt,ki,Gt,ln,null)}lc(tt,Gt)}return typeof Gt=="function"&&Yf(tt),null}function ht(Me,tt,Ve){{if(typeof Me!="object"||Me===null)return tt;switch(Me.$$typeof){case Xt:case Ot:Xf(Me,Ve);var Gt=Me.key;if(typeof Gt!="string")break;if(tt===null){tt=new Set,tt.add(Gt);break}if(!tt.has(Gt)){tt.add(Gt);break}d("Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted  the behavior is unsupported and could change in a future version.",Gt);break;case Ae:{var ln=Me._payload,Tt=Me._init;ht(Tt(ln),tt,Ve);break}}}return tt}function Rt(Me,tt,Ve,Gt){for(var ln=null,Tt=0;Tt<Ve.length;Tt++){var _n=Ve[Tt];ln=ht(_n,ln,Me)}for(var ri=null,qn=null,li=tt,ki=0,ti=0,Tn=null;li!==null&&ti<Ve.length;ti++){li.index>ti?(Tn=li,li=null):Tn=li.sibling;var ra=ke(Me,li,Ve[ti],Gt);if(ra===null){li===null&&(li=Tn);break}l&&li&&ra.alternate===null&&g(Me,li),ki=W(ra,ki,ti),qn===null?ri=ra:qn.sibling=ra,qn=ra,li=Tn}if(ti===Ve.length){if(A(Me,li),Na()){var Ui=ti;hu(Me,Ui)}return ri}if(li===null){for(;ti<Ve.length;ti++){var Yo=Re(Me,Ve[ti],Gt);Yo!==null&&(ki=W(Yo,ki,ti),qn===null?ri=Yo:qn.sibling=Yo,qn=Yo)}if(Na()){var Sa=ti;hu(Me,Sa)}return ri}for(var Us=m(Me,li);ti<Ve.length;ti++){var Ds=Qe(Us,Me,ti,Ve[ti],Gt);Ds!==null&&(l&&Ds.alternate!==null&&Us.delete(Ds.key===null?ti:Ds.key),ki=W(Ds,ki,ti),qn===null?ri=Ds:qn.sibling=Ds,qn=Ds)}if(l&&Us.forEach(function(Hl){return g(Me,Hl)}),Na()){var Ar=ti;hu(Me,Ar)}return ri}function Cn(Me,tt,Ve,Gt){var ln=ae(Ve);if(typeof ln!="function")throw new Error("An object is not an iterable. This error is likely caused by a bug in React. Please file an issue.");{typeof Symbol=="function"&&Ve[Symbol.toStringTag]==="Generator"&&(rc||d("Using Generators as children is unsupported and will likely yield unexpected results because enumerating a generator mutates it. You may convert it to an array with `Array.from()` or the `[...spread]` operator before rendering. Keep in mind you might need to polyfill these features for older browsers."),rc=!0),Ve.entries===ln&&(Ts||d("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),Ts=!0);var Tt=ln.call(Ve);if(Tt)for(var _n=null,ri=Tt.next();!ri.done;ri=Tt.next()){var qn=ri.value;_n=ht(qn,_n,Me)}}var li=ln.call(Ve);if(li==null)throw new Error("An iterable object provided no iterator.");for(var ki=null,ti=null,Tn=tt,ra=0,Ui=0,Yo=null,Sa=li.next();Tn!==null&&!Sa.done;Ui++,Sa=li.next()){Tn.index>Ui?(Yo=Tn,Tn=null):Yo=Tn.sibling;var Us=ke(Me,Tn,Sa.value,Gt);if(Us===null){Tn===null&&(Tn=Yo);break}l&&Tn&&Us.alternate===null&&g(Me,Tn),ra=W(Us,ra,Ui),ti===null?ki=Us:ti.sibling=Us,ti=Us,Tn=Yo}if(Sa.done){if(A(Me,Tn),Na()){var Ds=Ui;hu(Me,Ds)}return ki}if(Tn===null){for(;!Sa.done;Ui++,Sa=li.next()){var Ar=Re(Me,Sa.value,Gt);Ar!==null&&(ra=W(Ar,ra,Ui),ti===null?ki=Ar:ti.sibling=Ar,ti=Ar)}if(Na()){var Hl=Ui;hu(Me,Hl)}return ki}for(var Qu=m(Me,Tn);!Sa.done;Ui++,Sa=li.next()){var Js=Qe(Qu,Me,Ui,Sa.value,Gt);Js!==null&&(l&&Js.alternate!==null&&Qu.delete(Js.key===null?Ui:Js.key),ra=W(Js,ra,Ui),ti===null?ki=Js:ti.sibling=Js,ti=Js)}if(l&&Qu.forEach(function(um){return g(Me,um)}),Na()){var Gg=Ui;hu(Me,Gg)}return ki}function En(Me,tt,Ve,Gt){if(tt!==null&&tt.tag===ee){A(Me,tt.sibling);var ln=G(tt,Ve);return ln.return=Me,ln}A(Me,tt);var Tt=Pp(Ve,Me.mode,Gt);return Tt.return=Me,Tt}function Gn(Me,tt,Ve,Gt){for(var ln=Ve.key,Tt=tt;Tt!==null;){if(Tt.key===ln){var _n=Ve.type;if(_n===oe){if(Tt.tag===Ie){A(Me,Tt.sibling);var ri=G(Tt,Ve.props.children);return ri.return=Me,ri._debugSource=Ve._source,ri._debugOwner=Ve._owner,ri}}else if(Tt.elementType===_n||dZ(Tt,Ve)||typeof _n=="object"&&_n!==null&&_n.$$typeof===Ae&&JC(_n)===Tt.type){A(Me,Tt.sibling);var qn=G(Tt,Ve.props);return qn.ref=pu(Me,Tt,Ve),qn.return=Me,qn._debugSource=Ve._source,qn._debugOwner=Ve._owner,qn}A(Me,Tt);break}else g(Me,Tt);Tt=Tt.sibling}if(Ve.type===oe){var li=Ml(Ve.props.children,Me.mode,Gt,Ve.key);return li.return=Me,li}else{var ki=Th(Ve,Me.mode,Gt);return ki.ref=pu(Me,tt,Ve),ki.return=Me,ki}}function Ei(Me,tt,Ve,Gt){for(var ln=Ve.key,Tt=tt;Tt!==null;){if(Tt.key===ln)if(Tt.tag===K&&Tt.stateNode.containerInfo===Ve.containerInfo&&Tt.stateNode.implementation===Ve.implementation){A(Me,Tt.sibling);var _n=G(Tt,Ve.children||[]);return _n.return=Me,_n}else{A(Me,Tt);break}else g(Me,Tt);Tt=Tt.sibling}var ri=Qp(Ve,Me.mode,Gt);return ri.return=Me,ri}function Ti(Me,tt,Ve,Gt){var ln=typeof Ve=="object"&&Ve!==null&&Ve.type===oe&&Ve.key===null;if(ln&&(Ve=Ve.props.children),typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case Xt:return M(Gn(Me,tt,Ve,Gt));case Ot:return M(Ei(Me,tt,Ve,Gt));case Ae:{var Tt=Ve._payload,_n=Ve._init;return Ti(Me,tt,_n(Tt),Gt)}}if(dn(Ve))return Rt(Me,tt,Ve,Gt);if(ae(Ve))return Cn(Me,tt,Ve,Gt);lc(Me,Ve)}return typeof Ve=="string"&&Ve!==""||typeof Ve=="number"?M(En(Me,tt,""+Ve,Gt)):(typeof Ve=="function"&&Yf(Me),A(Me,tt))}return Ti}var PI=dv(!0),nB=dv(!1);function Fw(l,g){if(l!==null&&g.child!==l.child)throw new Error("Resuming work not yet implemented.");if(g.child!==null){var A=g.child,m=$a(A,A.pendingProps);for(g.child=m,m.return=g;A.sibling!==null;)A=A.sibling,m=m.sibling=$a(A,A.pendingProps),m.return=g;m.sibling=null}}function Cv(l,g){for(var A=l.child;A!==null;)hZ(A,g),A=A.sibling}var OC={},gc=Og(OC),PC=Og(OC),Mf=Og(OC);function Hf(l){if(l===OC)throw new Error("Expected host context to exist. This error is likely caused by a bug in React. Please file an issue.");return l}function Ff(){var l=Hf(Mf.current);return l}function hv(l,g){os(Mf,g,l),os(PC,l,l),os(gc,OC,l);var A=xi(g);ss(gc,l),os(gc,A,l)}function QI(l){ss(gc,l),ss(PC,l),ss(Mf,l)}function QC(){var l=Hf(gc.current);return l}function iB(l){var g=Hf(Mf.current),A=Hf(gc.current),m=Po(A,l.type,g);A!==m&&(os(PC,l,l),os(gc,m,l))}function Av(l){PC.current===l&&(ss(gc,l),ss(PC,l))}var Kw=0,Kf=1,aB=1,jC=2,Dr=Og(Kw);function Ef(l,g){return(l&g)!==0}function jI(l){return l&Kf}function fv(l,g){return l&Kf|g}function Ew(l,g){return l|g}function cc(l,g){os(Dr,g,l)}function qI(l){ss(Dr,l)}function Tw(l,g){var A=l.memoizedState;return A!==null?A.dehydrated!==null:(l.memoizedProps,!0)}function Tf(l){for(var g=l;g!==null;){if(g.tag===ve){var A=g.memoizedState;if(A!==null){var m=A.dehydrated;if(m===null||Jn(m)||ui(m))return g}}else if(g.tag===Ee&&g.memoizedProps.revealOrder!==void 0){var G=(g.flags&mt)!==ye;if(G)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===l)return null;for(;g.sibling===null;){if(g.return===null||g.return===l)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Jr=0,Li=1,nr=2,Ia=4,Pa=8,zf=[];function Lf(){for(var l=0;l<zf.length;l++){var g=zf[l];vI?g._workInProgressVersionPrimary=null:g._workInProgressVersionSecondary=null}zf.length=0}function zw(l,g){var A=g._getVersion,m=A(g._source);l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[g,m]:l.mutableSourceEagerHydrationData.push(g,m)}var Qt=o.ReactCurrentDispatcher,ro=o.ReactCurrentBatchConfig,pv,$I;pv=new Set;var mu=yt,Zi=null,gs=null,qi=null,_f=!1,qC=!1,$C=0,Lw=0,_w=25,st=null,Xo=null,uc=-1,mv=!1;function si(){{var l=st;Xo===null?Xo=[l]:Xo.push(l)}}function Ht(){{var l=st;Xo!==null&&(uc++,Xo[uc]!==l&&kw(l))}}function ml(l){l!=null&&!dn(l)&&d("%s received a final argument that is not an array (instead, received `%s`). When specified, the final argument must be an array.",st,typeof l)}function kw(l){{var g=q(Zi);if(!pv.has(g)&&(pv.add(g),Xo!==null)){for(var A="",m=30,G=0;G<=uc;G++){for(var W=Xo[G],M=G===uc?l:W,T=G+1+". "+W;T.length<m;)T+=" ";T+=M+`
`,A+=T}d(`React has detected a change in the order of Hooks called by %s. This will lead to bugs and errors if not fixed. For more information, read the Rules of Hooks: https://reactjs.org/link/rules-of-hooks

   Previous render            Next render
   ------------------------------------------------------
%s   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
`,g,A)}}}function Gs(){throw new Error(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.`)}function bv(l,g){if(mv)return!1;if(g===null)return d("%s received a final argument during this render, but not during the previous render. Even though the final argument is optional, its type cannot change between renders.",st),!1;l.length!==g.length&&d(`The final argument passed to %s changed size between renders. The order and size of this array must remain constant.

Previous: %s
Incoming: %s`,st,"["+g.join(", ")+"]","["+l.join(", ")+"]");for(var A=0;A<g.length&&A<l.length;A++)if(!$o(l[A],g[A]))return!1;return!0}function ug(l,g,A,m,G,W){mu=W,Zi=g,Xo=l!==null?l._debugHookTypes:null,uc=-1,mv=l!==null&&l.type!==g.type,g.memoizedState=null,g.updateQueue=null,g.lanes=yt,l!==null&&l.memoizedState!==null?Qt.current=AB:Xo!==null?Qt.current=Fv:Qt.current=hB;var M=A(m,G);if(qC){var T=0;do{if(qC=!1,$C=0,T>=_w)throw new Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");T+=1,mv=!1,gs=null,qi=null,g.updateQueue=null,uc=-1,Qt.current=Ki,M=A(m,G)}while(qC)}Qt.current=lh,g._debugHookTypes=Xo;var U=gs!==null&&gs.next!==null;if(mu=yt,Zi=null,gs=null,qi=null,st=null,Xo=null,uc=-1,l!==null&&(l.flags&bt)!==(g.flags&bt)&&(l.mode&Ri)!==Yn&&d("Internal React error: Expected static flag was missing. Please notify the React team."),_f=!1,U)throw new Error("Rendered fewer hooks than expected. This may be caused by an accidental early return statement.");return M}function ed(){var l=$C!==0;return $C=0,l}function vv(l,g,A){g.updateQueue=l.updateQueue,(g.mode&Mr)!==Yn?g.flags&=-50333701:g.flags&=-2053,l.lanes=VI(l.lanes,A)}function sB(){if(Qt.current=lh,_f){for(var l=Zi.memoizedState;l!==null;){var g=l.queue;g!==null&&(g.pending=null),l=l.next}_f=!1}mu=yt,Zi=null,gs=null,qi=null,Xo=null,uc=-1,st=null,Hv=!1,qC=!1,$C=0}function bl(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return qi===null?Zi.memoizedState=qi=l:qi=qi.next=l,qi}function Or(){var l;if(gs===null){var g=Zi.alternate;g!==null?l=g.memoizedState:l=null}else l=gs.next;var A;if(qi===null?A=Zi.memoizedState:A=qi.next,A!==null)qi=A,A=qi.next,gs=l;else{if(l===null)throw new Error("Rendered more hooks than during the previous render.");gs=l;var m={memoizedState:gs.memoizedState,baseState:gs.baseState,baseQueue:gs.baseQueue,queue:gs.queue,next:null};qi===null?Zi.memoizedState=qi=m:qi=qi.next=m}return qi}function oB(){return{lastEffect:null,stores:null}}function yv(l,g){return typeof g=="function"?g(l):g}function Gv(l,g,A){var m=bl(),G;A!==void 0?G=A(g):G=g,m.memoizedState=m.baseState=G;var W={pending:null,interleaved:null,lanes:yt,dispatch:null,lastRenderedReducer:l,lastRenderedState:G};m.queue=W;var M=W.dispatch=uB.bind(null,Zi,W);return[m.memoizedState,M]}function Bv(l,g,A){var m=Or(),G=m.queue;if(G===null)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");G.lastRenderedReducer=l;var W=gs,M=W.baseQueue,T=G.pending;if(T!==null){if(M!==null){var U=M.next,ie=T.next;M.next=ie,T.next=U}W.baseQueue!==M&&d("Internal error: Expected work-in-progress queue to be a clone. This is a bug in React."),W.baseQueue=M=T,G.pending=null}if(M!==null){var ue=M.next,Re=W.baseState,ke=null,Qe=null,ht=null,Rt=ue;do{var Cn=Rt.lane;if(Wo(mu,Cn)){if(ht!==null){var Gn={lane:La,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null};ht=ht.next=Gn}if(Rt.hasEagerState)Re=Rt.eagerState;else{var Ei=Rt.action;Re=l(Re,Ei)}}else{var En={lane:Cn,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null};ht===null?(Qe=ht=En,ke=Re):ht=ht.next=En,Zi.lanes=Kn(Zi.lanes,Cn),Sd(Cn)}Rt=Rt.next}while(Rt!==null&&Rt!==ue);ht===null?ke=Re:ht.next=Qe,$o(Re,m.memoizedState)||pc(),m.memoizedState=Re,m.baseState=ke,m.baseQueue=ht,G.lastRenderedState=Re}var Ti=G.interleaved;if(Ti!==null){var Me=Ti;do{var tt=Me.lane;Zi.lanes=Kn(Zi.lanes,tt),Sd(tt),Me=Me.next}while(Me!==Ti)}else M===null&&(G.lanes=yt);var Ve=G.dispatch;return[m.memoizedState,Ve]}function Zv(l,g,A){var m=Or(),G=m.queue;if(G===null)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");G.lastRenderedReducer=l;var W=G.dispatch,M=G.pending,T=m.memoizedState;if(M!==null){G.pending=null;var U=M.next,ie=U;do{var ue=ie.action;T=l(T,ue),ie=ie.next}while(ie!==U);$o(T,m.memoizedState)||pc(),m.memoizedState=T,m.baseQueue===null&&(m.baseState=T),G.lastRenderedState=T}return[T,W]}function k2(l,g,A){}function U2(l,g,A){}function Sv(l,g,A){var m=Zi,G=bl(),W,M=Na();if(M){if(A===void 0)throw new Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");W=A(),$I||W!==A()&&(d("The result of getServerSnapshot should be cached to avoid an infinite loop"),$I=!0)}else{if(W=g(),!$I){var T=g();$o(W,T)||(d("The result of getSnapshot should be cached to avoid an infinite loop"),$I=!0)}var U=Nh();if(U===null)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");ul(U,mu)||rB(m,g,W)}G.memoizedState=W;var ie={value:W,getSnapshot:g};return G.queue=ie,id(td.bind(null,m,ie,l),[l]),m.flags|=Dn,eh(Li|Pa,lo.bind(null,m,ie,W,g),void 0,null),W}function kf(l,g,A){var m=Zi,G=Or(),W=g();if(!$I){var M=g();$o(W,M)||(d("The result of getSnapshot should be cached to avoid an infinite loop"),$I=!0)}var T=G.memoizedState,U=!$o(T,W);U&&(G.memoizedState=W,pc());var ie=G.queue;if(Ig(td.bind(null,m,ie,l),[l]),ie.getSnapshot!==g||U||qi!==null&&qi.memoizedState.tag&Li){m.flags|=Dn,eh(Li|Pa,lo.bind(null,m,ie,W,g),void 0,null);var ue=Nh();if(ue===null)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");ul(ue,mu)||rB(m,g,W)}return W}function rB(l,g,A){l.flags|=is;var m={getSnapshot:g,value:A},G=Zi.updateQueue;if(G===null)G=oB(),Zi.updateQueue=G,G.stores=[m];else{var W=G.stores;W===null?G.stores=[m]:W.push(m)}}function lo(l,g,A,m){g.value=A,g.getSnapshot=m,Rv(g)&&lB(l)}function td(l,g,A){var m=function(){Rv(g)&&lB(l)};return A(m)}function Rv(l){var g=l.getSnapshot,A=l.value;try{var m=g();return!$o(A,m)}catch{return!0}}function lB(l){ha(l,On,Fi)}function nd(l){var g=bl();typeof l=="function"&&(l=l()),g.memoizedState=g.baseState=l;var A={pending:null,interleaved:null,lanes:yt,dispatch:null,lastRenderedReducer:yv,lastRenderedState:l};g.queue=A;var m=A.dispatch=dc.bind(null,Zi,A);return[g.memoizedState,m]}function Uf(l){return Bv(yv)}function Df(l){return Zv(yv)}function eh(l,g,A,m){var G={tag:l,create:g,destroy:A,deps:m,next:null},W=Zi.updateQueue;if(W===null)W=oB(),Zi.updateQueue=W,W.lastEffect=G.next=G;else{var M=W.lastEffect;if(M===null)W.lastEffect=G.next=G;else{var T=M.next;M.next=G,G.next=T,W.lastEffect=G}}return G}function Jf(l){var g=bl();{var A={current:l};return g.memoizedState=A,A}}function th(l){var g=Or();return g.memoizedState}function nh(l,g,A,m){var G=bl(),W=m===void 0?null:m;Zi.flags|=l,G.memoizedState=eh(Li|g,A,void 0,W)}function Of(l,g,A,m){var G=Or(),W=m===void 0?null:m,M=void 0;if(gs!==null){var T=gs.memoizedState;if(M=T.destroy,W!==null){var U=T.deps;if(bv(W,U)){G.memoizedState=eh(g,A,M,W);return}}}Zi.flags|=l,G.memoizedState=eh(Li|g,A,M,W)}function id(l,g){return(Zi.mode&Mr)!==Yn?nh(D|Dn|_t,Pa,l,g):nh(Dn|_t,Pa,l,g)}function Ig(l,g){return Of(Dn,Pa,l,g)}function wv(l,g){return nh(Ne,nr,l,g)}function Pf(l,g){return Of(Ne,nr,l,g)}function Wv(l,g){var A=Ne;return A|=ft,(Zi.mode&Mr)!==Yn&&(A|=xt),nh(A,Ia,l,g)}function Qf(l,g){return Of(Ne,Ia,l,g)}function gB(l,g){if(typeof g=="function"){var A=g,m=l();return A(m),function(){A(null)}}else if(g!=null){var G=g;G.hasOwnProperty("current")||d("Expected useImperativeHandle() first argument to either be a ref callback or React.createRef() object. Instead received: %s.","an object with keys {"+Object.keys(G).join(", ")+"}");var W=l();return G.current=W,function(){G.current=null}}}function xv(l,g,A){typeof g!="function"&&d("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",g!==null?typeof g:"null");var m=A!=null?A.concat([l]):null,G=Ne;return G|=ft,(Zi.mode&Mr)!==Yn&&(G|=xt),nh(G,Ia,gB.bind(null,g,l),m)}function dg(l,g,A){typeof g!="function"&&d("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",g!==null?typeof g:"null");var m=A!=null?A.concat([l]):null;return Of(Ne,Ia,gB.bind(null,g,l),m)}function Vv(l,g){}var Ic=Vv;function ih(l,g){var A=bl(),m=g===void 0?null:g;return A.memoizedState=[l,m],l}function jf(l,g){var A=Or(),m=g===void 0?null:g,G=A.memoizedState;if(G!==null&&m!==null){var W=G[1];if(bv(m,W))return G[0]}return A.memoizedState=[l,m],l}function Nv(l,g){var A=bl(),m=g===void 0?null:g,G=l();return A.memoizedState=[G,m],G}function ah(l,g){var A=Or(),m=g===void 0?null:g,G=A.memoizedState;if(G!==null&&m!==null){var W=G[1];if(bv(m,W))return G[0]}var M=l();return A.memoizedState=[M,m],M}function Xv(l){var g=nd(l),A=g[0],m=g[1];return id(function(){var G=ro.transition;ro.transition={};try{m(l)}finally{ro.transition=G}},[l]),A}function sh(l){var g=Uf(),A=g[0],m=g[1];return Ig(function(){var G=ro.transition;ro.transition={};try{m(l)}finally{ro.transition=G}},[l]),A}function bu(l){var g=Df(),A=g[0],m=g[1];return Ig(function(){var G=ro.transition;ro.transition={};try{m(l)}finally{ro.transition=G}},[l]),A}function Yv(l,g,A){var m=Tr();ka(Ua(m,XI)),l(!0);var G=ro.transition;ro.transition={};var W=ro.transition;ro.transition._updatedFibers=new Set;try{l(!1),g()}finally{if(ka(m),ro.transition=G,G===null&&W._updatedFibers){var M=W._updatedFibers.size;M>10&&C("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),W._updatedFibers.clear()}}}function qf(){var l=nd(!1),g=l[0],A=l[1],m=Yv.bind(null,A),G=bl();return G.memoizedState=m,[g,m]}function oh(){var l=Uf(),g=l[0],A=Or(),m=A.memoizedState;return[g,m]}function Mv(){var l=Df(),g=l[0],A=Or(),m=A.memoizedState;return[g,m]}var Hv=!1;function cB(){return Hv}function $f(){var l=bl(),g=Nh(),A=g.identifierPrefix,m;if(Na()){var G=ww();m=":"+A+"R"+G;var W=$C++;W>0&&(m+="H"+W.toString(32)),m+=":"}else{var M=Lw++;m=":"+A+"r"+M.toString(32)+":"}return l.memoizedState=m,m}function rh(){var l=Or(),g=l.memoizedState;return g}function uB(l,g,A){typeof arguments[3]=="function"&&d("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var m=bg(l),G={lane:m,action:A,hasEagerState:!1,eagerState:null,next:null};if(IB(l))dB(g,G);else{CB(l,g,G);var W=ws(),M=ha(l,m,W);M!==null&&ad(M,g,m)}ep(l,m)}function dc(l,g,A){typeof arguments[3]=="function"&&d("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var m=bg(l),G={lane:m,action:A,hasEagerState:!1,eagerState:null,next:null};if(IB(l))dB(g,G);else{CB(l,g,G);var W=l.alternate;if(l.lanes===yt&&(W===null||W.lanes===yt)){var M=g.lastRenderedReducer;if(M!==null){var T;T=Qt.current,Qt.current=go;try{var U=g.lastRenderedState,ie=M(U,A);if(G.hasEagerState=!0,G.eagerState=ie,$o(ie,U))return}catch{}finally{Qt.current=T}}}var ue=ws(),Re=ha(l,m,ue);Re!==null&&ad(Re,g,m)}ep(l,m)}function IB(l){var g=l.alternate;return l===Zi||g!==null&&g===Zi}function dB(l,g){qC=_f=!0;var A=l.pending;A===null?g.next=g:(g.next=A.next,A.next=g),l.pending=g}function CB(l,g,A,m){if(_u(l)){var G=g.interleaved;G===null?(A.next=A,nv(g)):(A.next=G.next,G.next=A),g.interleaved=A}else{var W=g.pending;W===null?A.next=A:(A.next=W.next,W.next=A),g.pending=A}}function ad(l,g,A){if(WG(A)){var m=g.lanes;m=gf(m,l.pendingLanes);var G=Kn(m,A);g.lanes=G,kb(l,G)}}function ep(l,g,A){df(l,g)}var lh={readContext:aa,useCallback:Gs,useContext:Gs,useEffect:Gs,useImperativeHandle:Gs,useInsertionEffect:Gs,useLayoutEffect:Gs,useMemo:Gs,useReducer:Gs,useRef:Gs,useState:Gs,useDebugValue:Gs,useDeferredValue:Gs,useTransition:Gs,useMutableSource:Gs,useSyncExternalStore:Gs,useId:Gs,unstable_isNewReconciler:Z},hB=null,Fv=null,AB=null,Ki=null,ir=null,go=null,Cc=null;{var tp=function(){d("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().")},Sn=function(){d("Do not call Hooks inside useEffect(...), useMemo(...), or other built-in Hooks. You can only call Hooks at the top level of your React function. For more information, see https://reactjs.org/link/rules-of-hooks")};hB={readContext:function(l){return aa(l)},useCallback:function(l,g){return st="useCallback",si(),ml(g),ih(l,g)},useContext:function(l){return st="useContext",si(),aa(l)},useEffect:function(l,g){return st="useEffect",si(),ml(g),id(l,g)},useImperativeHandle:function(l,g,A){return st="useImperativeHandle",si(),ml(A),xv(l,g,A)},useInsertionEffect:function(l,g){return st="useInsertionEffect",si(),ml(g),wv(l,g)},useLayoutEffect:function(l,g){return st="useLayoutEffect",si(),ml(g),Wv(l,g)},useMemo:function(l,g){st="useMemo",si(),ml(g);var A=Qt.current;Qt.current=ir;try{return Nv(l,g)}finally{Qt.current=A}},useReducer:function(l,g,A){st="useReducer",si();var m=Qt.current;Qt.current=ir;try{return Gv(l,g,A)}finally{Qt.current=m}},useRef:function(l){return st="useRef",si(),Jf(l)},useState:function(l){st="useState",si();var g=Qt.current;Qt.current=ir;try{return nd(l)}finally{Qt.current=g}},useDebugValue:function(l,g){return st="useDebugValue",si(),void 0},useDeferredValue:function(l){return st="useDeferredValue",si(),Xv(l)},useTransition:function(){return st="useTransition",si(),qf()},useMutableSource:function(l,g,A){return st="useMutableSource",si(),void 0},useSyncExternalStore:function(l,g,A){return st="useSyncExternalStore",si(),Sv(l,g,A)},useId:function(){return st="useId",si(),$f()},unstable_isNewReconciler:Z},Fv={readContext:function(l){return aa(l)},useCallback:function(l,g){return st="useCallback",Ht(),ih(l,g)},useContext:function(l){return st="useContext",Ht(),aa(l)},useEffect:function(l,g){return st="useEffect",Ht(),id(l,g)},useImperativeHandle:function(l,g,A){return st="useImperativeHandle",Ht(),xv(l,g,A)},useInsertionEffect:function(l,g){return st="useInsertionEffect",Ht(),wv(l,g)},useLayoutEffect:function(l,g){return st="useLayoutEffect",Ht(),Wv(l,g)},useMemo:function(l,g){st="useMemo",Ht();var A=Qt.current;Qt.current=ir;try{return Nv(l,g)}finally{Qt.current=A}},useReducer:function(l,g,A){st="useReducer",Ht();var m=Qt.current;Qt.current=ir;try{return Gv(l,g,A)}finally{Qt.current=m}},useRef:function(l){return st="useRef",Ht(),Jf(l)},useState:function(l){st="useState",Ht();var g=Qt.current;Qt.current=ir;try{return nd(l)}finally{Qt.current=g}},useDebugValue:function(l,g){return st="useDebugValue",Ht(),void 0},useDeferredValue:function(l){return st="useDeferredValue",Ht(),Xv(l)},useTransition:function(){return st="useTransition",Ht(),qf()},useMutableSource:function(l,g,A){return st="useMutableSource",Ht(),void 0},useSyncExternalStore:function(l,g,A){return st="useSyncExternalStore",Ht(),Sv(l,g,A)},useId:function(){return st="useId",Ht(),$f()},unstable_isNewReconciler:Z},AB={readContext:function(l){return aa(l)},useCallback:function(l,g){return st="useCallback",Ht(),jf(l,g)},useContext:function(l){return st="useContext",Ht(),aa(l)},useEffect:function(l,g){return st="useEffect",Ht(),Ig(l,g)},useImperativeHandle:function(l,g,A){return st="useImperativeHandle",Ht(),dg(l,g,A)},useInsertionEffect:function(l,g){return st="useInsertionEffect",Ht(),Pf(l,g)},useLayoutEffect:function(l,g){return st="useLayoutEffect",Ht(),Qf(l,g)},useMemo:function(l,g){st="useMemo",Ht();var A=Qt.current;Qt.current=go;try{return ah(l,g)}finally{Qt.current=A}},useReducer:function(l,g,A){st="useReducer",Ht();var m=Qt.current;Qt.current=go;try{return Bv(l,g,A)}finally{Qt.current=m}},useRef:function(l){return st="useRef",Ht(),th()},useState:function(l){st="useState",Ht();var g=Qt.current;Qt.current=go;try{return Uf(l)}finally{Qt.current=g}},useDebugValue:function(l,g){return st="useDebugValue",Ht(),Ic()},useDeferredValue:function(l){return st="useDeferredValue",Ht(),sh(l)},useTransition:function(){return st="useTransition",Ht(),oh()},useMutableSource:function(l,g,A){return st="useMutableSource",Ht(),void 0},useSyncExternalStore:function(l,g,A){return st="useSyncExternalStore",Ht(),kf(l,g)},useId:function(){return st="useId",Ht(),rh()},unstable_isNewReconciler:Z},Ki={readContext:function(l){return aa(l)},useCallback:function(l,g){return st="useCallback",Ht(),jf(l,g)},useContext:function(l){return st="useContext",Ht(),aa(l)},useEffect:function(l,g){return st="useEffect",Ht(),Ig(l,g)},useImperativeHandle:function(l,g,A){return st="useImperativeHandle",Ht(),dg(l,g,A)},useInsertionEffect:function(l,g){return st="useInsertionEffect",Ht(),Pf(l,g)},useLayoutEffect:function(l,g){return st="useLayoutEffect",Ht(),Qf(l,g)},useMemo:function(l,g){st="useMemo",Ht();var A=Qt.current;Qt.current=Cc;try{return ah(l,g)}finally{Qt.current=A}},useReducer:function(l,g,A){st="useReducer",Ht();var m=Qt.current;Qt.current=Cc;try{return Zv(l,g,A)}finally{Qt.current=m}},useRef:function(l){return st="useRef",Ht(),th()},useState:function(l){st="useState",Ht();var g=Qt.current;Qt.current=Cc;try{return Df(l)}finally{Qt.current=g}},useDebugValue:function(l,g){return st="useDebugValue",Ht(),Ic()},useDeferredValue:function(l){return st="useDeferredValue",Ht(),bu(l)},useTransition:function(){return st="useTransition",Ht(),Mv()},useMutableSource:function(l,g,A){return st="useMutableSource",Ht(),void 0},useSyncExternalStore:function(l,g,A){return st="useSyncExternalStore",Ht(),kf(l,g)},useId:function(){return st="useId",Ht(),rh()},unstable_isNewReconciler:Z},ir={readContext:function(l){return tp(),aa(l)},useCallback:function(l,g){return st="useCallback",Sn(),si(),ih(l,g)},useContext:function(l){return st="useContext",Sn(),si(),aa(l)},useEffect:function(l,g){return st="useEffect",Sn(),si(),id(l,g)},useImperativeHandle:function(l,g,A){return st="useImperativeHandle",Sn(),si(),xv(l,g,A)},useInsertionEffect:function(l,g){return st="useInsertionEffect",Sn(),si(),wv(l,g)},useLayoutEffect:function(l,g){return st="useLayoutEffect",Sn(),si(),Wv(l,g)},useMemo:function(l,g){st="useMemo",Sn(),si();var A=Qt.current;Qt.current=ir;try{return Nv(l,g)}finally{Qt.current=A}},useReducer:function(l,g,A){st="useReducer",Sn(),si();var m=Qt.current;Qt.current=ir;try{return Gv(l,g,A)}finally{Qt.current=m}},useRef:function(l){return st="useRef",Sn(),si(),Jf(l)},useState:function(l){st="useState",Sn(),si();var g=Qt.current;Qt.current=ir;try{return nd(l)}finally{Qt.current=g}},useDebugValue:function(l,g){return st="useDebugValue",Sn(),si(),void 0},useDeferredValue:function(l){return st="useDeferredValue",Sn(),si(),Xv(l)},useTransition:function(){return st="useTransition",Sn(),si(),qf()},useMutableSource:function(l,g,A){return st="useMutableSource",Sn(),si(),void 0},useSyncExternalStore:function(l,g,A){return st="useSyncExternalStore",Sn(),si(),Sv(l,g,A)},useId:function(){return st="useId",Sn(),si(),$f()},unstable_isNewReconciler:Z},go={readContext:function(l){return tp(),aa(l)},useCallback:function(l,g){return st="useCallback",Sn(),Ht(),jf(l,g)},useContext:function(l){return st="useContext",Sn(),Ht(),aa(l)},useEffect:function(l,g){return st="useEffect",Sn(),Ht(),Ig(l,g)},useImperativeHandle:function(l,g,A){return st="useImperativeHandle",Sn(),Ht(),dg(l,g,A)},useInsertionEffect:function(l,g){return st="useInsertionEffect",Sn(),Ht(),Pf(l,g)},useLayoutEffect:function(l,g){return st="useLayoutEffect",Sn(),Ht(),Qf(l,g)},useMemo:function(l,g){st="useMemo",Sn(),Ht();var A=Qt.current;Qt.current=go;try{return ah(l,g)}finally{Qt.current=A}},useReducer:function(l,g,A){st="useReducer",Sn(),Ht();var m=Qt.current;Qt.current=go;try{return Bv(l,g,A)}finally{Qt.current=m}},useRef:function(l){return st="useRef",Sn(),Ht(),th()},useState:function(l){st="useState",Sn(),Ht();var g=Qt.current;Qt.current=go;try{return Uf(l)}finally{Qt.current=g}},useDebugValue:function(l,g){return st="useDebugValue",Sn(),Ht(),Ic()},useDeferredValue:function(l){return st="useDeferredValue",Sn(),Ht(),sh(l)},useTransition:function(){return st="useTransition",Sn(),Ht(),oh()},useMutableSource:function(l,g,A){return st="useMutableSource",Sn(),Ht(),void 0},useSyncExternalStore:function(l,g,A){return st="useSyncExternalStore",Sn(),Ht(),kf(l,g)},useId:function(){return st="useId",Sn(),Ht(),rh()},unstable_isNewReconciler:Z},Cc={readContext:function(l){return tp(),aa(l)},useCallback:function(l,g){return st="useCallback",Sn(),Ht(),jf(l,g)},useContext:function(l){return st="useContext",Sn(),Ht(),aa(l)},useEffect:function(l,g){return st="useEffect",Sn(),Ht(),Ig(l,g)},useImperativeHandle:function(l,g,A){return st="useImperativeHandle",Sn(),Ht(),dg(l,g,A)},useInsertionEffect:function(l,g){return st="useInsertionEffect",Sn(),Ht(),Pf(l,g)},useLayoutEffect:function(l,g){return st="useLayoutEffect",Sn(),Ht(),Qf(l,g)},useMemo:function(l,g){st="useMemo",Sn(),Ht();var A=Qt.current;Qt.current=go;try{return ah(l,g)}finally{Qt.current=A}},useReducer:function(l,g,A){st="useReducer",Sn(),Ht();var m=Qt.current;Qt.current=go;try{return Zv(l,g,A)}finally{Qt.current=m}},useRef:function(l){return st="useRef",Sn(),Ht(),th()},useState:function(l){st="useState",Sn(),Ht();var g=Qt.current;Qt.current=go;try{return Df(l)}finally{Qt.current=g}},useDebugValue:function(l,g){return st="useDebugValue",Sn(),Ht(),Ic()},useDeferredValue:function(l){return st="useDeferredValue",Sn(),Ht(),bu(l)},useTransition:function(){return st="useTransition",Sn(),Ht(),Mv()},useMutableSource:function(l,g,A){return st="useMutableSource",Sn(),Ht(),void 0},useSyncExternalStore:function(l,g,A){return st="useSyncExternalStore",Sn(),Ht(),kf(l,g)},useId:function(){return st="useId",Sn(),Ht(),rh()},unstable_isNewReconciler:Z}}var vl=a.unstable_now,sd=0,np=-1,hc=-1,Cg=-1,Kv=!1,gh=!1;function fB(){return Kv}function Uw(){gh=!0}function co(){Kv=!1,gh=!1}function ch(){Kv=gh,gh=!1}function uh(){return sd}function hg(){sd=vl()}function ip(l){hc=vl(),l.actualStartTime<0&&(l.actualStartTime=vl())}function Ac(l){hc=-1}function yl(l,g){if(hc>=0){var A=vl()-hc;l.actualDuration+=A,g&&(l.selfBaseDuration=A),hc=-1}}function zs(l){if(np>=0){var g=vl()-np;np=-1;for(var A=l.return;A!==null;){switch(A.tag){case P:var m=A.stateNode;m.effectDuration+=g;return;case Be:var G=A.stateNode;G.effectDuration+=g;return}A=A.return}}}function Ih(l){if(Cg>=0){var g=vl()-Cg;Cg=-1;for(var A=l.return;A!==null;){switch(A.tag){case P:var m=A.stateNode;m!==null&&(m.passiveEffectDuration+=g);return;case Be:var G=A.stateNode;G!==null&&(G.passiveEffectDuration+=g);return}A=A.return}}}function Ls(){np=vl()}function vu(){Cg=vl()}function ap(l){for(var g=l.child;g;)l.actualDuration+=g.actualDuration,g=g.sibling}function yu(l,g){return{value:l,source:g,stack:Cf(g)}}function pB(l,g){return!0}function sp(l,g){try{var A=pB(l,g);if(A===!1)return;var m=g.value,G=g.source,W=g.stack,M=W!==null?W:"";if(m!=null&&m._suppressLogging){if(l.tag===F)return;console.error(m)}var T=G?q(G):null,U=T?"The above error occurred in the <"+T+"> component:":"The above error occurred in one of your React components:",ie;if(l.tag===P)ie=`Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.`;else{var ue=q(l)||"Anonymous";ie="React will try to recreate this component tree from scratch "+("using the error boundary you provided, "+ue+".")}var Re=U+`
`+M+`

`+(""+ie);console.error(Re)}catch(ke){setTimeout(function(){throw ke})}}var Dw=typeof WeakMap=="function"?WeakMap:Map;function mB(l,g,A){var m=fl(Fi,A);m.tag=gg,m.payload={element:null};var G=g.value;return m.callback=function(){uZ(G),sp(l,g)},m}function od(l,g,A){var m=fl(Fi,A);m.tag=gg;var G=l.type.getDerivedStateFromError;if(typeof G=="function"){var W=g.value;m.payload=function(){return G(W)},m.callback=function(){nt(l),sp(l,g)}}var M=l.stateNode;return M!==null&&typeof M.componentDidCatch=="function"&&(m.callback=function(){nt(l),sp(l,g),typeof G!="function"&&Gy(this);var U=g.value,ie=g.stack;this.componentDidCatch(U,{componentStack:ie!==null?ie:""}),typeof G!="function"&&(Ms(l.lanes,On)||d("%s: Error boundaries should implement getDerivedStateFromError(). In that method, return a state update to display an error message or fallback UI.",q(l)||"Unknown"))}),m}function dh(l,g,A){var m=l.pingCache,G;if(m===null?(m=l.pingCache=new Dw,G=new Set,m.set(g,G)):(G=m.get(g),G===void 0&&(G=new Set,m.set(g,G))),!G.has(A)){G.add(A);var W=jr.bind(null,l,g,A);wi&&Fh(l,A),g.then(W,W)}}function bB(l,g,A,m){var G=l.updateQueue;if(G===null){var W=new Set;W.add(A),l.updateQueue=W}else G.add(A)}function Jw(l,g){var A=l.tag;if((l.mode&Ri)===Yn&&(A===H||A===he||A===me)){var m=l.alternate;m?(l.updateQueue=m.updateQueue,l.memoizedState=m.memoizedState,l.lanes=m.lanes):(l.updateQueue=null,l.memoizedState=null)}}function Ch(l){var g=l;do{if(g.tag===ve&&Tw(g))return g;g=g.return}while(g!==null);return null}function vB(l,g,A,m,G){if((l.mode&Ri)===Yn){if(l===g)l.flags|=ot;else{if(l.flags|=mt,A.flags|=Q,A.flags&=-52805,A.tag===F){var W=A.alternate;if(W===null)A.tag=Ue;else{var M=fl(Fi,On);M.tag=ic,du(A,M)}}A.lanes=Kn(A.lanes,On)}return l}return l.flags|=ot,l.lanes=G,l}function Ow(l,g,A,m,G){if(A.flags|=re,wi&&Fh(l,G),m!==null&&typeof m=="object"&&typeof m.then=="function"){var W=m;Jw(A);var M=Ch(g);if(M!==null){M.flags&=~mn,vB(M,g,A,l,G),M.mode&Ri&&dh(l,W,G),bB(M,l,W);return}else{if(!tu(G)){dh(l,W,G),Rd();return}var T=new Error("A component suspended while responding to synchronous input. This will cause the UI to be replaced with a loading indicator. To fix, updates that suspend should be wrapped with startTransition.");m=T}}else if(Na()&&A.mode&Ri){Vw();var U=Ch(g);if(U!==null){(U.flags&ot)===ye&&(U.flags|=mn),vB(U,g,A,l,G),Nf(m);return}}VW(m),m=yu(m,A);var ie=g;do{switch(ie.tag){case P:{var ue=m;ie.flags|=ot;var Re=xI(G);ie.lanes=Kn(ie.lanes,Re);var ke=mB(ie,ue,Re);FC(ie,ke);return}case F:var Qe=m,ht=ie.type,Rt=ie.stateNode;if((ie.flags&mt)===ye&&(typeof ht.getDerivedStateFromError=="function"||Rt!==null&&typeof Rt.componentDidCatch=="function"&&!yy(Rt))){ie.flags|=ot;var Cn=xI(G);ie.lanes=Kn(ie.lanes,Cn);var En=od(ie,Qe,Cn);FC(ie,En);return}break}ie=ie.return}while(ie!==null)}function Pw(){return null}function Gl(l){l.flags|=Ne}function yB(l){l.flags|=Wn,l.flags|=ct}function GB(l,g){var A=l!==null&&l.child===g.child;if(A)return!0;if((g.flags&dt)!==ye)return!1;for(var m=g.child;m!==null;){if((m.flags&Ge)!==ye||(m.subtreeFlags&Ge)!==ye)return!1;m=m.sibling}return!0}var hh,Ah,op,rp;if(no)hh=function(l,g,A,m){for(var G=g.child;G!==null;){if(G.tag===E||G.tag===ee)Mi(l,G.stateNode);else if(G.tag!==K){if(G.child!==null){G.child.return=G,G=G.child;continue}}if(G===g)return;for(;G.sibling===null;){if(G.return===null||G.return===g)return;G=G.return}G.sibling.return=G.return,G=G.sibling}},Ah=function(l,g){},op=function(l,g,A,m,G){var W=l.memoizedProps;if(W!==m){var M=g.stateNode,T=QC(),U=xr(M,A,W,m,G,T);g.updateQueue=U,U&&Gl(g)}},rp=function(l,g,A,m){A!==m&&Gl(g)};else if(_g){hh=function(l,g,A,m){for(var G=g.child;G!==null;){if(G.tag===E){var W=G.stateNode;if(A&&m){var M=G.memoizedProps,T=G.type;W=Je(W,T,M,G)}Mi(l,W)}else if(G.tag===ee){var U=G.stateNode;if(A&&m){var ie=G.memoizedProps;U=Nt(U,ie,G)}Mi(l,U)}else if(G.tag!==K){if(G.tag===Zt&&G.memoizedState!==null){var ue=G.child;ue!==null&&(ue.return=G),hh(l,G,!0,!0)}else if(G.child!==null){G.child.return=G,G=G.child;continue}}if(G=G,G===g)return;for(;G.sibling===null;){if(G.return===null||G.return===g)return;G=G.return}G.sibling.return=G.return,G=G.sibling}};var lp=function(l,g,A,m){for(var G=g.child;G!==null;){if(G.tag===E){var W=G.stateNode;if(A&&m){var M=G.memoizedProps,T=G.type;W=Je(W,T,M,G)}L(l,W)}else if(G.tag===ee){var U=G.stateNode;if(A&&m){var ie=G.memoizedProps;U=Nt(U,ie,G)}L(l,U)}else if(G.tag!==K){if(G.tag===Zt&&G.memoizedState!==null){var ue=G.child;ue!==null&&(ue.return=G),lp(l,G,!0,!0)}else if(G.child!==null){G.child.return=G,G=G.child;continue}}if(G=G,G===g)return;for(;G.sibling===null;){if(G.return===null||G.return===g)return;G=G.return}G.sibling.return=G.return,G=G.sibling}};Ah=function(l,g){var A=g.stateNode,m=GB(l,g);if(!m){var G=A.containerInfo,W=dC(G);lp(W,g,!1,!1),A.pendingChildren=W,Gl(g),le(G,W)}},op=function(l,g,A,m,G){var W=l.stateNode,M=l.memoizedProps,T=GB(l,g);if(T&&M===m){g.stateNode=W;return}var U=g.stateNode,ie=QC(),ue=null;if(M!==m&&(ue=xr(U,A,M,m,G,ie)),T&&ue===null){g.stateNode=W;return}var Re=IC(W,ue,A,M,m,g,T,U);as(Re,A,m,G,ie)&&Gl(g),g.stateNode=Re,T?Gl(g):hh(Re,g,!1,!1)},rp=function(l,g,A,m){if(A!==m){var G=Ff(),W=QC();g.stateNode=Vr(m,G,W,g),Gl(g)}else g.stateNode=l.stateNode}}else Ah=function(l,g){},op=function(l,g,A,m,G){},rp=function(l,g,A,m){};function Gu(l,g){if(!Na())switch(l.tailMode){case"hidden":{for(var A=l.tail,m=null;A!==null;)A.alternate!==null&&(m=A),A=A.sibling;m===null?l.tail=null:m.sibling=null;break}case"collapsed":{for(var G=l.tail,W=null;G!==null;)G.alternate!==null&&(W=G),G=G.sibling;W===null?!g&&l.tail!==null?l.tail.sibling=null:l.tail=null:W.sibling=null;break}}}function Xa(l){var g=l.alternate!==null&&l.alternate.child===l.child,A=yt,m=ye;if(g){if((l.mode&Ii)!==Yn){for(var U=l.selfBaseDuration,ie=l.child;ie!==null;)A=Kn(A,Kn(ie.lanes,ie.childLanes)),m|=ie.subtreeFlags&bt,m|=ie.flags&bt,U+=ie.treeBaseDuration,ie=ie.sibling;l.treeBaseDuration=U}else for(var ue=l.child;ue!==null;)A=Kn(A,Kn(ue.lanes,ue.childLanes)),m|=ue.subtreeFlags&bt,m|=ue.flags&bt,ue.return=l,ue=ue.sibling;l.subtreeFlags|=m}else{if((l.mode&Ii)!==Yn){for(var G=l.actualDuration,W=l.selfBaseDuration,M=l.child;M!==null;)A=Kn(A,Kn(M.lanes,M.childLanes)),m|=M.subtreeFlags,m|=M.flags,G+=M.actualDuration,W+=M.treeBaseDuration,M=M.sibling;l.actualDuration=G,l.treeBaseDuration=W}else for(var T=l.child;T!==null;)A=Kn(A,Kn(T.lanes,T.childLanes)),m|=T.subtreeFlags,m|=T.flags,T.return=l,T=T.sibling;l.subtreeFlags|=m}return l.childLanes=A,g}function gp(l,g,A){var m=g.pendingProps;switch(Rf(g),g.tag){case _:case Xe:case me:case H:case he:case Ie:case be:case Be:case se:case we:return Xa(g),null;case F:{var G=g.type;return gl(G)&&QA(g),Xa(g),null}case P:{var W=g.stateNode;if(QI(g),Xb(g),Lf(),W.pendingContext&&(W.context=W.pendingContext,W.pendingContext=null),l===null||l.child===null){var M=kC(g);if(M)Gl(g);else if(l!==null){var T=l.memoizedState;(!T.isDehydrated||(g.flags&mn)!==ye)&&(g.flags|=zn,UC())}}return Ah(l,g),Xa(g),null}case E:{Av(g);var U=Ff(),ie=g.type;if(l!==null&&g.stateNode!=null)op(l,g,ie,m,U),l.ref!==g.ref&&yB(g);else{if(!m){if(g.stateNode===null)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return Xa(g),null}var ue=QC(),Re=kC(g);if(Re)Yw(g,U,ue)&&Gl(g);else{var ke=to(ie,m,U,ue,g);hh(ke,g,!1,!1),g.stateNode=ke,as(ke,ie,m,U,ue)&&Gl(g)}g.ref!==null&&yB(g)}return Xa(g),null}case ee:{var Qe=m;if(l&&g.stateNode!=null){var ht=l.memoizedProps;rp(l,g,ht,Qe)}else{if(typeof Qe!="string"&&g.stateNode===null)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");var Rt=Ff(),Cn=QC(),En=kC(g);En?Mw(g)&&Gl(g):g.stateNode=Vr(Qe,Rt,Cn,g)}return Xa(g),null}case ve:{qI(g);var Gn=g.memoizedState;{if(Hw()&&(g.mode&Ri)!==Yn&&(g.flags&mt)===ye)return uv(g),Au(),g.flags|=mn|re|ot,g;if(Gn!==null&&Gn.dehydrated!==null){var Ei=kC(g);if(l===null){if(!Ei)throw new Error("A dehydrated suspense component was completed without a hydrated node. This is probably a bug in React.");if(_C(g),Xa(g),(g.mode&Ii)!==Yn){var Ti=Gn!==null;if(Ti){var Me=g.child;Me!==null&&(g.treeBaseDuration-=Me.treeBaseDuration)}}return null}else{if(Au(),(g.flags&mt)===ye&&(g.memoizedState=null),g.flags|=Ne,Xa(g),(g.mode&Ii)!==Yn){var tt=Gn!==null;if(tt){var Ve=g.child;Ve!==null&&(g.treeBaseDuration-=Ve.treeBaseDuration)}}return null}}UC()}if((g.flags&mt)!==ye)return g.lanes=A,(g.mode&Ii)!==Yn&&ap(g),g;var Gt=Gn!==null,ln=!1;if(l===null)kC(g);else{var Tt=l.memoizedState;ln=Tt!==null}if(Gt&&!ln){var _n=g.child;if(_n.flags|=ci,(g.mode&Ri)!==Yn){var ri=l===null&&(g.memoizedProps.unstable_avoidThisFallback!==!0||!0);ri||Ef(Dr.current,aB)?xW():Rd()}}var qn=g.updateQueue;if(qn!==null&&(g.flags|=Ne),Xa(g),(g.mode&Ii)!==Yn&&Gt){var li=g.child;li!==null&&(g.treeBaseDuration-=li.treeBaseDuration)}return null}case K:return QI(g),Ah(l,g),l===null&&Ul(g.stateNode.containerInfo),Xa(g),null;case Ce:var ki=g.type._context;return tv(ki,g),Xa(g),null;case Ue:{var ti=g.type;return gl(ti)&&QA(g),Xa(g),null}case Ee:{qI(g);var Tn=g.memoizedState;if(Tn===null)return Xa(g),null;var ra=(g.flags&mt)!==ye,Ui=Tn.rendering;if(Ui===null)if(ra)Gu(Tn,!1);else{var Yo=lZ()&&(l===null||(l.flags&mt)===ye);if(!Yo)for(var Sa=g.child;Sa!==null;){var Us=Tf(Sa);if(Us!==null){ra=!0,g.flags|=mt,Gu(Tn,!1);var Ds=Us.updateQueue;return Ds!==null&&(g.updateQueue=Ds,g.flags|=Ne),g.subtreeFlags=ye,Cv(g,A),cc(g,fv(Dr.current,jC)),g.child}Sa=Sa.sibling}Tn.tail!==null&&Da()>xh()&&(g.flags|=mt,ra=!0,Gu(Tn,!1),g.lanes=rf)}else{if(!ra){var Ar=Tf(Ui);if(Ar!==null){g.flags|=mt,ra=!0;var Hl=Ar.updateQueue;if(Hl!==null&&(g.updateQueue=Hl,g.flags|=Ne),Gu(Tn,!0),Tn.tail===null&&Tn.tailMode==="hidden"&&!Ui.alternate&&!Na())return Xa(g),null}else Da()*2-Tn.renderingStartTime>xh()&&A!==_a&&(g.flags|=mt,ra=!0,Gu(Tn,!1),g.lanes=rf)}if(Tn.isBackwards)Ui.sibling=g.child,g.child=Ui;else{var Qu=Tn.last;Qu!==null?Qu.sibling=Ui:g.child=Ui,Tn.last=Ui}}if(Tn.tail!==null){var Js=Tn.tail;Tn.rendering=Js,Tn.tail=Js.sibling,Tn.renderingStartTime=Da(),Js.sibling=null;var Gg=Dr.current;return ra?Gg=fv(Gg,jC):Gg=jI(Gg),cc(g,Gg),Js}return Xa(g),null}case At:break;case Zt:case Bt:{Zd(g);var um=g.memoizedState,ZZ=um!==null;if(l!==null){var SZ=l.memoizedState,RZ=SZ!==null;RZ!==ZZ&&!R&&(g.flags|=ci)}return!ZZ||(g.mode&Ri)===Yn?Xa(g):Ms(ho,_a)&&(Xa(g),no&&g.subtreeFlags&(De|Ne)&&(g.flags|=ci)),null}case kt:return null;case $t:return null}throw new Error("Unknown unit of work tag ("+g.tag+"). This error is likely caused by a bug in React. Please file an issue.")}var fh=o.ReactCurrentOwner,_s=!1,Bu,ph,cp,Ev,Tv,fc,zv,up;Bu={},ph={},cp={},Ev={},Tv={},fc=!1,zv={},up={};function Bs(l,g,A,m){l===null?g.child=nB(g,null,A,m):g.child=PI(g,l.child,A,m)}function Ip(l,g,A,m){g.child=PI(g,l.child,null,m),g.child=PI(g,null,A,m)}function mh(l,g,A,m,G){if(g.type!==g.elementType){var W=A.propTypes;W&&Xr(W,m,"prop",Pe(A))}var M=A.render,T=g.ref,U,ie;zI(g,G),NC(g);{if(fh.current=g,er(!0),U=ug(l,g,M,m,T,G),ie=ed(),g.mode&ba){ia(!0);try{U=ug(l,g,M,m,T,G),ie=ed()}finally{ia(!1)}}er(!1)}return HI(),l!==null&&!_s?(vv(l,g,G),Ag(l,g,G)):(Na()&&ie&&Sf(g),g.flags|=gt,Bs(l,g,U,G),g.child)}function bh(l,g,A,m,G){if(l===null){var W=A.type;if(CZ(W)&&A.compare===null&&A.defaultProps===void 0){var M=W;return M=Xl(W),g.tag=me,g.type=M,vh(g,W),rd(l,g,M,m,G)}{var T=W.propTypes;T&&Xr(T,m,"prop",Pe(W))}var U=Eh(A.type,null,m,g,g.mode,G);return U.ref=g.ref,U.return=g,g.child=U,U}{var ie=A.type,ue=ie.propTypes;ue&&Xr(ue,m,"prop",Pe(ie))}var Re=l.child,ke=qv(l,G);if(!ke){var Qe=Re.memoizedProps,ht=A.compare;if(ht=ht!==null?ht:$g,ht(Qe,m)&&l.ref===g.ref)return Ag(l,g,G)}g.flags|=gt;var Rt=$a(Re,m);return Rt.ref=g.ref,Rt.return=g,g.child=Rt,Rt}function rd(l,g,A,m,G){if(g.type!==g.elementType){var W=g.elementType;if(W.$$typeof===Ae){var M=W,T=M._payload,U=M._init;try{W=U(T)}catch{W=null}var ie=W&&W.propTypes;ie&&Xr(ie,m,"prop",Pe(W))}}if(l!==null){var ue=l.memoizedProps;if($g(ue,m)&&l.ref===g.ref&&g.type===l.type)if(_s=!1,qv(l,G))(l.flags&Q)!==ye&&(_s=!0);else return g.lanes=l.lanes,Ag(l,g,G)}return kv(l,g,A,m,G)}function ld(l,g,A){var m=g.pendingProps,G=m.children,W=l!==null?l.memoizedState:null;if(m.mode==="hidden"||R)if((g.mode&Ri)===Yn){var M={baseLanes:yt,cachePool:null};g.memoizedState=M,Bd(g,A)}else if(Ms(A,_a)){var Re={baseLanes:yt,cachePool:null};g.memoizedState=Re;var ke=W!==null?W.baseLanes:A;Bd(g,ke)}else{var T=null,U;if(W!==null){var ie=W.baseLanes;U=Kn(ie,A)}else U=A;g.lanes=g.childLanes=_a;var ue={baseLanes:U,cachePool:T};return g.memoizedState=ue,g.updateQueue=null,Bd(g,U),null}else{var Qe;W!==null?(Qe=Kn(W.baseLanes,A),g.memoizedState=null):Qe=A,Bd(g,Qe)}return Bs(l,g,G,A),g.child}function Qw(l,g,A){var m=g.pendingProps;return Bs(l,g,m,A),g.child}function Lv(l,g,A){var m=g.pendingProps.children;return Bs(l,g,m,A),g.child}function _v(l,g,A){{g.flags|=Ne;{var m=g.stateNode;m.effectDuration=0,m.passiveEffectDuration=0}}var G=g.pendingProps,W=G.children;return Bs(l,g,W,A),g.child}function BB(l,g){var A=g.ref;(l===null&&A!==null||l!==null&&l.ref!==A)&&(g.flags|=Wn,g.flags|=ct)}function kv(l,g,A,m,G){if(g.type!==g.elementType){var W=A.propTypes;W&&Xr(W,m,"prop",Pe(A))}var M;{var T=jl(g,A,!0);M=Yr(g,T)}var U,ie;zI(g,G),NC(g);{if(fh.current=g,er(!0),U=ug(l,g,A,m,M,G),ie=ed(),g.mode&ba){ia(!0);try{U=ug(l,g,A,m,M,G),ie=ed()}finally{ia(!1)}}er(!1)}return HI(),l!==null&&!_s?(vv(l,g,G),Ag(l,g,G)):(Na()&&ie&&Sf(g),g.flags|=gt,Bs(l,g,U,G),g.child)}function jw(l,g,A,m,G){{switch(Jh(g)){case!1:{var W=g.stateNode,M=g.type,T=new M(g.memoizedProps,W.context),U=T.state;W.updater.enqueueSetState(W,U,null);break}case!0:{g.flags|=mt,g.flags|=ot;var ie=new Error("Simulated error coming from DevTools"),ue=xI(G);g.lanes=Kn(g.lanes,ue);var Re=od(g,yu(ie,g),ue);FC(g,Re);break}}if(g.type!==g.elementType){var ke=A.propTypes;ke&&Xr(ke,m,"prop",Pe(A))}}var Qe;gl(A)?(Qe=!0,jA(g)):Qe=!1,zI(g,G);var ht=g.stateNode,Rt;ht===null?(l!==null&&(l.alternate=null,g.alternate=null,g.flags|=De),QG(g,A,m),Bf(g,A,m,G),Rt=!0):l===null?Rt=Rw(g,A,m,G):Rt=qG(l,g,A,m,G);var Cn=Uv(l,g,A,Rt,Qe,G);{var En=g.stateNode;Rt&&En.props!==m&&(fc||d("It looks like %s is reassigning its own `this.props` while rendering. This is not supported and can lead to confusing bugs.",q(g)||"a component"),fc=!0)}return Cn}function Uv(l,g,A,m,G,W){BB(l,g);var M=(g.flags&mt)!==ye;if(!m&&!M)return G&&Mb(g,A,!1),Ag(l,g,W);var T=g.stateNode;fh.current=g;var U;if(M&&typeof A.getDerivedStateFromError!="function")U=null,Ac();else{NC(g);{if(er(!0),U=T.render(),g.mode&ba){ia(!0);try{T.render()}finally{ia(!1)}}er(!1)}HI()}return g.flags|=gt,l!==null&&M?Ip(l,g,U,W):Bs(l,g,U,W),g.memoizedState=T.state,G&&Mb(g,A,!0),g.child}function ZB(l){var g=l.stateNode;g.pendingContext?ZG(l,g.pendingContext,g.pendingContext!==g.context):g.context&&ZG(l,g.context,!1),hv(l,g.containerInfo)}function qw(l,g,A){if(ZB(g),l===null)throw new Error("Should have a current fiber. This is a bug in React.");var m=g.pendingProps,G=g.memoizedState,W=G.element;HC(l,g),bf(g,m,null,A);var M=g.memoizedState;g.stateNode;var T=M.element;if(Mn&&G.isDehydrated){var U={element:T,isDehydrated:!1,cache:M.cache,transitions:M.transitions},ie=g.updateQueue;if(ie.baseState=U,g.memoizedState=U,g.flags&mn){var ue=new Error("There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.");return SB(l,g,T,A,ue)}else if(T!==W){var Re=new Error("This root received an early update, before anything was able hydrate. Switched the entire root to client rendering.");return SB(l,g,T,A,Re)}else{Nw(g);var ke=nB(g,null,T,A);g.child=ke;for(var Qe=ke;Qe;)Qe.flags=Qe.flags&~De|In,Qe=Qe.sibling}}else{if(Au(),T===W)return Ag(l,g,A);Bs(l,g,T,A)}return g.child}function SB(l,g,A,m,G){return Au(),Nf(G),g.flags|=mn,Bs(l,g,A,m),g.child}function $w(l,g,A){iB(g),l===null&&gv(g);var m=g.type,G=g.pendingProps,W=l!==null?l.memoizedProps:null,M=G.children,T=ga(m,G);return T?M=null:W!==null&&ga(m,W)&&(g.flags|=wt),BB(l,g),Bs(l,g,M,A),g.child}function eW(l,g){return l===null&&gv(g),null}function Dv(l,g,A,m){l!==null&&(l.alternate=null,g.alternate=null,g.flags|=De);var G=g.pendingProps,W=A,M=W._payload,T=W._init,U=T(M);g.type=U;var ie=g.tag=Yl(U),ue=_r(U,G),Re;switch(ie){case H:return vh(g,U),g.type=U=Xl(U),Re=kv(null,g,U,ue,m),Re;case F:return g.type=U=Pu(U),Re=jw(null,g,U,ue,m),Re;case he:return g.type=U=Ry(U),Re=mh(null,g,U,ue,m),Re;case we:{if(g.type!==g.elementType){var ke=U.propTypes;ke&&Xr(ke,ue,"prop",Pe(U))}return Re=bh(null,g,U,_r(U.type,ue),m),Re}}var Qe="";throw U!==null&&typeof U=="object"&&U.$$typeof===Ae&&(Qe=" Did you wrap a component in React.lazy() more than once?"),new Error("Element type is invalid. Received a promise that resolves to: "+U+". "+("Lazy element type must resolve to a class or function."+Qe))}function tW(l,g,A,m,G){l!==null&&(l.alternate=null,g.alternate=null,g.flags|=De),g.tag=F;var W;return gl(A)?(W=!0,jA(g)):W=!1,zI(g,G),QG(g,A,m),Bf(g,A,m,G),Uv(null,g,A,!0,W,G)}function nW(l,g,A,m){l!==null&&(l.alternate=null,g.alternate=null,g.flags|=De);var G=g.pendingProps,W;{var M=jl(g,A,!1);W=Yr(g,M)}zI(g,m);var T,U;NC(g);{if(A.prototype&&typeof A.prototype.render=="function"){var ie=Pe(A)||"Unknown";Bu[ie]||(d("The <%s /> component appears to have a render method, but doesn't extend React.Component. This is likely to cause errors. Change %s to extend React.Component instead.",ie,ie),Bu[ie]=!0)}g.mode&ba&&xo.recordLegacyContextWarning(g,null),er(!0),fh.current=g,T=ug(null,g,A,G,W,m),U=ed(),er(!1)}if(HI(),g.flags|=gt,typeof T=="object"&&T!==null&&typeof T.render=="function"&&T.$$typeof===void 0){var ue=Pe(A)||"Unknown";ph[ue]||(d("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",ue,ue,ue),ph[ue]=!0)}if(typeof T=="object"&&T!==null&&typeof T.render=="function"&&T.$$typeof===void 0){{var Re=Pe(A)||"Unknown";ph[Re]||(d("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",Re,Re,Re),ph[Re]=!0)}g.tag=F,g.memoizedState=null,g.updateQueue=null;var ke=!1;return gl(A)?(ke=!0,jA(g)):ke=!1,g.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,Fn(g),PG(g,T),Bf(g,A,G,m),Uv(null,g,A,!0,ke,m)}else{if(g.tag=H,g.mode&ba){ia(!0);try{T=ug(null,g,A,G,W,m),U=ed()}finally{ia(!1)}}return Na()&&U&&Sf(g),Bs(null,g,T,m),vh(g,A),g.child}}function vh(l,g){{if(g&&g.childContextTypes&&d("%s(...): childContextTypes cannot be defined on a function component.",g.displayName||g.name||"Component"),l.ref!==null){var A="",m=Qb();m&&(A+=`

Check the render method of \``+m+"`.");var G=m||"",W=l._debugSource;W&&(G=W.fileName+":"+W.lineNumber),Tv[G]||(Tv[G]=!0,d("Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s",A))}if(typeof g.getDerivedStateFromProps=="function"){var M=Pe(g)||"Unknown";Ev[M]||(d("%s: Function components do not support getDerivedStateFromProps.",M),Ev[M]=!0)}if(typeof g.contextType=="object"&&g.contextType!==null){var T=Pe(g)||"Unknown";cp[T]||(d("%s: Function components do not support contextType.",T),cp[T]=!0)}}}var dp={dehydrated:null,treeContext:null,retryLane:La};function gd(l){return{baseLanes:l,cachePool:Pw()}}function Jv(l,g){var A=null;return{baseLanes:Kn(l.baseLanes,g),cachePool:A}}function iW(l,g,A,m){if(g!==null){var G=g.memoizedState;if(G===null)return!1}return Ef(l,jC)}function RB(l,g){return VI(l.childLanes,g)}function wB(l,g,A){var m=g.pendingProps;Oh(g)&&(g.flags|=mt);var G=Dr.current,W=!1,M=(g.flags&mt)!==ye;if(M||iW(G,l)?(W=!0,g.flags&=~mt):(l===null||l.memoizedState!==null)&&(G=Ew(G,aB)),G=jI(G),cc(g,G),l===null){gv(g);{var T=g.memoizedState;if(T!==null){var U=T.dehydrated;if(U!==null)return sW(g,U)}}var ie=m.children,ue=m.fallback;if(W){var Re=WB(g,ie,ue,A),ke=g.child;return ke.memoizedState=gd(A),g.memoizedState=dp,Re}else return Ov(g,ie)}else{var Qe=l.memoizedState;if(Qe!==null){{var ht=Qe.dehydrated;if(ht!==null)if(M){if(g.flags&mn)return g.flags&=~mn,Cp(l,g,A,new Error("There was an error while hydrating this Suspense boundary. Switched to client rendering."));if(g.memoizedState!==null)return g.child=l.child,g.flags|=mt,null;var Rt=m.children,Cn=m.fallback,En=aW(l,g,Rt,Cn,A),Gn=g.child;return Gn.memoizedState=gd(A),g.memoizedState=dp,En}else return Qv(l,g,ht,Qe,A)}if(W){var Ei=m.fallback,Ti=m.children,Me=NB(l,g,Ti,Ei,A),tt=g.child,Ve=l.child.memoizedState;return tt.memoizedState=Ve===null?gd(A):Jv(Ve,A),tt.childLanes=RB(l,A),g.memoizedState=dp,Me}else{var Gt=m.children,ln=VB(l,g,Gt,A);return g.memoizedState=null,ln}}else if(W){var Tt=m.fallback,_n=m.children,ri=NB(l,g,_n,Tt,A),qn=g.child,li=l.child.memoizedState;return qn.memoizedState=li===null?gd(A):Jv(li,A),qn.childLanes=RB(l,A),g.memoizedState=dp,ri}else{var ki=m.children,ti=VB(l,g,ki,A);return g.memoizedState=null,ti}}}function Ov(l,g,A){var m=l.mode,G={mode:"visible",children:g},W=Pv(G,m);return W.return=l,l.child=W,W}function WB(l,g,A,m){var G=l.mode,W=l.child,M={mode:"hidden",children:g},T,U;return(G&Ri)===Yn&&W!==null?(T=W,T.childLanes=yt,T.pendingProps=M,l.mode&Ii&&(T.actualDuration=0,T.actualStartTime=-1,T.selfBaseDuration=0,T.treeBaseDuration=0),U=Ml(A,G,m,null)):(T=Pv(M,G),U=Ml(A,G,m,null)),T.return=l,U.return=l,T.sibling=U,l.child=T,U}function Pv(l,g,A){return zh(l,g,yt,null)}function xB(l,g){return $a(l,g)}function VB(l,g,A,m){var G=l.child,W=G.sibling,M=xB(G,{mode:"visible",children:A});if((g.mode&Ri)===Yn&&(M.lanes=m),M.return=g,M.sibling=null,W!==null){var T=g.deletions;T===null?(g.deletions=[W],g.flags|=dt):T.push(W)}return g.child=M,M}function NB(l,g,A,m,G){var W=g.mode,M=l.child,T=M.sibling,U={mode:"hidden",children:A},ie;if((W&Ri)===Yn&&g.child!==M){var ue=g.child;ie=ue,ie.childLanes=yt,ie.pendingProps=U,g.mode&Ii&&(ie.actualDuration=0,ie.actualStartTime=-1,ie.selfBaseDuration=M.selfBaseDuration,ie.treeBaseDuration=M.treeBaseDuration),g.deletions=null}else ie=xB(M,U),ie.subtreeFlags=M.subtreeFlags&bt;var Re;return T!==null?Re=$a(T,m):(Re=Ml(m,W,G,null),Re.flags|=De),Re.return=g,ie.return=g,ie.sibling=Re,g.child=ie,Re}function Cp(l,g,A,m){m!==null&&Nf(m),PI(g,l.child,null,A);var G=g.pendingProps,W=G.children,M=Ov(g,W);return M.flags|=De,g.memoizedState=null,M}function aW(l,g,A,m,G){var W=g.mode,M={mode:"visible",children:A},T=Pv(M,W),U=Ml(m,W,G,null);return U.flags|=De,T.return=g,U.return=g,T.sibling=U,g.child=T,(g.mode&Ri)!==Yn&&PI(g,l.child,null,G),U}function sW(l,g,A){return(l.mode&Ri)===Yn?(d("Cannot hydrate Suspense in legacy mode. Switch from ReactDOM.hydrate(element, container) to ReactDOMClient.hydrateRoot(container, <App />).render(element) or remove the Suspense components from the server rendered components."),l.lanes=On):ui(g)?l.lanes=qo:l.lanes=_a,null}function Qv(l,g,A,m,G){if(eB(),(g.mode&Ri)===Yn)return Cp(l,g,G,null);if(ui(A))return Cp(l,g,G,new Error("The server could not finish this Suspense boundary, likely due to an error during server rendering. Switched to client rendering."));var W=Ms(G,l.childLanes);if(_s||W){var M=Nh();if(M!==null){var T=ow(M,G);if(T!==La&&T!==m.retryLane){m.retryLane=T;var U=Fi;ha(l,T,U)}}return Rd(),Cp(l,g,G,new Error("This Suspense boundary received an update before it finished hydrating. This caused the boundary to switch to client rendering. The usual way to fix this is to wrap the original update in startTransition."))}else if(Jn(A)){g.flags|=mt,g.child=l.child;var ie=xd.bind(null,l);return Hi(A,ie),null}else{Xw(g,A,m.treeContext);var ue=g.pendingProps,Re=ue.children,ke=Ov(g,Re);return ke.flags|=In,ke}}function XB(l,g,A){l.lanes=Kn(l.lanes,g);var m=l.alternate;m!==null&&(m.lanes=Kn(m.lanes,g)),MC(l.return,g,A)}function oW(l,g,A){for(var m=g;m!==null;){if(m.tag===ve){var G=m.memoizedState;G!==null&&XB(m,A,l)}else if(m.tag===Ee)XB(m,A,l);else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===l)return;for(;m.sibling===null;){if(m.return===null||m.return===l)return;m=m.return}m.sibling.return=m.return,m=m.sibling}}function rW(l){for(var g=l,A=null;g!==null;){var m=g.alternate;m!==null&&Tf(m)===null&&(A=g),g=g.sibling}return A}function lW(l){if(l!==void 0&&l!=="forwards"&&l!=="backwards"&&l!=="together"&&!zv[l])if(zv[l]=!0,typeof l=="string")switch(l.toLowerCase()){case"together":case"forwards":case"backwards":{d('"%s" is not a valid value for revealOrder on <SuspenseList />. Use lowercase "%s" instead.',l,l.toLowerCase());break}case"forward":case"backward":{d('"%s" is not a valid value for revealOrder on <SuspenseList />. React uses the -s suffix in the spelling. Use "%ss" instead.',l,l.toLowerCase());break}default:d('"%s" is not a supported revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',l);break}else d('%s is not a supported value for revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',l)}function gW(l,g){l!==void 0&&!up[l]&&(l!=="collapsed"&&l!=="hidden"?(up[l]=!0,d('"%s" is not a supported value for tail on <SuspenseList />. Did you mean "collapsed" or "hidden"?',l)):g!=="forwards"&&g!=="backwards"&&(up[l]=!0,d('<SuspenseList tail="%s" /> is only valid if revealOrder is "forwards" or "backwards". Did you mean to specify revealOrder="forwards"?',l)))}function YB(l,g){{var A=dn(l),m=!A&&typeof ae(l)=="function";if(A||m){var G=A?"array":"iterable";return d("A nested %s was passed to row #%s in <SuspenseList />. Wrap it in an additional SuspenseList to configure its revealOrder: <SuspenseList revealOrder=...> ... <SuspenseList revealOrder=...>{%s}</SuspenseList> ... </SuspenseList>",G,g,G),!1}}return!0}function cW(l,g){if((g==="forwards"||g==="backwards")&&l!==void 0&&l!==null&&l!==!1)if(dn(l)){for(var A=0;A<l.length;A++)if(!YB(l[A],A))return}else{var m=ae(l);if(typeof m=="function"){var G=m.call(l);if(G)for(var W=G.next(),M=0;!W.done;W=G.next()){if(!YB(W.value,M))return;M++}}else d('A single row was passed to a <SuspenseList revealOrder="%s" />. This is not useful since it needs multiple rows. Did you mean to pass multiple children or an array?',g)}}function jv(l,g,A,m,G){var W=l.memoizedState;W===null?l.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:m,tail:A,tailMode:G}:(W.isBackwards=g,W.rendering=null,W.renderingStartTime=0,W.last=m,W.tail=A,W.tailMode=G)}function MB(l,g,A){var m=g.pendingProps,G=m.revealOrder,W=m.tail,M=m.children;lW(G),gW(W,G),cW(M,G),Bs(l,g,M,A);var T=Dr.current,U=Ef(T,jC);if(U)T=fv(T,jC),g.flags|=mt;else{var ie=l!==null&&(l.flags&mt)!==ye;ie&&oW(g,g.child,A),T=jI(T)}if(cc(g,T),(g.mode&Ri)===Yn)g.memoizedState=null;else switch(G){case"forwards":{var ue=rW(g.child),Re;ue===null?(Re=g.child,g.child=null):(Re=ue.sibling,ue.sibling=null),jv(g,!1,Re,ue,W);break}case"backwards":{var ke=null,Qe=g.child;for(g.child=null;Qe!==null;){var ht=Qe.alternate;if(ht!==null&&Tf(ht)===null){g.child=Qe;break}var Rt=Qe.sibling;Qe.sibling=ke,ke=Qe,Qe=Rt}jv(g,!0,ke,null,W);break}case"together":{jv(g,!1,null,null,void 0);break}default:g.memoizedState=null}return g.child}function HB(l,g,A){hv(g,g.stateNode.containerInfo);var m=g.pendingProps;return l===null?g.child=PI(g,null,m,A):Bs(l,g,m,A),g.child}var hp=!1;function uW(l,g,A){var m=g.type,G=m._context,W=g.pendingProps,M=g.memoizedProps,T=W.value;{"value"in W||hp||(hp=!0,d("The `value` prop is required for the `<Context.Provider>`. Did you misspell it or forget to pass it?"));var U=g.type.propTypes;U&&Xr(U,W,"prop","Context.Provider")}if(pf(g,G,T),M!==null){var ie=M.value;if($o(ie,T)){if(M.children===W.children&&!PA())return Ag(l,g,A)}else zG(g,G,A)}var ue=W.children;return Bs(l,g,ue,A),g.child}var FB=!1;function Ap(l,g,A){var m=g.type;m._context===void 0?m!==m.Consumer&&(FB||(FB=!0,d("Rendering <Context> directly is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?"))):m=m._context;var G=g.pendingProps,W=G.children;typeof W!="function"&&d("A context consumer was rendered with multiple children, or a child that isn't a function. A context consumer expects a single child that is a function. If you did pass a function, make sure there is no trailing or leading whitespace around it."),zI(g,A);var M=aa(m);NC(g);var T;return fh.current=g,er(!0),T=W(M),er(!1),HI(),g.flags|=gt,Bs(l,g,T,A),g.child}function pc(){_s=!0}function Ag(l,g,A){return l!==null&&(g.dependencies=l.dependencies),Ac(),Sd(g.lanes),Ms(A,g.childLanes)?(Fw(l,g),g.child):null}function IW(l,g,A){{var m=g.return;if(m===null)throw new Error("Cannot swap the root fiber.");if(l.alternate=null,g.alternate=null,A.index=g.index,A.sibling=g.sibling,A.return=g.return,A.ref=g.ref,g===m.child)m.child=A;else{var G=m.child;if(G===null)throw new Error("Expected parent to have a child.");for(;G.sibling!==g;)if(G=G.sibling,G===null)throw new Error("Expected to find the previous sibling.");G.sibling=A}var W=m.deletions;return W===null?(m.deletions=[l],m.flags|=dt):W.push(l),A.flags|=De,A}}function qv(l,g){var A=l.lanes;return!!Ms(A,g)}function dW(l,g,A){switch(g.tag){case P:ZB(g),g.stateNode,Au();break;case E:iB(g);break;case F:{var m=g.type;gl(m)&&jA(g);break}case K:hv(g,g.stateNode.containerInfo);break;case Ce:{var G=g.memoizedProps.value,W=g.type._context;pf(g,W,G);break}case Be:{var M=Ms(A,g.childLanes);M&&(g.flags|=Ne);{var T=g.stateNode;T.effectDuration=0,T.passiveEffectDuration=0}}break;case ve:{var U=g.memoizedState;if(U!==null){if(U.dehydrated!==null)return cc(g,jI(Dr.current)),g.flags|=mt,null;var ie=g.child,ue=ie.childLanes;if(Ms(A,ue))return wB(l,g,A);cc(g,jI(Dr.current));var Re=Ag(l,g,A);return Re!==null?Re.sibling:null}else cc(g,jI(Dr.current));break}case Ee:{var ke=(l.flags&mt)!==ye,Qe=Ms(A,g.childLanes);if(ke){if(Qe)return MB(l,g,A);g.flags|=mt}var ht=g.memoizedState;if(ht!==null&&(ht.rendering=null,ht.tail=null,ht.lastEffect=null),cc(g,Dr.current),Qe)break;return null}case Zt:case Bt:return g.lanes=yt,ld(l,g,A)}return Ag(l,g,A)}function KB(l,g,A){if(g._debugNeedsRemount&&l!==null)return IW(l,g,Eh(g.type,g.key,g.pendingProps,g._debugOwner||null,g.mode,g.lanes));if(l!==null){var m=l.memoizedProps,G=g.pendingProps;if(m!==G||PA()||g.type!==l.type)_s=!0;else{var W=qv(l,A);if(!W&&(g.flags&mt)===ye)return _s=!1,dW(l,g,A);(l.flags&Q)!==ye?_s=!0:_s=!1}}else if(_s=!1,Na()&&zC(g)){var M=g.index,T=ac();$G(g,T,M)}switch(g.lanes=yt,g.tag){case _:return nW(l,g,g.type,A);case Xe:{var U=g.elementType;return Dv(l,g,U,A)}case H:{var ie=g.type,ue=g.pendingProps,Re=g.elementType===ie?ue:_r(ie,ue);return kv(l,g,ie,Re,A)}case F:{var ke=g.type,Qe=g.pendingProps,ht=g.elementType===ke?Qe:_r(ke,Qe);return jw(l,g,ke,ht,A)}case P:return qw(l,g,A);case E:return $w(l,g,A);case ee:return eW(l,g);case ve:return wB(l,g,A);case K:return HB(l,g,A);case he:{var Rt=g.type,Cn=g.pendingProps,En=g.elementType===Rt?Cn:_r(Rt,Cn);return mh(l,g,Rt,En,A)}case Ie:return Qw(l,g,A);case be:return Lv(l,g,A);case Be:return _v(l,g,A);case Ce:return uW(l,g,A);case se:return Ap(l,g,A);case we:{var Gn=g.type,Ei=g.pendingProps,Ti=_r(Gn,Ei);if(g.type!==g.elementType){var Me=Gn.propTypes;Me&&Xr(Me,Ti,"prop",Pe(Gn))}return Ti=_r(Gn.type,Ti),bh(l,g,Gn,Ti,A)}case me:return rd(l,g,g.type,g.pendingProps,A);case Ue:{var tt=g.type,Ve=g.pendingProps,Gt=g.elementType===tt?Ve:_r(tt,Ve);return tW(l,g,tt,Gt,A)}case Ee:return MB(l,g,A);case At:break;case Zt:return ld(l,g,A)}throw new Error("Unknown unit of work tag ("+g.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function CW(l,g,A){switch(Rf(g),g.tag){case F:{var m=g.type;gl(m)&&QA(g);var G=g.flags;return G&ot?(g.flags=G&~ot|mt,(g.mode&Ii)!==Yn&&ap(g),g):null}case P:{QI(g),Xb(g),Lf();var W=g.flags;return(W&ot)!==ye&&(W&mt)===ye?(g.flags=W&~ot|mt,g):null}case E:return Av(g),null;case ve:{qI(g);{var M=g.memoizedState;if(M!==null&&M.dehydrated!==null){if(g.alternate===null)throw new Error("Threw in newly mounted dehydrated component. This is likely a bug in React. Please file an issue.");Au()}}var T=g.flags;return T&ot?(g.flags=T&~ot|mt,(g.mode&Ii)!==Yn&&ap(g),g):null}case Ee:return qI(g),null;case K:return QI(g),null;case Ce:var U=g.type._context;return tv(U,g),null;case Zt:case Bt:return Zd(g),null;case kt:return null;default:return null}}function EB(l,g,A){switch(Rf(g),g.tag){case F:{var m=g.type.childContextTypes;m!=null&&QA(g);break}case P:{QI(g),Xb(g),Lf();break}case E:{Av(g);break}case K:QI(g);break;case ve:qI(g);break;case Ee:qI(g);break;case Ce:var G=g.type._context;tv(G,g);break;case Zt:case Bt:Zd(g);break}}function $v(l,g,A,m,G,W,M,T,U){var ie=Array.prototype.slice.call(arguments,3);try{g.apply(A,ie)}catch(ue){this.onError(ue)}}var TB=$v;if(typeof window<"u"&&typeof window.dispatchEvent=="function"&&typeof document<"u"&&typeof document.createEvent=="function"){var ey=document.createElement("react");TB=function(g,A,m,G,W,M,T,U,ie){if(typeof document>"u"||document===null)throw new Error("The `document` global was defined when React was initialized, but is not defined anymore. This can happen in a test environment if a component schedules an update from an asynchronous callback, but the test has already finished running. To solve this, you can either unmount the component at the end of your test (and ensure that any asynchronous operations get canceled in `componentWillUnmount`), or you can change the test itself to be asynchronous.");var ue=document.createEvent("Event"),Re=!1,ke=!0,Qe=window.event,ht=Object.getOwnPropertyDescriptor(window,"event");function Rt(){ey.removeEventListener(tt,En,!1),typeof window.event<"u"&&window.hasOwnProperty("event")&&(window.event=Qe)}var Cn=Array.prototype.slice.call(arguments,3);function En(){Re=!0,Rt(),A.apply(m,Cn),ke=!1}var Gn,Ei=!1,Ti=!1;function Me(Ve){if(Gn=Ve.error,Ei=!0,Gn===null&&Ve.colno===0&&Ve.lineno===0&&(Ti=!0),Ve.defaultPrevented&&Gn!=null&&typeof Gn=="object")try{Gn._suppressLogging=!0}catch{}}var tt="react-"+(g||"invokeguardedcallback");if(window.addEventListener("error",Me),ey.addEventListener(tt,En,!1),ue.initEvent(tt,!1,!1),ey.dispatchEvent(ue),ht&&Object.defineProperty(window,"event",ht),Re&&ke&&(Ei?Ti&&(Gn=new Error("A cross-origin error was thrown. React doesn't have access to the actual error object in development. See https://reactjs.org/link/crossorigin-error for more information.")):Gn=new Error(`An error was thrown inside one of your components, but React doesn't know what it was. This is likely due to browser flakiness. React does its best to preserve the "Pause on exceptions" behavior of the DevTools, which requires some DEV-mode only tricks. It's possible that these don't work in your browser. Try triggering the error in production mode, or switching to a modern browser. If you suspect that this is actually an issue with React, please file an issue.`),this.onError(Gn)),window.removeEventListener("error",Me),!Re)return Rt(),$v.apply(this,arguments)}}var hW=TB,yh=!1,fp=null,AW={onError:function(l){yh=!0,fp=l}};function zB(l,g,A,m,G,W,M,T,U){yh=!1,fp=null,hW.apply(AW,arguments)}function fW(){return yh}function LB(){if(yh){var l=fp;return yh=!1,fp=null,l}else throw new Error("clearCaughtError was called but no error was captured. This error is likely caused by a bug in React. Please file an issue.")}var _B=null;_B=new Set;var pp=!1,mc=!1,pW=typeof WeakSet=="function"?WeakSet:Set,Ut=null,cd=null,ud=null;function ua(l){zB(null,function(){throw l}),LB()}var Id=function(l,g){if(g.props=l.memoizedProps,g.state=l.memoizedState,l.mode&Ii)try{Ls(),g.componentWillUnmount()}finally{zs(l)}else g.componentWillUnmount()};function mp(l,g){try{uo(Ia,l)}catch(A){ua(A),Aa(l,g,A)}}function Zu(l,g,A){try{Id(l,A)}catch(m){ua(m),Aa(l,g,m)}}function ty(l,g,A){try{A.componentDidMount()}catch(m){ua(m),Aa(l,g,m)}}function kB(l,g){try{iy(l)}catch(A){ua(A),Aa(l,g,A)}}function bp(l,g){var A=l.ref;if(A!==null)if(typeof A=="function"){var m;try{if(w&&X&&l.mode&Ii)try{Ls(),m=A(null)}finally{zs(l)}else m=A(null)}catch(G){ua(G),Aa(l,g,G)}typeof m=="function"&&d("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",q(l))}else A.current=null}function vp(l,g,A){try{A()}catch(m){ua(m),Aa(l,g,m)}}var dd=!1;function yp(l,g){kl(l.containerInfo),Ut=g,UB();var A=dd;return dd=!1,A}function UB(){for(;Ut!==null;){var l=Ut,g=l.child;(l.subtreeFlags&ge)!==ye&&g!==null?(lr(g,l),Ut=g):Gh()}}function Gh(){for(;Ut!==null;){var l=Ut;va(l);try{Su(l)}catch(A){ua(A),Aa(l,l.return,A)}Oa();var g=l.sibling;if(g!==null){lr(g,l.return),Ut=g;return}Ut=l.return}}function Su(l){var g=l.alternate,A=l.flags;if((A&zn)!==ye){switch(va(l),l.tag){case H:case he:case me:break;case F:{if(g!==null){var m=g.memoizedProps,G=g.memoizedState,W=l.stateNode;l.type===l.elementType&&!fc&&(W.props!==l.memoizedProps&&d("Expected %s props to match memoized props before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",q(l)||"instance"),W.state!==l.memoizedState&&d("Expected %s state to match memoized state before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",q(l)||"instance"));var M=W.getSnapshotBeforeUpdate(l.elementType===l.type?m:_r(l.type,m),G);{var T=_B;M===void 0&&!T.has(l.type)&&(T.add(l.type),d("%s.getSnapshotBeforeUpdate(): A snapshot value (or null) must be returned. You have returned undefined.",q(l)))}W.__reactInternalSnapshotBeforeUpdate=M}break}case P:{if(no){var U=l.stateNode;EA(U.containerInfo)}break}case E:case ee:case K:case Ue:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}Oa()}}function da(l,g,A){var m=g.updateQueue,G=m!==null?m.lastEffect:null;if(G!==null){var W=G.next,M=W;do{if((M.tag&l)===l){var T=M.destroy;M.destroy=void 0,T!==void 0&&((l&Pa)!==Jr?pw(g):(l&Ia)!==Jr&&MG(g),vp(g,A,T),(l&Pa)!==Jr?mw():(l&Ia)!==Jr&&HG())}M=M.next}while(M!==W)}}function uo(l,g){var A=g.updateQueue,m=A!==null?A.lastEffect:null;if(m!==null){var G=m.next,W=G;do{if((W.tag&l)===l){(l&Pa)!==Jr?XG(g):(l&Ia)!==Jr&&bw(g);var M=W.create;W.destroy=M(),(l&Pa)!==Jr?YG():(l&Ia)!==Jr&&vw();{var T=W.destroy;if(T!==void 0&&typeof T!="function"){var U=void 0;(W.tag&Ia)!==ye?U="useLayoutEffect":(W.tag&nr)!==ye?U="useInsertionEffect":U="useEffect";var ie=void 0;T===null?ie=" You returned null. If your effect does not require clean up, return undefined (or nothing).":typeof T.then=="function"?ie=`

It looks like you wrote `+U+`(async () => ...) or returned a Promise. Instead, write the async function inside your effect and call it immediately:

`+U+`(() => {
  async function fetchData() {
    // You can await here
    const response = await MyAPI.getData(someId);
    // ...
  }
  fetchData();
}, [someId]); // Or [] if effect doesn't need props or state

Learn more about data fetching with Hooks: https://reactjs.org/link/hooks-data-fetching`:ie=" You returned: "+T,d("%s must not return anything besides a function, which is used for clean-up.%s",U,ie)}}}W=W.next}while(W!==G)}}function Gp(l,g){if((g.flags&Ne)!==ye)switch(g.tag){case Be:{var A=g.stateNode.passiveEffectDuration,m=g.memoizedProps,G=m.id,W=m.onPostCommit,M=uh(),T=g.alternate===null?"mount":"update";fB()&&(T="nested-update"),typeof W=="function"&&W(G,T,A,M);var U=g.return;e:for(;U!==null;){switch(U.tag){case P:var ie=U.stateNode;ie.passiveEffectDuration+=A;break e;case Be:var ue=U.stateNode;ue.passiveEffectDuration+=A;break e}U=U.return}break}}}function ny(l,g,A,m){if((A.flags&Se)!==ye)switch(A.tag){case H:case he:case me:{if(!mc)if(A.mode&Ii)try{Ls(),uo(Ia|Li,A)}finally{zs(A)}else uo(Ia|Li,A);break}case F:{var G=A.stateNode;if(A.flags&Ne&&!mc)if(g===null)if(A.type===A.elementType&&!fc&&(G.props!==A.memoizedProps&&d("Expected %s props to match memoized props before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",q(A)||"instance"),G.state!==A.memoizedState&&d("Expected %s state to match memoized state before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",q(A)||"instance")),A.mode&Ii)try{Ls(),G.componentDidMount()}finally{zs(A)}else G.componentDidMount();else{var W=A.elementType===A.type?g.memoizedProps:_r(A.type,g.memoizedProps),M=g.memoizedState;if(A.type===A.elementType&&!fc&&(G.props!==A.memoizedProps&&d("Expected %s props to match memoized props before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",q(A)||"instance"),G.state!==A.memoizedState&&d("Expected %s state to match memoized state before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",q(A)||"instance")),A.mode&Ii)try{Ls(),G.componentDidUpdate(W,M,G.__reactInternalSnapshotBeforeUpdate)}finally{zs(A)}else G.componentDidUpdate(W,M,G.__reactInternalSnapshotBeforeUpdate)}var T=A.updateQueue;T!==null&&(A.type===A.elementType&&!fc&&(G.props!==A.memoizedProps&&d("Expected %s props to match memoized props before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",q(A)||"instance"),G.state!==A.memoizedState&&d("Expected %s state to match memoized state before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",q(A)||"instance")),DG(A,T,G));break}case P:{var U=A.updateQueue;if(U!==null){var ie=null;if(A.child!==null)switch(A.child.tag){case E:ie=wr(A.child.stateNode);break;case F:ie=A.child.stateNode;break}DG(A,U,ie)}break}case E:{var ue=A.stateNode;if(g===null&&A.flags&Ne){var Re=A.type,ke=A.memoizedProps;cC(ue,Re,ke,A)}break}case ee:break;case K:break;case Be:{{var Qe=A.memoizedProps,ht=Qe.onCommit,Rt=Qe.onRender,Cn=A.stateNode.effectDuration,En=uh(),Gn=g===null?"mount":"update";fB()&&(Gn="nested-update"),typeof Rt=="function"&&Rt(A.memoizedProps.id,Gn,A.actualDuration,A.treeBaseDuration,A.actualStartTime,En);{typeof ht=="function"&&ht(A.memoizedProps.id,Gn,Cn,En),Wd(A);var Ei=A.return;e:for(;Ei!==null;){switch(Ei.tag){case P:var Ti=Ei.stateNode;Ti.effectDuration+=Cn;break e;case Be:var Me=Ei.stateNode;Me.effectDuration+=Cn;break e}Ei=Ei.return}}}break}case ve:{Sl(l,A);break}case Ee:case Ue:case At:case Zt:case Bt:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}mc||A.flags&Wn&&iy(A)}function mW(l){switch(l.tag){case H:case he:case me:{if(l.mode&Ii)try{Ls(),mp(l,l.return)}finally{zs(l)}else mp(l,l.return);break}case F:{var g=l.stateNode;typeof g.componentDidMount=="function"&&ty(l,l.return,g),kB(l,l.return);break}case E:{kB(l,l.return);break}}}function DB(l,g){var A=null;if(no)for(var m=l;;){if(m.tag===E){if(A===null){A=m;var G=m.stateNode;g?GI(G):ZI(m.stateNode,m.memoizedProps)}}else if(m.tag===ee){if(A===null){var W=m.stateNode;g?BI(W):KA(W,m.memoizedProps)}}else if(!((m.tag===Zt||m.tag===Bt)&&m.memoizedState!==null&&m!==l)){if(m.child!==null){m.child.return=m,m=m.child;continue}}if(m===l)return;for(;m.sibling===null;){if(m.return===null||m.return===l)return;A===m&&(A=null),m=m.return}A===m&&(A=null),m.sibling.return=m.return,m=m.sibling}}function iy(l){var g=l.ref;if(g!==null){var A=l.stateNode,m;switch(l.tag){case E:m=wr(A);break;default:m=A}if(typeof g=="function"){var G;if(l.mode&Ii)try{Ls(),G=g(m)}finally{zs(l)}else G=g(m);typeof G=="function"&&d("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",q(l))}else g.hasOwnProperty("current")||d("Unexpected ref object provided for %s. Use either a ref-setter function or React.createRef().",q(l)),g.current=m}}function Bp(l){var g=l.ref;if(g!==null)if(typeof g=="function")if(l.mode&Ii)try{Ls(),g(null)}finally{zs(l)}else g(null);else g.current=null}function ar(l,g,A){switch(VC(g),g.tag){case H:case he:case we:case me:{var m=g.updateQueue;if(m!==null){var G=m.lastEffect;if(G!==null){var W=G.next,M=W;do{var T=M,U=T.destroy,ie=T.tag;U!==void 0&&((ie&nr)!==Jr?vp(g,A,U):(ie&Ia)!==Jr&&(MG(g),g.mode&Ii?(Ls(),vp(g,A,U),zs(g)):vp(g,A,U),HG())),M=M.next}while(M!==W)}}return}case F:{bp(g,A);var ue=g.stateNode;typeof ue.componentWillUnmount=="function"&&Zu(g,A,ue);return}case E:{bp(g,A);return}case K:{no?Ru(l,g,A):_g&&bc(g);return}case de:return;case At:return}}function Zp(l,g,A){for(var m=g;;){if(ar(l,m,A),m.child!==null&&(!no||m.tag!==K)){m.child.return=m,m=m.child;continue}if(m===g)return;for(;m.sibling===null;){if(m.return===null||m.return===g)return;m=m.return}m.sibling.return=m.return,m=m.sibling}}function Sp(l){var g=l.alternate;g!==null&&(g.return=null),l.return=null}function Bl(l){var g=l.alternate;g!==null&&(l.alternate=null,Bl(g));{if(l.child=null,l.deletions=null,l.sibling=null,l.tag===E){var A=l.stateNode;A!==null&&lC(A)}l.stateNode=null,l._debugOwner=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}}function bc(l){if(_g){var g=l.stateNode,A=g.containerInfo,m=dC(A);Ke(A,m)}}function Zs(l){if(_g){switch(l.tag){case F:case E:case ee:return;case P:case K:{var g=l.stateNode,A=g.containerInfo,m=g.pendingChildren;Ke(A,m);return}}throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}}function Ss(l){for(var g=l.return;g!==null;){if(Rp(g))return g;g=g.return}throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.")}function Rp(l){return l.tag===E||l.tag===P||l.tag===K}function Io(l){var g=l;e:for(;;){for(;g.sibling===null;){if(g.return===null||Rp(g.return))return null;g=g.return}for(g.sibling.return=g.return,g=g.sibling;g.tag!==E&&g.tag!==ee&&g.tag!==de;){if(g.flags&De||g.child===null||g.tag===K)continue e;g.child.return=g,g=g.child}if(!(g.flags&De))return g.stateNode}}function Zl(l){if(no){var g=Ss(l);switch(g.tag){case E:{var A=g.stateNode;g.flags&wt&&(ol(A),g.flags&=~wt);var m=Io(l);Bh(l,m,A);break}case P:case K:{var G=g.stateNode.containerInfo,W=Io(l);sr(l,W,G);break}default:throw new Error("Invalid host parent fiber. This error is likely caused by a bug in React. Please file an issue.")}}}function sr(l,g,A){var m=l.tag,G=m===E||m===ee;if(G){var W=l.stateNode;g?Ug(A,W,g):gC(A,W)}else if(m!==K){var M=l.child;if(M!==null){sr(M,g,A);for(var T=M.sibling;T!==null;)sr(T,g,A),T=T.sibling}}}function Bh(l,g,A){var m=l.tag,G=m===E||m===ee;if(G){var W=l.stateNode;g?mb(A,W,g):pb(A,W)}else if(m!==K){var M=l.child;if(M!==null){Bh(M,g,A);for(var T=M.sibling;T!==null;)Bh(T,g,A),T=T.sibling}}}function Ru(l,g,A){for(var m=g,G=!1,W,M;;){if(!G){var T=m.return;e:for(;;){if(T===null)throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");var U=T.stateNode;switch(T.tag){case E:W=U,M=!1;break e;case P:W=U.containerInfo,M=!0;break e;case K:W=U.containerInfo,M=!0;break e}T=T.return}G=!0}if(m.tag===E||m.tag===ee)Zp(l,m,A),M?uC(W,m.stateNode):Oc(W,m.stateNode);else if(m.tag===de)M?vb(W,m.stateNode):TA(W,m.stateNode);else if(m.tag===K){if(m.child!==null){W=m.stateNode.containerInfo,M=!0,m.child.return=m,m=m.child;continue}}else if(ar(l,m,A),m.child!==null){m.child.return=m,m=m.child;continue}if(m===g)return;for(;m.sibling===null;){if(m.return===null||m.return===g)return;m=m.return,m.tag===K&&(G=!1)}m.sibling.return=m.return,m=m.sibling}}function JB(l,g,A){no?Ru(l,g,A):Zp(l,g,A),Sp(g)}function vc(l,g){if(!no){switch(g.tag){case H:case he:case we:case me:{if(da(nr|Li,g,g.return),uo(nr|Li,g),g.mode&Ii)try{Ls(),da(Ia|Li,g,g.return)}finally{zs(g)}else da(Ia|Li,g,g.return);return}case Be:return;case ve:{Zh(g),wu(g);return}case Ee:{wu(g);return}case P:{if(Mn&&l!==null){var A=l.memoizedState;if(A.isDehydrated){var m=g.stateNode;SI(m.containerInfo)}}break}case Zt:case Bt:return}Zs(g);return}switch(g.tag){case H:case he:case we:case me:{if(da(nr|Li,g,g.return),uo(nr|Li,g),g.mode&Ii)try{Ls(),da(Ia|Li,g,g.return)}finally{zs(g)}else da(Ia|Li,g,g.return);return}case F:return;case E:{var G=g.stateNode;if(G!=null){var W=g.memoizedProps,M=l!==null?l.memoizedProps:W,T=g.type,U=g.updateQueue;g.updateQueue=null,U!==null&&yI(G,U,T,M,W,g)}return}case ee:{if(g.stateNode===null)throw new Error("This should have a text node initialized. This error is likely caused by a bug in React. Please file an issue.");var ie=g.stateNode,ue=g.memoizedProps,Re=l!==null?l.memoizedProps:ue;FA(ie,Re,ue);return}case P:{if(Mn&&l!==null){var ke=l.memoizedState;if(ke.isDehydrated){var Qe=g.stateNode;SI(Qe.containerInfo)}}return}case Be:return;case ve:{Zh(g),wu(g);return}case Ee:{wu(g);return}case Ue:return}throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}function Zh(l){l.memoizedState}function Sl(l,g){if(Mn){var A=g.memoizedState;if(A===null){var m=g.alternate;if(m!==null){var G=m.memoizedState;if(G!==null){var W=G.dehydrated;W!==null&&bb(W)}}}}}function wu(l){var g=l.updateQueue;if(g!==null){l.updateQueue=null;var A=l.stateNode;A===null&&(A=l.stateNode=new pW),g.forEach(function(m){var G=Zy.bind(null,l,m);if(!A.has(m)){if(A.add(m),wi)if(cd!==null&&ud!==null)Fh(ud,cd);else throw Error("Expected finished root and lanes to be set. This is a bug in React.");m.then(G,G)}})}}function ay(l){no&&ol(l.stateNode)}function OB(l,g,A){cd=A,ud=l,Ut=g,PB(l,A),cd=null,ud=null}function PB(l,g){for(;Ut!==null;){var A=Ut,m=A.deletions;if(m!==null)for(var G=0;G<m.length;G++){var W=m[G];try{JB(l,W,A)}catch(T){ua(T),Aa(W,A,T)}}var M=A.child;(A.subtreeFlags&Ge)!==ye&&M!==null?(lr(M,A),Ut=M):wp(l,g)}}function wp(l,g){for(;Ut!==null;){var A=Ut;va(A);try{QB(A,l,g)}catch(G){ua(G),Aa(A,A.return,G)}Oa();var m=A.sibling;if(m!==null){lr(m,A.return),Ut=m;return}Ut=A.return}}function QB(l,g,A){var m=l.flags;if(m&wt&&ay(l),m&Wn){var G=l.alternate;G!==null&&Bp(G)}if(m&ci)switch(l.tag){case ve:{var W=l.memoizedState,M=W!==null;if(M){var T=l.alternate,U=T!==null&&T.memoizedState!==null;U||_p()}break}case Zt:{var ie=l.memoizedState,ue=ie!==null,Re=l.alternate,ke=Re!==null&&Re.memoizedState!==null,Qe=l;no&&DB(Qe,ue);{if(ue&&!ke&&(Qe.mode&Ri)!==Yn){Ut=Qe;for(var ht=Qe.child;ht!==null;)Ut=ht,pg(ht),ht=ht.sibling}break}}}var Rt=m&(De|Ne|In);switch(Rt){case De:{Zl(l),l.flags&=~De;break}case ce:{Zl(l),l.flags&=~De;var Cn=l.alternate;vc(Cn,l);break}case In:{l.flags&=~In;break}case fi:{l.flags&=~In;var En=l.alternate;vc(En,l);break}case Ne:{var Gn=l.alternate;vc(Gn,l);break}}}function bW(l,g,A){cd=A,ud=g,Ut=l,fg(l,g,A),cd=null,ud=null}function fg(l,g,A){for(var m=(l.mode&Ri)!==Yn;Ut!==null;){var G=Ut,W=G.child;if(G.tag===Zt&&m){var M=G.memoizedState!==null,T=M||pp;if(T){Cd(l,g,A);continue}else{var U=G.alternate,ie=U!==null&&U.memoizedState!==null,ue=ie||mc,Re=pp,ke=mc;pp=T,mc=ue,mc&&!ke&&(Ut=G,sy(G));for(var Qe=W;Qe!==null;)Ut=Qe,fg(Qe,g,A),Qe=Qe.sibling;Ut=G,pp=Re,mc=ke,Cd(l,g,A);continue}}(G.subtreeFlags&Se)!==ye&&W!==null?(lr(W,G),Ut=W):Cd(l,g,A)}}function Cd(l,g,A){for(;Ut!==null;){var m=Ut;if((m.flags&Se)!==ye){var G=m.alternate;va(m);try{ny(g,G,m,A)}catch(M){ua(M),Aa(m,m.return,M)}Oa()}if(m===l){Ut=null;return}var W=m.sibling;if(W!==null){lr(W,m.return),Ut=W;return}Ut=m.return}}function pg(l){for(;Ut!==null;){var g=Ut,A=g.child;switch(g.tag){case H:case he:case we:case me:{if(g.mode&Ii)try{Ls(),da(Ia,g,g.return)}finally{zs(g)}else da(Ia,g,g.return);break}case F:{bp(g,g.return);var m=g.stateNode;typeof m.componentWillUnmount=="function"&&Zu(g,g.return,m);break}case E:{bp(g,g.return);break}case Zt:{var G=g.memoizedState!==null;if(G){Wp(l);continue}break}}A!==null?(A.return=g,Ut=A):Wp(l)}}function Wp(l){for(;Ut!==null;){var g=Ut;if(g===l){Ut=null;return}var A=g.sibling;if(A!==null){A.return=g.return,Ut=A;return}Ut=g.return}}function sy(l){for(;Ut!==null;){var g=Ut,A=g.child;if(g.tag===Zt){var m=g.memoizedState!==null;if(m){oy(l);continue}}A!==null?(A.return=g,Ut=A):oy(l)}}function oy(l){for(;Ut!==null;){var g=Ut;va(g);try{mW(g)}catch(m){ua(m),Aa(g,g.return,m)}if(Oa(),g===l){Ut=null;return}var A=g.sibling;if(A!==null){A.return=g.return,Ut=A;return}Ut=g.return}}function vW(l,g){Ut=g,jB(g,l)}function jB(l,g){for(;Ut!==null;){var A=Ut,m=A.child;(A.subtreeFlags&Ze)!==ye&&m!==null?(lr(m,A),Ut=m):yc(l,g)}}function yc(l,g){for(;Ut!==null;){var A=Ut;if((A.flags&Dn)!==ye){va(A);try{hd(g,A)}catch(G){ua(G),Aa(A,A.return,G)}Oa()}if(A===l){Ut=null;return}var m=A.sibling;if(m!==null){lr(m,A.return),Ut=m;return}Ut=A.return}}function hd(l,g){switch(g.tag){case H:case he:case me:{if(g.mode&Ii){vu();try{uo(Pa|Li,g)}finally{Ih(g)}}else uo(Pa|Li,g);break}}}function Ad(l){Ut=l,xp()}function xp(){for(;Ut!==null;){var l=Ut,g=l.child;if((Ut.flags&dt)!==ye){var A=l.deletions;if(A!==null){for(var m=0;m<A.length;m++){var G=A[m];Ut=G,rr(G,l)}{var W=l.alternate;if(W!==null){var M=W.child;if(M!==null){W.child=null;do{var T=M.sibling;M.sibling=null,M=T}while(M!==null)}}}Ut=l}}(l.subtreeFlags&Ze)!==ye&&g!==null?(lr(g,l),Ut=g):Vp()}}function Vp(){for(;Ut!==null;){var l=Ut;(l.flags&Dn)!==ye&&(va(l),or(l),Oa());var g=l.sibling;if(g!==null){lr(g,l.return),Ut=g;return}Ut=l.return}}function or(l){switch(l.tag){case H:case he:case me:{l.mode&Ii?(vu(),da(Pa|Li,l,l.return),Ih(l)):da(Pa|Li,l,l.return);break}}}function rr(l,g){for(;Ut!==null;){var A=Ut;va(A),mg(A,g),Oa();var m=A.child;m!==null?(lr(m,A),Ut=m):Wu(l)}}function Wu(l){for(;Ut!==null;){var g=Ut,A=g.sibling,m=g.return;if(Bl(g),g===l){Ut=null;return}if(A!==null){lr(A,m),Ut=A;return}Ut=m}}function mg(l,g){switch(l.tag){case H:case he:case me:{l.mode&Ii?(vu(),da(Pa,l,g),Ih(l)):da(Pa,l,g);break}}}var Rl=!1;function lr(l,g){!Rl&&l.return!==g&&(Rl=!0,d("Internal React error: Return pointer is inconsistent with parent.")),l.return=g}function yW(l){switch(l.tag){case H:case he:case me:{try{uo(Ia|Li,l)}catch(A){ua(A),Aa(l,l.return,A)}break}case F:{var g=l.stateNode;try{g.componentDidMount()}catch(A){ua(A),Aa(l,l.return,A)}break}}}function GW(l){switch(l.tag){case H:case he:case me:{try{uo(Pa|Li,l)}catch(g){ua(g),Aa(l,l.return,g)}break}}}function xu(l){switch(l.tag){case H:case he:case me:{try{da(Ia|Li,l,l.return)}catch(A){ua(A),Aa(l,l.return,A)}break}case F:{var g=l.stateNode;typeof g.componentWillUnmount=="function"&&Zu(l,l.return,g);break}}}function qB(l){switch(l.tag){case H:case he:case me:try{da(Pa|Li,l,l.return)}catch(g){ua(g),Aa(l,l.return,g)}}}var fd=0,Vu=1,Np=2,pd=3,Xp=4;if(typeof Symbol=="function"&&Symbol.for){var Sh=Symbol.for;fd=Sh("selector.component"),Vu=Sh("selector.has_pseudo_class"),Np=Sh("selector.role"),pd=Sh("selector.test_id"),Xp=Sh("selector.text")}function Nu(l){return{$$typeof:fd,value:l}}function cs(l){return{$$typeof:Vu,value:l}}function gr(l){return{$$typeof:Np,value:l}}function Pr(l){return{$$typeof:Xp,value:l}}function Xu(l){return{$$typeof:pd,value:l}}function wl(l){var g=Ab(l);if(g!=null){if(typeof g.memoizedProps["data-testname"]!="string")throw new Error("Invalid host root specified. Should be either a React container or a node with a testname attribute.");return g}else{var A=fb(l);if(A===null)throw new Error("Could not find React container within specified host subtree.");return A.stateNode.current}}function ry(l,g){switch(g.$$typeof){case fd:if(l.type===g.value)return!0;break;case Vu:return BW(l,g.value);case Np:if(l.tag===E){var A=l.stateNode;if(Qo(A,g.value))return!0}break;case Xp:if(l.tag===E||l.tag===ee){var m=Oi(l);if(m!==null&&m.indexOf(g.value)>=0)return!0}break;case pd:if(l.tag===E){var G=l.memoizedProps["data-testname"];if(typeof G=="string"&&G.toLowerCase()===g.value.toLowerCase())return!0}break;default:throw new Error("Invalid selector type specified.")}return!1}function Yp(l){switch(l.$$typeof){case fd:var g=Pe(l.value)||"Unknown";return"<"+g+">";case Vu:return":has("+(Yp(l)||"")+")";case Np:return'[role="'+l.value+'"]';case Xp:return'"'+l.value+'"';case pd:return'[data-testname="'+l.value+'"]';default:throw new Error("Invalid selector type specified.")}}function $B(l,g){for(var A=[],m=[l,0],G=0;G<m.length;){var W=m[G++],M=m[G++],T=g[M];if(!(W.tag===E&&kg(W))){for(;T!=null&&ry(W,T);)M++,T=g[M];if(M===g.length)A.push(W);else for(var U=W.child;U!==null;)m.push(U,M),U=U.sibling}}return A}function BW(l,g){for(var A=[l,0],m=0;m<A.length;){var G=A[m++],W=A[m++],M=g[W];if(!(G.tag===E&&kg(G))){for(;M!=null&&ry(G,M);)W++,M=g[W];if(W===g.length)return!0;for(var T=G.child;T!==null;)A.push(T,W),T=T.sibling}}return!1}function Mp(l,g){if(!So)throw new Error("Test selector API is not supported by this renderer.");for(var A=wl(l),m=$B(A,g),G=[],W=Array.from(m),M=0;M<W.length;){var T=W[M++];if(T.tag===E){if(kg(T))continue;G.push(T.stateNode)}else for(var U=T.child;U!==null;)W.push(U),U=U.sibling}return G}function eZ(l,g){if(!So)throw new Error("Test selector API is not supported by this renderer.");for(var A=wl(l),m=0,G=[],W=[A,0],M=0;M<W.length;){var T=W[M++],U=W[M++],ie=g[U];if(!(T.tag===E&&kg(T))&&(ry(T,ie)&&(G.push(Yp(ie)),U++,U>m&&(m=U)),U<g.length))for(var ue=T.child;ue!==null;)W.push(ue,U),ue=ue.sibling}if(m<g.length){for(var Re=[],ke=m;ke<g.length;ke++)Re.push(Yp(g[ke]));return`findAllNodes was able to match part of the selector:
`+("  "+G.join(" > ")+`

`)+`No matching component was found for:
`+("  "+Re.join(" > "))}return null}function tZ(l,g){if(!So)throw new Error("Test selector API is not supported by this renderer.");for(var A=Mp(l,g),m=[],G=0;G<A.length;G++)m.push(za(A[G]));for(var W=m.length-1;W>0;W--)for(var M=m[W],T=M.x,U=T+M.width,ie=M.y,ue=ie+M.height,Re=W-1;Re>=0;Re--)if(W!==Re){var ke=m[Re],Qe=ke.x,ht=Qe+ke.width,Rt=ke.y,Cn=Rt+ke.height;if(T>=Qe&&ie>=Rt&&U<=ht&&ue<=Cn){m.splice(W,1);break}else if(T===Qe&&M.width===ke.width&&!(Cn<ie)&&!(Rt>ue)){Rt>ie&&(ke.height+=Rt-ie,ke.y=ie),Cn<ue&&(ke.height=ue-Rt),m.splice(W,1);break}else if(ie===Rt&&M.height===ke.height&&!(ht<T)&&!(Qe>U)){Qe>T&&(ke.width+=Qe-T,ke.x=T),ht<U&&(ke.width=U-Qe),m.splice(W,1);break}}return m}function ly(l,g){if(!So)throw new Error("Test selector API is not supported by this renderer.");for(var A=wl(l),m=$B(A,g),G=Array.from(m),W=0;W<G.length;){var M=G[W++];if(!kg(M)){if(M.tag===E){var T=M.stateNode;if(Ns(T))return!0}for(var U=M.child;U!==null;)G.push(U),U=U.sibling}}return!1}var Rh=[];function nZ(){So&&Rh.forEach(function(l){return l()})}function gy(l,g,A,m){if(!So)throw new Error("Test selector API is not supported by this renderer.");var G=Mp(l,g),W=Nr(G,A,m),M=W.disconnect,T=W.observe,U=W.unobserve,ie=function(){var ue=Mp(l,g);G.forEach(function(Re){ue.indexOf(Re)<0&&U(Re)}),ue.forEach(function(Re){G.indexOf(Re)<0&&T(Re)})};return Rh.push(ie),{disconnect:function(){var ue=Rh.indexOf(ie);ue>=0&&Rh.splice(ue,1),M()}}}var cy=o.ReactCurrentActQueue;function uy(l){{var g=typeof IS_REACT_ACT_ENVIRONMENT<"u"?IS_REACT_ACT_ENVIRONMENT:void 0,A=typeof jest<"u";return Dc&&A&&g!==!1}}function iZ(){{var l=typeof IS_REACT_ACT_ENVIRONMENT<"u"?IS_REACT_ACT_ENVIRONMENT:void 0;return!l&&cy.current!==null&&d("The current testing environment is not configured to support act(...)"),l}}var ZW=Math.ceil,Iy=o.ReactCurrentDispatcher,dy=o.ReactCurrentOwner,$i=o.ReactCurrentBatchConfig,Co=o.ReactCurrentActQueue,Ga=0,Hp=1,Ca=2,cr=4,_i=0,Yu=1,Mu=2,Fp=3,wh=4,ur=5,Cy=6,Vn=Ga,Ba=null,Vi=null,sa=yt,ho=yt,Hu=Og(yt),oa=_i,Qr=null,Fu=yt,md=yt,bd=yt,Ku=null,Rs=null,Wh=0,Kp=500,hy=1/0,SW=500;function Wl(){hy=Da()+SW}function xh(){return hy}var Eu=!1,Ep=null,Tu=null,Ir=!1,xl=null,Vh=yt,Ay=[],fy=50,zu=0,vd=null,yd=50,Gd=0,Gc=Fi,Lu=yt;function Nh(){return Ba}function ws(){return(Vn&(Ca|cr))!==Ga?Da():(Gc!==Fi||(Gc=Da()),Gc)}function bg(l){var g=l.mode;if((g&Ri)===Yn)return On;if((Vn&Ca)!==Ga&&sa!==yt)return xI(sa);var A=FI()!==YC;if(A){if($i.transition!==null){var m=$i.transition;m._updatedFibers||(m._updatedFibers=new Set),m._updatedFibers.add(l)}return Lu===La&&(Lu=lf()),Lu}var G=Tr();if(G!==La)return G;var W=Xn();return W}function py(l){var g=l.mode;return(g&Ri)===Yn?On:Ys()}function ha(l,g,A){Rc();var m=Tp(l,g);return m===null?null:(wC(m,g,A),(Vn&Ca)!==yt&&m===Ba?Sy(l):(wi&&Ub(m,l,g),Ou(l),m===Ba&&((Vn&Ca)===Ga&&(md=Kn(md,g)),oa===wh&&Zc(m,sa)),oi(m,A),g===On&&Vn===Ga&&(l.mode&Ri)===Yn&&!Co.isBatchingLegacy&&(Wl(),iu())),m)}function RW(l,g,A){var m=l.current;m.lanes=g,wC(l,g,A),oi(l,A)}function Tp(l,g){l.lanes=Kn(l.lanes,g);var A=l.alternate;A!==null&&(A.lanes=Kn(A.lanes,g)),A===null&&(l.flags&(De|In))!==ye&&Za(l);for(var m=l,G=l.return;G!==null;)G.childLanes=Kn(G.childLanes,g),A=G.alternate,A!==null?A.childLanes=Kn(A.childLanes,g):(G.flags&(De|In))!==ye&&Za(l),m=G,G=G.return;if(m.tag===P){var W=m.stateNode;return W}else return null}function _u(l,g){return Ba!==null&&(l.mode&Ri)!==Yn&&(Vn&Ca)===Ga}function oi(l,g){var A=l.callbackNode;wG(l,g);var m=ei(l,l===Ba?sa:yt);if(m===yt){A!==null&&Up(A),l.callbackNode=null,l.callbackPriority=La;return}var G=ng(m),W=l.callbackPriority;if(W===G&&!(Co.current!==null&&A!==Dt)){A==null&&W!==On&&d("Expected scheduled callback to exist. This error is likely caused by a bug in React. Please file an issue.");return}A!=null&&Up(A);var M;if(G===On)l.tag===Qc?(Co.isBatchingLegacy!==null&&(Co.didScheduleLegacyUpdate=!0),wn(ks.bind(null,l))):xa(ks.bind(null,l)),Vs?Co.current!==null?Co.current.push(Ja):Jc(function(){Vn===Ga&&Ja()}):wc(sg,Ja),M=null;else{var T;switch(If(m)){case Er:T=sg;break;case XI:T=rs;break;case WC:T=zt;break;case uf:T=zr;break;default:T=zt;break}M=wc(T,Bc.bind(null,l))}l.callbackPriority=G,l.callbackNode=M}function Bc(l,g){if(co(),Gc=Fi,Lu=yt,(Vn&(Ca|cr))!==Ga)throw new Error("Should not already be working.");var A=l.callbackNode,m=dr();if(m&&l.callbackNode!==A)return null;var G=ei(l,l===Ba?sa:yt);if(G===yt)return null;var W=!ul(l,G)&&!Lb(l,G)&&!g,M=W?Yh(l,G):Uu(l,G);if(M!==_i){if(M===Mu){var T=Fr(l);T!==yt&&(G=T,M=Xh(l,T))}if(M===Yu){var U=Qr;throw vg(l,yt),Zc(l,G),oi(l,Da()),U}if(M===Cy)Zc(l,G);else{var ie=!ul(l,G),ue=l.current.alternate;if(ie&&!wW(ue)){if(M=Uu(l,G),M===Mu){var Re=Fr(l);Re!==yt&&(G=Re,M=Xh(l,Re))}if(M===Yu){var ke=Qr;throw vg(l,yt),Zc(l,G),oi(l,Da()),ke}}l.finishedWork=ue,l.finishedLanes=G,sZ(l,M,G)}}return oi(l,Da()),l.callbackNode===A?Bc.bind(null,l):null}function Xh(l,g){var A=Ku;if(qg(l)){var m=vg(l,g);m.flags|=mn,Ol(l.containerInfo)}var G=Uu(l,g);if(G!==Mu){var W=Rs;Rs=A,W!==null&&aZ(W)}return G}function aZ(l){Rs===null?Rs=l:Rs.push.apply(Rs,l)}function sZ(l,g,A){switch(g){case _i:case Yu:throw new Error("Root did not complete. This is a bug in React.");case Mu:{Nl(l,Rs);break}case Fp:{if(Zc(l,A),eg(A)&&!Ju()){var m=Wh+Kp-Da();if(m>10){var G=ei(l,yt);if(G!==yt)break;var W=l.suspendedLanes;if(!Wo(W,A)){ws(),_b(l,W);break}l.timeoutHandle=Lg(Nl.bind(null,l,Rs),m);break}}Nl(l,Rs);break}case wh:{if(Zc(l,A),tg(A))break;if(!Ju()){var M=eu(l,A),T=M,U=Da()-T,ie=XW(U)-U;if(ie>10){l.timeoutHandle=Lg(Nl.bind(null,l,Rs),ie);break}}Nl(l,Rs);break}case ur:{Nl(l,Rs);break}default:throw new Error("Unknown root exit status.")}}function wW(l){for(var g=l;;){if(g.flags&is){var A=g.updateQueue;if(A!==null){var m=A.stores;if(m!==null)for(var G=0;G<m.length;G++){var W=m[G],M=W.getSnapshot,T=W.value;try{if(!$o(M(),T))return!1}catch{return!1}}}}var U=g.child;if(g.subtreeFlags&is&&U!==null){U.return=g,g=U;continue}if(g===l)return!0;for(;g.sibling===null;){if(g.return===null||g.return===l)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}return!0}function Zc(l,g){g=VI(g,bd),g=VI(g,md),nu(l,g)}function ks(l){if(ch(),(Vn&(Ca|cr))!==Ga)throw new Error("Should not already be working.");dr();var g=ei(l,yt);if(!Ms(g,On))return oi(l,Da()),null;var A=Uu(l,g);if(l.tag!==Qc&&A===Mu){var m=Fr(l);m!==yt&&(g=m,A=Xh(l,m))}if(A===Yu){var G=Qr;throw vg(l,yt),Zc(l,g),oi(l,Da()),G}if(A===Cy)throw new Error("Root did not complete. This is a bug in React.");var W=l.current.alternate;return l.finishedWork=W,l.finishedLanes=g,Nl(l,Rs),oi(l,Da()),null}function WW(l,g){g!==yt&&(kb(l,Kn(g,On)),oi(l,Da()),(Vn&(Ca|cr))===Ga&&(Wl(),Ja()))}function zp(l){var g=Tr(),A=$i.transition;try{return $i.transition=null,ka(WC),l()}finally{ka(g),$i.transition=A}}function oZ(l,g){var A=Vn;Vn|=Hp;try{return l(g)}finally{Vn=A,Vn===Ga&&!Co.isBatchingLegacy&&(Wl(),iu())}}function rZ(l,g,A,m,G){var W=Tr(),M=$i.transition;try{return $i.transition=null,ka(Er),l(g,A,m,G)}finally{ka(W),$i.transition=M,Vn===Ga&&Wl()}}function ku(l){xl!==null&&xl.tag===Qc&&(Vn&(Ca|cr))===Ga&&dr();var g=Vn;Vn|=Hp;var A=$i.transition,m=Tr();try{return $i.transition=null,ka(Er),l?l():void 0}finally{ka(m),$i.transition=A,Vn=g,(Vn&(Ca|cr))===Ga&&Ja()}}function my(){return(Vn&(Ca|cr))!==Ga}function Lp(l){var g=Vn;Vn|=Hp;var A=$i.transition,m=Tr();try{$i.transition=null,ka(Er),l()}finally{ka(m),$i.transition=A,Vn=g,Vn===Ga&&(Wl(),Ja())}}function Bd(l,g){os(Hu,ho,l),ho=Kn(ho,g)}function Zd(l){ho=Hu.current,ss(Hu,l)}function vg(l,g){l.finishedWork=null,l.finishedLanes=yt;var A=l.timeoutHandle;if(A!==Uc&&(l.timeoutHandle=Uc,kc(A)),Vi!==null)for(var m=Vi.return;m!==null;){var G=m.alternate;EB(G,m),m=m.return}Ba=l;var W=$a(l.current,null);return Vi=W,sa=ho=g,oa=_i,Qr=null,Fu=yt,md=yt,bd=yt,Ku=null,Rs=null,LG(),xo.discardPendingWarnings(),W}function by(l,g){do{var A=Vi;try{if(ff(),sB(),Oa(),dy.current=null,A===null||A.return===null){oa=Yu,Qr=g,Vi=null;return}if(w&&A.mode&Ii&&yl(A,!0),N)if(HI(),g!==null&&typeof g=="object"&&typeof g.then=="function"){var m=g;yw(A,m,sa)}else FG(A,g,sa);Ow(l,A.return,A,g,sa),Mh(A)}catch(G){g=G,Vi===A&&A!==null?(A=A.return,Vi=A):A=Vi;continue}return}while(!0)}function Vl(){var l=Iy.current;return Iy.current=lh,l===null?lh:l}function yg(l){Iy.current=l}function _p(){Wh=Da()}function Sd(l){Fu=Kn(l,Fu)}function xW(){oa===_i&&(oa=Fp)}function Rd(){(oa===_i||oa===Fp||oa===Mu)&&(oa=wh),Ba!==null&&(Qg(Fu)||Qg(md))&&Zc(Ba,sa)}function VW(l){oa!==wh&&(oa=Mu),Ku===null?Ku=[l]:Ku.push(l)}function lZ(){return oa===_i}function Uu(l,g){var A=Vn;Vn|=Ca;var m=Vl();if(Ba!==l||sa!==g){if(wi){var G=l.memoizedUpdaters;G.size>0&&(Fh(l,sa),G.clear()),Db(l,g)}vg(l,g)}pn(g);do try{gZ();break}catch(W){by(l,W)}while(!0);if(ff(),Vn=A,yg(m),Vi!==null)throw new Error("Cannot commit an incomplete root. This error is likely caused by a bug in React. Please file an issue.");return pi(),Ba=null,sa=yt,oa}function gZ(){for(;Vi!==null;)wd(Vi)}function Yh(l,g){var A=Vn;Vn|=Ca;var m=Vl();if(Ba!==l||sa!==g){if(wi){var G=l.memoizedUpdaters;G.size>0&&(Fh(l,sa),G.clear()),Db(l,g)}Wl(),vg(l,g)}pn(g);do try{Sc();break}catch(W){by(l,W)}while(!0);return ff(),yg(m),Vn=A,Vi!==null?(jn(),_i):(pi(),Ba=null,sa=yt,oa)}function Sc(){for(;Vi!==null&&!Jb();)wd(Vi)}function wd(l){var g=l.alternate;va(l);var A;(l.mode&Ii)!==Yn?(ip(l),A=Cr(g,l,ho),yl(l,!0)):A=Cr(g,l,ho),Oa(),l.memoizedProps=l.pendingProps,A===null?Mh(l):Vi=A,dy.current=null}function Mh(l){var g=l;do{var A=g.alternate,m=g.return;if((g.flags&re)===ye){va(g);var G=void 0;if((g.mode&Ii)===Yn?G=gp(A,g,ho):(ip(g),G=gp(A,g,ho),yl(g,!1)),Oa(),G!==null){Vi=G;return}}else{var W=CW(A,g);if(W!==null){W.flags&=Rr,Vi=W;return}if((g.mode&Ii)!==Yn){yl(g,!1);for(var M=g.actualDuration,T=g.child;T!==null;)M+=T.actualDuration,T=T.sibling;g.actualDuration=M}if(m!==null)m.flags|=re,m.subtreeFlags=ye,m.deletions=null;else{oa=Cy,Vi=null;return}}var U=g.sibling;if(U!==null){Vi=U;return}g=m,Vi=g}while(g!==null);oa===_i&&(oa=ur)}function Nl(l,g){var A=Tr(),m=$i.transition;try{$i.transition=null,ka(Er),cZ(l,g,A)}finally{$i.transition=m,ka(A)}return null}function cZ(l,g,A){do dr();while(xl!==null);if(Vd(),(Vn&(Ca|cr))!==Ga)throw new Error("Should not already be working.");var m=l.finishedWork,G=l.finishedLanes;if(fw(G),m===null)return NG(),null;if(G===yt&&d("root.finishedLanes should not be empty during a commit. This is a bug in React."),l.finishedWork=null,l.finishedLanes=yt,m===l.current)throw new Error("Cannot commit the same tree as before. This error is likely caused by a bug in React. Please file an issue.");l.callbackNode=null,l.callbackPriority=La;var W=Kn(m.lanes,m.childLanes);xG(l,W),l===Ba&&(Ba=null,Vi=null,sa=yt),((m.subtreeFlags&Ze)!==ye||(m.flags&Ze)!==ye)&&(Ir||(Ir=!0,wc(zt,function(){return dr(),null})));var M=(m.subtreeFlags&(ge|Ge|Se|Ze))!==ye,T=(m.flags&(ge|Ge|Se|Ze))!==ye;if(M||T){var U=$i.transition;$i.transition=null;var ie=Tr();ka(Er);var ue=Vn;Vn|=cr,dy.current=null,yp(l,m),hg(),OB(l,m,G),Wr(l.containerInfo),l.current=m,KG(G),bW(m,l,G),Gw(),cw(),Vn=ue,ka(ie),$i.transition=U}else l.current=m,hg();var Re=Ir;if(Ir&&(Ir=!1,xl=l,Vh=G),W=l.pendingLanes,W===yt&&(Tu=null),Re||IZ(l.current,!1),Cw(m.stateNode,A),wi&&l.memoizedUpdaters.clear(),nZ(),oi(l,Da()),g!==null)for(var ke=l.onRecoverableError,Qe=0;Qe<g.length;Qe++){var ht=g[Qe];ke(ht)}if(Eu){Eu=!1;var Rt=Ep;throw Ep=null,Rt}return Ms(Vh,On)&&l.tag!==Qc&&dr(),W=l.pendingLanes,Ms(W,On)?(Uw(),l===vd?zu++:(zu=0,vd=l)):zu=0,Ja(),NG(),null}function dr(){if(xl!==null){var l=If(Vh),g=lw(WC,l),A=$i.transition,m=Tr();try{return $i.transition=null,ka(g),vy()}finally{ka(m),$i.transition=A}}return!1}function Wd(l){Ay.push(l),Ir||(Ir=!0,wc(zt,function(){return dr(),null}))}function vy(){if(xl===null)return!1;var l=xl,g=Vh;if(xl=null,Vh=yt,(Vn&(Ca|cr))!==Ga)throw new Error("Cannot flush passive effects while already rendering.");Bw(g);var A=Vn;Vn|=cr,Ad(l.current),vW(l,l.current);{var m=Ay;Ay=[];for(var G=0;G<m.length;G++){var W=m[G];Gp(l,W)}}Ob(),IZ(l.current,!0),Vn=A,Ja(),Gd=xl===null?0:Gd+1,VG(l);{var M=l.current.stateNode;M.effectDuration=0,M.passiveEffectDuration=0}return!0}function yy(l){return Tu!==null&&Tu.has(l)}function Gy(l){Tu===null?Tu=new Set([l]):Tu.add(l)}function NW(l){Eu||(Eu=!0,Ep=l)}var uZ=NW;function By(l,g,A){var m=yu(A,g),G=mB(l,m,On);du(l,G);var W=ws(),M=Tp(l,On);M!==null&&(wC(M,On,W),oi(M,W))}function Aa(l,g,A){if(l.tag===P){By(l,l,A);return}var m=null;for(m=g;m!==null;){if(m.tag===P){By(m,l,A);return}else if(m.tag===F){var G=m.type,W=m.stateNode;if(typeof G.getDerivedStateFromError=="function"||typeof W.componentDidCatch=="function"&&!yy(W)){var M=yu(A,l),T=od(m,M,On);du(m,T);var U=ws(),ie=Tp(m,On);ie!==null&&(wC(ie,On,U),oi(ie,U));return}}m=m.return}d(`Internal React error: Attempted to capture a commit phase error inside a detached tree. This indicates a bug in React. Likely causes include deleting the same fiber more than once, committing an already-finished tree, or an inconsistent return pointer.

Error message:

%s`,A)}function jr(l,g,A){var m=l.pingCache;m!==null&&m.delete(g);var G=ws();_b(l,A),bi(l),Ba===l&&Wo(sa,A)&&(oa===wh||oa===Fp&&eg(sa)&&Da()-Wh<Kp?vg(l,yt):bd=Kn(bd,A)),oi(l,G)}function kp(l,g){g===La&&(g=py(l));var A=ws(),m=Tp(l,g);m!==null&&(wC(m,g,A),oi(m,A))}function xd(l){var g=l.memoizedState,A=La;g!==null&&(A=g.retryLane),kp(l,A)}function Zy(l,g){var A=La,m;switch(l.tag){case ve:m=l.stateNode;var G=l.memoizedState;G!==null&&(A=G.retryLane);break;case Ee:m=l.stateNode;break;default:throw new Error("Pinged unknown suspense boundary type. This is probably a bug in React.")}m!==null&&m.delete(g),kp(l,A)}function XW(l){return l<120?120:l<480?480:l<1080?1080:l<1920?1920:l<3e3?3e3:l<4320?4320:ZW(l/1960)*1960}function Rc(){if(zu>fy)throw zu=0,vd=null,new Error("Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.");Gd>yd&&(Gd=0,d("Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render."))}function Vd(){xo.flushLegacyContextWarning(),xo.flushPendingUnsafeLifecycleWarnings()}function IZ(l,g){va(l),Du(l,xt,xu),g&&Du(l,D,qB),Du(l,xt,yW),g&&Du(l,D,GW),Oa()}function Du(l,g,A){for(var m=l,G=null;m!==null;){var W=m.subtreeFlags&g;m!==G&&m.child!==null&&W!==ye?m=m.child:((m.flags&g)!==ye&&A(m),m.sibling!==null?m=m.sibling:m=G=m.return)}}var us=null;function Za(l){{if((Vn&Ca)!==Ga||!(l.mode&Ri))return;var g=l.tag;if(g!==_&&g!==P&&g!==F&&g!==H&&g!==he&&g!==we&&g!==me)return;var A=q(l)||"ReactComponent";if(us!==null){if(us.has(A))return;us.add(A)}else us=new Set([A]);var m=ao;try{va(l),d("Can't perform a React state update on a component that hasn't mounted yet. This indicates that you have a side-effect in your render function that asynchronously later calls tries to update the component. Move this work to useEffect instead.")}finally{m?va(l):Oa()}}}var Cr;{var Ya=null;Cr=function(l,g,A){var m=xy(Ya,g);try{return KB(l,g,A)}catch(W){if(W!==null&&typeof W=="object"&&typeof W.then=="function")throw W;if(ff(),sB(),EB(l,g),xy(g,m),g.mode&Ii&&ip(g),zB(null,KB,null,l,g,A),fW()){var G=LB();typeof G=="object"&&G!==null&&G._suppressLogging&&typeof W=="object"&&W!==null&&!W._suppressLogging&&(W._suppressLogging=!0)}throw W}}}var Qa=!1,Hh;Hh=new Set;function Sy(l){if(au&&!cB())switch(l.tag){case H:case he:case me:{var g=Vi&&q(Vi)||"Unknown",A=g;if(!Hh.has(A)){Hh.add(A);var m=q(l)||"Unknown";d("Cannot update a component (`%s`) while rendering a different component (`%s`). To locate the bad setState() call inside `%s`, follow the stack trace as described in https://reactjs.org/link/setstate-in-render",m,g,g)}break}case F:{Qa||(d("Cannot update during an existing state transition (such as within `render`). Render methods should be a pure function of props and state."),Qa=!0);break}}}function Fh(l,g){if(wi){var A=l.memoizedUpdaters;A.forEach(function(m){Ub(l,m,g)})}}var Dt={};function wc(l,g){{var A=Co.current;return A!==null?(A.push(g),Dt):jg(l,g)}}function Up(l){if(l!==Dt)return gw(l)}function Ju(){return Co.current!==null}function Ou(l){{if(l.mode&Ri){if(!iZ())return}else if(!uy()||Vn!==Ga||l.tag!==H&&l.tag!==he&&l.tag!==me)return;if(Co.current===null){var g=ao;try{va(l),d(`An update to %s inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act`,q(l))}finally{g?va(l):Oa()}}}}function bi(l){l.tag!==Qc&&iZ()&&Co.current===null&&d(`A suspended resource finished loading inside a test, but the event was not wrapped in act(...).

When testing, code that resolves suspended data should be wrapped into act(...):

act(() => {
  /* finish loading suspended data */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act`)}var vi=null,ea=null,Dp=function(l){vi=l};function Xl(l){{if(vi===null)return l;var g=vi(l);return g===void 0?l:g.current}}function Pu(l){return Xl(l)}function Ry(l){{if(vi===null)return l;var g=vi(l);if(g===void 0){if(l!=null&&typeof l.render=="function"){var A=Xl(l.render);if(l.render!==A){var m={$$typeof:Et,render:A};return l.displayName!==void 0&&(m.displayName=l.displayName),m}}return l}return g.current}}function dZ(l,g){{if(vi===null)return!1;var A=l.elementType,m=g.type,G=!1,W=typeof m=="object"&&m!==null?m.$$typeof:null;switch(l.tag){case F:{typeof m=="function"&&(G=!0);break}case H:{(typeof m=="function"||W===Ae)&&(G=!0);break}case he:{(W===Et||W===Ae)&&(G=!0);break}case we:case me:{(W===k||W===Ae)&&(G=!0);break}default:return!1}if(G){var M=vi(A);if(M!==void 0&&M===vi(m))return!0}return!1}}function nt(l){{if(vi===null||typeof WeakSet!="function")return;ea===null&&(ea=new WeakSet),ea.add(l)}}var hr=function(l,g){{if(vi===null)return;var A=g.staleFamilies,m=g.updatedFamilies;dr(),ku(function(){Kh(l.current,m,A)})}},Wc=function(l,g){{if(l.context!==Ro)return;dr(),ku(function(){Uh(g,l,null,null)})}};function Kh(l,g,A){{var m=l.alternate,G=l.child,W=l.sibling,M=l.tag,T=l.type,U=null;switch(M){case H:case me:case F:U=T;break;case he:U=T.render;break}if(vi===null)throw new Error("Expected resolveFamily to be set during hot reload.");var ie=!1,ue=!1;if(U!==null){var Re=vi(U);Re!==void 0&&(A.has(Re)?ue=!0:g.has(Re)&&(M===F?ue=!0:ie=!0))}ea!==null&&(ea.has(l)||m!==null&&ea.has(m))&&(ue=!0),ue&&(l._debugNeedsRemount=!0),(ue||ie)&&ha(l,On,Fi),G!==null&&!ue&&Kh(G,g,A),W!==null&&Kh(W,g,A)}}var di=function(l,g){{var A=new Set,m=new Set(g.map(function(G){return G.current}));return Kt(l.current,m,A),A}};function Kt(l,g,A){{var m=l.child,G=l.sibling,W=l.tag,M=l.type,T=null;switch(W){case H:case me:case F:T=M;break;case he:T=M.render;break}var U=!1;T!==null&&g.has(T)&&(U=!0),U?Nd(l,A):m!==null&&Kt(m,g,A),G!==null&&Kt(G,g,A)}}function Nd(l,g){{var A=YW(l,g);if(A)return;for(var m=l;;){switch(m.tag){case E:g.add(m.stateNode);return;case K:g.add(m.stateNode.containerInfo);return;case P:g.add(m.stateNode.containerInfo);return}if(m.return===null)throw new Error("Expected to reach root first.");m=m.return}}}function YW(l,g){for(var A=l,m=!1;;){if(A.tag===E)m=!0,g.add(A.stateNode);else if(A.child!==null){A.child.return=A,A=A.child;continue}if(A===l)return m;for(;A.sibling===null;){if(A.return===null||A.return===l)return m;A=A.return}A.sibling.return=A.return,A=A.sibling}return!1}var ja;{ja=!1;try{var Jp=Object.preventExtensions({})}catch{ja=!0}}function Xd(l,g,A,m){this.tag=l,this.key=A,this.elementType=null,this.type=null,this.stateNode=null,this.return=null,this.child=null,this.sibling=null,this.index=0,this.ref=null,this.pendingProps=g,this.memoizedProps=null,this.updateQueue=null,this.memoizedState=null,this.dependencies=null,this.mode=m,this.flags=ye,this.subtreeFlags=ye,this.deletions=null,this.lanes=yt,this.childLanes=yt,this.alternate=null,this.actualDuration=Number.NaN,this.actualStartTime=Number.NaN,this.selfBaseDuration=Number.NaN,this.treeBaseDuration=Number.NaN,this.actualDuration=0,this.actualStartTime=-1,this.selfBaseDuration=0,this.treeBaseDuration=0,this._debugSource=null,this._debugOwner=null,this._debugNeedsRemount=!1,this._debugHookTypes=null,!ja&&typeof Object.preventExtensions=="function"&&Object.preventExtensions(this)}var qa=function(l,g,A,m){return new Xd(l,g,A,m)};function Op(l){var g=l.prototype;return!!(g&&g.isReactComponent)}function CZ(l){return typeof l=="function"&&!Op(l)&&l.defaultProps===void 0}function Yl(l){if(typeof l=="function")return Op(l)?F:H;if(l!=null){var g=l.$$typeof;if(g===Et)return he;if(g===k)return we}return _}function $a(l,g){var A=l.alternate;A===null?(A=qa(l.tag,g,l.key,l.mode),A.elementType=l.elementType,A.type=l.type,A.stateNode=l.stateNode,A._debugSource=l._debugSource,A._debugOwner=l._debugOwner,A._debugHookTypes=l._debugHookTypes,A.alternate=l,l.alternate=A):(A.pendingProps=g,A.type=l.type,A.flags=ye,A.subtreeFlags=ye,A.deletions=null,A.actualDuration=0,A.actualStartTime=-1),A.flags=l.flags&bt,A.childLanes=l.childLanes,A.lanes=l.lanes,A.child=l.child,A.memoizedProps=l.memoizedProps,A.memoizedState=l.memoizedState,A.updateQueue=l.updateQueue;var m=l.dependencies;switch(A.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},A.sibling=l.sibling,A.index=l.index,A.ref=l.ref,A.selfBaseDuration=l.selfBaseDuration,A.treeBaseDuration=l.treeBaseDuration,A._debugNeedsRemount=l._debugNeedsRemount,A.tag){case _:case H:case me:A.type=Xl(l.type);break;case F:A.type=Pu(l.type);break;case he:A.type=Ry(l.type);break}return A}function hZ(l,g){l.flags&=bt|De;var A=l.alternate;if(A===null)l.childLanes=yt,l.lanes=g,l.child=null,l.subtreeFlags=ye,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null,l.selfBaseDuration=0,l.treeBaseDuration=0;else{l.childLanes=A.childLanes,l.lanes=A.lanes,l.child=A.child,l.subtreeFlags=ye,l.deletions=null,l.memoizedProps=A.memoizedProps,l.memoizedState=A.memoizedState,l.updateQueue=A.updateQueue,l.type=A.type;var m=A.dependencies;l.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},l.selfBaseDuration=A.selfBaseDuration,l.treeBaseDuration=A.treeBaseDuration}return l}function wy(l,g,A){var m;return l===SG?(m=Ri,g===!0&&(m|=ba,m|=Mr)):m=Yn,wi&&(m|=Ii),qa(P,null,null,m)}function Eh(l,g,A,m,G,W){var M=_,T=l;if(typeof l=="function")Op(l)?(M=F,T=Pu(T)):T=Xl(T);else if(typeof l=="string")M=E;else e:switch(l){case oe:return Ml(A.children,G,W,g);case ut:M=be,G|=ba,(G&Ri)!==Yn&&(G|=Mr);break;case _e:return D2(A,G,W,g);case Wt:return J2(A,G,W,g);case O:return Wy(A,G,W,g);case et:return zh(A,G,W,g);case Yt:case Oe:case vt:case Vt:case $e:default:{if(typeof l=="object"&&l!==null)switch(l.$$typeof){case it:M=Ce;break e;case Te:M=se;break e;case Et:M=he,T=Ry(T);break e;case k:M=we;break e;case Ae:M=Xe,T=null;break e}var U="";{(l===void 0||typeof l=="object"&&l!==null&&Object.keys(l).length===0)&&(U+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var ie=m?q(m):null;ie&&(U+=`

Check the render method of \``+ie+"`.")}throw new Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) "+("but got: "+(l==null?l:typeof l)+"."+U))}}var ue=qa(M,A,g,G);return ue.elementType=l,ue.type=T,ue.lanes=W,ue._debugOwner=m,ue}function Th(l,g,A){var m=null;m=l._owner;var G=l.type,W=l.key,M=l.props,T=Eh(G,W,M,m,g,A);return T._debugSource=l._source,T._debugOwner=l._owner,T}function Ml(l,g,A,m){var G=qa(Ie,l,m,g);return G.lanes=A,G}function D2(l,g,A,m){typeof l.id!="string"&&d('Profiler must specify an "id" of type `string` as a prop. Received the type `%s` instead.',typeof l.id);var G=qa(Be,l,m,g|Ii);return G.elementType=_e,G.lanes=A,G.stateNode={effectDuration:0,passiveEffectDuration:0},G}function J2(l,g,A,m){var G=qa(ve,l,m,g);return G.elementType=Wt,G.lanes=A,G}function Wy(l,g,A,m){var G=qa(Ee,l,m,g);return G.elementType=O,G.lanes=A,G}function zh(l,g,A,m){var G=qa(Zt,l,m,g);G.elementType=et,G.lanes=A;var W={};return G.stateNode=W,G}function Pp(l,g,A){var m=qa(ee,l,null,g);return m.lanes=A,m}function AZ(){var l=qa(E,null,null,Yn);return l.elementType="DELETED",l}function fZ(l){var g=qa(de,null,null,Yn);return g.stateNode=l,g}function Qp(l,g,A){var m=l.children!==null?l.children:[],G=qa(K,m,l.key,g);return G.lanes=A,G.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},G}function xy(l,g){return l===null&&(l=qa(_,null,null,Yn)),l.tag=g.tag,l.key=g.key,l.elementType=g.elementType,l.type=g.type,l.stateNode=g.stateNode,l.return=g.return,l.child=g.child,l.sibling=g.sibling,l.index=g.index,l.ref=g.ref,l.pendingProps=g.pendingProps,l.memoizedProps=g.memoizedProps,l.updateQueue=g.updateQueue,l.memoizedState=g.memoizedState,l.dependencies=g.dependencies,l.mode=g.mode,l.flags=g.flags,l.subtreeFlags=g.subtreeFlags,l.deletions=g.deletions,l.lanes=g.lanes,l.childLanes=g.childLanes,l.alternate=g.alternate,l.actualDuration=g.actualDuration,l.actualStartTime=g.actualStartTime,l.selfBaseDuration=g.selfBaseDuration,l.treeBaseDuration=g.treeBaseDuration,l._debugSource=g._debugSource,l._debugOwner=g._debugOwner,l._debugNeedsRemount=g._debugNeedsRemount,l._debugHookTypes=g._debugHookTypes,l}function jp(l,g,A,m,G){this.tag=g,this.containerInfo=l,this.pendingChildren=null,this.current=null,this.pingCache=null,this.finishedWork=null,this.timeoutHandle=Uc,this.context=null,this.pendingContext=null,this.callbackNode=null,this.callbackPriority=La,this.eventTimes=Kr(yt),this.expirationTimes=Kr(Fi),this.pendingLanes=yt,this.suspendedLanes=yt,this.pingedLanes=yt,this.expiredLanes=yt,this.mutableReadLanes=yt,this.finishedLanes=yt,this.entangledLanes=yt,this.entanglements=Kr(yt),this.identifierPrefix=m,this.onRecoverableError=G,Mn&&(this.mutableSourceEagerHydrationData=null),this.effectDuration=0,this.passiveEffectDuration=0;{this.memoizedUpdaters=new Set;for(var W=this.pendingUpdatersLaneMap=[],M=0;M<Hb;M++)W.push(new Set)}switch(g){case SG:this._debugRootType=A?"hydrateRoot()":"createRoot()";break;case Qc:this._debugRootType=A?"hydrate()":"render()";break}}function qp(l,g,A,m,G,W,M,T,U,ie){var ue=new jp(l,g,A,T,U),Re=wy(g,W);ue.current=Re,Re.stateNode=ue;{var ke={element:m,isDehydrated:A,cache:null,transitions:null};Re.memoizedState=ke}return Fn(Re),ue}var Vy="18.0.0-fc46dba67-20220329";function Lh(l,g,A){var m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return cu(m),{$$typeof:Ot,key:m==null?null:""+m,children:l,containerInfo:g,implementation:A}}var _h,Yd;_h=!1,Yd={};function Md(l){if(!l)return Ro;var g=v(l),A=Xs(g);if(g.tag===F){var m=g.type;if(gl(m))return Yb(g,m,A)}return A}function $p(l){var g=v(l);if(g===void 0){if(typeof l.render=="function")throw new Error("Unable to find node on an unmounted component.");var A=Object.keys(l).join(",");throw new Error("Argument appears to not be a ReactComponent. Keys: "+A)}var m=Si(g);return m===null?null:m.stateNode}function em(l,g){{var A=v(l);if(A===void 0){if(typeof l.render=="function")throw new Error("Unable to find node on an unmounted component.");var m=Object.keys(l).join(",");throw new Error("Argument appears to not be a ReactComponent. Keys: "+m)}var G=Si(A);if(G===null)return null;if(G.mode&ba){var W=q(A)||"Component";if(!Yd[W]){Yd[W]=!0;var M=ao;try{va(G),A.mode&ba?d("%s is deprecated in StrictMode. %s was passed an instance of %s which is inside StrictMode. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",g,g,W):d("%s is deprecated in StrictMode. %s was passed an instance of %s which renders StrictMode children. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",g,g,W)}finally{M?va(M):Oa()}}}return G.stateNode}}function kh(l,g,A,m,G,W,M,T){var U=!1,ie=null;return qp(l,g,U,ie,A,m,G,W,M)}function Ny(l,g,A,m,G,W,M,T,U,ie){var ue=!0,Re=qp(A,m,ue,l,G,W,M,T,U);Re.context=Md(null);var ke=Re.current,Qe=ws(),ht=bg(ke),Rt=fl(Qe,ht);return Rt.callback=g??null,du(ke,Rt),RW(Re,ht,Qe),Re}function Uh(l,g,A,m){dw(g,l);var G=g.current,W=ws(),M=bg(G);ca(M);var T=Md(A);g.context===null?g.context=T:g.pendingContext=T,au&&ao!==null&&!_h&&(_h=!0,d(`Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate.

Check the render method of %s.`,q(ao)||"Unknown"));var U=fl(W,M);U.payload={element:l},m=m===void 0?null:m,m!==null&&(typeof m!="function"&&d("render(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",m),U.callback=m),du(G,U);var ie=ha(G,M,W);return ie!==null&&mf(ie,G,M),M}function Xy(l){var g=l.current;if(!g.child)return null;switch(g.child.tag){case E:return wr(g.child.stateNode);default:return g.child.stateNode}}function tm(l){switch(l.tag){case P:var g=l.stateNode;if(qg(g)){var A=ai(g);WW(g,A)}break;case ve:var m=ws();ku(function(){return ha(l,On,m)});var G=On;Dh(l,G);break}}function Yy(l,g){var A=l.memoizedState;A!==null&&A.dehydrated!==null&&(A.retryLane=NI(A.retryLane,g))}function Dh(l,g){Yy(l,g);var A=l.alternate;A&&Yy(A,g)}function nm(l){if(l.tag===ve){var g=ws(),A=ZC;ha(l,A,g),Dh(l,A)}}function MW(l){if(l.tag===ve){var g=ws(),A=bg(l);ha(l,A,g),Dh(l,A)}}function im(l){var g=Ji(l);return g===null?null:g.stateNode}var am=function(l){return null};function Jh(l){return am(l)}var sm=function(l){return!1};function Oh(l){return sm(l)}var om=null,My=null,Hy=null,Fy=null,pZ=null,rm=null,Ky=null,Ey=null,Ty=null;{var mZ=function(l,g,A){var m=g[A],G=dn(l)?l.slice():b({},l);return A+1===g.length?(dn(G)?G.splice(m,1):delete G[m],G):(G[m]=mZ(l[m],g,A+1),G)},lm=function(l,g){return mZ(l,g,0)},Ph=function(l,g,A,m){var G=g[m],W=dn(l)?l.slice():b({},l);if(m+1===g.length){var M=A[m];W[M]=W[G],dn(W)?W.splice(G,1):delete W[G]}else W[G]=Ph(l[G],g,A,m+1);return W},bZ=function(l,g,A){if(g.length!==A.length){C("copyWithRename() expects paths of the same length");return}else for(var m=0;m<A.length-1;m++)if(g[m]!==A[m]){C("copyWithRename() expects paths to be the same except for the deepest key");return}return Ph(l,g,A,0)},vZ=function(l,g,A,m){if(A>=g.length)return m;var G=g[A],W=dn(l)?l.slice():b({},l);return W[G]=vZ(l[G],g,A+1,m),W},zy=function(l,g,A){return vZ(l,g,0,A)},gm=function(l,g){for(var A=l.memoizedState;A!==null&&g>0;)A=A.next,g--;return A};om=function(l,g,A,m){var G=gm(l,g);if(G!==null){var W=zy(G.memoizedState,A,m);G.memoizedState=W,G.baseState=W,l.memoizedProps=b({},l.memoizedProps),ha(l,On,Fi)}},My=function(l,g,A){var m=gm(l,g);if(m!==null){var G=lm(m.memoizedState,A);m.memoizedState=G,m.baseState=G,l.memoizedProps=b({},l.memoizedProps),ha(l,On,Fi)}},Hy=function(l,g,A,m){var G=gm(l,g);if(G!==null){var W=bZ(G.memoizedState,A,m);G.memoizedState=W,G.baseState=W,l.memoizedProps=b({},l.memoizedProps),ha(l,On,Fi)}},Fy=function(l,g,A){l.pendingProps=zy(l.memoizedProps,g,A),l.alternate&&(l.alternate.pendingProps=l.pendingProps),ha(l,On,Fi)},pZ=function(l,g){l.pendingProps=lm(l.memoizedProps,g),l.alternate&&(l.alternate.pendingProps=l.pendingProps),ha(l,On,Fi)},rm=function(l,g,A){l.pendingProps=bZ(l.memoizedProps,g,A),l.alternate&&(l.alternate.pendingProps=l.pendingProps),ha(l,On,Fi)},Ky=function(l){ha(l,On,Fi)},Ey=function(l){am=l},Ty=function(l){sm=l}}function yZ(l){var g=Si(l);return g===null?null:g.stateNode}function GZ(l){return null}function cm(){return ao}function BZ(l){var g=l.findFiberByHostInstance,A=o.ReactCurrentDispatcher;return Iw({bundleType:l.bundleType,version:l.version,rendererPackageName:l.rendererPackageName,rendererConfig:l.rendererConfig,overrideHookState:om,overrideHookStateDeletePath:My,overrideHookStateRenamePath:Hy,overrideProps:Fy,overridePropsDeletePath:pZ,overridePropsRenamePath:rm,setErrorHandler:Ey,setSuspenseHandler:Ty,scheduleUpdate:Ky,currentDispatcherRef:A,findHostInstanceByFiber:yZ,findFiberByHostInstance:g||GZ,findHostInstancesForRefresh:di,scheduleRefresh:hr,scheduleRoot:Wc,setRefreshHandler:Dp,getCurrentFiber:cm,reconcilerVersion:Vy})}return t.attemptContinuousHydration=nm,t.attemptHydrationAtCurrentPriority=MW,t.attemptSynchronousHydration=tm,t.batchedUpdates=oZ,t.createComponentSelector=Nu,t.createContainer=kh,t.createHasPseudoClassSelector=cs,t.createHydrationContainer=Ny,t.createPortal=Lh,t.createRoleSelector=gr,t.createTestNameSelector=Xu,t.createTextSelector=Pr,t.deferredUpdates=zp,t.discreteUpdates=rZ,t.findAllNodes=Mp,t.findBoundingRects=tZ,t.findHostInstance=$p,t.findHostInstanceWithNoPortals=im,t.findHostInstanceWithWarning=em,t.flushControlled=Lp,t.flushPassiveEffects=dr,t.flushSync=ku,t.focusWithin=ly,t.getCurrentUpdatePriority=Tr,t.getFindAllNodesFailureDescription=eZ,t.getPublicRootInstance=Xy,t.injectIntoDevTools=BZ,t.isAlreadyRendering=my,t.observeVisibleRects=gy,t.registerMutableSourceForHydration=zw,t.runWithPriority=rw,t.shouldError=Jh,t.shouldSuspend=Oh,t.updateContainer=Uh,t};var XJ=BE.exports;GE.exports=XJ;var YJ=GE.exports;const MJ=UN(YJ),Y2={},HJ=r=>void Object.assign(Y2,r);function FJ(r,e){function t(f,{args:b=[],attach:v,...y},Z){let V=`${f[0].toUpperCase()}${f.slice(1)}`,R;if(f==="primitive"){if(y.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const S=y.object;R=km(S,{type:f,root:Z,attach:v,primitive:!0})}else{const S=Y2[V];if(!S)throw new Error(`R3F: ${V} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(b))throw new Error("R3F: The args prop must be an array!");R=km(new S(...b),{type:f,root:Z,attach:v,memoizedProps:{args:b}})}return R.__r3f.attach===void 0&&(R.isBufferGeometry?R.__r3f.attach="geometry":R.isMaterial&&(R.__r3f.attach="material")),V!=="inject"&&RV(R,y),R}function n(f,b){let v=!1;if(b){var y,Z;(y=b.__r3f)!=null&&y.attach?SV(f,b,b.__r3f.attach):b.isObject3D&&f.isObject3D&&(f.add(b),v=!0),v||(Z=f.__r3f)==null||Z.objects.push(b),b.__r3f||km(b,{}),b.__r3f.parent=f,MN(b),Um(b)}}function a(f,b,v){let y=!1;if(b){var Z,V;if((Z=b.__r3f)!=null&&Z.attach)SV(f,b,b.__r3f.attach);else if(b.isObject3D&&f.isObject3D){b.parent=f,b.dispatchEvent({type:"added"}),f.dispatchEvent({type:"childadded",child:b});const R=f.children.filter(N=>N!==b),S=R.indexOf(v);f.children=[...R.slice(0,S),b,...R.slice(S)],y=!0}y||(V=f.__r3f)==null||V.objects.push(b),b.__r3f||km(b,{}),b.__r3f.parent=f,MN(b),Um(b)}}function o(f,b,v=!1){f&&[...f].forEach(y=>c(b,y,v))}function c(f,b,v){if(b){var y,Z,V;if(b.__r3f&&(b.__r3f.parent=null),(y=f.__r3f)!=null&&y.objects&&(f.__r3f.objects=f.__r3f.objects.filter(X=>X!==b)),(Z=b.__r3f)!=null&&Z.attach)bH(f,b,b.__r3f.attach);else if(b.isObject3D&&f.isObject3D){var R;f.remove(b),(R=b.__r3f)!=null&&R.root&&UJ(oR(b),b)}const N=(V=b.__r3f)==null?void 0:V.primitive,w=!N&&(v===void 0?b.dispose!==null:v);if(!N){var S;o((S=b.__r3f)==null?void 0:S.objects,b,w),o(b.children,b,w)}if(delete b.__r3f,w&&b.dispose&&b.type!=="Scene"){const X=()=>{try{b.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?XN.unstable_scheduleCallback(XN.unstable_IdlePriority,X):X()}Um(f)}}function I(f,b,v,y){var Z;const V=(Z=f.__r3f)==null?void 0:Z.parent;if(!V)return;const R=t(b,v,f.__r3f.root);if(f.children){for(const S of f.children)S.__r3f&&n(R,S);f.children=f.children.filter(S=>!S.__r3f)}f.__r3f.objects.forEach(S=>n(R,S)),f.__r3f.objects=[],f.__r3f.autoRemovedBeforeAppend||c(V,f),R.parent&&(R.__r3f.autoRemovedBeforeAppend=!0),n(V,R),R.raycast&&R.__r3f.eventCount&&oR(R).getState().internal.interaction.push(R),[y,y.alternate].forEach(S=>{S!==null&&(S.stateNode=R,S.ref&&(typeof S.ref=="function"?S.ref(R):S.ref.current=R))})}const C=()=>{};return{reconciler:MJ({createInstance:t,removeChild:c,appendChild:n,appendInitialChild:n,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(f,b)=>{if(!b)return;const v=f.getState().scene;v.__r3f&&(v.__r3f.root=f,n(v,b))},removeChildFromContainer:(f,b)=>{b&&c(f.getState().scene,b)},insertInContainerBefore:(f,b,v)=>{if(!b||!v)return;const y=f.getState().scene;y.__r3f&&a(y,b,v)},getRootHostContext:()=>null,getChildHostContext:f=>f,finalizeInitialChildren(f){var b;return!!((b=f==null?void 0:f.__r3f)!=null?b:{}).handlers},prepareUpdate(f,b,v,y){var Z;if(((Z=f==null?void 0:f.__r3f)!=null?Z:{}).primitive&&y.object&&y.object!==f)return[!0];{const{args:R=[],children:S,...N}=y,{args:w=[],children:X,...H}=v;if(!Array.isArray(R))throw new Error("R3F: the args prop must be an array!");if(R.some((_,P)=>_!==w[P]))return[!0];const F=XE(f,N,H,!0);return F.changes.length?[!1,F]:null}},commitUpdate(f,[b,v],y,Z,V,R){b?I(f,y,V,R):RV(f,v)},commitMount(f,b,v,y){var Z;const V=(Z=f.__r3f)!=null?Z:{};f.raycast&&V.handlers&&V.eventCount&&oR(f).getState().internal.interaction.push(f)},getPublicInstance:f=>f,prepareForCommit:()=>null,preparePortalMount:f=>km(f.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(f){var b;const{attach:v,parent:y}=(b=f.__r3f)!=null?b:{};v&&y&&bH(y,f,v),f.isObject3D&&(f.visible=!1),Um(f)},unhideInstance(f,b){var v;const{attach:y,parent:Z}=(v=f.__r3f)!=null?v:{};y&&Z&&SV(Z,f,y),(f.isObject3D&&b.visible==null||b.visible)&&(f.visible=!0),Um(f)},createTextInstance:C,hideTextInstance:C,unhideTextInstance:C,getCurrentEventPriority:()=>e?e():jm.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&la.fun(performance.now)?performance.now:la.fun(Date.now)?Date.now:()=>0,scheduleTimeout:la.fun(setTimeout)?setTimeout:void 0,cancelTimeout:la.fun(clearTimeout)?clearTimeout:void 0}),applyProps:RV}}var AH,fH;const ZV=r=>"colorSpace"in r||"outputColorSpace"in r,RE=()=>{var r;return(r=Y2.ColorManagement)!=null?r:null},wE=r=>r&&r.isOrthographicCamera,KJ=r=>r&&r.hasOwnProperty("current"),uG=typeof window<"u"&&((AH=window.document)!=null&&AH.createElement||((fH=window.navigator)==null?void 0:fH.product)==="ReactNative")?rt.useLayoutEffect:rt.useEffect;function WE(r){const e=rt.useRef(r);return uG(()=>void(e.current=r),[r]),e}function EJ({set:r}){return uG(()=>(r(new Promise(()=>null)),()=>r(!1)),[r]),null}class xE extends rt.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}xE.getDerivedStateFromError=()=>({error:!0});const VE="__default",pH=new Map,TJ=r=>r&&!!r.memoized&&!!r.changes;function NE(r){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(r)?Math.min(Math.max(r[0],t),r[1]):r}const b0=r=>{var e;return(e=r.__r3f)==null?void 0:e.root.getState()};function oR(r){let e=r.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const la={obj:r=>r===Object(r)&&!la.arr(r)&&typeof r!="function",fun:r=>typeof r=="function",str:r=>typeof r=="string",num:r=>typeof r=="number",boo:r=>typeof r=="boolean",und:r=>r===void 0,arr:r=>Array.isArray(r),equ(r,e,{arrays:t="shallow",objects:n="reference",strict:a=!0}={}){if(typeof r!=typeof e||!!r!=!!e)return!1;if(la.str(r)||la.num(r)||la.boo(r))return r===e;const o=la.obj(r);if(o&&n==="reference")return r===e;const c=la.arr(r);if(c&&t==="reference")return r===e;if((c||o)&&r===e)return!0;let I;for(I in r)if(!(I in e))return!1;if(o&&t==="shallow"&&n==="shallow"){for(I in a?e:r)if(!la.equ(r[I],e[I],{strict:a,objects:"reference"}))return!1}else for(I in a?e:r)if(r[I]!==e[I])return!1;if(la.und(I)){if(c&&r.length===0&&e.length===0||o&&Object.keys(r).length===0&&Object.keys(e).length===0)return!0;if(r!==e)return!1}return!0}};function zJ(r){r.dispose&&r.type!=="Scene"&&r.dispose();for(const e in r)e.dispose==null||e.dispose(),delete r[e]}function km(r,e){const t=r;return t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},r}function YN(r,e){let t=r;if(e.includes("-")){const n=e.split("-"),a=n.pop();return t=n.reduce((o,c)=>o[c],r),{target:t,key:a}}else return{target:t,key:e}}const mH=/-\d+$/;function SV(r,e,t){if(la.str(t)){if(mH.test(t)){const o=t.replace(mH,""),{target:c,key:I}=YN(r,o);Array.isArray(c[I])||(c[I]=[])}const{target:n,key:a}=YN(r,t);e.__r3f.previousAttach=n[a],n[a]=e}else e.__r3f.previousAttach=t(r,e)}function bH(r,e,t){var n,a;if(la.str(t)){const{target:o,key:c}=YN(r,t),I=e.__r3f.previousAttach;I===void 0?delete o[c]:o[c]=I}else(n=e.__r3f)==null||n.previousAttach==null||n.previousAttach(r,e);(a=e.__r3f)==null||delete a.previousAttach}function XE(r,{children:e,key:t,ref:n,...a},{children:o,key:c,ref:I,...C}={},d=!1){const f=r.__r3f,b=Object.entries(a),v=[];if(d){const Z=Object.keys(C);for(let V=0;V<Z.length;V++)a.hasOwnProperty(Z[V])||b.unshift([Z[V],VE+"remove"])}b.forEach(([Z,V])=>{var R;if((R=r.__r3f)!=null&&R.primitive&&Z==="object"||la.equ(V,C[Z]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(Z))return v.push([Z,V,!0,[]]);let S=[];Z.includes("-")&&(S=Z.split("-")),v.push([Z,V,!1,S]);for(const N in a){const w=a[N];N.startsWith(`${Z}-`)&&v.push([N,w,!1,N.split("-")])}});const y={...a};return f!=null&&f.memoizedProps&&f!=null&&f.memoizedProps.args&&(y.args=f.memoizedProps.args),f!=null&&f.memoizedProps&&f!=null&&f.memoizedProps.attach&&(y.attach=f.memoizedProps.attach),{memoized:y,changes:v}}const LJ=typeof process<"u"&&!0;function RV(r,e){var t;const n=r.__r3f,a=n==null?void 0:n.root,o=a==null||a.getState==null?void 0:a.getState(),{memoized:c,changes:I}=TJ(e)?e:XE(r,e),C=n==null?void 0:n.eventCount;r.__r3f&&(r.__r3f.memoizedProps=c);for(let v=0;v<I.length;v++){let[y,Z,V,R]=I[v];if(ZV(r)){const X="srgb",H="srgb-linear";y==="encoding"?(y="colorSpace",Z=Z===3001?X:H):y==="outputEncoding"&&(y="outputColorSpace",Z=Z===3001?X:H)}let S=r,N=S[y];if(R.length&&(N=R.reduce((w,X)=>w[X],r),!(N&&N.set))){const[w,...X]=R.reverse();S=X.reverse().reduce((H,F)=>H[F],r),y=w}if(Z===VE+"remove")if(S.constructor){let w=pH.get(S.constructor);w||(w=new S.constructor,pH.set(S.constructor,w)),Z=w[y]}else Z=0;if(V&&n)Z?n.handlers[y]=Z:delete n.handlers[y],n.eventCount=Object.keys(n.handlers).length;else if(N&&N.set&&(N.copy||N instanceof RA)){if(Array.isArray(Z))N.fromArray?N.fromArray(Z):N.set(...Z);else if(N.copy&&Z&&Z.constructor&&(LJ?N.constructor.name===Z.constructor.name:N.constructor===Z.constructor))N.copy(Z);else if(Z!==void 0){var d;const w=(d=N)==null?void 0:d.isColor;!w&&N.setScalar?N.setScalar(Z):N instanceof RA&&Z instanceof RA?N.mask=Z.mask:N.set(Z),!RE()&&o&&!o.linear&&w&&N.convertSRGBToLinear()}}else{var f;if(S[y]=Z,(f=S[y])!=null&&f.isTexture&&S[y].format===Uo&&S[y].type===Kc&&o){const w=S[y];ZV(w)&&ZV(o.gl)?w.colorSpace=o.gl.outputColorSpace:w.encoding=o.gl.outputEncoding}}Um(r)}if(n&&n.parent&&r.raycast&&C!==n.eventCount){const v=oR(r).getState().internal,y=v.interaction.indexOf(r);y>-1&&v.interaction.splice(y,1),n.eventCount&&v.interaction.push(r)}return!(I.length===1&&I[0][0]==="onUpdate")&&I.length&&(t=r.__r3f)!=null&&t.parent&&MN(r),r}function Um(r){var e,t;const n=(e=r.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function MN(r){r.onUpdate==null||r.onUpdate(r)}function _J(r,e){r.manual||(wE(r)?(r.left=e.width/-2,r.right=e.width/2,r.top=e.height/2,r.bottom=e.height/-2):r.aspect=e.width/e.height,r.updateProjectionMatrix(),r.updateMatrixWorld())}function LS(r){return(r.eventObject||r.object).uuid+"/"+r.index+r.instanceId}function kJ(){var r;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return jm.DefaultEventPriority;switch((r=e.event)==null?void 0:r.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return jm.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return jm.ContinuousEventPriority;default:return jm.DefaultEventPriority}}function YE(r,e,t,n){const a=t.get(e);a&&(t.delete(e),t.size===0&&(r.delete(n),a.target.releasePointerCapture(n)))}function UJ(r,e){const{internal:t}=r.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,a)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(a)}),t.capturedMap.forEach((n,a)=>{YE(t.capturedMap,e,n,a)})}function DJ(r){function e(C){const{internal:d}=r.getState(),f=C.offsetX-d.initialClick[0],b=C.offsetY-d.initialClick[1];return Math.round(Math.sqrt(f*f+b*b))}function t(C){return C.filter(d=>["Move","Over","Enter","Out","Leave"].some(f=>{var b;return(b=d.__r3f)==null?void 0:b.handlers["onPointer"+f]}))}function n(C,d){const f=r.getState(),b=new Set,v=[],y=d?d(f.internal.interaction):f.internal.interaction;for(let S=0;S<y.length;S++){const N=b0(y[S]);N&&(N.raycaster.camera=void 0)}f.previousRoot||f.events.compute==null||f.events.compute(C,f);function Z(S){const N=b0(S);if(!N||!N.events.enabled||N.raycaster.camera===null)return[];if(N.raycaster.camera===void 0){var w;N.events.compute==null||N.events.compute(C,N,(w=N.previousRoot)==null?void 0:w.getState()),N.raycaster.camera===void 0&&(N.raycaster.camera=null)}return N.raycaster.camera?N.raycaster.intersectObject(S,!0):[]}let V=y.flatMap(Z).sort((S,N)=>{const w=b0(S.object),X=b0(N.object);return!w||!X?S.distance-N.distance:X.events.priority-w.events.priority||S.distance-N.distance}).filter(S=>{const N=LS(S);return b.has(N)?!1:(b.add(N),!0)});f.events.filter&&(V=f.events.filter(V,f));for(const S of V){let N=S.object;for(;N;){var R;(R=N.__r3f)!=null&&R.eventCount&&v.push({...S,eventObject:N}),N=N.parent}}if("pointerId"in C&&f.internal.capturedMap.has(C.pointerId))for(let S of f.internal.capturedMap.get(C.pointerId).values())b.has(LS(S.intersection))||v.push(S.intersection);return v}function a(C,d,f,b){const v=r.getState();if(C.length){const y={stopped:!1};for(const Z of C){const V=b0(Z.object)||v,{raycaster:R,pointer:S,camera:N,internal:w}=V,X=new $(S.x,S.y,0).unproject(N),H=E=>{var ee,Ie;return(ee=(Ie=w.capturedMap.get(E))==null?void 0:Ie.has(Z.eventObject))!=null?ee:!1},F=E=>{const ee={intersection:Z,target:d.target};w.capturedMap.has(E)?w.capturedMap.get(E).set(Z.eventObject,ee):w.capturedMap.set(E,new Map([[Z.eventObject,ee]])),d.target.setPointerCapture(E)},_=E=>{const ee=w.capturedMap.get(E);ee&&YE(w.capturedMap,Z.eventObject,ee,E)};let P={};for(let E in d){let ee=d[E];typeof ee!="function"&&(P[E]=ee)}let K={...Z,...P,pointer:S,intersections:C,stopped:y.stopped,delta:f,unprojectedPoint:X,ray:R.ray,camera:N,stopPropagation(){const E="pointerId"in d&&w.capturedMap.get(d.pointerId);if((!E||E.has(Z.eventObject))&&(K.stopped=y.stopped=!0,w.hovered.size&&Array.from(w.hovered.values()).find(ee=>ee.eventObject===Z.eventObject))){const ee=C.slice(0,C.indexOf(Z));o([...ee,Z])}},target:{hasPointerCapture:H,setPointerCapture:F,releasePointerCapture:_},currentTarget:{hasPointerCapture:H,setPointerCapture:F,releasePointerCapture:_},nativeEvent:d};if(b(K),y.stopped===!0)break}}return C}function o(C){const{internal:d}=r.getState();for(const f of d.hovered.values())if(!C.length||!C.find(b=>b.object===f.object&&b.index===f.index&&b.instanceId===f.instanceId)){const v=f.eventObject.__r3f,y=v==null?void 0:v.handlers;if(d.hovered.delete(LS(f)),v!=null&&v.eventCount){const Z={...f,intersections:C};y.onPointerOut==null||y.onPointerOut(Z),y.onPointerLeave==null||y.onPointerLeave(Z)}}}function c(C,d){for(let f=0;f<d.length;f++){const b=d[f].__r3f;b==null||b.handlers.onPointerMissed==null||b.handlers.onPointerMissed(C)}}function I(C){switch(C){case"onPointerLeave":case"onPointerCancel":return()=>o([]);case"onLostPointerCapture":return d=>{const{internal:f}=r.getState();"pointerId"in d&&f.capturedMap.has(d.pointerId)&&requestAnimationFrame(()=>{f.capturedMap.has(d.pointerId)&&(f.capturedMap.delete(d.pointerId),o([]))})}}return function(f){const{onPointerMissed:b,internal:v}=r.getState();v.lastEvent.current=f;const y=C==="onPointerMove",Z=C==="onClick"||C==="onContextMenu"||C==="onDoubleClick",R=n(f,y?t:void 0),S=Z?e(f):0;C==="onPointerDown"&&(v.initialClick=[f.offsetX,f.offsetY],v.initialHits=R.map(w=>w.eventObject)),Z&&!R.length&&S<=2&&(c(f,v.interaction),b&&b(f)),y&&o(R);function N(w){const X=w.eventObject,H=X.__r3f,F=H==null?void 0:H.handlers;if(H!=null&&H.eventCount)if(y){if(F.onPointerOver||F.onPointerEnter||F.onPointerOut||F.onPointerLeave){const _=LS(w),P=v.hovered.get(_);P?P.stopped&&w.stopPropagation():(v.hovered.set(_,w),F.onPointerOver==null||F.onPointerOver(w),F.onPointerEnter==null||F.onPointerEnter(w))}F.onPointerMove==null||F.onPointerMove(w)}else{const _=F[C];_?(!Z||v.initialHits.includes(X))&&(c(f,v.interaction.filter(P=>!v.initialHits.includes(P))),_(w)):Z&&v.initialHits.includes(X)&&c(f,v.interaction.filter(P=>!v.initialHits.includes(P)))}}a(R,f,S,N)}}return{handlePointer:I}}const ME=r=>!!(r!=null&&r.render),HE=rt.createContext(null),JJ=(r,e)=>{const t=NJ((I,C)=>{const d=new $,f=new $,b=new $;function v(S=C().camera,N=f,w=C().size){const{width:X,height:H,top:F,left:_}=w,P=X/H;N.isVector3?b.copy(N):b.set(...N);const K=S.getWorldPosition(d).distanceTo(b);if(wE(S))return{width:X/S.zoom,height:H/S.zoom,top:F,left:_,factor:1,distance:K,aspect:P};{const E=S.fov*Math.PI/180,ee=2*Math.tan(E/2)*K,Ie=ee*(X/H);return{width:Ie,height:ee,top:F,left:_,factor:X/Ie,distance:K,aspect:P}}}let y;const Z=S=>I(N=>({performance:{...N.performance,current:S}})),V=new lt;return{set:I,get:C,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(S=1)=>r(C(),S),advance:(S,N)=>e(S,N,C()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new x2,pointer:V,mouse:V,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const S=C();y&&clearTimeout(y),S.performance.current!==S.performance.min&&Z(S.performance.min),y=setTimeout(()=>Z(C().performance.max),S.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:v},setEvents:S=>I(N=>({...N,events:{...N.events,...S}})),setSize:(S,N,w,X,H)=>{const F=C().camera,_={width:S,height:N,top:X||0,left:H||0,updateStyle:w};I(P=>({size:_,viewport:{...P.viewport,...v(F,f,_)}}))},setDpr:S=>I(N=>{const w=NE(S);return{viewport:{...N.viewport,dpr:w,initialDpr:N.viewport.initialDpr||w}}}),setFrameloop:(S="always")=>{const N=C().clock;N.stop(),N.elapsedTime=0,S!=="never"&&(N.start(),N.elapsedTime=0),I(()=>({frameloop:S}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:rt.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(S,N,w)=>{const X=C().internal;return X.priority=X.priority+(N>0?1:0),X.subscribers.push({ref:S,priority:N,store:w}),X.subscribers=X.subscribers.sort((H,F)=>H.priority-F.priority),()=>{const H=C().internal;H!=null&&H.subscribers&&(H.priority=H.priority-(N>0?1:0),H.subscribers=H.subscribers.filter(F=>F.ref!==S))}}}}}),n=t.getState();let a=n.size,o=n.viewport.dpr,c=n.camera;return t.subscribe(()=>{const{camera:I,size:C,viewport:d,gl:f,set:b}=t.getState();if(C.width!==a.width||C.height!==a.height||d.dpr!==o){var v;a=C,o=d.dpr,_J(I,C),f.setPixelRatio(d.dpr);const y=(v=C.updateStyle)!=null?v:typeof HTMLCanvasElement<"u"&&f.domElement instanceof HTMLCanvasElement;f.setSize(C.width,C.height,y)}I!==c&&(c=I,b(y=>({viewport:{...y.viewport,...y.viewport.getCurrentViewport(I)}})))}),t.subscribe(I=>r(I)),t};function FE(r,e){const t={callback:r};return e.add(t),()=>void e.delete(t)}let _S,KE=new Set,EE=new Set,OJ=new Set;const PJ=r=>FE(r,KE),QJ=r=>FE(r,EE);function wV(r,e){if(r.size)for(const{callback:t}of r.values())t(e)}function v0(r,e){switch(r){case"before":return wV(KE,e);case"after":return wV(EE,e);case"tail":return wV(OJ,e)}}let WV,xV;function VV(r,e,t){let n=e.clock.getDelta();for(e.frameloop==="never"&&typeof r=="number"&&(n=r-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=r),WV=e.internal.subscribers,_S=0;_S<WV.length;_S++)xV=WV[_S],xV.ref.current(xV.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function jJ(r){let e=!1,t=!1,n,a,o;function c(d){a=requestAnimationFrame(c),e=!0,n=0,v0("before",d),t=!0;for(const b of r.values()){var f;o=b.store.getState(),o.internal.active&&(o.frameloop==="always"||o.internal.frames>0)&&!((f=o.gl.xr)!=null&&f.isPresenting)&&(n+=VV(d,o))}if(t=!1,v0("after",d),n===0)return v0("tail",d),e=!1,cancelAnimationFrame(a)}function I(d,f=1){var b;if(!d)return r.forEach(v=>I(v.store.getState(),f));(b=d.gl.xr)!=null&&b.isPresenting||!d.internal.active||d.frameloop==="never"||(f>1?d.internal.frames=Math.min(60,d.internal.frames+f):t?d.internal.frames=2:d.internal.frames=1,e||(e=!0,requestAnimationFrame(c)))}function C(d,f=!0,b,v){if(f&&v0("before",d),b)VV(d,b,v);else for(const y of r.values())VV(d,y.store.getState());f&&v0("after",d)}return{loop:c,invalidate:I,advance:C}}function TE(){const r=rt.useContext(HE);if(!r)throw new Error("R3F: Hooks can only be used within the Canvas component!");return r}function gI(r=t=>t,e){return TE()(r,e)}function Cb(r,e=0){const t=TE(),n=t.getState().internal.subscribe,a=WE(r);return uG(()=>n(a,e,t),[e,n,t]),null}const rb=new Map,{invalidate:vH,advance:yH}=jJ(rb),{reconciler:bR,applyProps:Lm}=FJ(rb,kJ),_m={objects:"shallow",strict:!1},qJ=(r,e)=>{const t=typeof r=="function"?r(e):r;return ME(t)?t:new d2({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...r})};function $J(r,e){const t=typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement;if(e){const{width:n,height:a,top:o,left:c,updateStyle:I=t}=e;return{width:n,height:a,top:o,left:c,updateStyle:I}}else if(typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement&&r.parentElement){const{width:n,height:a,top:o,left:c}=r.parentElement.getBoundingClientRect();return{width:n,height:a,top:o,left:c,updateStyle:t}}else if(typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas)return{width:r.width,height:r.height,top:0,left:0,updateStyle:t};return{width:0,height:0,top:0,left:0}}function eO(r){const e=rb.get(r),t=e==null?void 0:e.fiber,n=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,o=n||JJ(vH,yH),c=t||bR.createContainer(o,jm.ConcurrentRoot,null,!1,null,"",a,null);e||rb.set(r,{fiber:c,store:o});let I,C=!1,d;return{configure(f={}){let{gl:b,size:v,scene:y,events:Z,onCreated:V,shadows:R=!1,linear:S=!1,flat:N=!1,legacy:w=!1,orthographic:X=!1,frameloop:H="always",dpr:F=[1,2],performance:_,raycaster:P,camera:K,onPointerMissed:E}=f,ee=o.getState(),Ie=ee.gl;ee.gl||ee.set({gl:Ie=qJ(b,r)});let be=ee.raycaster;be||ee.set({raycaster:be=new mE});const{params:se,...Ce}=P||{};if(la.equ(Ce,be,_m)||Lm(be,{...Ce}),la.equ(se,be.params,_m)||Lm(be,{params:{...be.params,...se}}),!ee.camera||ee.camera===d&&!la.equ(d,K,_m)){d=K;const me=K instanceof aG,Xe=me?K:X?new $d(0,0,0,0,.1,1e3):new Ea(75,0,.1,1e3);me||(Xe.position.z=5,K&&(Lm(Xe,K),("aspect"in K||"left"in K||"right"in K||"bottom"in K||"top"in K)&&(Xe.manual=!0,Xe.updateProjectionMatrix())),!ee.camera&&!(K!=null&&K.rotation)&&Xe.lookAt(0,0,0)),ee.set({camera:Xe}),be.camera=Xe}if(!ee.scene){let me;y!=null&&y.isScene?me=y:(me=new C2,y&&Lm(me,y)),ee.set({scene:km(me)})}if(!ee.xr){var he;const me=(de,Ee)=>{const At=o.getState();At.frameloop!=="never"&&yH(de,!0,At,Ee)},Xe=()=>{const de=o.getState();de.gl.xr.enabled=de.gl.xr.isPresenting,de.gl.xr.setAnimationLoop(de.gl.xr.isPresenting?me:null),de.gl.xr.isPresenting||vH(de)},Ue={connect(){const de=o.getState().gl;de.xr.addEventListener("sessionstart",Xe),de.xr.addEventListener("sessionend",Xe)},disconnect(){const de=o.getState().gl;de.xr.removeEventListener("sessionstart",Xe),de.xr.removeEventListener("sessionend",Xe)}};typeof((he=Ie.xr)==null?void 0:he.addEventListener)=="function"&&Ue.connect(),ee.set({xr:Ue})}if(Ie.shadowMap){const me=Ie.shadowMap.enabled,Xe=Ie.shadowMap.type;if(Ie.shadowMap.enabled=!!R,la.boo(R))Ie.shadowMap.type=W0;else if(la.str(R)){var Be;const Ue={basic:uF,percentage:yR,soft:W0,variance:Yg};Ie.shadowMap.type=(Be=Ue[R])!=null?Be:W0}else la.obj(R)&&Object.assign(Ie.shadowMap,R);(me!==Ie.shadowMap.enabled||Xe!==Ie.shadowMap.type)&&(Ie.shadowMap.needsUpdate=!0)}const ve=RE();ve&&("enabled"in ve?ve.enabled=!w:"legacyMode"in ve&&(ve.legacyMode=w)),C||Lm(Ie,{outputEncoding:S?3e3:3001,toneMapping:N?Fc:DN}),ee.legacy!==w&&ee.set(()=>({legacy:w})),ee.linear!==S&&ee.set(()=>({linear:S})),ee.flat!==N&&ee.set(()=>({flat:N})),b&&!la.fun(b)&&!ME(b)&&!la.equ(b,Ie,_m)&&Lm(Ie,b),Z&&!ee.events.handlers&&ee.set({events:Z(o)});const we=$J(r,v);return la.equ(we,ee.size,_m)||ee.setSize(we.width,we.height,we.updateStyle,we.top,we.left),F&&ee.viewport.dpr!==NE(F)&&ee.setDpr(F),ee.frameloop!==H&&ee.setFrameloop(H),ee.onPointerMissed||ee.set({onPointerMissed:E}),_&&!la.equ(_,ee.performance,_m)&&ee.set(me=>({performance:{...me.performance,..._}})),I=V,C=!0,this},render(f){return C||this.configure(),bR.updateContainer(Tl.jsx(tO,{store:o,children:f,onCreated:I,rootElement:r}),c,null,()=>{}),o},unmount(){zE(r)}}}function tO({store:r,children:e,onCreated:t,rootElement:n}){return uG(()=>{const a=r.getState();a.set(o=>({internal:{...o.internal,active:!0}})),t&&t(a),r.getState().events.connected||a.events.connect==null||a.events.connect(n)},[]),Tl.jsx(HE.Provider,{value:r,children:e})}function zE(r,e){const t=rb.get(r),n=t==null?void 0:t.fiber;if(n){const a=t==null?void 0:t.store.getState();a&&(a.internal.active=!1),bR.updateContainer(null,n,null,()=>{a&&setTimeout(()=>{try{var o,c,I,C;a.events.disconnect==null||a.events.disconnect(),(o=a.gl)==null||(c=o.renderLists)==null||c.dispose==null||c.dispose(),(I=a.gl)==null||I.forceContextLoss==null||I.forceContextLoss(),(C=a.gl)!=null&&C.xr&&a.xr.disconnect(),zJ(a),rb.delete(r)}catch{}},500)})}}bR.injectIntoDevTools({bundleType:1,rendererPackageName:"@react-three/fiber",version:rt.version});const NV={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function nO(r){const{handlePointer:e}=DJ(r);return{priority:1,enabled:!0,compute(t,n,a){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(NV).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:a}=r.getState();(t=a.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(a.lastEvent.current)},connect:t=>{var n;const{set:a,events:o}=r.getState();o.disconnect==null||o.disconnect(),a(c=>({events:{...c.events,connected:t}})),Object.entries((n=o.handlers)!=null?n:[]).forEach(([c,I])=>{const[C,d]=NV[c];t.addEventListener(C,I,{passive:d})})},disconnect:()=>{const{set:t,events:n}=r.getState();if(n.connected){var a;Object.entries((a=n.handlers)!=null?a:[]).forEach(([o,c])=>{if(n&&n.connected instanceof HTMLElement){const[I]=NV[o];n.connected.removeEventListener(I,c)}}),t(o=>({events:{...o.events,connected:void 0}}))}}}}function GH(r,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>r(...n),e)}}function iO({debounce:r,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const a=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!a)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[o,c]=rt.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),I=rt.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o,orientationHandler:null}),C=r?typeof r=="number"?r:r.scroll:null,d=r?typeof r=="number"?r:r.resize:null,f=rt.useRef(!1);rt.useEffect(()=>(f.current=!0,()=>void(f.current=!1)));const[b,v,y]=rt.useMemo(()=>{const S=()=>{if(!I.current.element)return;const{left:N,top:w,width:X,height:H,bottom:F,right:_,x:P,y:K}=I.current.element.getBoundingClientRect(),E={left:N,top:w,width:X,height:H,bottom:F,right:_,x:P,y:K};I.current.element instanceof HTMLElement&&n&&(E.height=I.current.element.offsetHeight,E.width=I.current.element.offsetWidth),Object.freeze(E),f.current&&!rO(I.current.lastBounds,E)&&c(I.current.lastBounds=E)};return[S,d?GH(S,d):S,C?GH(S,C):S]},[c,n,C,d]);function Z(){I.current.scrollContainers&&(I.current.scrollContainers.forEach(S=>S.removeEventListener("scroll",y,!0)),I.current.scrollContainers=null),I.current.resizeObserver&&(I.current.resizeObserver.disconnect(),I.current.resizeObserver=null),I.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",I.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",I.current.orientationHandler))}function V(){I.current.element&&(I.current.resizeObserver=new a(y),I.current.resizeObserver.observe(I.current.element),e&&I.current.scrollContainers&&I.current.scrollContainers.forEach(S=>S.addEventListener("scroll",y,{capture:!0,passive:!0})),I.current.orientationHandler=()=>{y()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",I.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",I.current.orientationHandler))}const R=S=>{!S||S===I.current.element||(Z(),I.current.element=S,I.current.scrollContainers=LE(S),V())};return sO(y,!!e),aO(v),rt.useEffect(()=>{Z(),V()},[e,y,v]),rt.useEffect(()=>Z,[]),[R,o,b]}function aO(r){rt.useEffect(()=>{const e=r;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[r])}function sO(r,e){rt.useEffect(()=>{if(e){const t=r;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[r,e])}function LE(r){const e=[];if(!r||r===document.body)return e;const{overflow:t,overflowX:n,overflowY:a}=window.getComputedStyle(r);return[t,n,a].some(o=>o==="auto"||o==="scroll")&&e.push(r),[...e,...LE(r.parentElement)]}const oO=["x","y","top","bottom","left","right","width","height"],rO=(r,e)=>oO.every(t=>r[t]===e[t]);var lO=Object.defineProperty,gO=Object.defineProperties,cO=Object.getOwnPropertyDescriptors,BH=Object.getOwnPropertySymbols,uO=Object.prototype.hasOwnProperty,IO=Object.prototype.propertyIsEnumerable,ZH=(r,e,t)=>e in r?lO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,SH=(r,e)=>{for(var t in e||(e={}))uO.call(e,t)&&ZH(r,t,e[t]);if(BH)for(var t of BH(e))IO.call(e,t)&&ZH(r,t,e[t]);return r},dO=(r,e)=>gO(r,cO(e)),RH,wH;typeof window<"u"&&((RH=window.document)!=null&&RH.createElement||((wH=window.navigator)==null?void 0:wH.product)==="ReactNative")?rt.useLayoutEffect:rt.useEffect;function _E(r,e,t){if(!r)return;if(t(r)===!0)return r;let n=r.child;for(;n;){const a=_E(n,e,t);if(a)return a;n=n.sibling}}function kE(r){try{return Object.defineProperties(r,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return r}}const WH=console.error;console.error=function(){const r=[...arguments].join("");if(r!=null&&r.startsWith("Warning:")&&r.includes("useContext")){console.error=WH;return}return WH.apply(this,arguments)};const M2=kE(rt.createContext(null));class UE extends rt.Component{render(){return rt.createElement(M2.Provider,{value:this._reactInternals},this.props.children)}}function CO(){const r=rt.useContext(M2);if(r===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=rt.useId();return rt.useMemo(()=>{for(const n of[r,r==null?void 0:r.alternate]){if(!n)continue;const a=_E(n,!1,o=>{let c=o.memoizedState;for(;c;){if(c.memoizedState===e)return!0;c=c.next}});if(a)return a}},[r,e])}function hO(){const r=CO(),[e]=rt.useState(()=>new Map);e.clear();let t=r;for(;t;){if(t.type&&typeof t.type=="object"){const a=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;a&&a!==M2&&!e.has(a)&&e.set(a,rt.useContext(kE(a)))}t=t.return}return e}function AO(){const r=hO();return rt.useMemo(()=>Array.from(r.keys()).reduce((e,t)=>n=>rt.createElement(e,null,rt.createElement(t.Provider,dO(SH({},n),{value:r.get(t)}))),e=>rt.createElement(UE,SH({},e))),[r])}const fO=rt.forwardRef(function({children:e,fallback:t,resize:n,style:a,gl:o,events:c=nO,eventSource:I,eventPrefix:C,shadows:d,linear:f,flat:b,legacy:v,orthographic:y,frameloop:Z,dpr:V,performance:R,raycaster:S,camera:N,scene:w,onPointerMissed:X,onCreated:H,...F},_){rt.useMemo(()=>HJ(WJ),[]);const P=AO(),[K,E]=iO({scroll:!0,debounce:{scroll:50,resize:0},...n}),ee=rt.useRef(null),Ie=rt.useRef(null);rt.useImperativeHandle(_,()=>ee.current);const be=WE(X),[se,Ce]=rt.useState(!1),[he,Be]=rt.useState(!1);if(se)throw se;if(he)throw he;const ve=rt.useRef(null);uG(()=>{const me=ee.current;E.width>0&&E.height>0&&me&&(ve.current||(ve.current=eO(me)),ve.current.configure({gl:o,events:c,shadows:d,linear:f,flat:b,legacy:v,orthographic:y,frameloop:Z,dpr:V,performance:R,raycaster:S,camera:N,scene:w,size:E,onPointerMissed:(...Xe)=>be.current==null?void 0:be.current(...Xe),onCreated:Xe=>{Xe.events.connect==null||Xe.events.connect(I?KJ(I)?I.current:I:Ie.current),C&&Xe.setEvents({compute:(Ue,de)=>{const Ee=Ue[C+"X"],At=Ue[C+"Y"];de.pointer.set(Ee/de.size.width*2-1,-(At/de.size.height)*2+1),de.raycaster.setFromCamera(de.pointer,de.camera)}}),H==null||H(Xe)}}),ve.current.render(Tl.jsx(P,{children:Tl.jsx(xE,{set:Be,children:Tl.jsx(rt.Suspense,{fallback:Tl.jsx(EJ,{set:Ce}),children:e??null})})})))}),rt.useEffect(()=>{const me=ee.current;if(me)return()=>zE(me)},[]);const we=I?"none":"auto";return Tl.jsx("div",{ref:Ie,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:we,...a},...F,children:Tl.jsx("div",{ref:K,style:{width:"100%",height:"100%"},children:Tl.jsx("canvas",{ref:ee,style:{display:"block"},children:t})})})}),pO=rt.forwardRef(function(e,t){return Tl.jsx(UE,{children:Tl.jsx(fO,{...e,ref:t})})});var H2={exports:{}},eb=typeof Reflect=="object"?Reflect:null,xH=eb&&typeof eb.apply=="function"?eb.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},rR;eb&&typeof eb.ownKeys=="function"?rR=eb.ownKeys:Object.getOwnPropertySymbols?rR=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:rR=function(e){return Object.getOwnPropertyNames(e)};function mO(r){console&&console.warn&&console.warn(r)}var DE=Number.isNaN||function(e){return e!==e};function zi(){zi.init.call(this)}H2.exports=zi;H2.exports.once=GO;zi.EventEmitter=zi;zi.prototype._events=void 0;zi.prototype._eventsCount=0;zi.prototype._maxListeners=void 0;var VH=10;function QR(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(zi,"defaultMaxListeners",{enumerable:!0,get:function(){return VH},set:function(r){if(typeof r!="number"||r<0||DE(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");VH=r}});zi.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};zi.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||DE(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function JE(r){return r._maxListeners===void 0?zi.defaultMaxListeners:r._maxListeners}zi.prototype.getMaxListeners=function(){return JE(this)};zi.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var a=e==="error",o=this._events;if(o!==void 0)a=a&&o.error===void 0;else if(!a)return!1;if(a){var c;if(t.length>0&&(c=t[0]),c instanceof Error)throw c;var I=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw I.context=c,I}var C=o[e];if(C===void 0)return!1;if(typeof C=="function")xH(C,this,t);else for(var d=C.length,f=qE(C,d),n=0;n<d;++n)xH(f[n],this,t);return!0};function OE(r,e,t,n){var a,o,c;if(QR(t),o=r._events,o===void 0?(o=r._events=Object.create(null),r._eventsCount=0):(o.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),o=r._events),c=o[e]),c===void 0)c=o[e]=t,++r._eventsCount;else if(typeof c=="function"?c=o[e]=n?[t,c]:[c,t]:n?c.unshift(t):c.push(t),a=JE(r),a>0&&c.length>a&&!c.warned){c.warned=!0;var I=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");I.name="MaxListenersExceededWarning",I.emitter=r,I.type=e,I.count=c.length,mO(I)}return r}zi.prototype.addListener=function(e,t){return OE(this,e,t,!1)};zi.prototype.on=zi.prototype.addListener;zi.prototype.prependListener=function(e,t){return OE(this,e,t,!0)};function bO(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function PE(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},a=bO.bind(n);return a.listener=t,n.wrapFn=a,a}zi.prototype.once=function(e,t){return QR(t),this.on(e,PE(this,e,t)),this};zi.prototype.prependOnceListener=function(e,t){return QR(t),this.prependListener(e,PE(this,e,t)),this};zi.prototype.removeListener=function(e,t){var n,a,o,c,I;if(QR(t),a=this._events,a===void 0)return this;if(n=a[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(o=-1,c=n.length-1;c>=0;c--)if(n[c]===t||n[c].listener===t){I=n[c].listener,o=c;break}if(o<0)return this;o===0?n.shift():vO(n,o),n.length===1&&(a[e]=n[0]),a.removeListener!==void 0&&this.emit("removeListener",e,I||t)}return this};zi.prototype.off=zi.prototype.removeListener;zi.prototype.removeAllListeners=function(e){var t,n,a;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var o=Object.keys(n),c;for(a=0;a<o.length;++a)c=o[a],c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this};function QE(r,e,t){var n=r._events;if(n===void 0)return[];var a=n[e];return a===void 0?[]:typeof a=="function"?t?[a.listener||a]:[a]:t?yO(a):qE(a,a.length)}zi.prototype.listeners=function(e){return QE(this,e,!0)};zi.prototype.rawListeners=function(e){return QE(this,e,!1)};zi.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):jE.call(r,e)};zi.prototype.listenerCount=jE;function jE(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}zi.prototype.eventNames=function(){return this._eventsCount>0?rR(this._events):[]};function qE(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function vO(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function yO(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function GO(r,e){return new Promise(function(t,n){function a(c){r.removeListener(e,o),n(c)}function o(){typeof r.removeListener=="function"&&r.removeListener("error",a),t([].slice.call(arguments))}$E(r,e,o,{once:!0}),e!=="error"&&BO(r,a,{once:!0})})}function BO(r,e,t){typeof r.on=="function"&&$E(r,"error",e,t)}function $E(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function a(o){n.once&&r.removeEventListener(e,a),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var ZO=H2.exports;function SO(r,e){var t=atob(r);return t}function RO(r,e,t){var n=SO(r),a=n.indexOf(`
`,10)+1,o=n.substring(a)+"",c=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(c)}function wO(r,e,t){var n;return function(o){return n=n||RO(r),new Worker(n,o)}}var WO=wO("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtUSFJFRS5RdWF0ZXJuaW9ufSB0YXJnZXQKICAgKiBAcGFyYW0ge3sgcm90YXRpb24/OiBUSFJFRS5WZWN0b3IzVHVwbGUgcXVhdGVybmlvbj86IFRIUkVFLlZlY3RvcjRUdXBsZSB9fSBwcm9wcwogICAqIEByZXR1cm5zIHtUSFJFRS5RdWF0ZXJuaW9ufQogICAqLwogIGNvbnN0IHNldFF1YXRlcm5pb24gPSAodGFyZ2V0LCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgcXVhdGVybmlvbiwKICAgICAgcm90YXRpb24KICAgIH0gPSBfcmVmMzsKICAgIGlmIChxdWF0ZXJuaW9uKSB7CiAgICAgIHRhcmdldC5zZXQoLi4ucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHRhcmdldC5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uLAogICAgICBxdWF0ZXJuaW9uLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7CiAgICAgIC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgcXVhdGVybmlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjQ7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHNldFF1YXRlcm5pb24obmV3IFF1YXRlcm5pb24oMCwgMCwgMCwgMSksIHsKICAgICAgICAgIHF1YXRlcm5pb24sCiAgICAgICAgICByb3RhdGlvbgogICAgICAgIH0pKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICBzZXRRdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbiwgewogICAgICBxdWF0ZXJuaW9uLAogICAgICByb3RhdGlvbgogICAgfSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCB0cmlwbGV0VG9WZWMzKHBpdm90QSksIHN0YXRlLmJvZGllc1tib2R5Ql0sIHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBkaXN0YW5jZSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0cmFpbnQudXVpZCA9IHV1aWQ7CiAgICBzdGF0ZS53b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpOwogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSA9IHBvc3RTdGVwQ29uc3RyYWludDsKICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdG9VcHBlcmNhc2Uoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7CiAgfQogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7CiAgICAgICAgICAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgYXhsZUxvY2FsLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwKICAgICAgICBkaXJlY3Rpb25Mb2NhbCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSB3aGVlbEluZm9zW2ldOwogICAgICB2ZWhpY2xlLmFkZFdoZWVsKHsKICAgICAgICBheGxlTG9jYWw6IHRyaXBsZXRUb1ZlYzMoYXhsZUxvY2FsKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHRyaXBsZXRUb1ZlYzMoY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsKSwKICAgICAgICBkaXJlY3Rpb25Mb2NhbDogdHJpcGxldFRvVmVjMyhkaXJlY3Rpb25Mb2NhbCksCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0gPSB7CiAgICAgIHBvc3RTdGVwLAogICAgICBwcmVTdGVwLAogICAgICB2ZWhpY2xlCiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHByZVN0ZXApOwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBwb3N0U3RlcCk7CiAgfTsKCiAgY29uc3QgYWRkU3ByaW5nID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogW2JvZHlBLCBib2R5QiwgewogICAgICAgIGRhbXBpbmcsCiAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgIHN0aWZmbmVzcywKICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgd29ybGRBbmNob3JCCiAgICAgIH1dLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICBkYW1waW5nLAogICAgICBsb2NhbEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JBKSwKICAgICAgbG9jYWxBbmNob3JCOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQiksCiAgICAgIHJlc3RMZW5ndGgsCiAgICAgIHN0aWZmbmVzcywKICAgICAgd29ybGRBbmNob3JBOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQSksCiAgICAgIHdvcmxkQW5jaG9yQjogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckIpCiAgICB9KTsKICAgIHNwcmluZy51dWlkID0gdXVpZDsKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsKCiAgICAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CiAgY29uc3QgaW5pdCA9ICh3b3JsZCwgX3JlZjMpID0+IHsKICAgIGxldCB7CiAgICAgIGFsbG93U2xlZXAsCiAgICAgIGF4aXNJbmRleCA9IDAsCiAgICAgIGJyb2FkcGhhc2UsCiAgICAgIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwsCiAgICAgIGZyaWN0aW9uR3Jhdml0eSwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGZyaWN0aW9uR3Jhdml0eSA/IG5ldyBWZWMzKC4uLmZyaWN0aW9uR3Jhdml0eSkgOiB1bmRlZmluZWQ7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplRmFzdCA9IHF1YXROb3JtYWxpemVGYXN0OwogICAgd29ybGQucXVhdE5vcm1hbGl6ZVNraXAgPSBxdWF0Tm9ybWFsaXplU2tpcDsKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CiAgICB3b3JsZC5icm9hZHBoYXNlID0gYnJvYWRwaGFzZSA9PT0gJ1NBUCcgPyBuZXcgU0FQQnJvYWRwaGFzZSh3b3JsZCkgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CiAgY29uc3Qgc3RlcCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcG9zaXRpb25zLAogICAgICBwcm9wczogewogICAgICAgIG1heFN1YlN0ZXBzLAogICAgICAgIHN0ZXBTaXplLAogICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsZWQKICAgICAgfSwKICAgICAgcXVhdGVybmlvbnMKICAgIH0gPSBfcmVmOwogICAgc3RhdGUud29ybGQuc3RlcChzdGVwU2l6ZSwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpKSB7CiAgICAgIGNvbnN0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgY29uc3QgewogICAgICAgIGJvZGllcywKICAgICAgICB2ZWhpY2xlcwogICAgICB9ID0gc3RhdGU7CiAgICAgIGNvbnN0IHZhbHVlID0gdGFyZ2V0ID09PSAndmVoaWNsZXMnID8KICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdmVoaWNsZXNbdXVpZF0udmVoaWNsZVt0eXBlXSA6CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIGJvZGllc1t1dWlkXVt0eXBlXTsKICAgICAgY29uc3Qgc2VyaWFsaXphYmxlVmFsdWUgPSBpc1FvclYodmFsdWUpID8gdmFsdWUudG9BcnJheSgpIDogdmFsdWU7CiAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtOdW1iZXIoaWQpLCBzZXJpYWxpemFibGVWYWx1ZSwKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdHlwZV0pOwogICAgfQogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KICAgIHNlbGYucG9zdE1lc3NhZ2UobWVzc2FnZSwgW3Bvc2l0aW9ucy5idWZmZXIsIHF1YXRlcm5pb25zLmJ1ZmZlcl0pOwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGNvbnN0cmFpbnRzOiB7fSwKICAgIG1hdGVyaWFsczoge30sCiAgICByYXlzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdmVoaWNsZXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpCiAgfTsKCiAgLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7CiAgICAgIC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CiAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICBTQVBCcm9hZHBoYXNlCiAgfTsKICBjb25zdCBjcmVhdGVNYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeShzdGF0ZS5tYXRlcmlhbHMpOwogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgc3RlcChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWRbaV0pOwogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRHcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXRlcmF0aW9ucyc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gZGF0YS5wcm9wcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucHJvcHMgPT09IG51bGwgPyAwIDogZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5VG9ycXVlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBpZiAoc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSkgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yU3BlZWQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0uc3RpZmZuZXNzID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheWNhc3RWZWhpY2xlKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWQpOwogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1trZXldOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZENvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBjcmVhdGVNYXRlcmlhbCwgZGF0YS5wcm9wcywgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NsZWVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK");class xO extends ZO{constructor(t){let{allowSleep:n=!1,axisIndex:a=0,broadphase:o="Naive",defaultContactMaterial:c={contactEquationStiffness:1e6},frictionGravity:I=null,gravity:C=[0,-9.81,0],iterations:d=5,quatNormalizeFast:f=!1,quatNormalizeSkip:b=0,size:v=1e3,solver:y="GS",tolerance:Z=.001}=t;super();To(this,"messageQueue",[]);To(this,"worker",null);this.config={allowSleep:n,axisIndex:a,broadphase:o,defaultContactMaterial:c,frictionGravity:I,gravity:C,iterations:d,quatNormalizeFast:f,quatNormalizeSkip:b,size:v,solver:y,tolerance:Z},this.buffers={positions:new Float32Array(v*3),quaternions:new Float32Array(v*4)}}get axisIndex(){return this.config.axisIndex}set axisIndex(t){this.config.axisIndex=t,this.postMessage({op:"setAxisIndex",props:t})}get broadphase(){return this.config.broadphase}set broadphase(t){this.config.broadphase=t,this.postMessage({op:"setBroadphase",props:t})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(t){this.config.frictionGravity=t,this.postMessage({op:"setFrictionGravity",props:t})}get gravity(){return this.config.gravity}set gravity(t){this.config.gravity=t,this.postMessage({op:"setGravity",props:t})}get iterations(){return this.config.iterations}set iterations(t){this.config.iterations=t,this.postMessage({op:"setIterations",props:t})}get tolerance(){return this.config.tolerance}set tolerance(t){this.config.tolerance=t,this.postMessage({op:"setTolerance",props:t})}addBodies(t){let{props:n,type:a,uuid:o}=t;this.postMessage({op:"addBodies",props:n,type:a,uuid:o})}addConstraint(t){let{props:[n,a,o],type:c,uuid:I}=t;this.postMessage({op:"addConstraint",props:[n,a,o],type:c,uuid:I})}addContactMaterial(t){let{props:n,uuid:a}=t;this.postMessage({op:"addContactMaterial",props:n,uuid:a})}addRay(t){let{props:n,uuid:a}=t;this.postMessage({op:"addRay",props:n,uuid:a})}addRaycastVehicle(t){let{props:[n,a,o,c,I,C],uuid:d}=t;this.postMessage({op:"addRaycastVehicle",props:[n,a,o,c,I,C],uuid:d})}addSpring(t){let{props:[n,a,o],uuid:c}=t;this.postMessage({op:"addSpring",props:[n,a,o],uuid:c})}applyForce(t){let{props:n,uuid:a}=t;this.postMessage({op:"applyForce",props:n,uuid:a})}applyImpulse(t){let{props:n,uuid:a}=t;this.postMessage({op:"applyImpulse",props:n,uuid:a})}applyLocalForce(t){let{props:n,uuid:a}=t;this.postMessage({op:"applyLocalForce",props:n,uuid:a})}applyLocalImpulse(t){let{props:n,uuid:a}=t;this.postMessage({op:"applyLocalImpulse",props:n,uuid:a})}applyRaycastVehicleEngineForce(t){let{props:n,uuid:a}=t;this.postMessage({op:"applyRaycastVehicleEngineForce",props:n,uuid:a})}applyTorque(t){let{props:n,uuid:a}=t;this.postMessage({op:"applyTorque",props:n,uuid:a})}connect(){this.worker=new WO,this.worker.onmessage=t=>{if(t.data.op==="frame"){this.buffers.positions=t.data.positions,this.buffers.quaternions=t.data.quaternions,this.emit(t.data.op,t.data);return}this.emit(t.data.type,t.data)};for(const t of this.messageQueue)this.worker.postMessage(t);this.messageQueue.length=0}disableConstraint(t){let{uuid:n}=t;this.postMessage({op:"disableConstraint",uuid:n})}disableConstraintMotor(t){let{uuid:n}=t;this.postMessage({op:"disableConstraintMotor",uuid:n})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(t){let{uuid:n}=t;this.postMessage({op:"enableConstraint",uuid:n})}enableConstraintMotor(t){let{uuid:n}=t;this.postMessage({op:"enableConstraintMotor",uuid:n})}init(){const{allowSleep:t,axisIndex:n,broadphase:a,defaultContactMaterial:o,frictionGravity:c,gravity:I,iterations:C,quatNormalizeFast:d,quatNormalizeSkip:f,solver:b,tolerance:v}=this.config;this.postMessage({op:"init",props:{allowSleep:t,axisIndex:n,broadphase:a,defaultContactMaterial:o,frictionGravity:c,gravity:I,iterations:C,quatNormalizeFast:d,quatNormalizeSkip:f,solver:b,tolerance:v}})}removeBodies(t){let{uuid:n}=t;this.postMessage({op:"removeBodies",uuid:n})}removeConstraint(t){let{uuid:n}=t;this.postMessage({op:"removeConstraint",uuid:n})}removeContactMaterial(t){let{uuid:n}=t;this.postMessage({op:"removeContactMaterial",uuid:n})}removeRay(t){let{uuid:n}=t;this.postMessage({op:"removeRay",uuid:n})}removeRaycastVehicle(t){let{uuid:n}=t;this.postMessage({op:"removeRaycastVehicle",uuid:n})}removeSpring(t){let{uuid:n}=t;this.postMessage({op:"removeSpring",uuid:n})}setAllowSleep(t){let{props:n,uuid:a}=t;this.postMessage({op:"setAllowSleep",props:n,uuid:a})}setAngularDamping(t){let{props:n,uuid:a}=t;this.postMessage({op:"setAngularDamping",props:n,uuid:a})}setAngularFactor(t){let{props:n,uuid:a}=t;this.postMessage({op:"setAngularFactor",props:n,uuid:a})}setAngularVelocity(t){let{props:n,uuid:a}=t;this.postMessage({op:"setAngularVelocity",props:n,uuid:a})}setCollisionFilterGroup(t){let{props:n,uuid:a}=t;this.postMessage({op:"setCollisionFilterGroup",props:n,uuid:a})}setCollisionFilterMask(t){let{props:n,uuid:a}=t;this.postMessage({op:"setCollisionFilterMask",props:n,uuid:a})}setCollisionResponse(t){let{props:n,uuid:a}=t;this.postMessage({op:"setCollisionResponse",props:n,uuid:a})}setConstraintMotorMaxForce(t){let{props:n,uuid:a}=t;this.postMessage({op:"setConstraintMotorMaxForce",props:n,uuid:a})}setConstraintMotorSpeed(t){let{props:n,uuid:a}=t;this.postMessage({op:"setConstraintMotorSpeed",props:n,uuid:a})}setFixedRotation(t){let{props:n,uuid:a}=t;this.postMessage({op:"setFixedRotation",props:n,uuid:a})}setIsTrigger(t){let{props:n,uuid:a}=t;this.postMessage({op:"setIsTrigger",props:n,uuid:a})}setLinearDamping(t){let{props:n,uuid:a}=t;this.postMessage({op:"setLinearDamping",props:n,uuid:a})}setLinearFactor(t){let{props:n,uuid:a}=t;this.postMessage({op:"setLinearFactor",props:n,uuid:a})}setMass(t){let{props:n,uuid:a}=t;this.postMessage({op:"setMass",props:n,uuid:a})}setMaterial(t){let{props:n,uuid:a}=t;this.postMessage({op:"setMaterial",props:n,uuid:a})}setPosition(t){let{props:n,uuid:a}=t;this.postMessage({op:"setPosition",props:n,uuid:a})}setQuaternion(t){let{props:[n,a,o,c],uuid:I}=t;this.postMessage({op:"setQuaternion",props:[n,a,o,c],uuid:I})}setRaycastVehicleBrake(t){let{props:n,uuid:a}=t;this.postMessage({op:"setRaycastVehicleBrake",props:n,uuid:a})}setRaycastVehicleSteeringValue(t){let{props:n,uuid:a}=t;this.postMessage({op:"setRaycastVehicleSteeringValue",props:n,uuid:a})}setRotation(t){let{props:n,uuid:a}=t;this.postMessage({op:"setRotation",props:n,uuid:a})}setSleepSpeedLimit(t){let{props:n,uuid:a}=t;this.postMessage({op:"setSleepSpeedLimit",props:n,uuid:a})}setSleepTimeLimit(t){let{props:n,uuid:a}=t;this.postMessage({op:"setSleepTimeLimit",props:n,uuid:a})}setSpringDamping(t){let{props:n,uuid:a}=t;this.postMessage({op:"setSpringDamping",props:n,uuid:a})}setSpringRestLength(t){let{props:n,uuid:a}=t;this.postMessage({op:"setSpringRestLength",props:n,uuid:a})}setSpringStiffness(t){let{props:n,uuid:a}=t;this.postMessage({op:"setSpringStiffness",props:n,uuid:a})}setUserData(t){let{props:n,uuid:a}=t;this.postMessage({op:"setUserData",props:n,uuid:a})}setVelocity(t){let{props:n,uuid:a}=t;this.postMessage({op:"setVelocity",props:n,uuid:a})}sleep(t){let{uuid:n}=t;this.postMessage({op:"sleep",uuid:n})}step(t){var n;const{buffers:{positions:a,quaternions:o}}=this;!a.byteLength&&!o.byteLength||(n=this.worker)==null||n.postMessage({op:"step",positions:a,props:t,quaternions:o},[a.buffer,o.buffer])}subscribe(t){let{props:{id:n,target:a,type:o},uuid:c}=t;this.postMessage({op:"subscribe",props:{id:n,target:a,type:o},uuid:c})}terminate(){var t;(t=this.worker)==null||t.terminate(),this.worker=null}unsubscribe(t){let{props:n}=t;this.postMessage({op:"unsubscribe",props:n})}wakeUp(t){let{uuid:n}=t;this.postMessage({op:"wakeUp",uuid:n})}postMessage(t){if(this.worker)return this.worker.postMessage(t);this.messageQueue.push(t)}}class CI{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new te);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new te);const n=this.elements,a=e.x,o=e.y,c=e.z;return t.x=n[0]*a+n[1]*o+n[2]*c,t.y=n[3]*a+n[4]*o+n[5]*c,t.z=n[6]*a+n[7]*o+n[8]*c,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new CI);const n=this.elements,a=e.elements,o=t.elements,c=n[0],I=n[1],C=n[2],d=n[3],f=n[4],b=n[5],v=n[6],y=n[7],Z=n[8],V=a[0],R=a[1],S=a[2],N=a[3],w=a[4],X=a[5],H=a[6],F=a[7],_=a[8];return o[0]=c*V+I*N+C*H,o[1]=c*R+I*w+C*F,o[2]=c*S+I*X+C*_,o[3]=d*V+f*N+b*H,o[4]=d*R+f*w+b*F,o[5]=d*S+f*X+b*_,o[6]=v*V+y*N+Z*H,o[7]=v*R+y*w+Z*F,o[8]=v*S+y*X+Z*_,t}scale(e,t){t===void 0&&(t=new CI);const n=this.elements,a=t.elements;for(let o=0;o!==3;o++)a[3*o+0]=e.x*n[3*o+0],a[3*o+1]=e.y*n[3*o+1],a[3*o+2]=e.z*n[3*o+2];return t}solve(e,t){t===void 0&&(t=new te);const n=3,a=4,o=[];let c,I;for(c=0;c<n*a;c++)o.push(0);for(c=0;c<3;c++)for(I=0;I<3;I++)o[c+a*I]=this.elements[c+3*I];o[3+4*0]=e.x,o[3+4*1]=e.y,o[3+4*2]=e.z;let C=3;const d=C;let f;const b=4;let v;do{if(c=d-C,o[c+a*c]===0){for(I=c+1;I<d;I++)if(o[c+a*I]!==0){f=b;do v=b-f,o[v+a*c]+=o[v+a*I];while(--f);break}}if(o[c+a*c]!==0)for(I=c+1;I<d;I++){const y=o[c+a*I]/o[c+a*c];f=b;do v=b-f,o[v+a*I]=v<=c?0:o[v+a*I]-o[v+a*c]*y;while(--f)}}while(--C);if(t.z=o[2*a+3]/o[2*a+2],t.y=(o[1*a+3]-o[1*a+2]*t.z)/o[1*a+1],t.x=(o[0*a+3]-o[0*a+2]*t.z-o[0*a+1]*t.y)/o[0*a+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e){e===void 0&&(e=new CI);const t=3,n=6,a=VO;let o,c;for(o=0;o<3;o++)for(c=0;c<3;c++)a[o+n*c]=this.elements[o+3*c];a[3+6*0]=1,a[3+6*1]=0,a[3+6*2]=0,a[4+6*0]=0,a[4+6*1]=1,a[4+6*2]=0,a[5+6*0]=0,a[5+6*1]=0,a[5+6*2]=1;let I=3;const C=I;let d;const f=n;let b;do{if(o=C-I,a[o+n*o]===0){for(c=o+1;c<C;c++)if(a[o+n*c]!==0){d=f;do b=f-d,a[b+n*o]+=a[b+n*c];while(--d);break}}if(a[o+n*o]!==0)for(c=o+1;c<C;c++){const v=a[o+n*c]/a[o+n*o];d=f;do b=f-d,a[b+n*c]=b<=o?0:a[b+n*c]-a[b+n*o]*v;while(--d)}}while(--I);o=2;do{c=o-1;do{const v=a[o+n*c]/a[o+n*o];d=n;do b=n-d,a[b+n*c]=a[b+n*c]-a[b+n*o]*v;while(--d)}while(c--)}while(--o);o=2;do{const v=1/a[o+n*o];d=n;do b=n-d,a[b+n*o]=a[b+n*o]*v;while(--d)}while(o--);o=2;do{c=2;do{if(b=a[t+c+n*o],isNaN(b)||b===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(o,c,b)}while(c--)}while(o--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,a=e.z,o=e.w,c=t+t,I=n+n,C=a+a,d=t*c,f=t*I,b=t*C,v=n*I,y=n*C,Z=a*C,V=o*c,R=o*I,S=o*C,N=this.elements;return N[3*0+0]=1-(v+Z),N[3*0+1]=f-S,N[3*0+2]=b+R,N[3*1+0]=f+S,N[3*1+1]=1-(d+Z),N[3*1+2]=y-V,N[3*2+0]=b-R,N[3*2+1]=y+V,N[3*2+2]=1-(d+v),this}transpose(e){e===void 0&&(e=new CI);const t=this.elements,n=e.elements;let a;return n[0]=t[0],n[4]=t[4],n[8]=t[8],a=t[1],n[1]=t[3],n[3]=a,a=t[2],n[2]=t[6],n[6]=a,a=t[5],n[5]=t[7],n[7]=a,e}}const VO=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class te{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new te);const n=e.x,a=e.y,o=e.z,c=this.x,I=this.y,C=this.z;return t.x=I*o-C*a,t.y=C*n-c*o,t.z=c*a-I*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new te(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new te(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new CI([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,a=Math.sqrt(e*e+t*t+n*n);if(a>0){const o=1/a;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return a}unit(e){e===void 0&&(e=new te);const t=this.x,n=this.y,a=this.z;let o=Math.sqrt(t*t+n*n+a*a);return o>0?(o=1/o,e.x=t*o,e.y=n*o,e.z=a*o):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,a=this.z,o=e.x,c=e.y,I=e.z;return Math.sqrt((o-t)*(o-t)+(c-n)*(c-n)+(I-a)*(I-a))}distanceSquared(e){const t=this.x,n=this.y,a=this.z,o=e.x,c=e.y,I=e.z;return(o-t)*(o-t)+(c-n)*(c-n)+(I-a)*(I-a)}scale(e,t){t===void 0&&(t=new te);const n=this.x,a=this.y,o=this.z;return t.x=e*n,t.y=e*a,t.z=e*o,t}vmul(e,t){return t===void 0&&(t=new te),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new te),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new te),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const a=NO,o=1/n;a.set(this.x*o,this.y*o,this.z*o);const c=XO;Math.abs(a.x)<.9?(c.set(1,0,0),a.cross(c,e)):(c.set(0,1,0),a.cross(c,e)),a.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const a=this.x,o=this.y,c=this.z;n.x=a+(e.x-a)*t,n.y=o+(e.y-o)*t,n.z=c+(e.z-c)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(NH),NH.almostEquals(e,t)}clone(){return new te(this.x,this.y,this.z)}}te.ZERO=new te(0,0,0);te.UNIT_X=new te(1,0,0);te.UNIT_Y=new te(0,1,0);te.UNIT_Z=new te(0,0,1);const NO=new te,XO=new te,NH=new te;class Ll{constructor(e){e===void 0&&(e={}),this.lowerBound=new te,this.upperBound=new te,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,a){const o=this.lowerBound,c=this.upperBound,I=n;o.copy(e[0]),I&&I.vmult(o,o),c.copy(o);for(let C=1;C<e.length;C++){let d=e[C];I&&(I.vmult(d,XH),d=XH),d.x>c.x&&(c.x=d.x),d.x<o.x&&(o.x=d.x),d.y>c.y&&(c.y=d.y),d.y<o.y&&(o.y=d.y),d.z>c.z&&(c.z=d.z),d.z<o.z&&(o.z=d.z)}return t&&(t.vadd(o,o),t.vadd(c,c)),a&&(o.x-=a,o.y-=a,o.z-=a,c.x+=a,c.y+=a,c.z+=a),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new Ll().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,a=e.lowerBound,o=e.upperBound,c=a.x<=n.x&&n.x<=o.x||t.x<=o.x&&o.x<=n.x,I=a.y<=n.y&&n.y<=o.y||t.y<=o.y&&o.y<=n.y,C=a.z<=n.z&&n.z<=o.z||t.z<=o.z&&o.z<=n.z;return c&&I&&C}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,a=e.lowerBound,o=e.upperBound;return t.x<=a.x&&n.x>=o.x&&t.y<=a.y&&n.y>=o.y&&t.z<=a.z&&n.z>=o.z}getCorners(e,t,n,a,o,c,I,C){const d=this.lowerBound,f=this.upperBound;e.copy(d),t.set(f.x,d.y,d.z),n.set(f.x,f.y,d.z),a.set(d.x,f.y,f.z),o.set(f.x,d.y,f.z),c.set(d.x,f.y,d.z),I.set(d.x,d.y,f.z),C.copy(f)}toLocalFrame(e,t){const n=YH,a=n[0],o=n[1],c=n[2],I=n[3],C=n[4],d=n[5],f=n[6],b=n[7];this.getCorners(a,o,c,I,C,d,f,b);for(let v=0;v!==8;v++){const y=n[v];e.pointToLocal(y,y)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=YH,a=n[0],o=n[1],c=n[2],I=n[3],C=n[4],d=n[5],f=n[6],b=n[7];this.getCorners(a,o,c,I,C,d,f,b);for(let v=0;v!==8;v++){const y=n[v];e.pointToWorld(y,y)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,a=1/t.x,o=1/t.y,c=1/t.z,I=(this.lowerBound.x-n.x)*a,C=(this.upperBound.x-n.x)*a,d=(this.lowerBound.y-n.y)*o,f=(this.upperBound.y-n.y)*o,b=(this.lowerBound.z-n.z)*c,v=(this.upperBound.z-n.z)*c,y=Math.max(Math.max(Math.min(I,C),Math.min(d,f)),Math.min(b,v)),Z=Math.min(Math.min(Math.max(I,C),Math.max(d,f)),Math.max(b,v));return!(Z<0||y>Z)}}const XH=new te,YH=[new te,new te,new te,new te,new te,new te,new te,new te];class _o{constructor(e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),a===void 0&&(a=1),this.x=e,this.y=t,this.z=n,this.w=a}set(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new te),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=YO,a=MO;e.tangents(n,a),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new _o);const n=this.x,a=this.y,o=this.z,c=this.w,I=e.x,C=e.y,d=e.z,f=e.w;return t.x=n*f+c*I+a*d-o*C,t.y=a*f+c*C+o*I-n*d,t.z=o*f+c*d+n*C-a*I,t.w=c*f-n*I-a*C-o*d,t}inverse(e){e===void 0&&(e=new _o);const t=this.x,n=this.y,a=this.z,o=this.w;this.conjugate(e);const c=1/(t*t+n*n+a*a+o*o);return e.x*=c,e.y*=c,e.z*=c,e.w*=c,e}conjugate(e){return e===void 0&&(e=new _o),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new te);const n=e.x,a=e.y,o=e.z,c=this.x,I=this.y,C=this.z,d=this.w,f=d*n+I*o-C*a,b=d*a+C*n-c*o,v=d*o+c*a-I*n,y=-c*n-I*a-C*o;return t.x=f*d+y*-c+b*-C-v*-I,t.y=b*d+y*-I+v*-c-f*-C,t.z=v*d+y*-C+f*-I-b*-c,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,a,o;const c=this.x,I=this.y,C=this.z,d=this.w;switch(t){case"YZX":const f=c*I+C*d;if(f>.499&&(n=2*Math.atan2(c,d),a=Math.PI/2,o=0),f<-.499&&(n=-2*Math.atan2(c,d),a=-Math.PI/2,o=0),n===void 0){const b=c*c,v=I*I,y=C*C;n=Math.atan2(2*I*d-2*c*C,1-2*v-2*y),a=Math.asin(2*f),o=Math.atan2(2*c*d-2*I*C,1-2*b-2*y)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=a,e.x=o}setFromEuler(e,t,n,a){a===void 0&&(a="XYZ");const o=Math.cos(e/2),c=Math.cos(t/2),I=Math.cos(n/2),C=Math.sin(e/2),d=Math.sin(t/2),f=Math.sin(n/2);return a==="XYZ"?(this.x=C*c*I+o*d*f,this.y=o*d*I-C*c*f,this.z=o*c*f+C*d*I,this.w=o*c*I-C*d*f):a==="YXZ"?(this.x=C*c*I+o*d*f,this.y=o*d*I-C*c*f,this.z=o*c*f-C*d*I,this.w=o*c*I+C*d*f):a==="ZXY"?(this.x=C*c*I-o*d*f,this.y=o*d*I+C*c*f,this.z=o*c*f+C*d*I,this.w=o*c*I-C*d*f):a==="ZYX"?(this.x=C*c*I-o*d*f,this.y=o*d*I+C*c*f,this.z=o*c*f-C*d*I,this.w=o*c*I+C*d*f):a==="YZX"?(this.x=C*c*I+o*d*f,this.y=o*d*I+C*c*f,this.z=o*c*f-C*d*I,this.w=o*c*I-C*d*f):a==="XZY"&&(this.x=C*c*I-o*d*f,this.y=o*d*I-C*c*f,this.z=o*c*f+C*d*I,this.w=o*c*I+C*d*f),this}clone(){return new _o(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new _o);const a=this.x,o=this.y,c=this.z,I=this.w;let C=e.x,d=e.y,f=e.z,b=e.w,v,y,Z,V,R;return y=a*C+o*d+c*f+I*b,y<0&&(y=-y,C=-C,d=-d,f=-f,b=-b),1-y>1e-6?(v=Math.acos(y),Z=Math.sin(v),V=Math.sin((1-t)*v)/Z,R=Math.sin(t*v)/Z):(V=1-t,R=t),n.x=V*a+R*C,n.y=V*o+R*d,n.z=V*c+R*f,n.w=V*I+R*b,n}integrate(e,t,n,a){a===void 0&&(a=new _o);const o=e.x*n.x,c=e.y*n.y,I=e.z*n.z,C=this.x,d=this.y,f=this.z,b=this.w,v=t*.5;return a.x+=v*(o*b+c*f-I*d),a.y+=v*(c*b+I*C-o*f),a.z+=v*(I*b+o*d-c*C),a.w+=v*(-o*C-c*d-I*f),a}}const YO=new te,MO=new te,HO={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class hn{constructor(e){e===void 0&&(e={}),this.id=hn.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,a){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}hn.idCounter=0;hn.types=HO;class yr{constructor(e){e===void 0&&(e={}),this.position=new te,this.quaternion=new _o,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return yr.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return yr.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new te),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,a){return a===void 0&&(a=new te),n.vsub(e,a),t.conjugate(MH),MH.vmult(a,a),a}static pointToWorldFrame(e,t,n,a){return a===void 0&&(a=new te),t.vmult(n,a),a.vadd(e,a),a}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new te),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,a){return a===void 0&&(a=new te),t.w*=-1,t.vmult(n,a),t.w*=-1,a}}const MH=new _o;new te;new te;new te;new te;new te,new te,new te,new te,new te,new te,new te,new te;new te;new _o;new Ll;new CI;new CI;new CI;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new _o;new te;new te;new te;new te;class HN{constructor(){this.rayFromWorld=new te,this.rayToWorld=new te,this.hitNormalWorld=new te,this.hitPointWorld=new te,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,a,o,c,I){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(a),this.shape=o,this.body=c,this.distance=I}}let eT,tT,nT,iT,aT,sT,oT;const F2={CLOSEST:1,ANY:2,ALL:4};eT=hn.types.SPHERE;tT=hn.types.PLANE;nT=hn.types.BOX;iT=hn.types.CYLINDER;aT=hn.types.CONVEXPOLYHEDRON;sT=hn.types.HEIGHTFIELD;oT=hn.types.TRIMESH;class vo{get[eT](){return this._intersectSphere}get[tT](){return this._intersectPlane}get[nT](){return this._intersectBox}get[iT](){return this._intersectConvex}get[aT](){return this._intersectConvex}get[sT](){return this._intersectHeightfield}get[oT](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new te),t===void 0&&(t=new te),this.from=e.clone(),this.to=t.clone(),this.direction=new te,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=vo.ANY,this.result=new HN,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||vo.ANY,this.result=t.result||new HN,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(HH),XV.length=0,e.broadphase.aabbQuery(e,HH,XV),this.intersectBodies(XV),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const a=FO,o=KO;for(let c=0,I=e.shapes.length;c<I;c++){const C=e.shapes[c];if(!(n&&!C.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[c],o),e.quaternion.vmult(e.shapeOffsets[c],a),a.vadd(e.position,a),this.intersectShape(C,o,a,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,a=e.length;!this.result.shouldStop&&n<a;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,a){const o=this.from;if(qO(o,this.direction,n)>e.boundingSphereRadius)return;const I=this[e.type];I&&I.call(this,e,t,n,a,e)}_intersectBox(e,t,n,a,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,a,o)}_intersectPlane(e,t,n,a,o){const c=this.from,I=this.to,C=this.direction,d=new te(0,0,1);t.vmult(d,d);const f=new te;c.vsub(n,f);const b=f.dot(d);I.vsub(n,f);const v=f.dot(d);if(b*v>0||c.distanceTo(I)<b)return;const y=d.dot(C);if(Math.abs(y)<this.precision)return;const Z=new te,V=new te,R=new te;c.vsub(n,Z);const S=-d.dot(Z)/y;C.scale(S,V),c.vadd(V,R),this.reportIntersection(d,R,o,a,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,a=this.to,o=this.from;t.x=Math.min(a.x,o.x),t.y=Math.min(a.y,o.y),t.z=Math.min(a.z,o.z),n.x=Math.max(a.x,o.x),n.y=Math.max(a.y,o.y),n.z=Math.max(a.z,o.z)}_intersectHeightfield(e,t,n,a,o){e.data,e.elementSize;const c=EO;c.from.copy(this.from),c.to.copy(this.to),yr.pointToLocalFrame(n,t,c.from,c.from),yr.pointToLocalFrame(n,t,c.to,c.to),c.updateDirection();const I=TO;let C,d,f,b;C=d=0,f=b=e.data.length-1;const v=new Ll;c.getAABB(v),e.getIndexOfPosition(v.lowerBound.x,v.lowerBound.y,I,!0),C=Math.max(C,I[0]),d=Math.max(d,I[1]),e.getIndexOfPosition(v.upperBound.x,v.upperBound.y,I,!0),f=Math.min(f,I[0]+1),b=Math.min(b,I[1]+1);for(let y=C;y<f;y++)for(let Z=d;Z<b;Z++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(y,Z,v),!!v.overlapsRay(c)){if(e.getConvexTrianglePillar(y,Z,!1),yr.pointToWorldFrame(n,t,e.pillarOffset,kS),this._intersectConvex(e.pillarConvex,t,kS,a,o,FH),this.result.shouldStop)return;e.getConvexTrianglePillar(y,Z,!0),yr.pointToWorldFrame(n,t,e.pillarOffset,kS),this._intersectConvex(e.pillarConvex,t,kS,a,o,FH)}}}_intersectSphere(e,t,n,a,o){const c=this.from,I=this.to,C=e.radius,d=(I.x-c.x)**2+(I.y-c.y)**2+(I.z-c.z)**2,f=2*((I.x-c.x)*(c.x-n.x)+(I.y-c.y)*(c.y-n.y)+(I.z-c.z)*(c.z-n.z)),b=(c.x-n.x)**2+(c.y-n.y)**2+(c.z-n.z)**2-C**2,v=f**2-4*d*b,y=zO,Z=LO;if(!(v<0))if(v===0)c.lerp(I,v,y),y.vsub(n,Z),Z.normalize(),this.reportIntersection(Z,y,o,a,-1);else{const V=(-f-Math.sqrt(v))/(2*d),R=(-f+Math.sqrt(v))/(2*d);if(V>=0&&V<=1&&(c.lerp(I,V,y),y.vsub(n,Z),Z.normalize(),this.reportIntersection(Z,y,o,a,-1)),this.result.shouldStop)return;R>=0&&R<=1&&(c.lerp(I,R,y),y.vsub(n,Z),Z.normalize(),this.reportIntersection(Z,y,o,a,-1))}}_intersectConvex(e,t,n,a,o,c){const I=_O,C=KH,d=c&&c.faceList||null,f=e.faces,b=e.vertices,v=e.faceNormals,y=this.direction,Z=this.from,V=this.to,R=Z.distanceTo(V),S=d?d.length:f.length,N=this.result;for(let w=0;!N.shouldStop&&w<S;w++){const X=d?d[w]:w,H=f[X],F=v[X],_=t,P=n;C.copy(b[H[0]]),_.vmult(C,C),C.vadd(P,C),C.vsub(Z,C),_.vmult(F,I);const K=y.dot(I);if(Math.abs(K)<this.precision)continue;const E=I.dot(C)/K;if(!(E<0)){y.scale(E,mr),mr.vadd(Z,mr),Ng.copy(b[H[0]]),_.vmult(Ng,Ng),P.vadd(Ng,Ng);for(let ee=1;!N.shouldStop&&ee<H.length-1;ee++){Xc.copy(b[H[ee]]),Yc.copy(b[H[ee+1]]),_.vmult(Xc,Xc),_.vmult(Yc,Yc),P.vadd(Xc,Xc),P.vadd(Yc,Yc);const Ie=mr.distanceTo(Z);!(vo.pointInTriangle(mr,Ng,Xc,Yc)||vo.pointInTriangle(mr,Xc,Ng,Yc))||Ie>R||this.reportIntersection(I,mr,o,a,X)}}}}_intersectTrimesh(e,t,n,a,o,c){const I=kO,C=QO,d=jO,f=KH,b=UO,v=DO,y=JO,Z=PO,V=OO,R=e.indices;e.vertices;const S=this.from,N=this.to,w=this.direction;d.position.copy(n),d.quaternion.copy(t),yr.vectorToLocalFrame(n,t,w,b),yr.pointToLocalFrame(n,t,S,v),yr.pointToLocalFrame(n,t,N,y),y.x*=e.scale.x,y.y*=e.scale.y,y.z*=e.scale.z,v.x*=e.scale.x,v.y*=e.scale.y,v.z*=e.scale.z,y.vsub(v,b),b.normalize();const X=v.distanceSquared(y);e.tree.rayQuery(this,d,C);for(let H=0,F=C.length;!this.result.shouldStop&&H!==F;H++){const _=C[H];e.getNormal(_,I),e.getVertex(R[_*3],Ng),Ng.vsub(v,f);const P=b.dot(I),K=I.dot(f)/P;if(K<0)continue;b.scale(K,mr),mr.vadd(v,mr),e.getVertex(R[_*3+1],Xc),e.getVertex(R[_*3+2],Yc);const E=mr.distanceSquared(v);!(vo.pointInTriangle(mr,Xc,Ng,Yc)||vo.pointInTriangle(mr,Ng,Xc,Yc))||E>X||(yr.vectorToWorldFrame(t,I,V),yr.pointToWorldFrame(n,t,mr,Z),this.reportIntersection(V,Z,o,a,_))}C.length=0}reportIntersection(e,t,n,a,o){const c=this.from,I=this.to,C=c.distanceTo(t),d=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(d.hitFaceIndex=typeof o<"u"?o:-1,this.mode){case vo.ALL:this.hasHit=!0,d.set(c,I,e,t,n,a,C),d.hasHit=!0,this.callback(d);break;case vo.CLOSEST:(C<d.distance||!d.hasHit)&&(this.hasHit=!0,d.hasHit=!0,d.set(c,I,e,t,n,a,C));break;case vo.ANY:this.hasHit=!0,d.hasHit=!0,d.set(c,I,e,t,n,a,C),d.shouldStop=!0;break}}static pointInTriangle(e,t,n,a){a.vsub(t,mA),n.vsub(t,y0),e.vsub(t,YV);const o=mA.dot(mA),c=mA.dot(y0),I=mA.dot(YV),C=y0.dot(y0),d=y0.dot(YV);let f,b;return(f=C*I-c*d)>=0&&(b=o*d-c*I)>=0&&f+b<o*C-c*c}}vo.CLOSEST=F2.CLOSEST;vo.ANY=F2.ANY;vo.ALL=F2.ALL;const HH=new Ll,XV=[],y0=new te,YV=new te,FO=new te,KO=new _o,mr=new te,Ng=new te,Xc=new te,Yc=new te;new te;new HN;const FH={faceList:[0]},kS=new te,EO=new vo,TO=[],zO=new te,LO=new te,_O=new te;new te;new te;const KH=new te,kO=new te,UO=new te,DO=new te,JO=new te,OO=new te,PO=new te;new Ll;const QO=[],jO=new yr,mA=new te,US=new te;function qO(r,e,t){t.vsub(r,mA);const n=mA.dot(e);return e.scale(n,US),US.vadd(r,US),t.distanceTo(US)}new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new vo;new te;new te;new te;new te(1,0,0),new te(0,1,0),new te(0,0,1);new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new Ll;new te;new Ll;new te;new te;new te;new te;new te;new te;new te;new Ll;new te;new yr;new Ll;hn.types.SPHERE,hn.types.SPHERE|hn.types.PLANE,hn.types.BOX|hn.types.BOX,hn.types.SPHERE|hn.types.BOX,hn.types.PLANE|hn.types.BOX,hn.types.CONVEXPOLYHEDRON,hn.types.SPHERE|hn.types.CONVEXPOLYHEDRON,hn.types.PLANE|hn.types.CONVEXPOLYHEDRON,hn.types.BOX|hn.types.CONVEXPOLYHEDRON,hn.types.SPHERE|hn.types.HEIGHTFIELD,hn.types.BOX|hn.types.HEIGHTFIELD,hn.types.CONVEXPOLYHEDRON|hn.types.HEIGHTFIELD,hn.types.PARTICLE|hn.types.SPHERE,hn.types.PLANE|hn.types.PARTICLE,hn.types.BOX|hn.types.PARTICLE,hn.types.PARTICLE|hn.types.CONVEXPOLYHEDRON,hn.types.CYLINDER,hn.types.SPHERE|hn.types.CYLINDER,hn.types.PLANE|hn.types.CYLINDER,hn.types.BOX|hn.types.CYLINDER,hn.types.CONVEXPOLYHEDRON|hn.types.CYLINDER,hn.types.HEIGHTFIELD|hn.types.CYLINDER,hn.types.PARTICLE|hn.types.CYLINDER,hn.types.SPHERE|hn.types.TRIMESH,hn.types.PLANE|hn.types.TRIMESH;new te;new te;new te;new te;new te;new _o;new _o;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new Ll;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te,new te,new te,new te,new te,new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new te;new _o;new te;new te;new te;new te;new te;new te;new te;new te;new te;new Ll;new vo;const G0=globalThis.performance||{};if(!G0.now){let r=Date.now();G0.timing&&G0.timing.navigationStart&&(r=G0.timing.navigationStart),G0.now=()=>Date.now()-r}new te;class hI{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new ne);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new ne);const n=this.elements,a=e.x,o=e.y,c=e.z;return t.x=n[0]*a+n[1]*o+n[2]*c,t.y=n[3]*a+n[4]*o+n[5]*c,t.z=n[6]*a+n[7]*o+n[8]*c,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new hI);const n=this.elements,a=e.elements,o=t.elements,c=n[0],I=n[1],C=n[2],d=n[3],f=n[4],b=n[5],v=n[6],y=n[7],Z=n[8],V=a[0],R=a[1],S=a[2],N=a[3],w=a[4],X=a[5],H=a[6],F=a[7],_=a[8];return o[0]=c*V+I*N+C*H,o[1]=c*R+I*w+C*F,o[2]=c*S+I*X+C*_,o[3]=d*V+f*N+b*H,o[4]=d*R+f*w+b*F,o[5]=d*S+f*X+b*_,o[6]=v*V+y*N+Z*H,o[7]=v*R+y*w+Z*F,o[8]=v*S+y*X+Z*_,t}scale(e,t){t===void 0&&(t=new hI);const n=this.elements,a=t.elements;for(let o=0;o!==3;o++)a[3*o+0]=e.x*n[3*o+0],a[3*o+1]=e.y*n[3*o+1],a[3*o+2]=e.z*n[3*o+2];return t}solve(e,t){t===void 0&&(t=new ne);const n=3,a=4,o=[];let c,I;for(c=0;c<n*a;c++)o.push(0);for(c=0;c<3;c++)for(I=0;I<3;I++)o[c+a*I]=this.elements[c+3*I];o[3+4*0]=e.x,o[3+4*1]=e.y,o[3+4*2]=e.z;let C=3;const d=C;let f;const b=4;let v;do{if(c=d-C,o[c+a*c]===0){for(I=c+1;I<d;I++)if(o[c+a*I]!==0){f=b;do v=b-f,o[v+a*c]+=o[v+a*I];while(--f);break}}if(o[c+a*c]!==0)for(I=c+1;I<d;I++){const y=o[c+a*I]/o[c+a*c];f=b;do v=b-f,o[v+a*I]=v<=c?0:o[v+a*I]-o[v+a*c]*y;while(--f)}}while(--C);if(t.z=o[2*a+3]/o[2*a+2],t.y=(o[1*a+3]-o[1*a+2]*t.z)/o[1*a+1],t.x=(o[0*a+3]-o[0*a+2]*t.z-o[0*a+1]*t.y)/o[0*a+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e){e===void 0&&(e=new hI);const t=3,n=6,a=$O;let o,c;for(o=0;o<3;o++)for(c=0;c<3;c++)a[o+n*c]=this.elements[o+3*c];a[3+6*0]=1,a[3+6*1]=0,a[3+6*2]=0,a[4+6*0]=0,a[4+6*1]=1,a[4+6*2]=0,a[5+6*0]=0,a[5+6*1]=0,a[5+6*2]=1;let I=3;const C=I;let d;const f=n;let b;do{if(o=C-I,a[o+n*o]===0){for(c=o+1;c<C;c++)if(a[o+n*c]!==0){d=f;do b=f-d,a[b+n*o]+=a[b+n*c];while(--d);break}}if(a[o+n*o]!==0)for(c=o+1;c<C;c++){const v=a[o+n*c]/a[o+n*o];d=f;do b=f-d,a[b+n*c]=b<=o?0:a[b+n*c]-a[b+n*o]*v;while(--d)}}while(--I);o=2;do{c=o-1;do{const v=a[o+n*c]/a[o+n*o];d=n;do b=n-d,a[b+n*c]=a[b+n*c]-a[b+n*o]*v;while(--d)}while(c--)}while(--o);o=2;do{const v=1/a[o+n*o];d=n;do b=n-d,a[b+n*o]=a[b+n*o]*v;while(--d)}while(o--);o=2;do{c=2;do{if(b=a[t+c+n*o],isNaN(b)||b===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(o,c,b)}while(c--)}while(o--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,a=e.z,o=e.w,c=t+t,I=n+n,C=a+a,d=t*c,f=t*I,b=t*C,v=n*I,y=n*C,Z=a*C,V=o*c,R=o*I,S=o*C,N=this.elements;return N[3*0+0]=1-(v+Z),N[3*0+1]=f-S,N[3*0+2]=b+R,N[3*1+0]=f+S,N[3*1+1]=1-(d+Z),N[3*1+2]=y-V,N[3*2+0]=b-R,N[3*2+1]=y+V,N[3*2+2]=1-(d+v),this}transpose(e){e===void 0&&(e=new hI);const t=this.elements,n=e.elements;let a;return n[0]=t[0],n[4]=t[4],n[8]=t[8],a=t[1],n[1]=t[3],n[3]=a,a=t[2],n[2]=t[6],n[6]=a,a=t[5],n[5]=t[7],n[7]=a,e}}const $O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class ne{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new ne);const n=e.x,a=e.y,o=e.z,c=this.x,I=this.y,C=this.z;return t.x=I*o-C*a,t.y=C*n-c*o,t.z=c*a-I*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new ne(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new ne(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new hI([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,a=Math.sqrt(e*e+t*t+n*n);if(a>0){const o=1/a;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return a}unit(e){e===void 0&&(e=new ne);const t=this.x,n=this.y,a=this.z;let o=Math.sqrt(t*t+n*n+a*a);return o>0?(o=1/o,e.x=t*o,e.y=n*o,e.z=a*o):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,a=this.z,o=e.x,c=e.y,I=e.z;return Math.sqrt((o-t)*(o-t)+(c-n)*(c-n)+(I-a)*(I-a))}distanceSquared(e){const t=this.x,n=this.y,a=this.z,o=e.x,c=e.y,I=e.z;return(o-t)*(o-t)+(c-n)*(c-n)+(I-a)*(I-a)}scale(e,t){t===void 0&&(t=new ne);const n=this.x,a=this.y,o=this.z;return t.x=e*n,t.y=e*a,t.z=e*o,t}vmul(e,t){return t===void 0&&(t=new ne),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new ne),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new ne),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const a=eP,o=1/n;a.set(this.x*o,this.y*o,this.z*o);const c=tP;Math.abs(a.x)<.9?(c.set(1,0,0),a.cross(c,e)):(c.set(0,1,0),a.cross(c,e)),a.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const a=this.x,o=this.y,c=this.z;n.x=a+(e.x-a)*t,n.y=o+(e.y-o)*t,n.z=c+(e.z-c)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(EH),EH.almostEquals(e,t)}clone(){return new ne(this.x,this.y,this.z)}}ne.ZERO=new ne(0,0,0);ne.UNIT_X=new ne(1,0,0);ne.UNIT_Y=new ne(0,1,0);ne.UNIT_Z=new ne(0,0,1);const eP=new ne,tP=new ne,EH=new ne;class _l{constructor(e){e===void 0&&(e={}),this.lowerBound=new ne,this.upperBound=new ne,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,a){const o=this.lowerBound,c=this.upperBound,I=n;o.copy(e[0]),I&&I.vmult(o,o),c.copy(o);for(let C=1;C<e.length;C++){let d=e[C];I&&(I.vmult(d,TH),d=TH),d.x>c.x&&(c.x=d.x),d.x<o.x&&(o.x=d.x),d.y>c.y&&(c.y=d.y),d.y<o.y&&(o.y=d.y),d.z>c.z&&(c.z=d.z),d.z<o.z&&(o.z=d.z)}return t&&(t.vadd(o,o),t.vadd(c,c)),a&&(o.x-=a,o.y-=a,o.z-=a,c.x+=a,c.y+=a,c.z+=a),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new _l().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,a=e.lowerBound,o=e.upperBound,c=a.x<=n.x&&n.x<=o.x||t.x<=o.x&&o.x<=n.x,I=a.y<=n.y&&n.y<=o.y||t.y<=o.y&&o.y<=n.y,C=a.z<=n.z&&n.z<=o.z||t.z<=o.z&&o.z<=n.z;return c&&I&&C}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,a=e.lowerBound,o=e.upperBound;return t.x<=a.x&&n.x>=o.x&&t.y<=a.y&&n.y>=o.y&&t.z<=a.z&&n.z>=o.z}getCorners(e,t,n,a,o,c,I,C){const d=this.lowerBound,f=this.upperBound;e.copy(d),t.set(f.x,d.y,d.z),n.set(f.x,f.y,d.z),a.set(d.x,f.y,f.z),o.set(f.x,d.y,f.z),c.set(d.x,f.y,d.z),I.set(d.x,d.y,f.z),C.copy(f)}toLocalFrame(e,t){const n=zH,a=n[0],o=n[1],c=n[2],I=n[3],C=n[4],d=n[5],f=n[6],b=n[7];this.getCorners(a,o,c,I,C,d,f,b);for(let v=0;v!==8;v++){const y=n[v];e.pointToLocal(y,y)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=zH,a=n[0],o=n[1],c=n[2],I=n[3],C=n[4],d=n[5],f=n[6],b=n[7];this.getCorners(a,o,c,I,C,d,f,b);for(let v=0;v!==8;v++){const y=n[v];e.pointToWorld(y,y)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,a=1/t.x,o=1/t.y,c=1/t.z,I=(this.lowerBound.x-n.x)*a,C=(this.upperBound.x-n.x)*a,d=(this.lowerBound.y-n.y)*o,f=(this.upperBound.y-n.y)*o,b=(this.lowerBound.z-n.z)*c,v=(this.upperBound.z-n.z)*c,y=Math.max(Math.max(Math.min(I,C),Math.min(d,f)),Math.min(b,v)),Z=Math.min(Math.min(Math.max(I,C),Math.max(d,f)),Math.max(b,v));return!(Z<0||y>Z)}}const TH=new ne,zH=[new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne];class ko{constructor(e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),a===void 0&&(a=1),this.x=e,this.y=t,this.z=n,this.w=a}set(e,t,n,a){return this.x=e,this.y=t,this.z=n,this.w=a,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new ne),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=nP,a=iP;e.tangents(n,a),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new ko);const n=this.x,a=this.y,o=this.z,c=this.w,I=e.x,C=e.y,d=e.z,f=e.w;return t.x=n*f+c*I+a*d-o*C,t.y=a*f+c*C+o*I-n*d,t.z=o*f+c*d+n*C-a*I,t.w=c*f-n*I-a*C-o*d,t}inverse(e){e===void 0&&(e=new ko);const t=this.x,n=this.y,a=this.z,o=this.w;this.conjugate(e);const c=1/(t*t+n*n+a*a+o*o);return e.x*=c,e.y*=c,e.z*=c,e.w*=c,e}conjugate(e){return e===void 0&&(e=new ko),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new ne);const n=e.x,a=e.y,o=e.z,c=this.x,I=this.y,C=this.z,d=this.w,f=d*n+I*o-C*a,b=d*a+C*n-c*o,v=d*o+c*a-I*n,y=-c*n-I*a-C*o;return t.x=f*d+y*-c+b*-C-v*-I,t.y=b*d+y*-I+v*-c-f*-C,t.z=v*d+y*-C+f*-I-b*-c,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,a,o;const c=this.x,I=this.y,C=this.z,d=this.w;switch(t){case"YZX":const f=c*I+C*d;if(f>.499&&(n=2*Math.atan2(c,d),a=Math.PI/2,o=0),f<-.499&&(n=-2*Math.atan2(c,d),a=-Math.PI/2,o=0),n===void 0){const b=c*c,v=I*I,y=C*C;n=Math.atan2(2*I*d-2*c*C,1-2*v-2*y),a=Math.asin(2*f),o=Math.atan2(2*c*d-2*I*C,1-2*b-2*y)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=a,e.x=o}setFromEuler(e,t,n,a){a===void 0&&(a="XYZ");const o=Math.cos(e/2),c=Math.cos(t/2),I=Math.cos(n/2),C=Math.sin(e/2),d=Math.sin(t/2),f=Math.sin(n/2);return a==="XYZ"?(this.x=C*c*I+o*d*f,this.y=o*d*I-C*c*f,this.z=o*c*f+C*d*I,this.w=o*c*I-C*d*f):a==="YXZ"?(this.x=C*c*I+o*d*f,this.y=o*d*I-C*c*f,this.z=o*c*f-C*d*I,this.w=o*c*I+C*d*f):a==="ZXY"?(this.x=C*c*I-o*d*f,this.y=o*d*I+C*c*f,this.z=o*c*f+C*d*I,this.w=o*c*I-C*d*f):a==="ZYX"?(this.x=C*c*I-o*d*f,this.y=o*d*I+C*c*f,this.z=o*c*f-C*d*I,this.w=o*c*I+C*d*f):a==="YZX"?(this.x=C*c*I+o*d*f,this.y=o*d*I+C*c*f,this.z=o*c*f-C*d*I,this.w=o*c*I-C*d*f):a==="XZY"&&(this.x=C*c*I-o*d*f,this.y=o*d*I-C*c*f,this.z=o*c*f+C*d*I,this.w=o*c*I+C*d*f),this}clone(){return new ko(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new ko);const a=this.x,o=this.y,c=this.z,I=this.w;let C=e.x,d=e.y,f=e.z,b=e.w,v,y,Z,V,R;return y=a*C+o*d+c*f+I*b,y<0&&(y=-y,C=-C,d=-d,f=-f,b=-b),1-y>1e-6?(v=Math.acos(y),Z=Math.sin(v),V=Math.sin((1-t)*v)/Z,R=Math.sin(t*v)/Z):(V=1-t,R=t),n.x=V*a+R*C,n.y=V*o+R*d,n.z=V*c+R*f,n.w=V*I+R*b,n}integrate(e,t,n,a){a===void 0&&(a=new ko);const o=e.x*n.x,c=e.y*n.y,I=e.z*n.z,C=this.x,d=this.y,f=this.z,b=this.w,v=t*.5;return a.x+=v*(o*b+c*f-I*d),a.y+=v*(c*b+I*C-o*f),a.z+=v*(I*b+o*d-c*C),a.w+=v*(-o*C-c*d-I*f),a}}const nP=new ne,iP=new ne,aP={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class An{constructor(e){e===void 0&&(e={}),this.id=An.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,a){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}An.idCounter=0;An.types=aP;class Gr{constructor(e){e===void 0&&(e={}),this.position=new ne,this.quaternion=new ko,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return Gr.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return Gr.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new ne),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,a){return a===void 0&&(a=new ne),n.vsub(e,a),t.conjugate(LH),LH.vmult(a,a),a}static pointToWorldFrame(e,t,n,a){return a===void 0&&(a=new ne),t.vmult(n,a),a.vadd(e,a),a}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new ne),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,a){return a===void 0&&(a=new ne),t.w*=-1,t.vmult(n,a),t.w*=-1,a}}const LH=new ko;new ne;new ne;new ne;new ne;new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne;new ne;new ko;new _l;new hI;new hI;new hI;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ko;new ne;new ne;new ne;new ne;class FN{constructor(){this.rayFromWorld=new ne,this.rayToWorld=new ne,this.hitNormalWorld=new ne,this.hitPointWorld=new ne,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,a,o,c,I){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(a),this.shape=o,this.body=c,this.distance=I}}let rT,lT,gT,cT,uT,IT,dT;const K2={CLOSEST:1,ANY:2,ALL:4};rT=An.types.SPHERE;lT=An.types.PLANE;gT=An.types.BOX;cT=An.types.CYLINDER;uT=An.types.CONVEXPOLYHEDRON;IT=An.types.HEIGHTFIELD;dT=An.types.TRIMESH;class yo{get[rT](){return this._intersectSphere}get[lT](){return this._intersectPlane}get[gT](){return this._intersectBox}get[cT](){return this._intersectConvex}get[uT](){return this._intersectConvex}get[IT](){return this._intersectHeightfield}get[dT](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new ne),t===void 0&&(t=new ne),this.from=e.clone(),this.to=t.clone(),this.direction=new ne,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=yo.ANY,this.result=new FN,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||yo.ANY,this.result=t.result||new FN,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(_H),MV.length=0,e.broadphase.aabbQuery(e,_H,MV),this.intersectBodies(MV),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const a=sP,o=oP;for(let c=0,I=e.shapes.length;c<I;c++){const C=e.shapes[c];if(!(n&&!C.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[c],o),e.quaternion.vmult(e.shapeOffsets[c],a),a.vadd(e.position,a),this.intersectShape(C,o,a,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,a=e.length;!this.result.shouldStop&&n<a;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,a){const o=this.from;if(bP(o,this.direction,n)>e.boundingSphereRadius)return;const I=this[e.type];I&&I.call(this,e,t,n,a,e)}_intersectBox(e,t,n,a,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,a,o)}_intersectPlane(e,t,n,a,o){const c=this.from,I=this.to,C=this.direction,d=new ne(0,0,1);t.vmult(d,d);const f=new ne;c.vsub(n,f);const b=f.dot(d);I.vsub(n,f);const v=f.dot(d);if(b*v>0||c.distanceTo(I)<b)return;const y=d.dot(C);if(Math.abs(y)<this.precision)return;const Z=new ne,V=new ne,R=new ne;c.vsub(n,Z);const S=-d.dot(Z)/y;C.scale(S,V),c.vadd(V,R),this.reportIntersection(d,R,o,a,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,a=this.to,o=this.from;t.x=Math.min(a.x,o.x),t.y=Math.min(a.y,o.y),t.z=Math.min(a.z,o.z),n.x=Math.max(a.x,o.x),n.y=Math.max(a.y,o.y),n.z=Math.max(a.z,o.z)}_intersectHeightfield(e,t,n,a,o){e.data,e.elementSize;const c=rP;c.from.copy(this.from),c.to.copy(this.to),Gr.pointToLocalFrame(n,t,c.from,c.from),Gr.pointToLocalFrame(n,t,c.to,c.to),c.updateDirection();const I=lP;let C,d,f,b;C=d=0,f=b=e.data.length-1;const v=new _l;c.getAABB(v),e.getIndexOfPosition(v.lowerBound.x,v.lowerBound.y,I,!0),C=Math.max(C,I[0]),d=Math.max(d,I[1]),e.getIndexOfPosition(v.upperBound.x,v.upperBound.y,I,!0),f=Math.min(f,I[0]+1),b=Math.min(b,I[1]+1);for(let y=C;y<f;y++)for(let Z=d;Z<b;Z++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(y,Z,v),!!v.overlapsRay(c)){if(e.getConvexTrianglePillar(y,Z,!1),Gr.pointToWorldFrame(n,t,e.pillarOffset,DS),this._intersectConvex(e.pillarConvex,t,DS,a,o,kH),this.result.shouldStop)return;e.getConvexTrianglePillar(y,Z,!0),Gr.pointToWorldFrame(n,t,e.pillarOffset,DS),this._intersectConvex(e.pillarConvex,t,DS,a,o,kH)}}}_intersectSphere(e,t,n,a,o){const c=this.from,I=this.to,C=e.radius,d=(I.x-c.x)**2+(I.y-c.y)**2+(I.z-c.z)**2,f=2*((I.x-c.x)*(c.x-n.x)+(I.y-c.y)*(c.y-n.y)+(I.z-c.z)*(c.z-n.z)),b=(c.x-n.x)**2+(c.y-n.y)**2+(c.z-n.z)**2-C**2,v=f**2-4*d*b,y=gP,Z=cP;if(!(v<0))if(v===0)c.lerp(I,v,y),y.vsub(n,Z),Z.normalize(),this.reportIntersection(Z,y,o,a,-1);else{const V=(-f-Math.sqrt(v))/(2*d),R=(-f+Math.sqrt(v))/(2*d);if(V>=0&&V<=1&&(c.lerp(I,V,y),y.vsub(n,Z),Z.normalize(),this.reportIntersection(Z,y,o,a,-1)),this.result.shouldStop)return;R>=0&&R<=1&&(c.lerp(I,R,y),y.vsub(n,Z),Z.normalize(),this.reportIntersection(Z,y,o,a,-1))}}_intersectConvex(e,t,n,a,o,c){const I=uP,C=UH,d=c&&c.faceList||null,f=e.faces,b=e.vertices,v=e.faceNormals,y=this.direction,Z=this.from,V=this.to,R=Z.distanceTo(V),S=d?d.length:f.length,N=this.result;for(let w=0;!N.shouldStop&&w<S;w++){const X=d?d[w]:w,H=f[X],F=v[X],_=t,P=n;C.copy(b[H[0]]),_.vmult(C,C),C.vadd(P,C),C.vsub(Z,C),_.vmult(F,I);const K=y.dot(I);if(Math.abs(K)<this.precision)continue;const E=I.dot(C)/K;if(!(E<0)){y.scale(E,br),br.vadd(Z,br),Xg.copy(b[H[0]]),_.vmult(Xg,Xg),P.vadd(Xg,Xg);for(let ee=1;!N.shouldStop&&ee<H.length-1;ee++){Mc.copy(b[H[ee]]),Hc.copy(b[H[ee+1]]),_.vmult(Mc,Mc),_.vmult(Hc,Hc),P.vadd(Mc,Mc),P.vadd(Hc,Hc);const Ie=br.distanceTo(Z);!(yo.pointInTriangle(br,Xg,Mc,Hc)||yo.pointInTriangle(br,Mc,Xg,Hc))||Ie>R||this.reportIntersection(I,br,o,a,X)}}}}_intersectTrimesh(e,t,n,a,o,c){const I=IP,C=pP,d=mP,f=UH,b=dP,v=CP,y=hP,Z=fP,V=AP,R=e.indices;e.vertices;const S=this.from,N=this.to,w=this.direction;d.position.copy(n),d.quaternion.copy(t),Gr.vectorToLocalFrame(n,t,w,b),Gr.pointToLocalFrame(n,t,S,v),Gr.pointToLocalFrame(n,t,N,y),y.x*=e.scale.x,y.y*=e.scale.y,y.z*=e.scale.z,v.x*=e.scale.x,v.y*=e.scale.y,v.z*=e.scale.z,y.vsub(v,b),b.normalize();const X=v.distanceSquared(y);e.tree.rayQuery(this,d,C);for(let H=0,F=C.length;!this.result.shouldStop&&H!==F;H++){const _=C[H];e.getNormal(_,I),e.getVertex(R[_*3],Xg),Xg.vsub(v,f);const P=b.dot(I),K=I.dot(f)/P;if(K<0)continue;b.scale(K,br),br.vadd(v,br),e.getVertex(R[_*3+1],Mc),e.getVertex(R[_*3+2],Hc);const E=br.distanceSquared(v);!(yo.pointInTriangle(br,Mc,Xg,Hc)||yo.pointInTriangle(br,Xg,Mc,Hc))||E>X||(Gr.vectorToWorldFrame(t,I,V),Gr.pointToWorldFrame(n,t,br,Z),this.reportIntersection(V,Z,o,a,_))}C.length=0}reportIntersection(e,t,n,a,o){const c=this.from,I=this.to,C=c.distanceTo(t),d=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(d.hitFaceIndex=typeof o<"u"?o:-1,this.mode){case yo.ALL:this.hasHit=!0,d.set(c,I,e,t,n,a,C),d.hasHit=!0,this.callback(d);break;case yo.CLOSEST:(C<d.distance||!d.hasHit)&&(this.hasHit=!0,d.hasHit=!0,d.set(c,I,e,t,n,a,C));break;case yo.ANY:this.hasHit=!0,d.hasHit=!0,d.set(c,I,e,t,n,a,C),d.shouldStop=!0;break}}static pointInTriangle(e,t,n,a){a.vsub(t,bA),n.vsub(t,B0),e.vsub(t,HV);const o=bA.dot(bA),c=bA.dot(B0),I=bA.dot(HV),C=B0.dot(B0),d=B0.dot(HV);let f,b;return(f=C*I-c*d)>=0&&(b=o*d-c*I)>=0&&f+b<o*C-c*c}}yo.CLOSEST=K2.CLOSEST;yo.ANY=K2.ANY;yo.ALL=K2.ALL;const _H=new _l,MV=[],B0=new ne,HV=new ne,sP=new ne,oP=new ko,br=new ne,Xg=new ne,Mc=new ne,Hc=new ne;new ne;new FN;const kH={faceList:[0]},DS=new ne,rP=new yo,lP=[],gP=new ne,cP=new ne,uP=new ne;new ne;new ne;const UH=new ne,IP=new ne,dP=new ne,CP=new ne,hP=new ne,AP=new ne,fP=new ne;new _l;const pP=[],mP=new Gr,bA=new ne,JS=new ne;function bP(r,e,t){t.vsub(r,bA);const n=bA.dot(e);return e.scale(n,JS),JS.vadd(r,JS),t.distanceTo(JS)}new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new yo;new ne;new ne;new ne;new ne(1,0,0),new ne(0,1,0),new ne(0,0,1);new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new _l;new ne;new _l;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new _l;new ne;new Gr;new _l;An.types.SPHERE,An.types.SPHERE|An.types.PLANE,An.types.BOX|An.types.BOX,An.types.SPHERE|An.types.BOX,An.types.PLANE|An.types.BOX,An.types.CONVEXPOLYHEDRON,An.types.SPHERE|An.types.CONVEXPOLYHEDRON,An.types.PLANE|An.types.CONVEXPOLYHEDRON,An.types.BOX|An.types.CONVEXPOLYHEDRON,An.types.SPHERE|An.types.HEIGHTFIELD,An.types.BOX|An.types.HEIGHTFIELD,An.types.CONVEXPOLYHEDRON|An.types.HEIGHTFIELD,An.types.PARTICLE|An.types.SPHERE,An.types.PLANE|An.types.PARTICLE,An.types.BOX|An.types.PARTICLE,An.types.PARTICLE|An.types.CONVEXPOLYHEDRON,An.types.CYLINDER,An.types.SPHERE|An.types.CYLINDER,An.types.PLANE|An.types.CYLINDER,An.types.BOX|An.types.CYLINDER,An.types.CONVEXPOLYHEDRON|An.types.CYLINDER,An.types.HEIGHTFIELD|An.types.CYLINDER,An.types.PARTICLE|An.types.CYLINDER,An.types.SPHERE|An.types.TRIMESH,An.types.PLANE|An.types.TRIMESH;new ne;new ne;new ne;new ne;new ne;new ko;new ko;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new _l;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne,new ne,new ne,new ne,new ne,new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ko;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new ne;new _l;new yo;const Z0=globalThis.performance||{};if(!Z0.now){let r=Date.now();Z0.timing&&Z0.timing.navigationStart&&(r=Z0.timing.navigationStart),Z0.now=()=>Date.now()-r}new ne;const vP=rt.createContext(null),yP=()=>rt.useContext(vP),CT=rt.createContext(null),GP=()=>{const r=rt.useContext(CT);if(!r)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return r};new $(1,1,1);new $;new Nn;const DH=new Ai;function BP(r){const e=rt.useRef(null);return r&&typeof r!="function"?r:e}function JH(r){return r.charAt(0).toUpperCase()+r.slice(1)}function eo(r,e){const t=e===void 0?"":`/${e}`;return typeof r=="function"?null:r&&r.current&&`${r.current.uuid}${t}`}const ZP=new gb,SP=new xs,RP=r=>e=>r(ZP.setFromQuaternion(SP.fromArray(e)).toArray());let hT=0;function FV(r,e,t,n,a,o){return o===void 0&&(o="bodies"),c=>{const I=hT++;t[I]={[n]:c};const C=eo(r,a);return C&&e.subscribe({props:{id:I,target:o,type:n},uuid:C}),()=>{delete t[I],e.unsubscribe({props:I})}}}function OH(r,e){let{position:t=[0,0,0],rotation:n=[0,0,0],userData:a={}}=e;r.userData=a,r.position.set(...t),r.rotation.set(...n),r.updateMatrix()}function PH(r,e,t){let{onCollide:n,onCollideBegin:a,onCollideEnd:o}=e;r[t]={collide:n,collideBegin:a,collideEnd:o}}function AT(r,e,t,n,a){n===void 0&&(n=null),a===void 0&&(a=[]);const o=BP(n),{events:c,refs:I,scaleOverrides:C,subscriptions:d,worker:f}=GP(),b=yP();rt.useLayoutEffect(()=>{o.current||(o.current=new Ai);const y=o.current,Z=f,V=y instanceof $m?(y.instanceMatrix.setUsage(cK),y.count):1,R=y instanceof $m?new Array(V).fill(0).map((N,w)=>`${y.uuid}/${w}`):[y.uuid],S=y instanceof $m?R.map((N,w)=>{const X=e(w);return OH(DH,X),y.setMatrixAt(w,DH.matrix),y.instanceMatrix.needsUpdate=!0,I[N]=y,b==null||b.add(N,X,r),PH(c,X,N),{...X,args:t(X.args)}}):R.map((N,w)=>{const X=e(w);return OH(y,X),I[N]=y,b==null||b.add(N,X,r),PH(c,X,N),{...X,args:t(X.args)}});return Z.addBodies({props:S.map(N=>{let{onCollide:w,onCollideBegin:X,onCollideEnd:H,...F}=N;return{onCollide:!!w,...F}}),type:r,uuid:R}),()=>{R.forEach(N=>{delete I[N],b==null||b.remove(N),delete c[N]}),Z.removeBodies({uuid:R})}},a);const v=rt.useMemo(()=>{const y=(w,X)=>{const H=`set${JH(w)}`;return{set:F=>{const _=eo(o,X);_&&f[H]({props:F,uuid:_})},subscribe:FV(o,f,d,w,X)}},Z=w=>({copy:H=>{let{w:F,x:_,y:P,z:K}=H;const E=eo(o,w);E&&f.setQuaternion({props:[_,P,K,F],uuid:E})},set:(H,F,_,P)=>{const K=eo(o,w);K&&f.setQuaternion({props:[H,F,_,P],uuid:K})},subscribe:FV(o,f,d,"quaternion",w)}),V=w=>({copy:X=>{let{x:H,y:F,z:_}=X;const P=eo(o,w);P&&f.setRotation({props:[H,F,_],uuid:P})},set:(X,H,F)=>{const _=eo(o,w);_&&f.setRotation({props:[X,H,F],uuid:_})},subscribe:X=>{const H=hT++,F="bodies",_="quaternion",P=eo(o,w);return d[H]={[_]:RP(X)},P&&f.subscribe({props:{id:H,target:F,type:_},uuid:P}),()=>{delete d[H],f.unsubscribe({props:H})}}}),R=(w,X)=>{const H=`set${JH(w)}`;return{copy:F=>{let{x:_,y:P,z:K}=F;const E=eo(o,X);E&&f[H]({props:[_,P,K],uuid:E})},set:(F,_,P)=>{const K=eo(o,X);K&&f[H]({props:[F,_,P],uuid:K})},subscribe:FV(o,f,d,w,X)}};function S(w){return{allowSleep:y("allowSleep",w),angularDamping:y("angularDamping",w),angularFactor:R("angularFactor",w),angularVelocity:R("angularVelocity",w),applyForce(X,H){const F=eo(o,w);F&&f.applyForce({props:[X,H],uuid:F})},applyImpulse(X,H){const F=eo(o,w);F&&f.applyImpulse({props:[X,H],uuid:F})},applyLocalForce(X,H){const F=eo(o,w);F&&f.applyLocalForce({props:[X,H],uuid:F})},applyLocalImpulse(X,H){const F=eo(o,w);F&&f.applyLocalImpulse({props:[X,H],uuid:F})},applyTorque(X){const H=eo(o,w);H&&f.applyTorque({props:[X],uuid:H})},collisionFilterGroup:y("collisionFilterGroup",w),collisionFilterMask:y("collisionFilterMask",w),collisionResponse:y("collisionResponse",w),fixedRotation:y("fixedRotation",w),isTrigger:y("isTrigger",w),linearDamping:y("linearDamping",w),linearFactor:R("linearFactor",w),mass:y("mass",w),material:y("material",w),position:R("position",w),quaternion:Z(w),rotation:V(w),scaleOverride(X){const H=eo(o,w);H&&(C[H]=new $(...X))},sleep(){const X=eo(o,w);X&&f.sleep({uuid:X})},sleepSpeedLimit:y("sleepSpeedLimit",w),sleepTimeLimit:y("sleepTimeLimit",w),userData:y("userData",w),velocity:R("velocity",w),wakeUp(){const X=eo(o,w);X&&f.wakeUp({uuid:X})}}}const N={};return{...S(void 0),at:w=>N[w]||(N[w]=S(w))}},[]);return[o,v]}function wP(r,e,t){return AT("Plane",r,()=>[],e,t)}function WP(r,e,t){const n=[1,1,1];return AT("Box",r,function(a){return a===void 0&&(a=n),a},e,t)}const xP=new $,VP=new $(1,1,1),NP=new xs,OS=new Nn;function QH(r,e,t,n,a){return n===void 0&&(n=VP),r!==void 0?(OS.compose(xP.fromArray(e,r*3),NP.fromArray(t,r*4),n),a&&(a.matrixAutoUpdate=!1,a.matrix.copy(OS)),OS):OS.identity()}const XP=()=>{const r=[];return e=>r.includes(e)?!1:!!r.push(e)};function YP(r){let{allowSleep:e=!1,axisIndex:t=0,broadphase:n="Naive",children:a,defaultContactMaterial:o={contactEquationStiffness:1e6},frictionGravity:c=null,gravity:I=[0,-9.81,0],isPaused:C=!1,iterations:d=5,maxSubSteps:f=10,quatNormalizeFast:b=!1,quatNormalizeSkip:v=0,shouldInvalidate:y=!0,size:Z=1e3,solver:V="GS",stepSize:R=1/60,tolerance:S=.001}=r;const{invalidate:N}=gI(),[{bodies:w,events:X,refs:H,scaleOverrides:F,subscriptions:_,worker:P}]=rt.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new xO({allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:o,frictionGravity:c,gravity:I,iterations:d,quatNormalizeFast:b,quatNormalizeSkip:v,size:Z,solver:V,tolerance:S})}));let K=0;const E=rt.useCallback((Be,ve)=>{C||(K+=ve,P.step({maxSubSteps:f,stepSize:R,timeSinceLastCalled:K}),K=0)},[C,f,R]),ee=Be=>{var ve;let{body:we,contact:{bi:me,bj:Xe,...Ue},target:de,...Ee}=Be;const At=(ve=X[de])==null?void 0:ve.collide;At&&At({body:H[we],contact:{bi:H[me],bj:H[Xe],...Ue},target:H[de],...Ee})},Ie=Be=>{var ve,we;let{bodyA:me,bodyB:Xe}=Be;const Ue=(ve=X[me])==null?void 0:ve.collideBegin;Ue&&Ue({body:H[Xe],op:"event",target:H[me],type:"collideBegin"});const de=(we=X[Xe])==null?void 0:we.collideBegin;de&&de({body:H[me],op:"event",target:H[Xe],type:"collideBegin"})},be=Be=>{var ve,we;let{bodyA:me,bodyB:Xe}=Be;const Ue=(ve=X[me])==null?void 0:ve.collideEnd;Ue&&Ue({body:H[Xe],op:"event",target:H[me],type:"collideEnd"});const de=(we=X[Xe])==null?void 0:we.collideEnd;de&&de({body:H[me],op:"event",target:H[Xe],type:"collideEnd"})},se=Be=>{let{active:ve,bodies:we=[],observations:me,positions:Xe,quaternions:Ue}=Be;for(let de=0;de<we.length;de++)w[we[de]]=de;if(me.forEach(de=>{let[Ee,At,Zt]=de;const kt=(_[Ee]||{})[Zt];kt&&kt(At)}),!!ve){for(const de of Object.values(H).filter(XP()))if(de instanceof $m)for(let Ee=0;Ee<de.count;Ee++){const At=`${de.uuid}/${Ee}`,Zt=w[At];Zt!==void 0&&(de.setMatrixAt(Ee,QH(Zt,Xe,Ue,F[At])),de.instanceMatrix.needsUpdate=!0)}else{const Ee=F[de.uuid]||de.scale;QH(w[de.uuid],Xe,Ue,Ee,de)}y&&N()}},Ce=Be=>{var ve;let{body:we,ray:{uuid:me,...Xe},...Ue}=Be;const de=(ve=X[me])==null?void 0:ve.rayhit;de&&de({body:we?H[we]:null,ray:{uuid:me,...Xe},...Ue})};Cb(E),rt.useEffect(()=>(P.connect(),P.init(),P.on("collide",ee),P.on("collideBegin",Ie),P.on("collideEnd",be),P.on("frame",se),P.on("rayhit",Ce),()=>{P.terminate(),P.removeAllListeners()}),[]),rt.useEffect(()=>{P.axisIndex=t},[t]),rt.useEffect(()=>{P.broadphase=n},[n]),rt.useEffect(()=>{P.gravity=I},[I]),rt.useEffect(()=>{P.iterations=d},[d]),rt.useEffect(()=>{P.tolerance=S},[S]);const he=rt.useMemo(()=>({bodies:w,events:X,refs:H,scaleOverrides:F,subscriptions:_,worker:P}),[w,X,H,_,P]);return Tl.jsx(CT.Provider,{value:he,children:a})}function KN(){return KN=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},KN.apply(null,arguments)}var MP=Object.defineProperty,HP=(r,e,t)=>e in r?MP(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,FP=(r,e,t)=>(HP(r,e+"",t),t);class KP{constructor(){FP(this,"_listeners")}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const a=this._listeners[e];if(a!==void 0){const o=a.indexOf(t);o!==-1&&a.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const a=n.slice(0);for(let o=0,c=a.length;o<c;o++)a[o].call(this,e);e.target=null}}}var EP=Object.defineProperty,TP=(r,e,t)=>e in r?EP(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Bn=(r,e,t)=>(TP(r,typeof e!="symbol"?e+"":e,t),t);const PS=new XA,jH=new cI,zP=Math.cos(70*(Math.PI/180)),qH=(r,e)=>(r%e+e)%e;let LP=class extends KP{constructor(e,t){super(),Bn(this,"object"),Bn(this,"domElement"),Bn(this,"enabled",!0),Bn(this,"target",new $),Bn(this,"minDistance",0),Bn(this,"maxDistance",1/0),Bn(this,"minZoom",0),Bn(this,"maxZoom",1/0),Bn(this,"minPolarAngle",0),Bn(this,"maxPolarAngle",Math.PI),Bn(this,"minAzimuthAngle",-1/0),Bn(this,"maxAzimuthAngle",1/0),Bn(this,"enableDamping",!1),Bn(this,"dampingFactor",.05),Bn(this,"enableZoom",!0),Bn(this,"zoomSpeed",1),Bn(this,"enableRotate",!0),Bn(this,"rotateSpeed",1),Bn(this,"enablePan",!0),Bn(this,"panSpeed",1),Bn(this,"screenSpacePanning",!0),Bn(this,"keyPanSpeed",7),Bn(this,"zoomToCursor",!1),Bn(this,"autoRotate",!1),Bn(this,"autoRotateSpeed",2),Bn(this,"reverseOrbit",!1),Bn(this,"reverseHorizontalOrbit",!1),Bn(this,"reverseVerticalOrbit",!1),Bn(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Bn(this,"mouseButtons",{LEFT:dA.ROTATE,MIDDLE:dA.DOLLY,RIGHT:dA.PAN}),Bn(this,"touches",{ONE:CA.ROTATE,TWO:CA.DOLLY_PAN}),Bn(this,"target0"),Bn(this,"position0"),Bn(this,"zoom0"),Bn(this,"_domElementKeyEvents",null),Bn(this,"getPolarAngle"),Bn(this,"getAzimuthalAngle"),Bn(this,"setPolarAngle"),Bn(this,"setAzimuthalAngle"),Bn(this,"getDistance"),Bn(this,"getZoomScale"),Bn(this,"listenToKeyEvents"),Bn(this,"stopListenToKeyEvents"),Bn(this,"saveState"),Bn(this,"reset"),Bn(this,"update"),Bn(this,"connect"),Bn(this,"dispose"),Bn(this,"dollyIn"),Bn(this,"dollyOut"),Bn(this,"getScale"),Bn(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>f.phi,this.getAzimuthalAngle=()=>f.theta,this.setPolarAngle=q=>{let ye=qH(q,2*Math.PI),gt=f.phi;gt<0&&(gt+=2*Math.PI),ye<0&&(ye+=2*Math.PI);let De=Math.abs(ye-gt);2*Math.PI-De<De&&(ye<gt?ye+=2*Math.PI:gt+=2*Math.PI),b.phi=ye-gt,n.update()},this.setAzimuthalAngle=q=>{let ye=qH(q,2*Math.PI),gt=f.theta;gt<0&&(gt+=2*Math.PI),ye<0&&(ye+=2*Math.PI);let De=Math.abs(ye-gt);2*Math.PI-De<De&&(ye<gt?ye+=2*Math.PI:gt+=2*Math.PI),b.theta=ye-gt,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=q=>{q.addEventListener("keydown",tn),this._domElementKeyEvents=q},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",tn),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(a),n.update(),C=I.NONE},this.update=(()=>{const q=new $,ye=new $(0,1,0),gt=new xs().setFromUnitVectors(e.up,ye),De=gt.clone().invert(),Ne=new $,ce=new xs,dt=2*Math.PI;return function(){const rn=n.object.position;gt.setFromUnitVectors(e.up,ye),De.copy(gt).invert(),q.copy(rn).sub(n.target),q.applyQuaternion(gt),f.setFromVector3(q),n.autoRotate&&C===I.NONE&&se(Ie()),n.enableDamping?(f.theta+=b.theta*n.dampingFactor,f.phi+=b.phi*n.dampingFactor):(f.theta+=b.theta,f.phi+=b.phi);let mt=n.minAzimuthAngle,mn=n.maxAzimuthAngle;isFinite(mt)&&isFinite(mn)&&(mt<-Math.PI?mt+=dt:mt>Math.PI&&(mt-=dt),mn<-Math.PI?mn+=dt:mn>Math.PI&&(mn-=dt),mt<=mn?f.theta=Math.max(mt,Math.min(mn,f.theta)):f.theta=f.theta>(mt+mn)/2?Math.max(mt,f.theta):Math.min(mn,f.theta)),f.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,f.phi)),f.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(y,n.dampingFactor):n.target.add(y),n.zoomToCursor&&K||n.object.isOrthographicCamera?f.radius=de(f.radius):f.radius=de(f.radius*v),q.setFromSpherical(f),q.applyQuaternion(De),rn.copy(n.target).add(q),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(b.theta*=1-n.dampingFactor,b.phi*=1-n.dampingFactor,y.multiplyScalar(1-n.dampingFactor)):(b.set(0,0,0),y.set(0,0,0));let Wn=!1;if(n.zoomToCursor&&K){let zn=null;if(n.object instanceof Ea&&n.object.isPerspectiveCamera){const Dn=q.length();zn=de(Dn*v);const In=Dn-zn;n.object.position.addScaledVector(_,In),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const Dn=new $(P.x,P.y,0);Dn.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/v)),n.object.updateProjectionMatrix(),Wn=!0;const In=new $(P.x,P.y,0);In.unproject(n.object),n.object.position.sub(In).add(Dn),n.object.updateMatrixWorld(),zn=q.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;zn!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(zn).add(n.object.position):(PS.origin.copy(n.object.position),PS.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(PS.direction))<zP?e.lookAt(n.target):(jH.setFromNormalAndCoplanarPoint(n.object.up,n.target),PS.intersectPlane(jH,n.target))))}else n.object instanceof $d&&n.object.isOrthographicCamera&&(Wn=v!==1,Wn&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/v)),n.object.updateProjectionMatrix()));return v=1,K=!1,Wn||Ne.distanceToSquared(n.object.position)>d||8*(1-ce.dot(n.object.quaternion))>d?(n.dispatchEvent(a),Ne.copy(n.object.position),ce.copy(n.object.quaternion),Wn=!1,!0):!1}})(),this.connect=q=>{n.domElement=q,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",Le),n.domElement.addEventListener("pointerdown",Oe),n.domElement.addEventListener("pointercancel",et),n.domElement.addEventListener("wheel",Vt)},this.dispose=()=>{var q,ye,gt,De,Ne,ce;n.domElement&&(n.domElement.style.touchAction="auto"),(q=n.domElement)==null||q.removeEventListener("contextmenu",Le),(ye=n.domElement)==null||ye.removeEventListener("pointerdown",Oe),(gt=n.domElement)==null||gt.removeEventListener("pointercancel",et),(De=n.domElement)==null||De.removeEventListener("wheel",Vt),(Ne=n.domElement)==null||Ne.ownerDocument.removeEventListener("pointermove",$e),(ce=n.domElement)==null||ce.ownerDocument.removeEventListener("pointerup",et),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",tn)};const n=this,a={type:"change"},o={type:"start"},c={type:"end"},I={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let C=I.NONE;const d=1e-6,f=new NN,b=new NN;let v=1;const y=new $,Z=new lt,V=new lt,R=new lt,S=new lt,N=new lt,w=new lt,X=new lt,H=new lt,F=new lt,_=new $,P=new lt;let K=!1;const E=[],ee={};function Ie(){return 2*Math.PI/60/60*n.autoRotateSpeed}function be(){return Math.pow(.95,n.zoomSpeed)}function se(q){n.reverseOrbit||n.reverseHorizontalOrbit?b.theta+=q:b.theta-=q}function Ce(q){n.reverseOrbit||n.reverseVerticalOrbit?b.phi+=q:b.phi-=q}const he=(()=>{const q=new $;return function(gt,De){q.setFromMatrixColumn(De,0),q.multiplyScalar(-gt),y.add(q)}})(),Be=(()=>{const q=new $;return function(gt,De){n.screenSpacePanning===!0?q.setFromMatrixColumn(De,1):(q.setFromMatrixColumn(De,0),q.crossVectors(n.object.up,q)),q.multiplyScalar(gt),y.add(q)}})(),ve=(()=>{const q=new $;return function(gt,De){const Ne=n.domElement;if(Ne&&n.object instanceof Ea&&n.object.isPerspectiveCamera){const ce=n.object.position;q.copy(ce).sub(n.target);let dt=q.length();dt*=Math.tan(n.object.fov/2*Math.PI/180),he(2*gt*dt/Ne.clientHeight,n.object.matrix),Be(2*De*dt/Ne.clientHeight,n.object.matrix)}else Ne&&n.object instanceof $d&&n.object.isOrthographicCamera?(he(gt*(n.object.right-n.object.left)/n.object.zoom/Ne.clientWidth,n.object.matrix),Be(De*(n.object.top-n.object.bottom)/n.object.zoom/Ne.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function we(q){n.object instanceof Ea&&n.object.isPerspectiveCamera||n.object instanceof $d&&n.object.isOrthographicCamera?v=q:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function me(q){we(v/q)}function Xe(q){we(v*q)}function Ue(q){if(!n.zoomToCursor||!n.domElement)return;K=!0;const ye=n.domElement.getBoundingClientRect(),gt=q.clientX-ye.left,De=q.clientY-ye.top,Ne=ye.width,ce=ye.height;P.x=gt/Ne*2-1,P.y=-(De/ce)*2+1,_.set(P.x,P.y,1).unproject(n.object).sub(n.object.position).normalize()}function de(q){return Math.max(n.minDistance,Math.min(n.maxDistance,q))}function Ee(q){Z.set(q.clientX,q.clientY)}function At(q){Ue(q),X.set(q.clientX,q.clientY)}function Zt(q){S.set(q.clientX,q.clientY)}function Bt(q){V.set(q.clientX,q.clientY),R.subVectors(V,Z).multiplyScalar(n.rotateSpeed);const ye=n.domElement;ye&&(se(2*Math.PI*R.x/ye.clientHeight),Ce(2*Math.PI*R.y/ye.clientHeight)),Z.copy(V),n.update()}function kt(q){H.set(q.clientX,q.clientY),F.subVectors(H,X),F.y>0?me(be()):F.y<0&&Xe(be()),X.copy(H),n.update()}function $t(q){N.set(q.clientX,q.clientY),w.subVectors(N,S).multiplyScalar(n.panSpeed),ve(w.x,w.y),S.copy(N),n.update()}function Xt(q){Ue(q),q.deltaY<0?Xe(be()):q.deltaY>0&&me(be()),n.update()}function Ot(q){let ye=!1;switch(q.code){case n.keys.UP:ve(0,n.keyPanSpeed),ye=!0;break;case n.keys.BOTTOM:ve(0,-n.keyPanSpeed),ye=!0;break;case n.keys.LEFT:ve(n.keyPanSpeed,0),ye=!0;break;case n.keys.RIGHT:ve(-n.keyPanSpeed,0),ye=!0;break}ye&&(q.preventDefault(),n.update())}function oe(){if(E.length==1)Z.set(E[0].pageX,E[0].pageY);else{const q=.5*(E[0].pageX+E[1].pageX),ye=.5*(E[0].pageY+E[1].pageY);Z.set(q,ye)}}function ut(){if(E.length==1)S.set(E[0].pageX,E[0].pageY);else{const q=.5*(E[0].pageX+E[1].pageX),ye=.5*(E[0].pageY+E[1].pageY);S.set(q,ye)}}function _e(){const q=E[0].pageX-E[1].pageX,ye=E[0].pageY-E[1].pageY,gt=Math.sqrt(q*q+ye*ye);X.set(0,gt)}function it(){n.enableZoom&&_e(),n.enablePan&&ut()}function Te(){n.enableZoom&&_e(),n.enableRotate&&oe()}function Et(q){if(E.length==1)V.set(q.pageX,q.pageY);else{const gt=Ct(q),De=.5*(q.pageX+gt.x),Ne=.5*(q.pageY+gt.y);V.set(De,Ne)}R.subVectors(V,Z).multiplyScalar(n.rotateSpeed);const ye=n.domElement;ye&&(se(2*Math.PI*R.x/ye.clientHeight),Ce(2*Math.PI*R.y/ye.clientHeight)),Z.copy(V)}function Wt(q){if(E.length==1)N.set(q.pageX,q.pageY);else{const ye=Ct(q),gt=.5*(q.pageX+ye.x),De=.5*(q.pageY+ye.y);N.set(gt,De)}w.subVectors(N,S).multiplyScalar(n.panSpeed),ve(w.x,w.y),S.copy(N)}function O(q){const ye=Ct(q),gt=q.pageX-ye.x,De=q.pageY-ye.y,Ne=Math.sqrt(gt*gt+De*De);H.set(0,Ne),F.set(0,Math.pow(H.y/X.y,n.zoomSpeed)),me(F.y),X.copy(H)}function k(q){n.enableZoom&&O(q),n.enablePan&&Wt(q)}function Ae(q){n.enableZoom&&O(q),n.enableRotate&&Et(q)}function Oe(q){var ye,gt;n.enabled!==!1&&(E.length===0&&((ye=n.domElement)==null||ye.ownerDocument.addEventListener("pointermove",$e),(gt=n.domElement)==null||gt.ownerDocument.addEventListener("pointerup",et)),at(q),q.pointerType==="touch"?un(q):Yt(q))}function $e(q){n.enabled!==!1&&(q.pointerType==="touch"?ae(q):vt(q))}function et(q){var ye,gt,De;Pe(q),E.length===0&&((ye=n.domElement)==null||ye.releasePointerCapture(q.pointerId),(gt=n.domElement)==null||gt.ownerDocument.removeEventListener("pointermove",$e),(De=n.domElement)==null||De.ownerDocument.removeEventListener("pointerup",et)),n.dispatchEvent(c),C=I.NONE}function Yt(q){let ye;switch(q.button){case 0:ye=n.mouseButtons.LEFT;break;case 1:ye=n.mouseButtons.MIDDLE;break;case 2:ye=n.mouseButtons.RIGHT;break;default:ye=-1}switch(ye){case dA.DOLLY:if(n.enableZoom===!1)return;At(q),C=I.DOLLY;break;case dA.ROTATE:if(q.ctrlKey||q.metaKey||q.shiftKey){if(n.enablePan===!1)return;Zt(q),C=I.PAN}else{if(n.enableRotate===!1)return;Ee(q),C=I.ROTATE}break;case dA.PAN:if(q.ctrlKey||q.metaKey||q.shiftKey){if(n.enableRotate===!1)return;Ee(q),C=I.ROTATE}else{if(n.enablePan===!1)return;Zt(q),C=I.PAN}break;default:C=I.NONE}C!==I.NONE&&n.dispatchEvent(o)}function vt(q){if(n.enabled!==!1)switch(C){case I.ROTATE:if(n.enableRotate===!1)return;Bt(q);break;case I.DOLLY:if(n.enableZoom===!1)return;kt(q);break;case I.PAN:if(n.enablePan===!1)return;$t(q);break}}function Vt(q){n.enabled===!1||n.enableZoom===!1||C!==I.NONE&&C!==I.ROTATE||(q.preventDefault(),n.dispatchEvent(o),Xt(q),n.dispatchEvent(c))}function tn(q){n.enabled===!1||n.enablePan===!1||Ot(q)}function un(q){switch(pt(q),E.length){case 1:switch(n.touches.ONE){case CA.ROTATE:if(n.enableRotate===!1)return;oe(),C=I.TOUCH_ROTATE;break;case CA.PAN:if(n.enablePan===!1)return;ut(),C=I.TOUCH_PAN;break;default:C=I.NONE}break;case 2:switch(n.touches.TWO){case CA.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;it(),C=I.TOUCH_DOLLY_PAN;break;case CA.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Te(),C=I.TOUCH_DOLLY_ROTATE;break;default:C=I.NONE}break;default:C=I.NONE}C!==I.NONE&&n.dispatchEvent(o)}function ae(q){switch(pt(q),C){case I.TOUCH_ROTATE:if(n.enableRotate===!1)return;Et(q),n.update();break;case I.TOUCH_PAN:if(n.enablePan===!1)return;Wt(q),n.update();break;case I.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;k(q),n.update();break;case I.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Ae(q),n.update();break;default:C=I.NONE}}function Le(q){n.enabled!==!1&&q.preventDefault()}function at(q){E.push(q)}function Pe(q){delete ee[q.pointerId];for(let ye=0;ye<E.length;ye++)if(E[ye].pointerId==q.pointerId){E.splice(ye,1);return}}function pt(q){let ye=ee[q.pointerId];ye===void 0&&(ye=new lt,ee[q.pointerId]=ye),ye.set(q.pageX,q.pageY)}function Ct(q){const ye=q.pointerId===E[0].pointerId?E[1]:E[0];return ee[ye.pointerId]}this.dollyIn=(q=be())=>{Xe(q),n.update()},this.dollyOut=(q=be())=>{me(q),n.update()},this.getScale=()=>v,this.setScale=q=>{we(q),n.update()},this.getZoomScale=()=>be(),t!==void 0&&this.connect(t),this.update()}};const _P=rt.forwardRef(({makeDefault:r,camera:e,regress:t,domElement:n,enableDamping:a=!0,keyEvents:o=!1,onChange:c,onStart:I,onEnd:C,...d},f)=>{const b=gI(F=>F.invalidate),v=gI(F=>F.camera),y=gI(F=>F.gl),Z=gI(F=>F.events),V=gI(F=>F.setEvents),R=gI(F=>F.set),S=gI(F=>F.get),N=gI(F=>F.performance),w=e||v,X=n||Z.connected||y.domElement,H=rt.useMemo(()=>new LP(w),[w]);return Cb(()=>{H.enabled&&H.update()},-1),rt.useEffect(()=>(o&&H.connect(o===!0?X:o),H.connect(X),()=>void H.dispose()),[o,X,t,H,b]),rt.useEffect(()=>{const F=K=>{b(),t&&N.regress(),c&&c(K)},_=K=>{I&&I(K)},P=K=>{C&&C(K)};return H.addEventListener("change",F),H.addEventListener("start",_),H.addEventListener("end",P),()=>{H.removeEventListener("start",_),H.removeEventListener("end",P),H.removeEventListener("change",F)}},[c,I,C,H,b,V]),rt.useEffect(()=>{if(r){const F=S().controls;return R({controls:H}),()=>R({controls:F})}},[r,H]),rt.createElement("primitive",KN({ref:f,object:H,enableDamping:a},d))});var fT={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(Y9,function(){var t=function(){function n(y){return c.appendChild(y.dom),y}function a(y){for(var Z=0;Z<c.children.length;Z++)c.children[Z].style.display=Z===y?"block":"none";o=y}var o=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",c.addEventListener("click",function(y){y.preventDefault(),a(++o%c.children.length)},!1);var I=(performance||Date).now(),C=I,d=0,f=n(new t.Panel("FPS","#0ff","#002")),b=n(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var v=n(new t.Panel("MB","#f08","#201"));return a(0),{REVISION:16,dom:c,addPanel:n,showPanel:a,begin:function(){I=(performance||Date).now()},end:function(){d++;var y=(performance||Date).now();if(b.update(y-I,200),y>C+1e3&&(f.update(1e3*d/(y-C),100),C=y,d=0,v)){var Z=performance.memory;v.update(Z.usedJSHeapSize/1048576,Z.jsHeapSizeLimit/1048576)}return y},update:function(){I=this.end()},domElement:c,setMode:a}};return t.Panel=function(n,a,o){var c=1/0,I=0,C=Math.round,d=C(window.devicePixelRatio||1),f=80*d,b=48*d,v=3*d,y=2*d,Z=3*d,V=15*d,R=74*d,S=30*d,N=document.createElement("canvas");N.width=f,N.height=b,N.style.cssText="width:80px;height:48px";var w=N.getContext("2d");return w.font="bold "+9*d+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=o,w.fillRect(0,0,f,b),w.fillStyle=a,w.fillText(n,v,y),w.fillRect(Z,V,R,S),w.fillStyle=o,w.globalAlpha=.9,w.fillRect(Z,V,R,S),{dom:N,update:function(X,H){c=Math.min(c,X),I=Math.max(I,X),w.fillStyle=o,w.globalAlpha=1,w.fillRect(0,0,f,V),w.fillStyle=a,w.fillText(C(X)+" "+n+" ("+C(c)+"-"+C(I)+")",v,y),w.drawImage(N,Z+d,V,R-d,S,Z,V,R-d,S),w.fillRect(Z+R-d,V,d,S),w.fillStyle=o,w.globalAlpha=.9,w.fillRect(Z+R-d,V,d,C((1-X/H)*S))}}},t})})(fT);var kP=fT.exports;const UP=UN(kP);function DP(r,e=[],t){const[n,a]=rt.useState();return rt.useLayoutEffect(()=>{const o=r();return a(o),()=>void 0},e),n}function JP({showPanel:r=0,className:e,parent:t}){const n=DP(()=>new UP,[]);return rt.useEffect(()=>{if(n){const a=t&&t.current||document.body;n.showPanel(r),a==null||a.appendChild(n.dom);const o=(e??"").split(" ").filter(C=>C);o.length&&n.dom.classList.add(...o);const c=PJ(()=>n.begin()),I=QJ(()=>n.end());return()=>{o.length&&n.dom.classList.remove(...o),a==null||a.removeChild(n.dom),c(),I()}}},[t,n,e,r]),null}const OP=({player:r})=>{const[e,t]=WP(()=>({mass:1,position:r.position,rotation:r.rotation,args:[1,.5,1.5],material:{friction:.7}})),n=rt.useRef([]);return rt.useEffect(()=>{t&&(t.position.set(r.position[0],r.position[1],r.position[2]),t.rotation.set(r.rotation[0],r.rotation[1],r.rotation[2]))},[r.position,r.rotation,t]),Cb((a,o)=>{n.current.forEach(c=>{c&&(c.rotation.x+=o*5)})}),Fe.jsxDEV("group",{ref:e,children:[Fe.jsxDEV("mesh",{position:[0,.25,0],children:[Fe.jsxDEV("cylinderGeometry",{args:[.6,.6,.5,8]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:44,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:r.color},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:45,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:43,columnNumber:7},void 0),Fe.jsxDEV("mesh",{position:[0,.75,0],children:[Fe.jsxDEV("sphereGeometry",{args:[.3,8,6]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:50,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:r.color},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:51,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:49,columnNumber:7},void 0),Fe.jsxDEV("mesh",{position:[0,.5,.8],rotation:[0,0,0],children:[Fe.jsxDEV("cylinderGeometry",{args:[.05,.05,.4,8]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:56,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#333"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:57,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:55,columnNumber:7},void 0),Fe.jsxDEV("group",{ref:a=>a&&(n.current[0]=a),position:[-.4,-.1,-.3],children:Fe.jsxDEV("mesh",{rotation:[0,0,Math.PI/2],children:[Fe.jsxDEV("cylinderGeometry",{args:[.15,.15,.05,8]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:63,columnNumber:11},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#222"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:64,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:62,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:61,columnNumber:7},void 0),Fe.jsxDEV("group",{ref:a=>a&&(n.current[1]=a),position:[.4,-.1,-.3],children:Fe.jsxDEV("mesh",{rotation:[0,0,Math.PI/2],children:[Fe.jsxDEV("cylinderGeometry",{args:[.15,.15,.05,8]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:70,columnNumber:11},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#222"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:71,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:69,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:68,columnNumber:7},void 0),Fe.jsxDEV("group",{ref:a=>a&&(n.current[2]=a),position:[-.4,-.1,.3],children:Fe.jsxDEV("mesh",{rotation:[0,0,Math.PI/2],children:[Fe.jsxDEV("cylinderGeometry",{args:[.15,.15,.05,8]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:77,columnNumber:11},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#222"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:78,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:76,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:75,columnNumber:7},void 0),Fe.jsxDEV("group",{ref:a=>a&&(n.current[3]=a),position:[.4,-.1,.3],children:Fe.jsxDEV("mesh",{rotation:[0,0,Math.PI/2],children:[Fe.jsxDEV("cylinderGeometry",{args:[.15,.15,.05,8]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:84,columnNumber:11},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#222"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:85,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:83,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:82,columnNumber:7},void 0),Fe.jsxDEV("mesh",{position:[0,1.2,0],children:[Fe.jsxDEV("boxGeometry",{args:[.8,.1,.1]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:91,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#333"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:92,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:90,columnNumber:7},void 0),Fe.jsxDEV("mesh",{position:[0,1.2,0],scale:[r.health/r.maxHealth,1,1],children:[Fe.jsxDEV("boxGeometry",{args:[.8,.1,.1]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:96,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:r.health>50?"#44ff44":r.health>25?"#ffff44":"#ff4444"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:97,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:95,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Robot.tsx",lineNumber:41,columnNumber:5},void 0)},PP=({projectile:r})=>{const e=rt.useRef(null);return Cb((t,n)=>{e.current&&(e.current.position.set(r.position[0],r.position[1],r.position[2]),e.current.rotation.x+=n*8,e.current.rotation.y+=n*8)}),Fe.jsxDEV("group",{children:[Fe.jsxDEV("mesh",{ref:e,children:[Fe.jsxDEV("sphereGeometry",{args:[.1,12,8]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Projectile.tsx",lineNumber:32,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#ff4444",emissive:"#440000",emissiveIntensity:.5},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Projectile.tsx",lineNumber:33,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Projectile.tsx",lineNumber:31,columnNumber:7},void 0),Fe.jsxDEV("pointLight",{color:"#ff4444",intensity:.8,distance:2,decay:2},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Projectile.tsx",lineNumber:41,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Projectile.tsx",lineNumber:29,columnNumber:5},void 0)},QP=({position:r,rotation:e,onComplete:t})=>{const[n,a]=rt.useState(!0),o=rt.useRef(null),c=rt.useRef(0);return rt.useEffect(()=>{const I=setTimeout(()=>{a(!1),t()},200);return()=>clearTimeout(I)},[t]),Cb((I,C)=>{if(!o.current||!n)return;c.current+=C;const d=c.current/.2,f=1+d*2;o.current.scale.setScalar(f);const b=1-d;o.current.children.forEach(v=>{v.material&&(v.material.opacity=b)})}),n?Fe.jsxDEV("group",{ref:o,position:r,rotation:e,children:[Fe.jsxDEV("mesh",{children:[Fe.jsxDEV("sphereGeometry",{args:[.3,8,6]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/ShootEffect.tsx",lineNumber:58,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#ffff00",emissive:"#ffaa00",emissiveIntensity:2,transparent:!0,opacity:.8},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/ShootEffect.tsx",lineNumber:59,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/ShootEffect.tsx",lineNumber:57,columnNumber:7},void 0),Fe.jsxDEV("mesh",{children:[Fe.jsxDEV("ringGeometry",{args:[.2,.5,8]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/ShootEffect.tsx",lineNumber:70,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#ff6666",emissive:"#440000",emissiveIntensity:1,transparent:!0,opacity:.6,side:il},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/ShootEffect.tsx",lineNumber:71,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/ShootEffect.tsx",lineNumber:69,columnNumber:7},void 0),Fe.jsxDEV("mesh",{position:[0,0,-.2],children:[Fe.jsxDEV("sphereGeometry",{args:[.1,6,4]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/ShootEffect.tsx",lineNumber:83,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#666666",transparent:!0,opacity:.4},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/ShootEffect.tsx",lineNumber:84,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/ShootEffect.tsx",lineNumber:82,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/ShootEffect.tsx",lineNumber:51,columnNumber:5},void 0):null},jP=({position:r,onComplete:e})=>{const[t,n]=rt.useState(!0),a=rt.useRef(null),o=rt.useRef(null),c=rt.useRef(0),I=rt.useRef([]);return rt.useEffect(()=>{const C=setTimeout(()=>{n(!1),e()},2e3);return()=>clearTimeout(C)},[e]),Cb((C,d)=>{if(!a.current||!t)return;c.current+=d;const f=c.current/2,b=1+f*3;a.current.scale.setScalar(b);const v=1-f;a.current.children.forEach(y=>{y.material&&(y.material.opacity=v)}),I.current.forEach(y=>{const[Z,V,R]=y.velocity,[S,N,w]=y.position;y.position[0]=S+Z*d,y.position[1]=N+V*d,y.position[2]=w+R*d,y.velocity[1]-=5*d,y.mesh.position.set(y.position[0],y.position[1],y.position[2]),y.mesh.material&&(y.mesh.material.opacity=v)})}),rt.useEffect(()=>{if(o.current)for(let C=0;C<15;C++){const d=new ts(new Ib(.1+Math.random()*.2,4,4),new OR({color:new an().setHSL(Math.random(),.8,.5),transparent:!0,opacity:.8})),f=[(Math.random()-.5)*10,Math.random()*8+2,(Math.random()-.5)*10];I.current.push({position:[...r],velocity:f,mesh:d}),o.current.add(d)}},[r]),t?Fe.jsxDEV("group",{children:[Fe.jsxDEV("group",{ref:a,position:r,children:[Fe.jsxDEV("mesh",{children:[Fe.jsxDEV("sphereGeometry",{args:[1,16,12]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:117,columnNumber:11},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#ff6600",emissive:"#ff2200",emissiveIntensity:2,transparent:!0,opacity:.8},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:118,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:116,columnNumber:9},void 0),Fe.jsxDEV("mesh",{children:[Fe.jsxDEV("sphereGeometry",{args:[.5,12,8]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:129,columnNumber:11},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#ffff00",emissive:"#ffaa00",emissiveIntensity:3,transparent:!0,opacity:.9},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:130,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:128,columnNumber:9},void 0),Fe.jsxDEV("mesh",{children:[Fe.jsxDEV("ringGeometry",{args:[.8,1.5,8]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:141,columnNumber:11},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#ff4444",emissive:"#440000",emissiveIntensity:1.5,transparent:!0,opacity:.7,side:il},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:142,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:140,columnNumber:9},void 0),Fe.jsxDEV("mesh",{children:[Fe.jsxDEV("ringGeometry",{args:[1.2,2,8]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:153,columnNumber:11},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#ff8888",emissive:"#220000",emissiveIntensity:1,transparent:!0,opacity:.5,side:il},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:154,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:152,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:114,columnNumber:7},void 0),Fe.jsxDEV("group",{ref:o},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:166,columnNumber:7},void 0),Fe.jsxDEV("pointLight",{color:"#ff6600",intensity:5,distance:8,decay:1,position:r},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:169,columnNumber:7},void 0),Fe.jsxDEV("pointLight",{color:"#ffff00",intensity:3,distance:4,decay:2,position:r},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:177,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/DeathExplosion.tsx",lineNumber:112,columnNumber:5},void 0):null},pT={arenaSize:120,playerSpeed:15,playerHealth:100,projectileSpeed:12,projectileDamage:10,respawnTime:5e3,maxPlayers:8,gameTickRate:60},qP=()=>{const[r]=wP(()=>({rotation:[-Math.PI/2,0,0],position:[0,0,0],material:{friction:.8}})),e=pT.arenaSize;return Fe.jsxDEV("group",{children:[Fe.jsxDEV("mesh",{ref:r,receiveShadow:!0,children:[Fe.jsxDEV("planeGeometry",{args:[e,e]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:18,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#2a2a2a"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:19,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:17,columnNumber:7},void 0),Fe.jsxDEV("mesh",{position:[0,2,e/2],children:[Fe.jsxDEV("boxGeometry",{args:[e,4,1]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:24,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#444"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:25,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:23,columnNumber:7},void 0),Fe.jsxDEV("mesh",{position:[0,2,-e/2],children:[Fe.jsxDEV("boxGeometry",{args:[e,4,1]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:29,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#444"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:30,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:28,columnNumber:7},void 0),Fe.jsxDEV("mesh",{position:[e/2,2,0],children:[Fe.jsxDEV("boxGeometry",{args:[1,4,e]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:34,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#444"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:35,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:33,columnNumber:7},void 0),Fe.jsxDEV("mesh",{position:[-e/2,2,0],children:[Fe.jsxDEV("boxGeometry",{args:[1,4,e]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:39,columnNumber:9},void 0),Fe.jsxDEV("meshStandardMaterial",{color:"#444"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:40,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:38,columnNumber:7},void 0),Fe.jsxDEV("mesh",{position:[0,.01,0],rotation:[-Math.PI/2,0,0],children:[Fe.jsxDEV("planeGeometry",{args:[e,e]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:45,columnNumber:9},void 0),Fe.jsxDEV("meshBasicMaterial",{color:"#666",transparent:!0,opacity:.3},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:46,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:44,columnNumber:7},void 0),Fe.jsxDEV("mesh",{position:[0,.02,0],rotation:[-Math.PI/2,0,0],children:[Fe.jsxDEV("planeGeometry",{args:[.2,e]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:51,columnNumber:9},void 0),Fe.jsxDEV("meshBasicMaterial",{color:"#fff"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:52,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:50,columnNumber:7},void 0),Fe.jsxDEV("mesh",{position:[0,.02,0],rotation:[-Math.PI/2,0,0],children:[Fe.jsxDEV("planeGeometry",{args:[e,.2]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:56,columnNumber:9},void 0),Fe.jsxDEV("meshBasicMaterial",{color:"#fff"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:57,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:55,columnNumber:7},void 0),Fe.jsxDEV("mesh",{position:[0,.03,0],rotation:[-Math.PI/2,0,0],children:[Fe.jsxDEV("ringGeometry",{args:[3,3.2,32]},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:62,columnNumber:9},void 0),Fe.jsxDEV("meshBasicMaterial",{color:"#fff"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:63,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:61,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/Arena.tsx",lineNumber:15,columnNumber:5},void 0)};class $P{constructor(){To(this,"input",{forward:!1,backward:!1,left:!1,right:!1,shoot:!1});To(this,"keys",{});To(this,"isBlocked",!1);To(this,"handleKeyDown",null);To(this,"handleKeyUp",null);To(this,"handleMouseDown",null);To(this,"handleMouseUp",null);this.setupEventListeners()}setupEventListeners(){const e=o=>{this.isBlocked||o.button===0&&(console.log(" Click izquierdo detectado - DISPARO!"),this.input.shoot=!0)},t=o=>{this.isBlocked||o.button===0&&(console.log(" Click izquierdo liberado"),this.input.shoot=!1)},n=o=>{this.isBlocked||(this.keys[o.code]=!0,o.code==="Space"&&(this.input.shoot=!0,console.log(" Disparo con barra espaciadora!")),this.updateInput())},a=o=>{this.isBlocked||(this.keys[o.code]=!1,o.code==="Space"&&(this.input.shoot=!1,console.log(" Disparo liberado")),this.updateInput())};document.addEventListener("keydown",n),document.addEventListener("keyup",a),document.addEventListener("mousedown",e),document.addEventListener("mouseup",t),this.handleKeyDown=n,this.handleKeyUp=a,this.handleMouseDown=e,this.handleMouseUp=t}updateInput(){const e={...this.input};this.input.forward=this.keys.KeyW||this.keys.ArrowUp,this.input.backward=this.keys.KeyS||this.keys.ArrowDown,this.input.left=this.keys.KeyA||this.keys.ArrowLeft,this.input.right=this.keys.KeyD||this.keys.ArrowRight,(this.input.forward||this.input.backward||this.input.left||this.input.right)&&console.log(" Input detectado:",this.input),e.shoot!==this.input.shoot&&console.log(" Estado de disparo cambi:",e.shoot,"",this.input.shoot),JSON.stringify(e)!==JSON.stringify(this.input)&&console.log(" Input cambi:",e,"",this.input)}getInput(){return this.isBlocked?{forward:!1,backward:!1,left:!1,right:!1,shoot:!1}:{...this.input}}setBlocked(e){this.isBlocked=e,e&&(this.input={forward:!1,backward:!1,left:!1,right:!1,shoot:!1},this.keys={})}destroy(){this.handleKeyDown&&document.removeEventListener("keydown",this.handleKeyDown),this.handleKeyUp&&document.removeEventListener("keyup",this.handleKeyUp),this.handleMouseDown&&document.removeEventListener("mousedown",this.handleMouseDown),this.handleMouseUp&&document.removeEventListener("mouseup",this.handleMouseUp)}}class eQ{constructor(){To(this,"config",pT)}updatePlayer(e,t,n){const[a,o,c]=e.position,[I,C,d]=e.rotation;let f=a,b=c,v=C;const y=2;t.left&&(v+=y*n),t.right&&(v-=y*n);const Z=this.config.playerSpeed;t.forward&&(f+=Math.sin(v)*Z*n,b+=Math.cos(v)*Z*n),t.backward&&(f-=Math.sin(v)*Z*n,b-=Math.cos(v)*Z*n);const V=this.config.arenaSize/2-1;return f=Math.max(-V,Math.min(V,f)),b=Math.max(-V,Math.min(V,b)),{...e,position:[f,o,b],rotation:[I,v,d]}}updateProjectile(e,t){const[n,a,o]=e.position,[c,I,C]=e.velocity,d=n+c*t,f=a+I*t,b=o+C*t,y=I+-1*t,Z=this.config.arenaSize/2;return Math.abs(d)>Z||Math.abs(b)>Z||f>10||f<-5?{...e,lifetime:0}:{...e,position:[d,f,b],velocity:[c,y,C],lifetime:e.lifetime-t}}checkCollision(e,t){const[n,a,o]=e.position,[c,I,C]=t.position;return Math.sqrt(Math.pow(n-c,2)+Math.pow(a-I,2)+Math.pow(o-C,2))<1}createProjectile(e,t){const[n,a,o]=e.position,[c,I,C]=e.rotation,d=n+Math.sin(I)*1.2,f=o+Math.cos(I)*1.2,b=a+.5,v=this.config.projectileSpeed,y=Math.sin(I)*v,Z=Math.cos(I)*v;return{id:Math.random().toString(36).substr(2,9),position:[d,b,f],velocity:[y,.5,Z],ownerId:e.id,damage:this.config.projectileDamage,lifetime:5}}}const tQ=({localPlayerId:r,gameState:e,onPlayerUpdate:t,onShoot:n,onInputUpdate:a})=>{const o=rt.useRef(),c=rt.useRef(),I=rt.useRef(0),C=500,[d,f]=rt.useState([]);return rt.useEffect(()=>(o.current=new $P,c.current=new eQ,()=>{var b;(b=o.current)==null||b.destroy()}),[]),rt.useEffect(()=>{e.players.forEach(b=>{b.isDead&&b.deathTime&&(d.find(y=>y.id===`death-${b.id}`)||(console.log(` Creando explosin de muerte para ${b.name}`),f(y=>[...y,{id:`death-${b.id}`,position:[...b.position]}])))})},[e,d]),rt.useEffect(()=>{const v=setInterval(()=>{if(!o.current||!c.current)return;const y=e.players.find(Z=>Z.id===r);if(y)if(o.current.setBlocked(y.isDead||!1),y.isDead)console.log(" Jugador muerto, input bloqueado");else{const Z=o.current.getInput();(Z.forward||Z.backward||Z.left||Z.right)&&console.log(" Input de movimiento detectado:",Z);const V=1/60,R=c.current.updatePlayer(y,Z,V);t(R),a(Z),Z.shoot&&Date.now()-I.current>C&&(console.log(" Disparo detectado, enviando al servidor"),n(),I.current=Date.now()),Z.shoot||(I.current=0)}},16.666666666666668);return()=>clearInterval(v)},[r,e.players,t,n,a]),null},nQ=({gameState:r,localPlayerId:e,shootEffects:t,deathExplosions:n,onShootEffectComplete:a,onDeathExplosionComplete:o})=>Fe.jsxDEV(Fe.Fragment,{children:[Fe.jsxDEV("ambientLight",{intensity:.4},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:143,columnNumber:7},void 0),Fe.jsxDEV("directionalLight",{position:[10,10,5],intensity:1,castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:144,columnNumber:7},void 0),Fe.jsxDEV("pointLight",{position:[0,10,0],intensity:.5,color:"#4444ff"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:151,columnNumber:7},void 0),Fe.jsxDEV(YP,{gravity:[0,-9.81,0],children:[Fe.jsxDEV(qP,{},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:156,columnNumber:9},void 0),r.players.map(c=>Fe.jsxDEV(OP,{player:c,isLocal:c.id===e},c.id,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:160,columnNumber:11},void 0)),r.projectiles.map(c=>Fe.jsxDEV(PP,{projectile:c},c.id,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:169,columnNumber:11},void 0))]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:154,columnNumber:7},void 0),t.map(c=>Fe.jsxDEV(QP,{position:c.position,rotation:c.rotation,onComplete:()=>a(c.id)},c.id,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:178,columnNumber:9},void 0)),n.map(c=>Fe.jsxDEV(jP,{position:c.position,onComplete:()=>o(c.id)},c.id,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:188,columnNumber:9},void 0)),Fe.jsxDEV(_P,{target:[0,0,0],maxPolarAngle:Math.PI/2,minDistance:10,maxDistance:50},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:196,columnNumber:7},void 0),Fe.jsxDEV(JP,{},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:204,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:141,columnNumber:5},void 0),iQ=r=>{const[e,t]=rt.useState([]),[n,a]=rt.useState([]),o=I=>{t(C=>C.filter(d=>d.id!==I))},c=I=>{a(C=>C.filter(d=>d.id!==I))};return Fe.jsxDEV(Fe.Fragment,{children:[Fe.jsxDEV(tQ,{...r},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:231,columnNumber:7},void 0),Fe.jsxDEV(pO,{shadows:!0,camera:{position:[0,15,20],fov:60},style:{background:"#1a1a1a"},children:Fe.jsxDEV(nQ,{gameState:r.gameState,localPlayerId:r.localPlayerId,shootEffects:e,deathExplosions:n,onShootEffectComplete:o,onDeathExplosionComplete:c},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:239,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:234,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/game/GameWorld.tsx",lineNumber:229,columnNumber:5},void 0)},aQ=({gameState:r,localPlayerId:e,onJoinGame:t,isConnected:n})=>{const[a,o]=rt.useState(""),[c,I]=rt.useState(!0),C=e?r.players.find(f=>f.id===e):null,d=()=>{a.trim()&&(t(a.trim()),I(!1))};return Fe.jsxDEV("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:[c&&Fe.jsxDEV("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.8)",padding:"2rem",borderRadius:"10px",color:"white",textAlign:"center",pointerEvents:"auto"},children:[Fe.jsxDEV("h1",{style:{color:"#44ff44",marginBottom:"1rem"},children:"BytesWar"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:53,columnNumber:11},void 0),Fe.jsxDEV("p",{style:{marginBottom:"1rem"},children:"nete a la batalla de robots!"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:54,columnNumber:11},void 0),Fe.jsxDEV("input",{type:"text",placeholder:"Tu nombre",value:a,onChange:f=>o(f.target.value),style:{padding:"0.5rem",marginBottom:"1rem",width:"200px",borderRadius:"5px",border:"none",fontSize:"1rem"},onKeyPress:f=>f.key==="Enter"&&d()},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:56,columnNumber:11},void 0),Fe.jsxDEV("br",{},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:72,columnNumber:11},void 0),Fe.jsxDEV("button",{onClick:d,disabled:!a.trim()||!n,style:{padding:"0.5rem 1rem",background:"#44ff44",color:"black",border:"none",borderRadius:"5px",fontSize:"1rem",cursor:"pointer",opacity:!a.trim()||!n?.5:1},children:n?"Unirse al Juego":"Conectando..."},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:74,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:41,columnNumber:9},void 0),C&&Fe.jsxDEV("div",{style:{position:"absolute",top:"20px",left:"20px",background:"rgba(0, 0, 0, 0.7)",padding:"1rem",borderRadius:"5px",color:"white",pointerEvents:"auto"},children:[Fe.jsxDEV("h3",{style:{margin:"0 0 0.5rem 0",color:C.color},children:C.name},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:105,columnNumber:11},void 0),Fe.jsxDEV("div",{style:{marginBottom:"0.5rem"},children:[Fe.jsxDEV("span",{children:"Salud: "},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:109,columnNumber:13},void 0),Fe.jsxDEV("span",{style:{color:C.health>50?"#44ff44":C.health>25?"#ffff44":"#ff4444"},children:[C.health,"/",C.maxHealth]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:110,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:108,columnNumber:11},void 0),Fe.jsxDEV("div",{style:{width:"100px",height:"10px",background:"#333",borderRadius:"5px",overflow:"hidden"},children:Fe.jsxDEV("div",{style:{width:`${C.health/C.maxHealth*100}%`,height:"100%",background:C.health>50?"#44ff44":C.health>25?"#ffff44":"#ff4444",transition:"width 0.3s ease"}},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:121,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:114,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:95,columnNumber:9},void 0),Fe.jsxDEV("div",{style:{position:"absolute",top:"20px",right:"20px",background:"rgba(0, 0, 0, 0.7)",padding:"1rem",borderRadius:"5px",color:"white",minWidth:"200px",pointerEvents:"auto"},children:[Fe.jsxDEV("h3",{style:{margin:"0 0 1rem 0"},children:["Jugadores (",r.players.length,")"]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:143,columnNumber:9},void 0),r.players.map(f=>Fe.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",padding:"0.25rem 0"},children:[Fe.jsxDEV("span",{style:{color:f.color},children:[f.name," ",f.id===e?"(T)":""]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:152,columnNumber:13},void 0),Fe.jsxDEV("span",{style:{color:f.health>50?"#44ff44":f.health>25?"#ffff44":"#ff4444"},children:f.health},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:155,columnNumber:13},void 0)]},f.id,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:145,columnNumber:11},void 0))]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:132,columnNumber:7},void 0),Fe.jsxDEV("div",{style:{position:"absolute",bottom:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(0, 0, 0, 0.7)",padding:"1rem",borderRadius:"5px",color:"white",textAlign:"center",pointerEvents:"auto"},children:[Fe.jsxDEV("div",{style:{marginBottom:"0.5rem"},children:[Fe.jsxDEV("strong",{children:"Estado:"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:178,columnNumber:11},void 0)," ",r.isGameActive?"En Juego":"Esperando Jugadores"]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:177,columnNumber:9},void 0),Fe.jsxDEV("div",{style:{fontSize:"0.9rem",opacity:.8},children:[Fe.jsxDEV("div",{children:"WASD - Mover | Click - Disparar"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:181,columnNumber:11},void 0),Fe.jsxDEV("div",{children:["Tiempo: ",Math.floor(r.gameTime),"s"]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:182,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:180,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:165,columnNumber:7},void 0),Fe.jsxDEV("div",{style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",background:n?"rgba(0, 255, 0, 0.2)":"rgba(255, 0, 0, 0.2)",padding:"0.5rem 1rem",borderRadius:"20px",color:"white",fontSize:"0.9rem",pointerEvents:"auto"},children:n?" Conectado":" Desconectado"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:187,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/GameUI.tsx",lineNumber:30,columnNumber:5},void 0)},sQ=({isVisible:r,timeRemaining:e})=>{const[t,n]=rt.useState(!1);return console.log(" RespawnUI - isVisible:",r,"timeRemaining:",e),rt.useEffect(()=>{if(r){const a=setTimeout(()=>{n(!0)},2e3);return()=>clearTimeout(a)}else n(!1)},[r]),r?(console.log(" RespawnUI - Renderizando pantalla de muerte"),Fe.jsxDEV("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(255, 0, 0, 0.9)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:1e3,color:"white",fontFamily:"Arial, sans-serif"},children:[Fe.jsxDEV("div",{style:{textAlign:"center",marginBottom:"2rem"},children:[Fe.jsxDEV("h1",{style:{fontSize:"3rem",color:"#ff4444",margin:"0 0 1rem 0",textShadow:"2px 2px 4px rgba(0, 0, 0, 0.8)"},children:" TE HAN ELIMINADO! "},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/RespawnUI.tsx",lineNumber:59,columnNumber:9},void 0),Fe.jsxDEV("p",{style:{fontSize:"1.5rem",color:"#cccccc",margin:"0 0 2rem 0",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.8)"},children:"Tu robot ha sido destruido en batalla"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/RespawnUI.tsx",lineNumber:68,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/RespawnUI.tsx",lineNumber:55,columnNumber:7},void 0),t&&Fe.jsxDEV("div",{style:{textAlign:"center",marginBottom:"2rem"}},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/RespawnUI.tsx",lineNumber:80,columnNumber:9},void 0),Fe.jsxDEV("div",{style:{textAlign:"center"},children:[Fe.jsxDEV("p",{style:{fontSize:"1.2rem",color:"#888888",margin:"0",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.8)"},children:"Reaparicin automtica en:"},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/RespawnUI.tsx",lineNumber:91,columnNumber:9},void 0),Fe.jsxDEV("div",{style:{fontSize:"2rem",color:"#ffff44",fontWeight:"bold",margin:"0.5rem 0",textShadow:"2px 2px 4px rgba(0, 0, 0, 0.8)"},children:[Math.max(0,Math.ceil(e/1e3)),"s"]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/RespawnUI.tsx",lineNumber:100,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/RespawnUI.tsx",lineNumber:88,columnNumber:7},void 0),Fe.jsxDEV("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"200px",height:"200px",background:"radial-gradient(circle, rgba(255, 100, 100, 0.3) 0%, transparent 70%)",borderRadius:"50%",animation:"pulse 2s ease-in-out infinite"}},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/RespawnUI.tsx",lineNumber:112,columnNumber:7},void 0),Fe.jsxDEV("style",{children:`
        @keyframes pulse {
          0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
          50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.6; }
        }
      `},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/RespawnUI.tsx",lineNumber:124,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/components/RespawnUI.tsx",lineNumber:39,columnNumber:5},void 0)):(console.log(" RespawnUI - No visible"),null)},Lc=Object.create(null);Lc.open="0";Lc.close="1";Lc.ping="2";Lc.pong="3";Lc.message="4";Lc.upgrade="5";Lc.noop="6";const lR=Object.create(null);Object.keys(Lc).forEach(r=>{lR[Lc[r]]=r});const EN={type:"error",data:"parser error"},mT=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",bT=typeof ArrayBuffer=="function",vT=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,E2=({type:r,data:e},t,n)=>mT&&e instanceof Blob?t?n(e):$H(e,n):bT&&(e instanceof ArrayBuffer||vT(e))?t?n(e):$H(new Blob([e]),n):n(Lc[r]+(e||"")),$H=(r,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)};function eF(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let KV;function oQ(r,e){if(mT&&r.data instanceof Blob)return r.data.arrayBuffer().then(eF).then(e);if(bT&&(r.data instanceof ArrayBuffer||vT(r.data)))return e(eF(r.data));E2(r,!1,t=>{KV||(KV=new TextEncoder),e(KV.encode(t))})}const tF="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w0=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<tF.length;r++)w0[tF.charCodeAt(r)]=r;const rQ=r=>{let e=r.length*.75,t=r.length,n,a=0,o,c,I,C;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const d=new ArrayBuffer(e),f=new Uint8Array(d);for(n=0;n<t;n+=4)o=w0[r.charCodeAt(n)],c=w0[r.charCodeAt(n+1)],I=w0[r.charCodeAt(n+2)],C=w0[r.charCodeAt(n+3)],f[a++]=o<<2|c>>4,f[a++]=(c&15)<<4|I>>2,f[a++]=(I&3)<<6|C&63;return d},lQ=typeof ArrayBuffer=="function",T2=(r,e)=>{if(typeof r!="string")return{type:"message",data:yT(r,e)};const t=r.charAt(0);return t==="b"?{type:"message",data:gQ(r.substring(1),e)}:lR[t]?r.length>1?{type:lR[t],data:r.substring(1)}:{type:lR[t]}:EN},gQ=(r,e)=>{if(lQ){const t=rQ(r);return yT(t,e)}else return{base64:!0,data:r}},yT=(r,e)=>{switch(e){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},GT="",cQ=(r,e)=>{const t=r.length,n=new Array(t);let a=0;r.forEach((o,c)=>{E2(o,!1,I=>{n[c]=I,++a===t&&e(n.join(GT))})})},uQ=(r,e)=>{const t=r.split(GT),n=[];for(let a=0;a<t.length;a++){const o=T2(t[a],e);if(n.push(o),o.type==="error")break}return n};function IQ(){return new TransformStream({transform(r,e){oQ(r,t=>{const n=t.length;let a;if(n<126)a=new Uint8Array(1),new DataView(a.buffer).setUint8(0,n);else if(n<65536){a=new Uint8Array(3);const o=new DataView(a.buffer);o.setUint8(0,126),o.setUint16(1,n)}else{a=new Uint8Array(9);const o=new DataView(a.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(n))}r.data&&typeof r.data!="string"&&(a[0]|=128),e.enqueue(a),e.enqueue(t)})}})}let EV;function QS(r){return r.reduce((e,t)=>e+t.length,0)}function jS(r,e){if(r[0].length===e)return r.shift();const t=new Uint8Array(e);let n=0;for(let a=0;a<e;a++)t[a]=r[0][n++],n===r[0].length&&(r.shift(),n=0);return r.length&&n<r[0].length&&(r[0]=r[0].slice(n)),t}function dQ(r,e){EV||(EV=new TextDecoder);const t=[];let n=0,a=-1,o=!1;return new TransformStream({transform(c,I){for(t.push(c);;){if(n===0){if(QS(t)<1)break;const C=jS(t,1);o=(C[0]&128)===128,a=C[0]&127,a<126?n=3:a===126?n=1:n=2}else if(n===1){if(QS(t)<2)break;const C=jS(t,2);a=new DataView(C.buffer,C.byteOffset,C.length).getUint16(0),n=3}else if(n===2){if(QS(t)<8)break;const C=jS(t,8),d=new DataView(C.buffer,C.byteOffset,C.length),f=d.getUint32(0);if(f>Math.pow(2,21)-1){I.enqueue(EN);break}a=f*Math.pow(2,32)+d.getUint32(4),n=3}else{if(QS(t)<a)break;const C=jS(t,a);I.enqueue(T2(o?C:EV.decode(C),e)),n=0}if(a===0||a>r){I.enqueue(EN);break}}}})}const BT=4;function ns(r){if(r)return CQ(r)}function CQ(r){for(var e in ns.prototype)r[e]=ns.prototype[e];return r}ns.prototype.on=ns.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};ns.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};ns.prototype.off=ns.prototype.removeListener=ns.prototype.removeAllListeners=ns.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,a=0;a<t.length;a++)if(n=t[a],n===e||n.fn===e){t.splice(a,1);break}return t.length===0&&delete this._callbacks["$"+r],this};ns.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,a=t.length;n<a;++n)t[n].apply(this,e)}return this};ns.prototype.emitReserved=ns.prototype.emit;ns.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};ns.prototype.hasListeners=function(r){return!!this.listeners(r).length};const jR=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),zl=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),hQ="arraybuffer";function ZT(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}const AQ=zl.setTimeout,fQ=zl.clearTimeout;function qR(r,e){e.useNativeTimers?(r.setTimeoutFn=AQ.bind(zl),r.clearTimeoutFn=fQ.bind(zl)):(r.setTimeoutFn=zl.setTimeout.bind(zl),r.clearTimeoutFn=zl.clearTimeout.bind(zl))}const pQ=1.33;function mQ(r){return typeof r=="string"?bQ(r):Math.ceil((r.byteLength||r.size)*pQ)}function bQ(r){let e=0,t=0;for(let n=0,a=r.length;n<a;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}function ST(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function vQ(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function yQ(r){let e={},t=r.split("&");for(let n=0,a=t.length;n<a;n++){let o=t[n].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}class GQ extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class z2 extends ns{constructor(e){super(),this.writable=!1,qR(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved("error",new GQ(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=T2(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=vQ(e);return t.length?"?"+t:""}}class BQ extends z2{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};uQ(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,cQ(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=ST()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let RT=!1;try{RT=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const ZQ=RT;function SQ(){}class RQ extends BQ{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let n=location.port;n||(n=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(a,o)=>{this.onError("xhr post error",a,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}let tb=class gR extends ns{constructor(e,t,n){super(),this.createRequest=e,qR(this,n),this._opts=n,this._method=n.method||"GET",this._uri=t,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var e;const t=ZT(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(t);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let a in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(a)&&n.setRequestHeader(a,this._opts.extraHeaders[a])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var a;n.readyState===3&&((a=this._opts.cookieJar)===null||a===void 0||a.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},n.send(this._data)}catch(a){this.setTimeoutFn(()=>{this._onError(a)},0);return}typeof document<"u"&&(this._index=gR.requestsCount++,gR.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=SQ,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete gR.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};tb.requestsCount=0;tb.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",nF);else if(typeof addEventListener=="function"){const r="onpagehide"in zl?"pagehide":"unload";addEventListener(r,nF,!1)}}function nF(){for(let r in tb.requests)tb.requests.hasOwnProperty(r)&&tb.requests[r].abort()}const wQ=function(){const r=wT({xdomain:!1});return r&&r.responseType!==null}();class WQ extends RQ{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=wQ&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new tb(wT,this.uri(),e)}}function wT(r){const e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||ZQ))return new XMLHttpRequest}catch{}if(!e)try{return new zl[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const WT=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class xQ extends z2{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,n=WT?{}:ZT(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(a){return this.emitReserved("error",a)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],a=t===e.length-1;E2(n,this.supportsBinary,o=>{try{this.doWrite(n,o)}catch{}a&&jR(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=ST()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const TV=zl.WebSocket||zl.MozWebSocket;class VQ extends xQ{createSocket(e,t,n){return WT?new TV(e,t,n):t?new TV(e,t):new TV(e)}doWrite(e,t){this.ws.send(t)}}class NQ extends z2{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=dQ(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),a=IQ();a.readable.pipeTo(e.writable),this._writer=a.writable.getWriter();const o=()=>{n.read().then(({done:I,value:C})=>{I||(this.onPacket(C),o())}).catch(I=>{})};o();const c={type:"open"};this.query.sid&&(c.data=`{"sid":"${this.query.sid}"}`),this._writer.write(c).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],a=t===e.length-1;this._writer.write(n).then(()=>{a&&jR(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const XQ={websocket:VQ,webtransport:NQ,polling:WQ},YQ=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,MQ=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function TN(r){if(r.length>8e3)throw"URI too long";const e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let a=YQ.exec(r||""),o={},c=14;for(;c--;)o[MQ[c]]=a[c]||"";return t!=-1&&n!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=HQ(o,o.path),o.queryKey=FQ(o,o.query),o}function HQ(r,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function FQ(r,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,a,o){a&&(t[a]=o)}),t}const zN=typeof addEventListener=="function"&&typeof removeEventListener=="function",cR=[];zN&&addEventListener("offline",()=>{cR.forEach(r=>r())},!1);class eC extends ns{constructor(e,t){if(super(),this.binaryType=hQ,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const n=TN(e);t.hostname=n.host,t.secure=n.protocol==="https"||n.protocol==="wss",t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=TN(t.host).host);qR(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(n=>{const a=n.prototype.name;this.transports.push(a),this._transportsByName[a]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=yQ(this.opts.query)),zN&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},cR.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=BT,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&eC.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",eC.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const a=this.writeBuffer[n].data;if(a&&(t+=mQ(a)),n>0&&t>this._maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,jR(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket("message",e,t,n),this}send(e,t,n){return this._sendPacket("message",e,t,n),this}_sendPacket(e,t,n,a){if(typeof t=="function"&&(a=t,t=void 0),typeof n=="function"&&(a=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const o={type:e,data:t,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),a&&this.once("flush",a),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}_onError(e){if(eC.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),zN&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const n=cR.indexOf(this._offlineEventListener);n!==-1&&cR.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}eC.protocol=BT;class KQ extends eC{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),n=!1;eC.priorWebsocketSuccess=!1;const a=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",b=>{if(!n)if(b.type==="pong"&&b.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;eC.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(f(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const v=new Error("probe error");v.transport=t.name,this.emitReserved("upgradeError",v)}}))};function o(){n||(n=!0,f(),t.close(),t=null)}const c=b=>{const v=new Error("probe error: "+b);v.transport=t.name,o(),this.emitReserved("upgradeError",v)};function I(){c("transport closed")}function C(){c("socket closed")}function d(b){t&&b.name!==t.name&&o()}const f=()=>{t.removeListener("open",a),t.removeListener("error",c),t.removeListener("close",I),this.off("close",C),this.off("upgrading",d)};t.once("open",a),t.once("error",c),t.once("close",I),this.once("close",C),this.once("upgrading",d),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}let EQ=class extends KQ{constructor(e,t={}){const n=typeof e=="object"?e:t;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(a=>XQ[a]).filter(a=>!!a)),super(e,n)}};function TQ(r,e="",t){let n=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),n=TN(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+e,n.href=n.protocol+"://"+o+(t&&t.port===n.port?"":":"+n.port),n}const zQ=typeof ArrayBuffer=="function",LQ=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,xT=Object.prototype.toString,_Q=typeof Blob=="function"||typeof Blob<"u"&&xT.call(Blob)==="[object BlobConstructor]",kQ=typeof File=="function"||typeof File<"u"&&xT.call(File)==="[object FileConstructor]";function L2(r){return zQ&&(r instanceof ArrayBuffer||LQ(r))||_Q&&r instanceof Blob||kQ&&r instanceof File}function uR(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(uR(r[t]))return!0;return!1}if(L2(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return uR(r.toJSON(),!0);for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&uR(r[t]))return!0;return!1}function UQ(r){const e=[],t=r.data,n=r;return n.data=LN(t,e),n.attachments=e.length,{packet:n,buffers:e}}function LN(r,e){if(!r)return r;if(L2(r)){const t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=LN(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){const t={};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=LN(r[n],e));return t}return r}function DQ(r,e){return r.data=_N(r.data,e),delete r.attachments,r}function _N(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=_N(r[t],e);else if(typeof r=="object")for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=_N(r[t],e));return r}const JQ=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],OQ=5;var gi;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(gi||(gi={}));class PQ{constructor(e){this.replacer=e}encode(e){return(e.type===gi.EVENT||e.type===gi.ACK)&&uR(e)?this.encodeAsBinary({type:e.type===gi.EVENT?gi.BINARY_EVENT:gi.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===gi.BINARY_EVENT||e.type===gi.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=UQ(e),n=this.encodeAsString(t.packet),a=t.buffers;return a.unshift(n),a}}function iF(r){return Object.prototype.toString.call(r)==="[object Object]"}class _2 extends ns{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===gi.BINARY_EVENT;n||t.type===gi.BINARY_ACK?(t.type=n?gi.EVENT:gi.ACK,this.reconstructor=new QQ(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(L2(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(gi[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===gi.BINARY_EVENT||n.type===gi.BINARY_ACK){const o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const c=e.substring(o,t);if(c!=Number(c)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(c)}if(e.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(o,t)}else n.nsp="/";const a=e.charAt(t+1);if(a!==""&&Number(a)==a){const o=t+1;for(;++t;){const c=e.charAt(t);if(c==null||Number(c)!=c){--t;break}if(t===e.length)break}n.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(_2.isPayloadValid(n.type,o))n.data=o;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case gi.CONNECT:return iF(t);case gi.DISCONNECT:return t===void 0;case gi.CONNECT_ERROR:return typeof t=="string"||iF(t);case gi.EVENT:case gi.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&JQ.indexOf(t[0])===-1);case gi.ACK:case gi.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class QQ{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=DQ(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const jQ=Object.freeze(Object.defineProperty({__proto__:null,Decoder:_2,Encoder:PQ,get PacketType(){return gi},protocol:OQ},Symbol.toStringTag,{value:"Module"}));function Mg(r,e,t){return r.on(e,t),function(){r.off(e,t)}}const qQ=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class VT extends ns{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Mg(e,"open",this.onopen.bind(this)),Mg(e,"packet",this.onpacket.bind(this)),Mg(e,"error",this.onerror.bind(this)),Mg(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var n,a,o;if(qQ.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const c={type:gi.EVENT,data:t};if(c.options={},c.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const f=this.ids++,b=t.pop();this._registerAckCallback(f,b),c.id=f}const I=(a=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||a===void 0?void 0:a.writable,C=this.connected&&!(!((o=this.io.engine)===null||o===void 0)&&o._hasPingExpired());return this.flags.volatile&&!I||(C?(this.notifyOutgoingListeners(c),this.packet(c)):this.sendBuffer.push(c)),this.flags={},this}_registerAckCallback(e,t){var n;const a=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(a===void 0){this.acks[e]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let I=0;I<this.sendBuffer.length;I++)this.sendBuffer[I].id===e&&this.sendBuffer.splice(I,1);t.call(this,new Error("operation has timed out"))},a),c=(...I)=>{this.io.clearTimeoutFn(o),t.apply(this,I)};c.withError=!0,this.acks[e]=c}emitWithAck(e,...t){return new Promise((n,a)=>{const o=(c,I)=>c?a(c):n(I);o.withError=!0,t.push(o),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((a,...o)=>n!==this._queue[0]?void 0:(a!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(a)):(this._queue.shift(),t&&t(null,...o)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:gi.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(n=>String(n.id)===e)){const n=this.acks[e];delete this.acks[e],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case gi.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case gi.EVENT:case gi.BINARY_EVENT:this.onevent(e);break;case gi.ACK:case gi.BINARY_ACK:this.onack(e);break;case gi.DISCONNECT:this.ondisconnect();break;case gi.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...a){n||(n=!0,t.packet({type:gi.ACK,id:e,data:a}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:gi.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function hb(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}hb.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0};hb.prototype.reset=function(){this.attempts=0};hb.prototype.setMin=function(r){this.ms=r};hb.prototype.setMax=function(r){this.max=r};hb.prototype.setJitter=function(r){this.jitter=r};class kN extends ns{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,qR(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new hb({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const a=t.parser||jQ;this.encoder=new a.Encoder,this.decoder=new a.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new EQ(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const a=Mg(t,"open",function(){n.onopen(),e&&e()}),o=I=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",I),e?e(I):this.maybeReconnectOnOpen()},c=Mg(t,"error",o);if(this._timeout!==!1){const I=this._timeout,C=this.setTimeoutFn(()=>{a(),o(new Error("timeout")),t.close()},I);this.opts.autoUnref&&C.unref(),this.subs.push(()=>{this.clearTimeoutFn(C)})}return this.subs.push(a),this.subs.push(c),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Mg(e,"ping",this.onping.bind(this)),Mg(e,"data",this.ondata.bind(this)),Mg(e,"error",this.onerror.bind(this)),Mg(e,"close",this.onclose.bind(this)),Mg(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){jR(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new VT(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(a=>{a?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",a)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const S0={};function IR(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};const t=TQ(r,e.path||"/socket.io"),n=t.source,a=t.id,o=t.path,c=S0[a]&&o in S0[a].nsps,I=e.forceNew||e["force new connection"]||e.multiplex===!1||c;let C;return I?C=new kN(n,e):(S0[a]||(S0[a]=new kN(n,e)),C=S0[a]),t.query&&!e.query&&(e.query=t.queryKey),C.socket(t.path,e)}Object.assign(IR,{Manager:kN,Socket:VT,io:IR,connect:IR});const $Q={SERVER_URL:window.location.origin};class ej{constructor(e){To(this,"socket",null);To(this,"serverUrl");To(this,"onGameStateUpdate",null);To(this,"onPlayerJoined",null);this.serverUrl=e||$Q.SERVER_URL}connect(){return new Promise((e,t)=>{this.socket=IR(this.serverUrl,{transports:["polling","websocket"],upgrade:!0,rememberUpgrade:!0,timeout:2e4,forceNew:!0}),this.socket.on("connect",()=>{console.log("Conectado al servidor de BytesWar"),e()}),this.socket.on("connect_error",n=>{console.error("Error al conectar:",n),t(n)}),this.socket.on("gameState",n=>{this.onGameStateUpdate&&this.onGameStateUpdate(n)}),this.socket.on("playerJoined",n=>{console.log(" NetworkManager recibi playerJoined:",n),this.onPlayerJoined?this.onPlayerJoined(n):console.log(" No hay callback registrado para playerJoined")})})}joinGame(e){this.socket&&this.socket.emit("joinGame",e)}sendInput(e){this.socket?(console.log("Enviando input al servidor:",e),this.socket.emit("playerInput",e)):console.log("ERROR: Socket no est conectado")}shoot(){this.socket&&this.socket.emit("shoot")}respawn(){this.socket&&this.socket.emit("respawn")}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null)}onGameState(e){this.onGameStateUpdate=e}onPlayerJoin(e){this.onPlayerJoined=e}getSocketId(){var e;return((e=this.socket)==null?void 0:e.id)||null}}function tj(){const[r]=rt.useState(()=>new ej),[e,t]=rt.useState({players:[],projectiles:[],gameTime:0,isGameActive:!1}),[n,a]=rt.useState(null),[o,c]=rt.useState(!1),[I,C]=rt.useState(!1),[d,f]=rt.useState(null);rt.useEffect(()=>{console.log(" localPlayerId cambi a:",n)},[n]);const b=rt.useCallback(w=>{if(!n){console.log(" No hay localPlayerId configurado para verificar muerte");return}const X=w.players.find(H=>H.id===n);X?(console.log(" Estado del jugador local:",{name:X.name,health:X.health,isDead:X.isDead,deathTime:X.deathTime,currentIsDead:I}),X.isDead&&!I?(console.log(" Jugador local muri!"),C(!0),f(X.deathTime||Date.now())):!X.isDead&&I?(console.log(" Jugador local respawne!"),C(!1),f(null)):X.isDead&&I?console.log(" Jugador sigue muerto..."):!X.isDead&&!I&&console.log(" Jugador sigue vivo")):console.log(" No se encontr jugador local en el estado del juego")},[n,I]);rt.useEffect(()=>{e.players.length>0&&b(e)},[e,b]);const v=rt.useRef({forward:!1,backward:!1,left:!1,right:!1,shoot:!1});rt.useEffect(()=>(r.connect().then(()=>{c(!0),console.log("Conectado al servidor")}).catch(w=>{console.error("Error al conectar:",w),c(!1)}),r.onGameState(w=>{if(console.log(" Estado del juego actualizado:",w),console.log(" Jugadores:",w.players.map(X=>`${X.name}: [${X.position.join(", ")}]`)),t(w),!n&&r.getSocketId()){const X=r.getSocketId(),H=w.players.find(F=>F.id===X);H&&(console.log(" Estableciendo localPlayerId por respaldo:",H.name,"ID:",X),a(X))}}),r.onPlayerJoin(w=>{console.log(" Evento playerJoined recibido:",w),console.log(" Socket ID actual:",r.getSocketId()),console.log(" Comparacin de IDs:",w.id===r.getSocketId()),w.id===r.getSocketId()?(console.log(" Jugador local identificado:",w.name),a(w.id)):console.log(" No es el jugador local:",w.name)}),()=>{r.disconnect()}),[r]);const y=w=>{r.joinGame(w)},Z=w=>{t(X=>({...X,players:X.players.map(H=>H.id===w.id?w:H)})),console.log(" Actualizando posicin local del jugador:",w.name,"en",w.position)},V=()=>{r.shoot()},R=()=>{r.respawn()},S=w=>{const X={forward:!!w.forward,backward:!!w.backward,left:!!w.left,right:!!w.right,shoot:!!w.shoot};v.current=X,o&&n?(console.log("Enviando input desde App:",X),r.sendInput(X)):console.log("No enviando input - no conectado:",{isConnected:o,localPlayerId:!!n})},N=d?Math.max(0,5e3-(Date.now()-d)):0;return Fe.jsxDEV("div",{style:{width:"100vw",height:"100vh",position:"relative"},children:[Fe.jsxDEV(iQ,{localPlayerId:n||"",gameState:e,onPlayerUpdate:Z,onShoot:V,onInputUpdate:S},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/App.tsx",lineNumber:178,columnNumber:7},this),Fe.jsxDEV(aQ,{gameState:e,localPlayerId:n,onJoinGame:y,isConnected:o},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/App.tsx",lineNumber:186,columnNumber:7},this),Fe.jsxDEV(sQ,{isVisible:I,onRespawn:R,timeRemaining:N},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/App.tsx",lineNumber:192,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/App.tsx",lineNumber:177,columnNumber:5},this)}LV.createRoot(document.getElementById("root")).render(Fe.jsxDEV(H9.StrictMode,{children:Fe.jsxDEV(tj,{},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/main.tsx",lineNumber:7,columnNumber:5},void 0)},void 0,!1,{fileName:"/Users/sistemasbatest/Documents/Personales/Proyectos/byteswar/src/main.tsx",lineNumber:6,columnNumber:3},void 0));
//# sourceMappingURL=index-FBLryFFC.js.map
